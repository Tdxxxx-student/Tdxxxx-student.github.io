{{- define "main" }}

<article class="post-single">
  <!-- å¤´éƒ¨åŒºåŸŸ (èƒŒæ™¯å›¾ + æ ‡é¢˜) -->
  <header class="post-header">
    {{- partial "breadcrumbs.html" . }}
    <h1 class="post-title">
      {{ .Title }}
    </h1>
    {{- if .Description }}
    <div class="post-description">{{ .Description }}</div>
    {{- end }}
    {{- if not (.Param "hideMeta") }}
    <div class="post-meta">
      {{- partial "post_meta.html" . -}}
    </div>
    {{- end }}
  </header>

  <!-- é¡µé¢å¸ƒå±€å®¹å™¨ -->
  <div class="page-layout">
    
    <!-- ä¸­é—´ï¼šæ–‡ç« å¡ç‰‡ -->
    <div class="post-card">
      <!-- ç§»é™¤æ–‡ç« å†…éƒ¨çš„é»˜è®¤ç›®å½• -->
      
      <div class="post-content">
        {{- if not (.Param "disableAnchoredHeadings") }}
        {{- partial "anchored_headings.html" .Content -}}
        {{- else }}{{ .Content }}{{ end }}
      </div>
      
      {{- if .Params.tags }}
      <footer class="post-footer">
        <ul class="post-tags">
          {{- range .Params.tags }}
          <li><a href="{{ "tags/" | absURL }}{{ . | urlize }}">{{ . }}</a></li>
          {{- end }}
        </ul>
      </footer>
      {{- end }}
      
      {{- partial "comments.html" . -}}
    </div>

    <!-- å³ä¾§ï¼šæ‚¬æµ®ç›®å½• (å®Œå…¨ç‹¬ç«‹) -->
    {{- if (.Param "ShowToc") }}
    <aside class="sidebar-right">
      <div class="toc-card">
        <div class="toc-title">
          <span class="toc-icon">ðŸ“–</span> ç›®å½•
        </div>
        <nav id="TableOfContents">
          {{ .TableOfContents }}
        </nav>
      </div>
    </aside>
    {{- end }}

  </div>
</article>

<!-- æ»šåŠ¨ç›‘å¬è„šæœ¬ (ä¿æŒä¸å˜) -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        const id = entry.target.getAttribute('id');
        if (entry.intersectionRatio > 0) {
          document.querySelectorAll('.toc-card li a').forEach(link => {
            link.classList.remove('active');
          });
          const activeLink = document.querySelector(`.toc-card li a[href="#${id}"]`);
          if (activeLink) {
            activeLink.classList.add('active');
          }
        }
      });
    });
    document.querySelectorAll('h1[id], h2[id], h3[id], h4[id]').forEach((section) => {
      observer.observe(section);
    });
  });
</script>

{{- end }}