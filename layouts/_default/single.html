{{- define "main" }}

<div class="main-container">
  
  <!-- é¡¶éƒ¨è£…é¥°èƒŒæ™¯æ¡ (çº¯è£…é¥°ï¼Œä¸æ”¾å†…å®¹) -->
  <div class="top-banner-decoration"></div>

  <!-- é¡µé¢å¸ƒå±€å®¹å™¨ -->
  <div class="page-layout">
    
    <!-- å·¦ä¾§ï¼šæ–‡ç« å¡ç‰‡ (åŒ…å«æ ‡é¢˜ã€ä¿¡æ¯ã€æ­£æ–‡) -->
    <article class="post-card">
      
      <!-- 1. æ ‡é¢˜åŒºåŸŸç§»åˆ°å¡ç‰‡å†…éƒ¨ -->
      <header class="post-header">
        {{- partial "breadcrumbs.html" . }}
        <h1 class="post-title">
          {{ .Title }}
        </h1>
        {{- if .Description }}
        <div class="post-description">{{ .Description }}</div>
        {{- end }}
        {{- if not (.Param "hideMeta") }}
        <div class="post-meta">
          {{- partial "post_meta.html" . -}}
        </div>
        {{- end }}
      </header>

      <!-- 2. æ­£æ–‡åŒºåŸŸ -->
      <div class="post-content">
        {{- if not (.Param "disableAnchoredHeadings") }}
        {{- partial "anchored_headings.html" .Content -}}
        {{- else }}{{ .Content }}{{ end }}
      </div>
      
      <!-- 3. åº•éƒ¨æ ‡ç­¾å’Œè¯„è®º -->
      {{- if .Params.tags }}
      <footer class="post-footer">
        <ul class="post-tags">
          {{- range .Params.tags }}
          <li><a href="{{ "tags/" | absURL }}{{ . | urlize }}">{{ . }}</a></li>
          {{- end }}
        </ul>
      </footer>
      {{- end }}
      
      {{- partial "comments.html" . -}}
    </article>

    <!-- å³ä¾§ï¼šæ‚¬æµ®ç›®å½• (å®Œå…¨ç‹¬ç«‹) -->
    {{- if (.Param "ShowToc") }}
    <aside class="sidebar-right">
      <div class="toc-card">
        <div class="toc-title">
          <span class="toc-icon">ðŸ“–</span> ç›®å½•
        </div>
        <nav id="TableOfContents">
          {{ .TableOfContents }}
        </nav>
      </div>
    </aside>
    {{- end }}

  </div>
</div>

<!-- æ»šåŠ¨ç›‘å¬è„šæœ¬ -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        const id = entry.target.getAttribute('id');
        if (entry.intersectionRatio > 0) {
          document.querySelectorAll('.toc-card li a').forEach(link => {
            link.classList.remove('active');
          });
          const activeLink = document.querySelector(`.toc-card li a[href="#${id}"]`);
          if (activeLink) {
            activeLink.classList.add('active');
          }
        }
      });
    });
    document.querySelectorAll('h1[id], h2[id], h3[id], h4[id]').forEach((section) => {
      observer.observe(section);
    });
  });
</script>

{{- end }}