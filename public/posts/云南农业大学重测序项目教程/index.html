<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>äº‘å—å†œä¸šå¤§å­¦é‡æµ‹åºé¡¹ç›®æ•™ç¨‹ | æˆ‘çš„ç©ºé—´</title>
<meta name="keywords" content="ç¾¤ä½“ç»“æ„åˆ†æ, å˜å¼‚æ£€æµ‹, é‡æµ‹åº, GWAS, QTL-seq">
<meta name="description" content="äº‘å—å†œä¸šå¤§å­¦ äº‘å—ç”Ÿç‰©èµ„æºä¿æŠ¤ä¸åˆ©ç”¨å›½å®¶é‡ç‚¹å®éªŒå®¤
æè¯¦ | 2019 å¹´ 12 æœˆ 31 æ—¥
ç›®å½•

è½¯ä»¶å®‰è£…
å˜å¼‚æ£€æµ‹
ç¾¤ä½“ç»“æ„åˆ†æ
é€‰æ‹©åˆ†æ
GWAS åˆ†æ
QTL-seq åˆ†æ
é™„å½•ï¼šåˆ†ææµç¨‹å›¾

ï¼ˆå…¶ä¸­åŒ…å«äº†ä¸€äº›æˆ‘å¤ç”¨æ—¶å¯èƒ½é‡åˆ°çš„é—®é¢˜å’Œè§£å†³åŠæ³•ï¼Œæ¯”è¾ƒæ··ä¹±ï¼Œç”„åˆ«ä½¿ç”¨ï¼‰">
<meta name="author" content="">
<link rel="canonical" href="https://Tdxxxx-student.github.io/posts/%E4%BA%91%E5%8D%97%E5%86%9C%E4%B8%9A%E5%A4%A7%E5%AD%A6%E9%87%8D%E6%B5%8B%E5%BA%8F%E9%A1%B9%E7%9B%AE%E6%95%99%E7%A8%8B/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.01d35acdbbaa1404939950eac1b15ada4d2a087b51757e85aec3659df639bc28.css" integrity="sha256-AdNazbuqFASTmVDqwbFa2k0qCHtRdX6FrsNlnfY5vCg=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://Tdxxxx-student.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://Tdxxxx-student.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://Tdxxxx-student.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://Tdxxxx-student.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://Tdxxxx-student.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://Tdxxxx-student.github.io/posts/%E4%BA%91%E5%8D%97%E5%86%9C%E4%B8%9A%E5%A4%A7%E5%AD%A6%E9%87%8D%E6%B5%8B%E5%BA%8F%E9%A1%B9%E7%9B%AE%E6%95%99%E7%A8%8B/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><link rel="stylesheet" href="https://Tdxxxx-student.github.io/css/custom.css"><meta property="og:url" content="https://Tdxxxx-student.github.io/posts/%E4%BA%91%E5%8D%97%E5%86%9C%E4%B8%9A%E5%A4%A7%E5%AD%A6%E9%87%8D%E6%B5%8B%E5%BA%8F%E9%A1%B9%E7%9B%AE%E6%95%99%E7%A8%8B/">
  <meta property="og:site_name" content="æˆ‘çš„ç©ºé—´">
  <meta property="og:title" content="äº‘å—å†œä¸šå¤§å­¦é‡æµ‹åºé¡¹ç›®æ•™ç¨‹">
  <meta property="og:description" content="äº‘å—å†œä¸šå¤§å­¦ äº‘å—ç”Ÿç‰©èµ„æºä¿æŠ¤ä¸åˆ©ç”¨å›½å®¶é‡ç‚¹å®éªŒå®¤
æè¯¦ | 2019 å¹´ 12 æœˆ 31 æ—¥
ç›®å½• è½¯ä»¶å®‰è£… å˜å¼‚æ£€æµ‹ ç¾¤ä½“ç»“æ„åˆ†æ é€‰æ‹©åˆ†æ GWAS åˆ†æ QTL-seq åˆ†æ é™„å½•ï¼šåˆ†ææµç¨‹å›¾ ï¼ˆå…¶ä¸­åŒ…å«äº†ä¸€äº›æˆ‘å¤ç”¨æ—¶å¯èƒ½é‡åˆ°çš„é—®é¢˜å’Œè§£å†³åŠæ³•ï¼Œæ¯”è¾ƒæ··ä¹±ï¼Œç”„åˆ«ä½¿ç”¨ï¼‰">
  <meta property="og:locale" content="zh-cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2026-02-03T12:08:55+08:00">
    <meta property="article:modified_time" content="2026-02-03T12:08:55+08:00">
    <meta property="article:tag" content="ç¾¤ä½“ç»“æ„åˆ†æ">
    <meta property="article:tag" content="å˜å¼‚æ£€æµ‹">
    <meta property="article:tag" content="é‡æµ‹åº">
    <meta property="article:tag" content="GWAS">
    <meta property="article:tag" content="QTL-Seq">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="äº‘å—å†œä¸šå¤§å­¦é‡æµ‹åºé¡¹ç›®æ•™ç¨‹">
<meta name="twitter:description" content="äº‘å—å†œä¸šå¤§å­¦ äº‘å—ç”Ÿç‰©èµ„æºä¿æŠ¤ä¸åˆ©ç”¨å›½å®¶é‡ç‚¹å®éªŒå®¤
æè¯¦ | 2019 å¹´ 12 æœˆ 31 æ—¥
ç›®å½•

è½¯ä»¶å®‰è£…
å˜å¼‚æ£€æµ‹
ç¾¤ä½“ç»“æ„åˆ†æ
é€‰æ‹©åˆ†æ
GWAS åˆ†æ
QTL-seq åˆ†æ
é™„å½•ï¼šåˆ†ææµç¨‹å›¾

ï¼ˆå…¶ä¸­åŒ…å«äº†ä¸€äº›æˆ‘å¤ç”¨æ—¶å¯èƒ½é‡åˆ°çš„é—®é¢˜å’Œè§£å†³åŠæ³•ï¼Œæ¯”è¾ƒæ··ä¹±ï¼Œç”„åˆ«ä½¿ç”¨ï¼‰">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://Tdxxxx-student.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "äº‘å—å†œä¸šå¤§å­¦é‡æµ‹åºé¡¹ç›®æ•™ç¨‹",
      "item": "https://Tdxxxx-student.github.io/posts/%E4%BA%91%E5%8D%97%E5%86%9C%E4%B8%9A%E5%A4%A7%E5%AD%A6%E9%87%8D%E6%B5%8B%E5%BA%8F%E9%A1%B9%E7%9B%AE%E6%95%99%E7%A8%8B/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "äº‘å—å†œä¸šå¤§å­¦é‡æµ‹åºé¡¹ç›®æ•™ç¨‹",
  "name": "äº‘å—å†œä¸šå¤§å­¦é‡æµ‹åºé¡¹ç›®æ•™ç¨‹",
  "description": "äº‘å—å†œä¸šå¤§å­¦ äº‘å—ç”Ÿç‰©èµ„æºä¿æŠ¤ä¸åˆ©ç”¨å›½å®¶é‡ç‚¹å®éªŒå®¤\næè¯¦ | 2019 å¹´ 12 æœˆ 31 æ—¥\nç›®å½• è½¯ä»¶å®‰è£… å˜å¼‚æ£€æµ‹ ç¾¤ä½“ç»“æ„åˆ†æ é€‰æ‹©åˆ†æ GWAS åˆ†æ QTL-seq åˆ†æ é™„å½•ï¼šåˆ†ææµç¨‹å›¾ ï¼ˆå…¶ä¸­åŒ…å«äº†ä¸€äº›æˆ‘å¤ç”¨æ—¶å¯èƒ½é‡åˆ°çš„é—®é¢˜å’Œè§£å†³åŠæ³•ï¼Œæ¯”è¾ƒæ··ä¹±ï¼Œç”„åˆ«ä½¿ç”¨ï¼‰\n",
  "keywords": [
    "ç¾¤ä½“ç»“æ„åˆ†æ", "å˜å¼‚æ£€æµ‹", "é‡æµ‹åº", "GWAS", "QTL-seq"
  ],
  "articleBody": "äº‘å—å†œä¸šå¤§å­¦ äº‘å—ç”Ÿç‰©èµ„æºä¿æŠ¤ä¸åˆ©ç”¨å›½å®¶é‡ç‚¹å®éªŒå®¤\næè¯¦ | 2019 å¹´ 12 æœˆ 31 æ—¥\nç›®å½• è½¯ä»¶å®‰è£… å˜å¼‚æ£€æµ‹ ç¾¤ä½“ç»“æ„åˆ†æ é€‰æ‹©åˆ†æ GWAS åˆ†æ QTL-seq åˆ†æ é™„å½•ï¼šåˆ†ææµç¨‹å›¾ ï¼ˆå…¶ä¸­åŒ…å«äº†ä¸€äº›æˆ‘å¤ç”¨æ—¶å¯èƒ½é‡åˆ°çš„é—®é¢˜å’Œè§£å†³åŠæ³•ï¼Œæ¯”è¾ƒæ··ä¹±ï¼Œç”„åˆ«ä½¿ç”¨ï¼‰\nè½¯ä»¶å®‰è£… âš ï¸ æ³¨æ„ï¼šè¯¥éƒ¨åˆ†è½¯ä»¶å¾ˆéš¾ç”¨ conda ç›´æ¥å®‰è£…ï¼Œå®‰è£…æ­¥éª¤æ¯”è¾ƒç‰¹æ®Šã€‚\n1. lumpy-sv ğŸ’¡ lumpy-sv ä¾èµ– Python2.7ï¼Œéœ€åˆ‡æ¢åˆ° py27 ç¯å¢ƒä¸‹è¿›è¡Œå®‰è£…ã€‚\nconda activate py27 git clone --recursive https://github.com/arq5x/lumpy-sv.git cd lumpy-sv make 2. svtyper conda install svtyper 3. cnvnator ğŸ’¡ cnvnator ä¾èµ–äº root è½¯ä»¶åŒ…åŠ samtools è½¯ä»¶åŒ…ï¼ˆåŒ…å« HTSlibï¼‰ï¼Œå› æ­¤å…ˆå®‰è£…ä¾èµ–ã€‚\n3.1 å®‰è£… samtools wget https://github.com/samtools/samtools/releases/download/1.9/samtools-1.9.tar.bz2 tar -xvf samtools-1.9.tar.bz2 cd samtools-1.9/ ./configure make 3.2 å®‰è£… root è½¯ä»¶ # ç›´æ¥ä¸‹è½½åè§£å‹å³å¯ wget https://root.cern/download/root_v6.18.04.Linux-ubuntu18-x86_64-gcc7.4.tar.gz tar -zxvf root_v6.18.04.Linux-ubuntu18-x86_64-gcc7.4.tar.gz 3.3 å®‰è£… cnvnator git clone https://github.com/abyzovlab/CNVnator.git cd CNVnator # é“¾æ¥samtoolsè½¯ä»¶ç›®å½•åˆ°cnvnatorç›®å½• ln -s ../samtools-1.9 ./samtools # åŠ è½½rootè½¯ä»¶åˆ°ç¯å¢ƒå˜é‡ export ROOTSYS=/pub/software/root export PATH=/pub/software/root/bin:$PATH export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$ROOTSYS/lib # å®‰è£…cnvnator make LIBS=\"-lcrypto\" å˜å¼‚æ£€æµ‹ 1. æ„å»ºåŸºå› ç»„ index # åˆ›å»ºè½¯é“¾æ¥ ln -s ../data/genome.fasta ./genome.fasta # for gatk samtools faidx genome.fasta # for bwa bwa index genome.fasta # for picard picard CreateSequenceDictionary R=genome.fasta 2. æ¯”å¯¹æ’åºå»é‡ 2.1 æ¯”å¯¹æ’åº bwa mem -t 2 -R '@RG\\tID:S1\\tSM:S1\\tPL:illumina' \\ ../01.ref/genome.fasta \\ ../data/S1_1.fq.gz ../data/S1_2.fq.gz | \\ /pub/software/samtools/samtools sort -@ 2 -m 1G -o S1.sort.bam - bwa mem -t 2 -R '@RG\\tID:S2\\tSM:S2\\tPL:illumina' \\ ../01.ref/genome.fasta \\ ../data/S2_1.fq.gz ../data/S2_2.fq.gz | \\ /pub/software/samtools/samtools sort -@ 2 -m 1G -o S2.sort.bam - 2.2 å»é™¤é‡å¤ picard -Xmx4g MarkDuplicates \\ I=S1.sort.bam \\ O=S1.sort.rmdup.bam \\ CREATE_INDEX=true \\ REMOVE_DUPLICATES=true \\ M=S1.marked_dup_metrics.txt picard -Xmx4g MarkDuplicates \\ I=S2.sort.bam \\ O=S2.sort.rmdup.bam \\ CREATE_INDEX=true \\ REMOVE_DUPLICATES=true \\ M=S2.marked_dup_metrics.txt 2.3 æ¯”å¯¹ç‡ç»Ÿè®¡ /pub/software/samtools/samtools flagstat S1.sort.bam \u003e S1.sort.bam.flagstat /pub/software/samtools/samtools flagstat S2.sort.bam \u003e S2.sort.bam.flagstat 2.4 æ‰¹é‡æ¯”å¯¹è„šæœ¬ç”Ÿæˆ less ../data/sample.list | awk '{ print \"bwa mem -t 2 -R '\\''@RG\\\\tID:\"$1\"\\\\tSM:\"$1\"\\\\tPL:illumina'\\'' \\ ../01.ref/genome.fasta ../data/\"$1\"_1.fq.gz ../data/\"$1\"_2.fq.gz | \\ /pub/software/samtools/samtools sort -@ 2 -m 1G -o \"$1\".sort.bam -\" }' 3. SNPã€Indel æ£€æµ‹ 3.1 HaplotypeCaller gatk --java-options \"-Xmx10g -Djava.io.tmpdir=./tmp\" HaplotypeCaller \\ -R ../01.ref/genome.fasta \\ -I ../02.mapping/S1.sort.rmdup.bam \\ -ERC GVCF \\ -O S1.g.vcf 1\u003eS1.HC.log 2\u003e\u00261 gatk --java-options \"-Xmx10g -Djava.io.tmpdir=./tmp\" HaplotypeCaller \\ -R ../01.ref/genome.fasta \\ -I ../02.mapping/S2.sort.rmdup.bam \\ -ERC GVCF \\ -O S2.g.vcf 1\u003eS2.HC.log 2\u003e\u00261 3.2 CombineGVCFs ls ./S*.g.vcf \u003e gvcf.list gatk --java-options \"-Xmx4g -Djava.io.tmpdir=./tmp\" CombineGVCFs \\ -R ../01.ref/genome.fasta \\ -V gvcf.list \\ -O all.merge.g.vcf 3.3GenotpeGVCFs gatk --java-options \"-Xmx4g -Djava.io.tmpdir=./tmp\" GenotypeGVCFs \\ -R ../01.ref/genome.fasta \\ --variant all.merge.g.vcf \\ -O all.merge_raw.vcf 3.4 SNP è¿‡æ»¤ # æå–SNP gatk --java-options \"-Xmx4g -Djava.io.tmpdir=./tmp\" SelectVariants \\ -R ../01.ref/genome.fasta \\ -V all.merge_raw.vcf \\ --select-type SNP \\ -O all.raw.snp.vcf # æ ‡è®°è¿‡æ»¤ gatk --java-options \"-Xmx4g -Djava.io.tmpdir=./tmp\" VariantFiltration \\ -R ../01.ref/genome.fasta \\ -V all.raw.snp.vcf \\ --filter-expression \"QD \u003c 2.0 || MQ \u003c 40.0 || FS \u003e 60.0 || SOR \u003e 3.0 || MQRankSum \u003c -12.5 || ReadPosRankSum \u003c -8.0\" \\ --filter-name 'SNP_filter' \\ -O all.filter.snp.vcf # æå–è¿‡æ»¤åçš„SNP gatk --java-options \"-Xmx4g -Djava.io.tmpdir=./tmp\" SelectVariants \\ -R ../01.ref/genome.fasta \\ -V all.filter.snp.vcf \\ --exclude-filtered \\ -O all.filtered.snp.vcf 3.5 InDel è¿‡æ»¤ # æå–InDel gatk --java-options \"-Xmx4g -Djava.io.tmpdir=./tmp\" SelectVariants \\ -R ../01.ref/genome.fasta \\ -V all.merge_raw.vcf \\ --select-type INDEL \\ -O all.raw.indel.vcf # æ ‡è®°è¿‡æ»¤ gatk --java-options \"-Xmx4g -Djava.io.tmpdir=./tmp\" VariantFiltration \\ -R ../01.ref/genome.fasta \\ -V all.raw.indel.vcf \\ --filter-expression \"QD \u003c 2.0 || FS \u003e 200.0 || SOR \u003e 10.0 || MQRankSum \u003c -12.5 || ReadPosRankSum \u003c -8.0\" \\ --filter-name 'INDEL_filter' \\ -O all.filter.indel.vcf # æå–è¿‡æ»¤åçš„InDel gatk --java-options \"-Xmx4g -Djava.io.tmpdir=./tmp\" SelectVariants \\ -R ../01.ref/genome.fasta \\ -V all.filter.indel.vcf \\ --exclude-filtered \\ -O all.filtered.indel.vcf 4. SV æ£€æµ‹ # Step 1: æå– discordants reads /pub/software/samtools/samtools view -b -F 1294 -@ 12 \\ ../02.mapping/S1.sort.rmdup.bam \u003e S1.discordants.bam /pub/software/samtools/samtools view -b -F 1294 -@ 12 \\ ../02.mapping/S2.sort.rmdup.bam \u003e S2.discordants.bam # Step 2: æå– split reads /pub/software/samtools/samtools view -h ../02.mapping/S1.sort.rmdup.bam | \\ /pub/software/lumpy-sv/scripts/extractSplitReads_BwaMem -i stdin | \\ /pub/software/samtools/samtools sort - \u003e S1.splitters.bam /pub/software/samtools/samtools view -h ../02.mapping/S2.sort.rmdup.bam | \\ /pub/software/lumpy-sv/scripts/extractSplitReads_BwaMem -i stdin | \\ /pub/software/samtools/samtools sort - \u003e S2.splitters.bam # Step 3: è¿è¡Œ lumpy /pub/software/lumpy-sv/bin/lumpyexpress \\ -B ../02.mapping/S1.sort.rmdup.bam,../02.mapping/S2.sort.rmdup.bam \\ -S S1.splitters.bam,S2.splitters.bam \\ -D S1.discordants.bam,S2.discordants.bam \\ -o all.sv.lumpy.vcf # Step 4: ä¸ªä½“åŸºå› å‹åˆ†å‹ vcftools --vcf all.sv.lumpy.vcf --indv S1 --recode --recode-INFO-all --out S1 \u0026\u0026 \\ svtyper -i S1.recode.vcf -B ../02.mapping/S1.sort.rmdup.bam -o S1.genotype.vcf vcftools --vcf all.sv.lumpy.vcf --indv S2 --recode --recode-INFO-all --out S2 \u0026\u0026 \\ svtyper -i S2.recode.vcf -B ../02.mapping/S2.sort.rmdup.bam -o S2.genotype.vcf 5. CNV æ£€æµ‹ 5.1 å‡†å¤‡åŸºå› ç»„ # å°†åŸºå› ç»„æ‹†åˆ†ä¸ºå•æ¡æŸ“è‰²ä½“ ln -s ../data/genome.fasta ./genome.fa seqkit split -i ./genome.fa -O split # é‡å‘½åæ–‡ä»¶ ls ./split/genome.id_*.fa | sed 's/./split/genome.id_//' | \\ awk '{print \"mv ./split/genome.id_\"$aa\" ./split/\"$aa}' \u003e mv_name.sh sh mv_name.sh 5.2 è¿è¡Œ cnvnator # è®¾ç½®ç¯å¢ƒå˜é‡ export ROOTSYS=/pub/software/root export PATH=/pub/software/root/bin:$PATH export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$ROOTSYS/lib # é“¾æ¥æ–‡ä»¶ ln -s ../02.mapping/S1.sort.rmdup.bam # æå–æ¯”å¯¹ç»“æœ /pub/software/CNVnator/cnvnator -genome genome.fa -root S1.root -tree S1.sort.rmdup.bam # ç”Ÿæˆæ·±åº¦åˆ†å¸ƒ /pub/software/CNVnator/cnvnator -genome genome.fa -root S1.root -his 500 -d split # è¿›è¡Œç»Ÿè®¡è®¡ç®— /pub/software/CNVnator/cnvnator -root S1.root -stat 500 # æ£€æŸ¥bin sizeæ˜¯å¦åˆé€‚ /pub/software/CNVnator/cnvnator -root S1.root -eval 500 \u003e S1.eval.ratio # RDä¿¡å·åˆ†å‰² /pub/software/CNVnator/cnvnator -root S1.root -partition 500 # è¿›è¡ŒCNVæ£€æµ‹ /pub/software/CNVnator/cnvnator -root S1.root -call 500 \u003e S1.cnv 6. SNP/InDel æ³¨é‡Š 6.1 å‡†å¤‡æ³¨é‡Šæ•°æ®åº“ ln -s ../data/genome.gtf ln -s ../data/genome.fasta gtfToGenePred -genePredExt genome.gtf genome_refGene.txt /pub/software/annovar/retrieve_seq_from_fasta.pl \\ --format refGene \\ --seqfile genome.fasta \\ genome_refGene.txt \\ --out genome_refGeneMrna.fa 6.2 æ³¨é‡Š VCF æ–‡ä»¶ ln -s ../03.SNP_indel/all.filtered.snp.vcf # æ ¼å¼è½¬æ¢ /pub/software/annovar/convert2annovar.pl \\ -format vcf4old \\ all.filtered.snp.vcf \u003e all.snp.vcf.annovar.input # è¿›è¡Œæ³¨é‡Š /pub/software/annovar/annotate_variation.pl \\ -geneanno \\ --neargene 2000 \\ -buildver genome \\ -dbtype refGene \\ -outfile all.anno \\ -exonsort \\ all.snp.vcf.annovar.input ./ 7. CNV å’Œ SV æ³¨é‡Š # å¤„ç†SVæ–‡ä»¶ less -S ../04.SV/all.sv.lumpy.vcf | \\ awk -F \";\" '{ if($1!~/#/){print $1\"\\t\"$2\"\\t\"$3\"\\t\"$4} }' | \\ awk '{print $1\"\\t\"$2\"\\t\"$11\"\\t\"$3\"\\t\"$8}' | \\ sed 's/END=//' | sed 's/SVTYPE=//' \u003e SV.bed # è¿‡æ»¤BNDç±»å‹ awk '$5 !~ /BND/' SV.bed \u003e SV_filter.bed # SVæ³¨é‡Š bedtools intersect -wo -a SV_filter.bed -b gene.gtf \u003e SV_filter.Anno # å¤„ç†CNVæ–‡ä»¶ less -S ../05.CNV/S1.cnv | \\ awk '{print $2 \"\\t\" $1}' | \\ sed 's/:/\\t/' | sed 's/-/\\t/' \u003e CNV.bed # CNVæ³¨é‡Š bedtools intersect -wo -a CNV.bed -b gene.gtf \u003e CNV.Anno ç¾¤ä½“ç»“æ„åˆ†æ 1. æ•°æ®è¿‡æ»¤ vcf=../data/all.vcf # è¿‡æ»¤ç¼ºå¤±ç‡å’Œæœ€å°ç­‰ä½åŸºå› é¢‘ç‡ plink --vcf $vcf \\ --geno 0.1 \\ --maf 0.01 \\ --out all.missing_maf \\ --recode vcf-iid \\ --allow-extra-chr \\ --set-missing-var-ids @:# \\ --keep-allele-order # è¿‡æ»¤è¿é”ä¸å¹³è¡¡ plink --vcf all.missing_maf.vcf \\ --indep-pairwise 50 10 0.2 \\ --out tmp.ld \\ --allow-extra-chr \\ --set-missing-var-ids @:# plink --vcf all.missing_maf.vcf \\ --make-bed \\ --extract tmp.ld.prune.in \\ --out all.LDfilter \\ --recode vcf-iid \\ --keep-allele-order \\ --allow-extra-chr \\ --set-missing-var-ids @:# 2. å»ºæ ‘åˆ†æ 2.1 NJ æ ‘ # ä¸‹è½½ git clone https://gitcode.com/gh_mirrors/vc/vcf2phylip # 1 æ ¼å¼è½¬æ¢ï¼ˆnewï¼‰ /home2/xtc/pub/vcf2phylip/vcf2phylip.py -i all.LDfilter.vcf -o phylip_file # 2 æˆ–ä½¿ç”¨seqtk seqtk subseq reference.fasta region_list.txt \u003e alignment.fasta # åŸºæœ¬åˆ†æ iqtree -s phylip_file -m GTR+G -bb 1000 -nt AUTO # å‚æ•°è¯´æ˜ï¼š # -s: è¾“å…¥æ–‡ä»¶ï¼ˆPHYLIPæˆ–FASTAæ ¼å¼ï¼‰ # -m: æ›¿ä»£æ¨¡å‹ï¼ˆGTR+Gå¸¸ç”¨ï¼Œæˆ–ä½¿ç”¨MFPè®©è½¯ä»¶è‡ªåŠ¨é€‰æ‹©ï¼‰ # -bb: è‡ªä¸¾é‡å¤æ¬¡æ•°ï¼ˆ1000ä¸ºæ ‡å‡†ï¼‰ # -nt: çº¿ç¨‹æ•°ï¼ˆAUTOè‡ªåŠ¨æ£€æµ‹ï¼‰ # è¾“å‡ºæ–‡ä»¶ï¼š # - *.treefile: æœ€ä½³ç³»ç»Ÿå‘è‚²æ ‘ï¼ˆNewickæ ¼å¼ï¼‰ # - *.log: è¿è¡Œæ—¥å¿— # - *.iqtree: è¯¦ç»†ç»“æœ # 3 æ ¼å¼è½¬æ¢ï¼ˆæ›´æ–°ç”¨pyè„šæœ¬ï¼‰ #----------------------------------------------------------------------------- # æ ¼å¼è½¬æ¢ perl ../../script/vcf2phy.pl ../../00.filter/all.LDfilter.vcf \u003e sequences.dat # è®¡ç®—é—ä¼ è·ç¦» echo -e \"sequences.dat\\nY\" \u003e dnadist.cfg dnadist \u003c dnadist.cfg \u003e dnadist.log mv outfile infile.dist # æ„å»ºNJæ ‘ echo -e \"infile.dist\\nY\" \u003e neighbor.cfg neighbor \u003c neighbor.cfg \u003e nj.log # æ ¼å¼æ•´ç† less infile.dist | tr '\\n' '|' | sed 's/| / /g' | tr '|' '\\n' \u003e infile.dist.table less outtree | tr '\\n' ' ' | sed 's/ //g' \u003e outtree.nwk 2.2 SNPhylo å»ºæ ‘ï¼ˆæ…¢ï¼‰ /pub/software/SNPhylo/snphylo.sh \\ -v ../../00.filter/all.LDfilter.vcf \\ -r \\ -l 1 \\ -m 0.01 \\ -o GA0001 \\ -b \\ -B 2 \\ -P tree_snphylo treefileæ–‡ä»¶è®©å¦‚ITOLç”»è¿›åŒ–æ ‘ï¼ŒåŒæ—¶æ ¹æ®éœ€æ±‚è¿›è¡Œç¾åŒ–ï¼Œä¸Šä¼ æ³¨é‡Šæ–‡ä»¶ã€‚\n# itol_colorstrip.txt ,ç»™ä¸åŒç§ç¾¤å¤–åœˆæ·»åŠ é¢œè‰²åŒºåˆ† DATASET_COLORSTRIP SEPARATOR TAB DATASET_LABEL\tpopulation COLOR\t#000000 STRIP_WIDTH\t50 LEGEND_TITLE\tPopulation LEGEND_SHAPES\t1\t1 LEGEND_COLORS\t#377EB8\t#E41A1C LEGEND_LABELS\tCultivated\tWild DATA C01\t#377EB8\tCultivated C02\t#377EB8\tCultivated C08\t#377EB8\tCultivated C12\t#377EB8\tCultivated C14\t#377EB8\tCultivated C16\t#377EB8\tCultivated C17\t#377EB8\tCultivated C19\t#377EB8\tCultivated C24\t#377EB8\tCultivated C27\t#377EB8\tCultivated C30\t#377EB8\tCultivated C33\t#377EB8\tCultivated C34\t#377EB8\tCultivated C35\t#377EB8\tCultivated W01\t#E41A1C\tWild W02\t#E41A1C\tWild W03\t#E41A1C\tWild W04\t#E41A1C\tWild W05\t#E41A1C\tWild W06\t#E41A1C\tWild W07\t#E41A1C\tWild W08\t#E41A1C\tWild W09\t#E41A1C\tWild W10\t#E41A1C\tWild W11\t#E41A1C\tWild W12\t#E41A1C\tWild W13\t#E41A1C\tWild W14\t#E41A1C\tWild W15\t#E41A1C\tWild W16\t#E41A1C\tWild W17\t#E41A1C\tWild itol_branch_colors.txt ,åˆ†æ”¯æ ‡ç­¾é¢œè‰² TREE_COLORS SEPARATOR TAB DATA C01\tbranch\t#377EB8\tnormal\t2 C01\tlabel\t#377EB8\tnormal\t1 C02\tbranch\t#377EB8\tnormal\t2 C02\tlabel\t#377EB8\tnormal\t1 C08\tbranch\t#377EB8\tnormal\t2 C08\tlabel\t#377EB8\tnormal\t1 C12\tbranch\t#377EB8\tnormal\t2 C12\tlabel\t#377EB8\tnormal\t1 C14\tbranch\t#377EB8\tnormal\t2 C14\tlabel\t#377EB8\tnormal\t1 C16\tbranch\t#377EB8\tnormal\t2 C16\tlabel\t#377EB8\tnormal\t1 C17\tbranch\t#377EB8\tnormal\t2 C17\tlabel\t#377EB8\tnormal\t1 C19\tbranch\t#377EB8\tnormal\t2 C19\tlabel\t#377EB8\tnormal\t1 C24\tbranch\t#377EB8\tnormal\t2 C24\tlabel\t#377EB8\tnormal\t1 C27\tbranch\t#377EB8\tnormal\t2 C27\tlabel\t#377EB8\tnormal\t1 C30\tbranch\t#377EB8\tnormal\t2 C30\tlabel\t#377EB8\tnormal\t1 C33\tbranch\t#377EB8\tnormal\t2 C33\tlabel\t#377EB8\tnormal\t1 C34\tbranch\t#377EB8\tnormal\t2 C34\tlabel\t#377EB8\tnormal\t1 C35\tbranch\t#377EB8\tnormal\t2 C35\tlabel\t#377EB8\tnormal\t1 W01\tbranch\t#E41A1C\tnormal\t2 W01\tlabel\t#E41A1C\tnormal\t1 W02\tbranch\t#E41A1C\tnormal\t2 W02\tlabel\t#E41A1C\tnormal\t1 W03\tbranch\t#E41A1C\tnormal\t2 W03\tlabel\t#E41A1C\tnormal\t1 W04\tbranch\t#E41A1C\tnormal\t2 W04\tlabel\t#E41A1C\tnormal\t1 W05\tbranch\t#E41A1C\tnormal\t2 W05\tlabel\t#E41A1C\tnormal\t1 W06\tbranch\t#E41A1C\tnormal\t2 W06\tlabel\t#E41A1C\tnormal\t1 W07\tbranch\t#E41A1C\tnormal\t2 W07\tlabel\t#E41A1C\tnormal\t1 W08\tbranch\t#E41A1C\tnormal\t2 W08\tlabel\t#E41A1C\tnormal\t1 W09\tbranch\t#E41A1C\tnormal\t2 W09\tlabel\t#E41A1C\tnormal\t1 W10\tbranch\t#E41A1C\tnormal\t2 W10\tlabel\t#E41A1C\tnormal\t1 W11\tbranch\t#E41A1C\tnormal\t2 W11\tlabel\t#E41A1C\tnormal\t1 W12\tbranch\t#E41A1C\tnormal\t2 W12\tlabel\t#E41A1C\tnormal\t1 W13\tbranch\t#E41A1C\tnormal\t2 W13\tlabel\t#E41A1C\tnormal\t1 W14\tbranch\t#E41A1C\tnormal\t2 W14\tlabel\t#E41A1C\tnormal\t1 W15\tbranch\t#E41A1C\tnormal\t2 W15\tlabel\t#E41A1C\tnormal\t1 W16\tbranch\t#E41A1C\tnormal\t2 W16\tlabel\t#E41A1C\tnormal\t1 W17\tbranch\t#E41A1C\tnormal\t2 W17\tlabel\t#E41A1C\tnormal\t1 3. PCA åˆ†æ plink --vcf ../00.filter/all.LDfilter.vcf \\ --pca 10 \\ --out PCA_out \\ --allow-extra-chr \\ --set-missing-var-ids @:# # Rç»˜å›¾ Rscript ../script/draw_PCA.R PCA_out.eigenvec 1 2 ../data/sample.pop PCA_out_figure 4. ç¾¤ä½“ç»“æ„åˆ†æ # Step 0: vcfè½¬bedæ ¼å¼ plink --vcf ../00.filter/all.LDfilter.vcf \\ --make-bed \\ --out all \\ --allow-extra-chr \\ --keep-allele-order \\ --set-missing-var-ids @:# # è½¬æ¢ä¸ºadmixtureæ ¼å¼ï¼ˆped,ä¸ä¼šå‡ºç°æŸ“è‰²ä½“å‘½åæŠ¥é”™ä¸­æ­¢ï¼‰ plink --vcf all.LDfilter.vcf --recode 12 --out all.LDfilter.prune --allow-extra-chr # Step 1: ç”ŸæˆAdmixtureè¿è¡Œè„šæœ¬ seq 2 4 | awk '{print \"admixture --cv -j2 all.bed \"$1\" 1\u003eadmix.\"$1\".log 2\u003e\u00261\"}' \u003e admixture.sh # pedç‰ˆæœ¬ seq 2 10 | awk '{print \"admixture --cv -j4 all.LDfilter.prune.ped \"$1\" 1\u003eadmix.\"$1\".log 2\u003e\u00261\"}' \u003e admixture.sh nohup parallel -j 10 \u003c admixture.sh \u003e admixture.log 2\u003e\u00261 \u0026 grep -h CV *.log | sort -t':' -k2 -n # Step 2: è¿è¡ŒAdmixture sh admixture.sh # ä¹Ÿå¯å•ç‹¬è¿è¡Œï¼ˆè¦æ±‚æ–‡ä»¶ä¸­æŸ“è‰²ä½“å‘½ååªå«æ•°å­—ï¼‰ admixture --cv -j2 all.bed 2 1\u003eadmix.2.log 2\u003e\u00261 admixture --cv -j2 all.bed 3 1\u003eadmix.3.log 2\u003e\u00261 admixture --cv -j2 all.bed 4 1\u003eadmix.4.log 2\u003e\u00261 # S2.1 é€‰æ‹©æœ€ä¼˜åˆ†ç¾¤ # æŸ¥çœ‹äº¤å‰éªŒè¯è¯¯å·® grep -h CV log*.out | sort -t':' -k2 -n # é€‰æ‹©CVè¯¯å·®æœ€å°çš„Kå€¼ï¼Œç»˜å›¾ä»£ç å¦ä½œæ•´ç† # Step 3: ç»˜åˆ¶ç»“æ„å›¾ mkdir result cp ./*.Q result/ Rscript ../script/draw_admixture.R result all.nosex structure # admixtureåˆ†ç¾¤ç»˜å›¾ library(ggsci) library(tidyverse) library(ggthemes) library(pophelper) files \u003c- paste0(\"all.LDfilter.prune.\",2:10,\".Q\") ID \u003c- read.table(\"sample.list\",header = F) slist \u003c- readQ(files = files) for(i in 1:length(slist)){ row.names(slist[[i]]) \u003c- ID[,1] } P1 \u003c- plotQ(slist, imgoutput = \"join\",imgtype = \"pdf\",width = 20,height = 1.2, showindlab = T,useindlab = T,indlabhjust = 0.5,indlabangle = 90, indlabsize = 0.6,sortind = \"all\",sharedindlab = F, panelspacer = 0.02, indlabspacer = 0,indlabcol = \"black\", showtitle = T,titlelab = \"Population Structure\",titlecol = \"black\", titlehjust = 0.5,showsp = T,exportpath=getwd(), sppos = \"left\",splab = paste0(\"K=\",2:10),splabangle = 180,dpi = 600, outputfilename = paste0(\"admixture_barplot\"),units = \"cm\") # å¼•å…¥åˆ†ç»„ä¿¡æ¯ group \u003c- read.table(\"sample.list\",header = F,row.names = 1) #ç¬¬ä¸€åˆ—ä¸ºæ ·å“åï¼Œç¬¬äºŒåˆ—ä¸ºç§ç¾¤åˆ†ç±» P2 \u003c- plotQ(slist,imgoutput = \"join\", imgtype = \"png\", #è¾“å‡ºæ ¼å¼çš„å˜åŒ– height = 1.2,width = 20, showindlab = T,useindlab = T,sharedindlab = T, showtitle = T,titlelab = \"Population Structure\",titlecol = \"black\", showsp = T,sppos = \"left\",splab = paste0(\"K=\",2:10),splabangle = 180, showlegend = F,ordergrp = T,grplab = group, #æ·»åŠ åˆ†ç»„ subsetgrp = LETTERS[1:31], #æ·»åŠ ç»„å dpi = 600, outputfilename = paste0(\"structure_barplot_pop\"),units = \"cm\", exportpath = getwd()) 5. LD è¡°å‡åˆ†æï¼ˆä¸è¦åšLDä¿®å‰ªçš„vcfè¿›è¡Œè®¡ç®—ï¼‰ # Step 1: è®¡ç®—LD(å¯ä¿®æ”¹binå‚æ•°è°ƒæ•´æ›²çº¿å…‰æ»‘ç¨‹åº¦ï¼Œå¯ç»˜åˆ¶æ€»ç¾¤ä½“æˆ–è€…å•ä¸ªç¾¤ä½“) # ä»¥ä¸‹ä¸ºè®¡ç®—å•ä¸ªç¾¤ä½“çš„LDè¡°å‡è·ç¦»ï¼Œäºšç¾¤æ–‡ä»¶ä¸ºä¸€åˆ—è¯¥ç¾¤çš„æ ·å“åã€‚e.g W01 W02ã€‚ã€‚ã€‚ /pub/software/PopLDdecay/bin/PopLDdecay \\ -InVCF ../data/all.vcf \\ -SubPop ../data/pop.SC.table \\ -MaxDist 500 \\ -OutStat pop.SC.stat /pub/software/PopLDdecay/bin/PopLDdecay \\ -InVCF ../data/all.vcf \\ -SubPop ../data/pop.YZR.table \\ -MaxDist 500 \\ -OutStat pop.YZR.stat # Step 2: ç»˜åˆ¶å•ç¾¤ä½“LDè¡°å‡å›¾ perl /pub/software/PopLDdecay/bin/Plot_OnePop.pl \\ -inFile pop.SC.stat.gz \\ -output pop.SC.ld perl /pub/software/PopLDdecay/bin/Plot_OnePop.pl \\ -inFile pop.YZR.stat.gz \\ -output pop.YZR.ld # Step 3: ç»˜åˆ¶å¤šç¾¤ä½“LDè¡°å‡å›¾ perl /pub/software/PopLDdecay/bin/Plot_MultiPop.pl \\ -inList ld_stat.list \\ -output ld_stat.multi é€‰æ‹©åˆ†æ 1. Ï€ å’Œ ROD åˆ†æ vcf=../../data/all.vcf window=20000 step=2000 # Step 1: è®¡ç®—piå€¼ vcftools --vcf $vcf \\ --window-pi $window \\ --window-pi-step $step \\ --keep ../../data/pop.SC.table \\ --out ./Pi.pop1 vcftools --vcf $vcf \\ --window-pi $window \\ --window-pi-step $step \\ --keep ../../data/pop.YZR.table \\ --out ./Pi.pop2 # Step 2: è®¡ç®—RODï¼ˆæ²¡æœ‰æä¾›è¯¥è„šæœ¬ï¼Œä¸‹é¢Rè„šæœ¬å·²ç»è®¡ç®—ï¼Œéœ€è¦ä¿å­˜ï¼‰ pi1=Pi.pop1.windowed.pi pi2=Pi.pop2.windowed.pi perl ../../script/merge2pi_ROD.pl $pi1 $pi2 \u003e Pi.ROD (è‡ªç”¨RODåˆ†æè„šæœ¬ï¼Œç½‘ä¸Šæ•°ä¿¡é™¢æä¾›ï¼‰ setwd(\"~/workspace/soybean.project/select.place/\") library(ggplot2) library(tidyr) library(dplyr) library(CMplot) qtile \u003c- 0.95 # åˆ†ä½æ•°é˜ˆå€¼ï¼Œä¾‹å¦‚0.95è¡¨ç¤º95%åˆ†ä½æ•° prefix \u003c- \"outsample\"# è¾“å‡ºæ–‡ä»¶å‰ç¼€ # è¯»å–æ•°æ®ï¼ˆæ›¿æ¢ä¸ºå®é™…æ–‡ä»¶è·¯å¾„ï¼‰ wd \u003c- read.table(\"Pi.pop2_W.windowed.pi\", header = TRUE) # subpop1çš„Piæ•°æ® cd \u003c- read.table(\"Pi.pop1_C.windowed.pi\", header = TRUE) # subpop2çš„Piæ•°æ® # æ•°æ®å¤„ç†ï¼šåˆå¹¶IDå¹¶è¿›è¡Œå†…è¿æ¥ # åŸå§‹æ•°æ®åˆ—ååº”ä¸ºï¼šCHROM BIN_START BIN_END N_VARIANTS PI wd1 \u003c- unite(wd, ID, CHROM, BIN_START, BIN_END, sep = \":\", remove = TRUE) cd1 \u003c- unite(cd, ID, CHROM, BIN_START, BIN_END, sep = \":\", remove = TRUE) wild_cult \u003c- inner_join(wd1, cd1, by = \"ID\") # è®¡ç®—RODå’ŒPiæ¯”ç‡ wild_cult \u003c- wild_cult %\u003e% mutate( rod = 1 - PI.y / PI.x, # ROD = 1 - (subpop2çš„Pi / subpop1çš„Pi) pi_ratio1 = PI.x / PI.y, # subpop1çš„Pi / subpop2çš„Pi pi_ratio2 = PI.y / PI.x # subpop2çš„Pi / subpop1çš„Pi ) %\u003e% separate(ID, c(\"chr\", \"start\", \"end\"), sep = \":\") %\u003e% unite(ID, chr, start, sep = \":\", remove = FALSE) # RODç»˜å›¾ { # è®¡ç®—RODçš„é˜ˆå€¼ï¼ˆæŒ‡å®šåˆ†ä½æ•°ï¼‰ rod_cut \u003c- quantile(wild_cult$rod, qtile, na.rm = TRUE) # ç­›é€‰ROD\u003e0çš„æ•°æ®å¹¶ç»˜å›¾ rod_data \u003c- select(wild_cult, ID, chr, start, rod) %\u003e% filter(rod \u003e 0) # ä¿å­˜ä¸ºPDF pdf(paste(prefix, \"ROD.pdf\", sep = \".\"), width = 10, height = 3) CMplot( rod_data, type = \"p\", plot.type = \"m\", LOG10 = FALSE, col = c(\"blue4\", \"orange3\"), cex = 0.2, band = 0.5, ylab.pos = 2.5, cex.axis = 0.8, # è¯¥å‚æ•°ç‰ˆæœ¬ä¸å¯¹åˆ™ä½¿ç”¨ä¸äº†ï¼Œä¼šæŠ¥é”™ threshold = rod_cut, amplify = FALSE, ylab = expr(paste(\"ROD ( 1-\", pi, \"_subpop2/\", pi, \"_subpop1 )\")), file.output = FALSE ) dev.off() # ä¿å­˜ä¸ºPNG png(paste(prefix, \"ROD.png\", sep = \".\"), width = 1000, height = 300) CMplot( rod_data, type = \"p\", plot.type = \"m\", LOG10 = FALSE, col = c(\"blue4\", \"orange3\"), cex = 0.2, band = 0.5, ylab.pos = 2.5, cex.axis = 0.8, # è¯¥å‚æ•°ç‰ˆæœ¬ä¸å¯¹åˆ™ä½¿ç”¨ä¸äº†ï¼Œä¼šæŠ¥é”™ threshold = rod_cut, amplify = FALSE, ylab = expr(paste(\"ROD ( 1-\", pi, \"_subpop2/\", pi, \"_subpop1 )\")), file.output = FALSE ) dev.off() } # Pi_ratio1ç»˜å›¾ï¼ˆsubpop1çš„Pi / subpop2çš„Piï¼‰ { ratio1_cut \u003c- quantile(wild_cult$pi_ratio1, qtile, na.rm = TRUE) ratio1_data \u003c- select(wild_cult, ID, chr, start, pi_ratio1) # PDFæ ¼å¼ pdf(paste(prefix, \"PIratio1.pdf\", sep = \".\"), width = 10, height = 3) CMplot( ratio1_data, type = \"p\", plot.type = \"m\", LOG10 = FALSE, col = c(\"blue4\", \"orange3\"), cex = 0.2, band = 0.5, ylab.pos = 2.5, cex.axis = 0.8, threshold = ratio1_cut, amplify = FALSE, ylab = expr(paste(pi, \"_subpop1/\", pi, \"_subpop2\")), file.output = FALSE ) dev.off() # PNGæ ¼å¼ png(paste(prefix, \"PIratio1.png\", sep = \".\"), width = 1000, height = 300) CMplot( ratio1_data, type = \"p\", plot.type = \"m\", LOG10 = FALSE, col = c(\"blue4\", \"orange3\"), cex = 0.2, band = 0.5, ylab.pos = 2.5, cex.axis = 0.8, threshold = ratio1_cut, amplify = FALSE, ylab = expr(paste(pi, \"_subpop1/\", pi, \"_subpop2\")), file.output = FALSE ) dev.off() } # Pi_ratio2ç»˜å›¾ï¼ˆsubpop2çš„Pi / subpop1çš„Piï¼‰ { ratio2_cut \u003c- quantile(wild_cult$pi_ratio2, qtile, na.rm = TRUE) ratio2_data \u003c- select(wild_cult, ID, chr, start, pi_ratio2) # PDFæ ¼å¼ pdf(paste(prefix, \"PIratio2.pdf\", sep = \".\"), width = 10, height = 3) CMplot( ratio2_data, type = \"p\", plot.type = \"m\", LOG10 = FALSE, col = c(\"blue4\", \"orange3\"), cex = 0.2, band = 0.5, ylab.pos = 2.5, cex.axis = 0.8, threshold = ratio2_cut, amplify = FALSE, ylab = expr(paste(pi, \"_subpop2/\", pi, \"_subpop1\")), file.output = FALSE ) dev.off() # PNGæ ¼å¼ png(paste(prefix, \"PIratio2.png\", sep = \".\"), width = 1000, height = 300) CMplot( ratio2_data, type = \"p\", plot.type = \"m\", LOG10 = FALSE, col = c(\"blue4\", \"orange3\"), cex = 0.2, band = 0.5, ylab.pos = 2.5, cex.axis = 0.8, threshold = ratio2_cut, amplify = FALSE, ylab = expr(paste(pi, \"_subpop2/\", pi, \"_subpop1\")), file.output = FALSE ) dev.off() } # è¾“å‡ºæ±‡æ€»è¡¨æ ¼ outtable \u003c- select(wild_cult, ID, chr, start, end, PI.x, PI.y, rod, pi_ratio1, pi_ratio2) outfile \u003c- paste(prefix, \"ROD_PiRatio.table\", sep = \".\") write.table(outtable, file = outfile, sep = \"\\t\", quote = FALSE, row.names = FALSE) # è¾“å‡ºç»Ÿè®¡é˜ˆå€¼ cutfile \u003c- paste(prefix, \"ROD_PiRatio.cutoff\", sep = \".\") outcut \u003c- data.frame( Iterm = c(\"ROD(1-subpop2/subpop1)\", \"Piratio1(subpop1/subpop2)\", \"Piratio2(subpop2/subpop1)\"), cutoff = c(rod_cut, ratio1_cut, ratio2_cut) ) write.table(outcut, file = cutfile, sep = \"\\t\", quote = FALSE, row.names = FALSE) # ========== å•ç‹¬ä¿å­˜ ROD å€™é€‰åŒºåŸŸ ========== rod_cut \u003c- quantile(wild_cult$rod, qtile, na.rm = TRUE) # ç­›é€‰ ROD è¶…è¿‡é˜ˆå€¼çš„åŒºåŸŸ rod_candidates \u003c- wild_cult %\u003e% filter(rod \u003e rod_cut) %\u003e% select(chr, start, end, PI.x, PI.y, rod) %\u003e% arrange(desc(rod)) # é‡å‘½ååˆ— colnames(rod_candidates) \u003c- c(\"Chr\", \"Start\", \"End\", \"Pi_wild\", \"Pi_cultivated\", \"ROD\") # ä¿å­˜ write.table(rod_candidates, paste0(prefix, \".ROD_candidates.txt\"), row.names = FALSE, quote = FALSE, sep = \"\\t\") 2. Tajimaâ€™s D åˆ†æ vcf=../../data/all.vcf window=20000 vcftools --vcf $vcf \\ --TajimaD $window \\ --keep ../../data/pop.SC.table \\ --out TajimaD.pop1 vcftools --vcf $vcf \\ --TajimaD $window \\ --keep ../../data/pop.YZR.table \\ --out TajimaD.pop2 3. Fst åˆ†æï¼ˆè‹¥è¾“å…¥vcf.gz,å‚æ•°ä¿®æ”¹ä¸ºâ€“gzvcfï¼‰ vcf=../../data/all.vcf window=20000 step=2000 vcftools --vcf $vcf \\ --fst-window-size $window \\ --fst-window-step $step \\ --weir-fst-pop ../../data/pop.SC.table \\ --weir-fst-pop ../../data/pop.YZR.table \\ --out ./Fst.pop1.pop2 library(ggplot2) # ä½¿ç”¨çª—å£æ–‡ä»¶ç»˜å›¾ fst_data \u003c- read.table(\"../select.place/Fst.popC.popW.windowed.weir.fst\", header=TRUE) head(fst_data) # CHROM BIN_START BIN_END N_VARIANTS WEIGHTED_FST MEAN_FST ggplot(fst_data, aes(x=BIN_START/1000000, y=WEIGHTED_FST)) + geom_point(size=0.5, alpha=0.6, color=\"steelblue\") + geom_hline(yintercept=0.15, linetype=\"dashed\", color=\"red\") + facet_wrap(~CHROM, scales=\"free_x\", ncol=4) + labs(x=\"Position (Mb)\", y=\"FST\", title=\"Genome-wide FST (Cultivated vs Wild)\") + theme_bw() + theme(strip.text = element_text(size=8)) ggsave(\"FST_plot.pdf\", width=12, height=8) ggsave(\"FST_plot.png\", width=12, height=8, dpi=300) 4. ROD + Fst è”åˆåˆ†æ fst=../03.Fst/Fst.pop1.pop2.windowed.weir.fst ROD=../01.pi_ROD/Pi.ROD gff=../../data/genome.gff # æå–æ˜¾è‘—ä½ç‚¹ perl ../../script/top_Fst_ROD_S.pl $fst $ROD 0.05 0.05 Fst_ROD.table Fst_ROD.stat # ç­›é€‰topä½ç‚¹ awk '$NF==\"top\"' Fst_ROD.table \u003e Fst_ROD.table.top # æå–åŸºå› æ³¨é‡Š awk '$3==\"gene\"' $gff \u003e gene.gff # æ³¨é‡Šå€™é€‰åŸºå›  bedtools intersect -wo -F 0.1 -a Fst_ROD.table.top -b gene.gff | \\ awk -F \"\\t\" '{print $7\"\\t\"$10\"\\t\"$11\"\\t\"$13\"\\t\"$15}' | \\ sort -u \u003e Fst_ROD.table.top.gene 5. Fst+tajimaD+Pi # å‡†å¤‡Piã€TajimaD ã€Fst åˆ†æçš„ç»“æœæ–‡ä»¶ cat all.list Fst Fst.subpop.windowed.weir.fst Pi_subpop1 subpop1.windowed.pi Pi_subpop2 subpop2.windowed.pi TajimaD_sub1 TajimaD.subpop1.Tajima.D TajimaD_sub2 TajimaD.subpop2.Tajima.D # ç»˜å›¾ # åŠ è½½æ‰€éœ€åº“ library(ggplot2) library(tidyr) library(dplyr) # å®šä¹‰å‚æ•° input \u003c- \"all.list\"# æ›¿æ¢ä¸ºä½ çš„file.listæ–‡ä»¶è·¯å¾„ chrname \u003c- \"Chr01\" # æ›¿æ¢ä¸ºä½ è¦åˆ†æçš„æŸ“è‰²ä½“åç§° p_start \u003c- 2000000 # æ›¿æ¢ä¸ºèµ·å§‹ä½ç½® p_end \u003c- 4000000 # æ›¿æ¢ä¸ºç»“æŸä½ç½® prefix \u003c- \"output\" # æ›¿æ¢ä¸ºè¾“å‡ºæ–‡ä»¶å‰ç¼€ # è¯»å–æ–‡ä»¶åˆ—è¡¨ flist \u003c- read.table(input, header = FALSE) # åˆå§‹åŒ–æ•°æ®æ¡† alldata \u003c- data.frame() # å¾ªç¯è¯»å–å¹¶å¤„ç†æ¯ä¸ªæ–‡ä»¶ for(i in 1:nrow(flist)){ type \u003c- flist[i, 1] data \u003c- read.table(flist[i, 2], header = TRUE) # æå–ç¬¬ä¸€åˆ—æŸ“è‰²ä½“ï¼Œç¬¬äºŒåˆ—èµ·å§‹ä½ç½®ï¼Œæœ€åä¸€åˆ—å€¼ data_f \u003c- data[, c(1, 2, ncol(data))] # ä¿®æ”¹åˆ—å colnames(data_f) \u003c- c(\"chr\", \"start\", \"val\") # æŒ‰ä½ç½®ä¿¡æ¯è¿‡æ»¤æ•°æ® data_f \u003c- data_f %\u003e% dplyr::filter(chr == chrname \u0026 start \u003e p_start \u0026 start \u003c p_end) # æ·»åŠ æ•°æ®æ¥æº data_f \u003c- mutate(data_f, type = rep(type, nrow(data_f))) # åˆå¹¶æˆä¸€ä¸ªè¡¨æ ¼ alldata \u003c- rbind(alldata, data_f) } # æ•°æ®å¤„ç† alldata_f \u003c- tidyr::separate(alldata, type, c(\"TP\", \"pop\"), sep = \"_\") alldata_f$val[which(alldata_f$TP == \"Fst\" \u0026 alldata_f$val \u003c 0)] \u003c- 0 # åˆ›å»ºç»˜å›¾ p \u003c- ggplot(alldata_f, aes(x = start/1000000, y = val, color = pop)) + geom_point(cex = 1) + geom_smooth(method = \"loess\", span = 0.25, cex = 0.5, se = FALSE) + scale_x_continuous(expand = c(0, 0)) + theme_bw() + # è®¾ç½®ä¸»é¢˜ facet_wrap(~TP, scales = \"free_y\", ncol = 1, strip.position = \"left\") + theme( strip.background = element_blank(), # å»é™¤æ ‡é¢˜èƒŒæ™¯ strip.text.x = element_blank(), # å»é™¤è½´title strip.placement = \"outside\", axis.title.x = element_blank(), # å»é™¤æ¨ªè½´title axis.title.y = element_blank(), # å»é™¤yè½´title panel.spacing.y = unit(0, \"lines\"), # å»é™¤é—´è· legend.title = element_blank(), # å»é™¤legend title panel.grid.major = element_blank(), # å»é™¤ç½‘æ ¼ panel.grid.minor = element_blank() # å»é™¤ç½‘æ ¼ ) print(p) # ä¿å­˜PDFæ–‡ä»¶ pdf(paste(prefix, \"combine_figure.pdf\", sep = \".\"), width = 5, height = 4) print(p) dev.off() 6 Fst+Rod (å°è¯•å€ŸåŠ©aiå¼¥è¡¥ä¸Šå…å¾—Perlè„šæœ¬) #!/usr/bin/perl use strict; use warnings; # æ£€æŸ¥è¾“å…¥å‚æ•° die \"Usage: $0 \\n\" unless @ARGV == 6; # è§£æå‚æ•° my ($fst_file, $rod_file, $fst_pct, $rod_pct, $out_table, $out_stat) = @ARGV; # -------------------------- å¤„ç†Fstæ–‡ä»¶ -------------------------- my (%fst_data, @fst_values); open my $fst_fh, '\u003c', $fst_file or die \"æ— æ³•æ‰“å¼€Fstæ–‡ä»¶: $!\"; my $fst_header = \u003c$fst_fh\u003e; # è·³è¿‡è¡¨å¤´ while (my $line = \u003c$fst_fh\u003e) { chomp $line; my @cols = split /\\t/, $line; my ($chr, $start, $end, $fst) = @cols[0,1,2,5]; # Fståœ¨weir.fstç¬¬6åˆ—ï¼ˆç´¢å¼•5ï¼‰ # è¿‡æ»¤æ— æ•ˆå€¼ next if $fst eq 'NA' || $fst =~ /NaN/ || $fst == -1 || $fst \u003e 1; # ç»Ÿä¸€æŸ“è‰²ä½“å‘½åï¼ˆåŒ¹é…RODæ–‡ä»¶çš„chræ ¼å¼ï¼šglyma.Wm82.gnm6.Gm01ï¼‰ $fst_data{\"$chr:$start:$end\"} = $fst; push @fst_values, $fst; } close $fst_fh; # è®¡ç®—Fst topé˜ˆå€¼ï¼ˆé™åºæ’åºï¼‰ @fst_values = sort {$b \u003c=\u003e $a} @fst_values; my $fst_top_idx = int(scalar(@fst_values) * $fst_pct); my $fst_cutoff = $fst_values[$fst_top_idx] // 0; # -------------------------- å¤„ç†RODæ–‡ä»¶ï¼ˆé€‚é…ä½ çš„æ ¼å¼ï¼‰ -------------------------- my (%rod_data, @rod_values); open my $rod_fh, '\u003c', $rod_file or die \"æ— æ³•æ‰“å¼€RODæ–‡ä»¶: $!\"; my $rod_header = \u003c$rod_fh\u003e; # è·³è¿‡è¡¨å¤´ while (my $line = \u003c$rod_fh\u003e) { chomp $line; my @cols = split /\\t/, $line; # é€‚é…ä½ çš„æ–‡ä»¶ï¼šchr(1), start(2), end(3), rod(6) my ($chr, $start, $end, $rod) = @cols[1,2,3,6]; # è¿‡æ»¤æ— æ•ˆ/å¼‚å¸¸å€¼ï¼ˆRODå€¼èŒƒå›´0~1ï¼‰ next if $rod eq 'NA' || $rod =~ /NaN/ || $rod \u003c 0 || $rod \u003e 1; $rod_data{\"$chr:$start:$end\"} = $rod; push @rod_values, $rod; } close $rod_fh; # è®¡ç®—ROD topé˜ˆå€¼ï¼ˆé™åºæ’åºï¼‰ @rod_values = sort {$b \u003c=\u003e $a} @rod_values; my $rod_top_idx = int(scalar(@rod_values) * $rod_pct); my $rod_cutoff = $rod_values[$rod_top_idx] // 0; # -------------------------- è¾“å‡ºç»“æœè¡¨æ ¼ -------------------------- open my $table_fh, '\u003e', $out_table or die \"æ— æ³•å†™å…¥è¡¨æ ¼: $!\"; print $table_fh join(\"\\t\", qw/Chr Start End Fst ROD Status/), \"\\n\"; my ($total_top, $total_sites) = (0, 0); foreach my $key (keys %fst_data) { my ($chr, $start, $end) = split /:/, $key; my $fst_val = $fst_data{$key}; my $rod_val = $rod_data{$key} // 'NA'; my $status = 'normal'; # ä»…å½“ä¸¤ä¸ªå€¼éƒ½è¾¾æ ‡æ—¶æ ‡è®°ä¸ºtop if ($fst_val \u003e= $fst_cutoff \u0026\u0026 $rod_val ne 'NA' \u0026\u0026 $rod_val \u003e= $rod_cutoff) { $status = 'top'; $total_top++; } print $table_fh join(\"\\t\", $chr, $start, $end, $fst_val, $rod_val, $status), \"\\n\"; $total_sites++; } close $table_fh; # -------------------------- è¾“å‡ºç»Ÿè®¡æ–‡ä»¶ -------------------------- open my $stat_fh, '\u003e', $out_stat or die \"æ— æ³•å†™å…¥ç»Ÿè®¡æ–‡ä»¶: $!\"; my $top_ratio = $total_sites \u003e 0 ? sprintf(\"%.4f\", $total_top/$total_sites) : \"0.0000\"; print $stat_fh \u003c\u003c\"STAT\"; # Fst + ROD è”åˆåˆ†æç»Ÿè®¡ Fstæ–‡ä»¶: $fst_file RODæ–‡ä»¶: $rod_file Fst top $fst_pct é˜ˆå€¼: $fst_cutoff ROD top $rod_pct é˜ˆå€¼: $rod_cutoff æ€»æœ‰æ•ˆä½ç‚¹æ•°é‡: $total_sites Topæ˜¾è‘—ä½ç‚¹æ•°é‡: $total_top Topä½ç‚¹å æ¯”: $top_ratio STAT close $stat_fh; # è¿è¡Œæç¤º print \"åˆ†æå®Œæˆï¼\\n\"; print \"ç»“æœè¡¨æ ¼: $out_table\\nç»Ÿè®¡æ–‡ä»¶: $out_stat\\n\"; print \"Fsté˜ˆå€¼: $fst_cutoff | RODé˜ˆå€¼: $rod_cutoff | Topä½ç‚¹: $total_top\\n\"; ROD_piæ–‡ä»¶æ ¼å¼ï¼Œè¦ä¸perlç´¢å¼•åˆ—å¯¹åº”\nID\tchr\tstart\tend\tPI.x\tPI.y\trod\tpi_ratio1\tpi_ratio2 # è”åˆFST RODåˆ†æ fst=Fst.popC.popW.windowed.weir.fst ROD=outsample.ROD_PiRatio.table gff=Wm82.gnm6.gff3 # æå–æ˜¾è‘—ä½ç‚¹ perl ~/pub/script/top_Fst_ROD_S.pl $fst $ROD 0.05 0.05 Fst_ROD.table Fst_ROD.stat # ç­›é€‰topä½ç‚¹ awk '$NF==\"top\"' Fst_ROD.table \u003e Fst_ROD.table.top # æå–åŸºå› æ³¨é‡Š awk '$3==\"gene\"' $gff \u003e gene.gff # æ³¨é‡Šå€™é€‰åŸºå›  bedtools intersect -wo -F 0.1 -a Fst_ROD.table.top -b gene.gff | \\ awk -F \"\\t\" '{print $7\"\\t\"$10\"\\t\"$11\"\\t\"$13\"\\t\"$15}' | \\ sort -u \u003e Fst_ROD.table.top.gene GWAS åˆ†æ 1. åŸºå› å‹å¡«å…… beagle -Xmx4g -Djava.io.tmpdir=./TMP \\ gt=../data/all.vcf \\ out=all.impute \\ impute=true \\ window=10 \\ nthreads=2 2. æ ‡å‡† GWAS åˆ†æ # Step 1: å‡†å¤‡VCFæ•°æ® plink --vcf ../data/all.vcf \\ --maf 0.05 \\ --geno 0.1 \\ --recode12 \\ --output-missing-genotype 0 \\ --transpose \\ --out snp_filter \\ --set-missing-var-ids @:# \\ --allow-extra-chr # å‡†å¤‡è¡¨å‹æ•°æ® perl ../script/sort_pheno.pl snp_filter.tfam ../data/trait.table \u003e trait.sort.txt # Step 2: è®¡ç®—äº²ç¼˜å…³ç³»çŸ©é˜µ /pub/software/emmax/emmax-kin-intel64 -v -d 10 -o ./pop.kinship snp_filter # Step 3: è¿è¡ŒGWAS /pub/software/emmax/emmax-intel64 -v -d 10 \\ -t snp_filter \\ -p trait.sort.txt \\ -k pop.kinship \\ -o emmax.out 1\u003e emmax.log 2\u003eemmax.err # Step 4: ç»˜åˆ¶æ›¼å“ˆé¡¿å›¾ paste snp_filter.map emmax.out.ps | \\ awk 'BEGIN{print \"SNP\\tCHR\\tBP\\tP\"}{if($2==$5){print $2\"\\t\"$1\"\\t\"$4\"\\t\"$NF}}' \\ \u003e emmax.out.ps.manht_input Rscript ../script/manhattan.R emmax.out.ps.manht_input emmax.out.ps.manht_figure 3. GWAS-Q åˆ†æï¼ˆåŠ å…¥ç¾¤ä½“ç»“æ„åå˜é‡ï¼‰ # é“¾æ¥æ–‡ä»¶ ln -s ../01.GWAS/snp_filter.tped ln -s ../01.GWAS/snp_filter.tfam ln -s ../01.GWAS/snp_filter.nosex ln -s ../01.GWAS/snp_filter.map ln -s ../01.GWAS/trait.sort.txt ln -s ../../02.population_genetics/03.structure/all.3.Q # å‡†å¤‡QçŸ©é˜µ paste snp_filter.nosex all.3.Q | awk '{print $1\" \"$1\" 1 \"$3\" \"$4}' \u003e pop.Qmatrix # è¿è¡ŒGWAS /pub/software/emmax/emmax-intel64 -v -d 10 \\ -t snp_filter \\ -p trait.sort.txt \\ -k pop.kinship \\ -c pop.Qmatrix \\ -o emmax.out 1\u003e emmax.log 2\u003eemmax.err # ç»˜åˆ¶æ›¼å“ˆé¡¿å›¾ paste snp_filter.map emmax.out.ps | \\ awk 'BEGIN{print \"SNP\\tCHR\\tBP\\tP\"}{if($2==$5){print $2\"\\t\"$1\"\\t\"$4\"\\t\"$NF}}' \\ \u003e emmax.out.ps.manht_input Rscript ../script/manhattan.R emmax.out.ps.manht_input emmax.out.ps.manht_figure_Q 4. çœŸå®æ•°æ® GWAS # Step 1: å‡†å¤‡æ•°æ® plink --vcf ../data_real/Sample215.M5M8H3.2allel.vcf \\ --maf 0.05 \\ --geno 0.1 \\ --recode12 \\ --output-missing-genotype 0 \\ --transpose \\ --out snp_filter \\ --set-missing-var-ids @:# \\ --allow-extra-chr perl ../script/sort_pheno.pl snp_filter.tfam ../data_real/trait.C16_0.table \u003e trait.sort.txt # Step 2: è®¡ç®—äº²ç¼˜å…³ç³»çŸ©é˜µ /pub/software/emmax/emmax-kin-intel64 -v -d 10 -o ./pop.kinship snp_filter # Step 3: è¿è¡ŒGWAS /pub/software/emmax/emmax-intel64 -v -d 10 \\ -t snp_filter \\ -p trait.sort.txt \\ -k pop.kinship \\ -o emmax.out 1\u003e emmax.log 2\u003eemmax.err # Step 4: ç»˜åˆ¶æ›¼å“ˆé¡¿å›¾ paste snp_filter.map emmax.out.ps | \\ awk 'BEGIN{print \"SNP\\tCHR\\tBP\\tP\"}{if($2==$5){print $2\"\\t\"$1\"\\t\"$4\"\\t\"$NF}}' \\ \u003e emmax.out.ps.manht_input Rscript ../script/manhattan.R emmax.out.ps.manht_input emmax.out.ps.manht_figure_readData QTL-seq åˆ†æ 1. VCF è½¬æ¢ä¸º Table æ ¼å¼ ref= vcf= outfile= gatk VariantsToTable \\ -R $ref \\ -V $vcf \\ -F CHROM -F POS -F REF -F ALT \\ -GF AD -GF DP -GF GQ -GF PL \\ -O $outfile 2. QTL-seq åˆ†æï¼ˆR è„šæœ¬ï¼‰ library(QTLseqr) library(ggplot2) # è®¾ç½®å‚æ•° HighBulk \u003c- \"SRR834931\" # é«˜å€¼æ··æ± åç§° LowBulk \u003c- \"SRR834927\" # ä½å€¼æ··æ± åç§° Chroms \u003c- paste0(rep(\"Chr\", 12), 1:12) # æŸ“è‰²ä½“åˆ—è¡¨ # ==================== æ•°æ®è¯»å– ==================== df \u003c- importFromGATK( file = \"../data/Yang_et_al_2013.table\", highBulk = HighBulk, lowBulk = LowBulk, chromList = Chroms ) # ==================== è´¨é‡æ£€æŸ¥å›¾ ==================== # æ·±åº¦åˆ†å¸ƒå›¾ p1 \u003c- ggplot(data = df) + geom_histogram(aes(x = DP.HIGH + DP.LOW)) + xlim(0, 800) pdf(file = \"SNP_depth.pdf\") p1 dev.off() # REFç­‰ä½åŸºå› é¢‘ç‡åˆ†å¸ƒ p2 \u003c- ggplot(data = df) + geom_histogram(aes(x = REF_FRQ)) pdf(file = \"ref_allele_frequency.pdf\") p2 dev.off() # é«˜å€¼æ··æ± SNP-indexåˆ†å¸ƒ p3 \u003c- ggplot(data = df) + geom_histogram(aes(x = SNPindex.HIGH)) pdf(file = \"SNPindex.HIGH.dis.pdf\") p3 dev.off() # ä½å€¼æ··æ± SNP-indexåˆ†å¸ƒ p4 \u003c- ggplot(data = df) + geom_histogram(aes(x = SNPindex.LOW)) pdf(file = \"SNPindex.LOW.dis.pdf\") p4 dev.off() # ==================== SNPè¿‡æ»¤ ==================== df_filt \u003c- filterSNPs( SNPset = df, refAlleleFreq = 0.20, # REFç­‰ä½åŸºå› é¢‘ç‡: 0.2~0.8 minTotalDepth = 100, # æœ€å°æ€»æ·±åº¦ maxTotalDepth = 400, # æœ€å¤§æ€»æ·±åº¦ minSampleDepth = 40, # å•æ ·å“æœ€å°æ·±åº¦ minGQ = 99, # åŸºå› å‹è´¨é‡é˜ˆå€¼ verbose = TRUE ) # ==================== deltaSNPindexè®¡ç®— ==================== df_filt \u003c- runQTLseqAnalysis( df_filt, windowSize = 1e6, # çª—å£å¤§å° popStruc = \"F2\", # ç¾¤ä½“ç±»å‹ bulkSize = c(385, 430), # æ··æ± ä¸ªä½“æ•° replications = 10000, # Bootstrapæ¬¡æ•° intervals = c(95, 99) # ç½®ä¿¡åŒºé—´ ) # ==================== ç»“æœå¯è§†åŒ– ==================== # SNPæ²¿æŸ“è‰²ä½“åˆ†å¸ƒ p5 \u003c- plotQTLStats(SNPset = df_filt, var = \"nSNPs\") pdf(file = \"SNP_filter.window.pdf\", width = 20, height = 4) p5 dev.off() # deltaSNPindexæ²¿æŸ“è‰²ä½“åˆ†å¸ƒ p6 \u003c- plotQTLStats( SNPset = df_filt, var = \"deltaSNP\", plotIntervals = TRUE ) pdf(file = \"deltaSNPindex.pdf\", width = 20, height = 4) p6 dev.off() # ==================== æå–æ˜¾è‘—åŒºåŸŸ ==================== QTL \u003c- getSigRegions( SNPset = df_filt, method = \"QTLseq\", interval = 95 ) write.table(QTL[[1]], \"QTLseq_result.SigRegions.table\", sep = \"\\t\", quote = FALSE) # ==================== å¯¼å‡ºå®Œæ•´ç»“æœ ==================== results99 \u003c- getQTLTable( SNPset = df_filt, method = \"QTLseq\", interval = 99, export = FALSE ) write.table( results99, file = \"QTLseq_result_deltaSNPindex_CI99.table\", sep = \"\\t\", quote = FALSE ) é™„å½•ï¼šåˆ†ææµç¨‹å›¾ åŸå§‹æ•°æ® (FASTQ) â”‚ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ è´¨é‡æ§åˆ¶ QC â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ æ¯”å¯¹ Mapping â”‚ â”€â”€â–º BWA MEM â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ å»é‡ MarkDup â”‚ â”€â”€â–º Picard â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â–¼ â–¼ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ SNP/InDel â”‚ â”‚ SV â”‚ â”‚ CNV â”‚ â”‚ GATK â”‚ â”‚ lumpy-sv â”‚ â”‚ CNVnator â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ æ³¨é‡Š â”‚ â”‚ ANNOVAR/bedtoolsâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â–¼ â–¼ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ ç¾¤ä½“ç»“æ„ â”‚ â”‚ é€‰æ‹©åˆ†æ â”‚ â”‚ GWAS â”‚ â”‚ PCA/Tree â”‚ â”‚ Fst/Ï€/D â”‚ â”‚ EMMAX â”‚ â”‚ Structure â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ å¸¸è§çš„æ»‘åŠ¨çª—å£å¤§å°è®¾ç½® ä¸€ã€å¸¸ç”¨çª—å£å¤§å° çª—å£å¤§å°\té€‚ç”¨åœºæ™¯ 10 kb\tç²¾ç»†å®šä½ï¼Œå°åŸºå› ç»„ 20 kb\tè¾ƒå¸¸ç”¨ï¼Œé€‚ä¸­ 50 kb\tå¸¸ç”¨ï¼Œå¹³è¡¡ç²¾åº¦å’Œå™ªéŸ³ 100 kb\tæœ€å¸¸ç”¨ï¼Œå¤§åŸºå› ç»„ï¼ˆå¦‚å¤§è±†ï¼‰ 200 kb\tç²—ç•¥æ‰«æï¼Œè¶…å¤§åŸºå› ç»„ äºŒã€çª—å£å¤§å°å–å†³äºä»€ä¹ˆï¼Ÿ 1. åŸºå› ç»„å¤§å° ç‰©ç§\tåŸºå› ç»„å¤§å°\tå»ºè®®çª—å£ æ‹Ÿå—èŠ¥\t~135 Mb\t10-20 kb æ°´ç¨»\t~430 Mb\t50-100 kb å¤§è±†\t~1.1 Gb\t50-100 kb ç‰ç±³\t~2.3 Gb\t100-200 kb å°éº¦\t~17 Gb\t200-500 kb ä¸‰ã€ä¸åŒåˆ†æçš„çª—å£å»ºè®®ï¼ˆå¤§è±†ï¼‰ åˆ†æ\tå»ºè®®çª—å£\tæ­¥é•¿ Tajima's D\t100 kb\t- Ï€ï¼ˆæ ¸è‹·é…¸å¤šæ ·æ€§ï¼‰\t100 kb\t10 kb Fst\t100 kb\t10 kb ROD\t100 kb\t10 kb é€‰æ‹©æ¶ˆé™¤ï¼ˆXP-CLRï¼‰\t50-100 kb\t10 kb é€‰æ‹©åˆ†æï¼ˆå¯é€‰ï¼‰ XP-CLR (è·¨ç¾¤ä½“å¤åˆä¼¼ç„¶æ¯”æ£€éªŒ) # å®‰è£…xpclr conda create -n xpclr_env python=3.11 scipy=1.11.4 numpy -y conda activate xpclr_env mamba install xpclr # è½¬æ¢vcf2xpclræ ¼å¼ vcftools --vcf filtered_all.vcf.gz \\ --freq \\ --out allele_freq # æ–‡ä»¶å‡†å¤‡ï¼š #1.vcfæ–‡ä»¶ bgzip -c all.missing_maf.vcf \u003e all.missing_maf.vcf.gz echo \"Building index...\" tabix -p vcf all.missing_maf.vcf.gz #2.ä¸¤ä¸ªè¦æ¯”è¾ƒç¾¤ä½“çš„æ ·æœ¬idçš„txtæ–‡ä»¶ #è®¡ç®—ï¼šåŸæ–¹æ³•è®¡ç®—å¤ªæ…¢ #!/bin/bash RAW_VCF=\"all.missing_maf.vcf\" WILD=\"W.sample.list\" CULT=\"C.sample.list\" OUTDIR=\"./xpclr_results\" VCFDIR=\"./vcf_by_chr\" BCFTOOLS_THREADS=4 SPLIT_PARALLEL=10 XPCLR_PARALLEL=10 mkdir -p \"$OUTDIR\" \"$VCFDIR\" # ===== ç¬¬é›¶æ­¥ï¼šè¿‡æ»¤åªä¿ç•™åŒç­‰ä½SNP + å‹ç¼©å»ºç´¢å¼• ===== SNP_VCF=\"all.snps_only.vcf.gz\" if [ ! -f \"$SNP_VCF\" ]; then echo \"[Step 0] Filtering: keep biallelic SNPs only...\" bcftools view \"$RAW_VCF\" \\ --types snps \\ -m2 -M2 \\ --threads $BCFTOOLS_THREADS \\ -Oz -o \"$SNP_VCF\" tabix -p vcf \"$SNP_VCF\" # ç»Ÿè®¡ raw_count=$(bcftools view -H \"$RAW_VCF\" | wc -l) snp_count=$(bcftools view -H \"$SNP_VCF\" | wc -l) indel_count=$((raw_count - snp_count)) echo \" è¿‡æ»¤å‰æ€»å˜å¼‚: $raw_count\" echo \" å»æ‰ indel/å¤šç­‰ä½: $indel_count\" echo \" ä¿ç•™ SNP: $snp_count\" else echo \"[Step 0] $SNP_VCF already exists, skipping...\" fi echo \"============================================\" VCF=\"$SNP_VCF\" # ===== ç¬¬ä¸€æ­¥ï¼šè·å–æŸ“è‰²ä½“åˆ—è¡¨ ===== chromosomes=$(bcftools view -h \"$VCF\" | grep '^##contig' | sed 's/.*ID=\\([^,\u003e]*\\).*/\\1/') echo \"Chromosomes found:\" echo \"$chromosomes\" echo \"============================================\" # ===== ç¬¬äºŒæ­¥ï¼šå¹¶è¡Œæ‹†åˆ†VCF ===== echo \"[Step 1] Splitting VCF by chromosome...\" echo \" bcftools threads per task: $BCFTOOLS_THREADS\" echo \" parallel tasks: $SPLIT_PARALLEL\" echo \"============================================\" while IFS= read -r chr; do [ -z \"$chr\" ] \u0026\u0026 continue if [ -f \"${VCFDIR}/${chr}.vcf.gz\" ] \u0026\u0026 [ -f \"${VCFDIR}/${chr}.vcf.gz.tbi\" ]; then echo \" $chr already exists, skipping...\" continue fi ( echo \" Splitting $chr ...\" bcftools view \\ -r \"$chr\" \\ --threads $BCFTOOLS_THREADS \\ \"$VCF\" \\ -Oz -o \"${VCFDIR}/${chr}.vcf.gz\" tabix -p vcf \"${VCFDIR}/${chr}.vcf.gz\" echo \" âœ“ $chr split done\" ) \u0026 while [ $(jobs -rp | wc -l) -ge $SPLIT_PARALLEL ]; do sleep 2 done done \u003c\u003c\u003c \"$chromosomes\" wait echo \"[Step 1] All chromosomes split!\" echo \"============================================\" # ===== éªŒè¯æ‹†åˆ†ç»“æœ ===== echo \"Verifying split files...\" all_ok=true while IFS= read -r chr; do [ -z \"$chr\" ] \u0026\u0026 continue if [ ! -f \"${VCFDIR}/${chr}.vcf.gz\" ]; then echo \" ERROR: ${chr}.vcf.gz missing!\" all_ok=false else snp_count=$(bcftools view -H \"${VCFDIR}/${chr}.vcf.gz\" | wc -l) echo \" âœ“ $chr : $snp_count SNPs\" fi done \u003c\u003c\u003c \"$chromosomes\" if [ \"$all_ok\" = false ]; then echo \"Some files missing! Check errors above.\" exit 1 fi echo \"============================================\" # ===== ç¬¬ä¸‰æ­¥ï¼šå¹¶è¡Œè¿è¡Œ xpclr ===== echo \"[Step 2] Running XPCLR in parallel...\" echo \" parallel tasks: $XPCLR_PARALLEL\" echo \"============================================\" while IFS= read -r chr; do [ -z \"$chr\" ] \u0026\u0026 continue if [ -f \"${OUTDIR}/xpclr_${chr}.out\" ] \u0026\u0026 [ -s \"${OUTDIR}/xpclr_${chr}.out\" ]; then echo \" $chr already completed, skipping...\" continue fi ( echo \" [$(date '+%H:%M:%S')] Starting $chr ...\" xpclr \\ --out \"${OUTDIR}/xpclr_${chr}.out\" \\ --format vcf \\ --input \"${VCFDIR}/${chr}.vcf.gz\" \\ --samplesA \"$WILD\" \\ --samplesB \"$CULT\" \\ --size 100000 \\ --step 50000 \\ --chr \"$chr\" \\ 2\u003e\"${OUTDIR}/xpclr_${chr}.log\" echo \" [$(date '+%H:%M:%S')] âœ“ $chr completed\" ) \u0026 while [ $(jobs -rp | wc -l) -ge $XPCLR_PARALLEL ]; do sleep 10 done done \u003c\u003c\u003c \"$chromosomes\" wait echo \"[Step 2] All XPCLR runs completed!\" echo \"============================================\" # ===== ç¬¬å››æ­¥ï¼šåˆå¹¶ç»“æœ ===== echo \"[Step 3] Merging results...\" first_chr=$(echo \"$chromosomes\" | head -1) head -1 \"${OUTDIR}/xpclr_${first_chr}.out\" \u003e \"${OUTDIR}/chr_all_C_vs_W.txt\" while IFS= read -r chr; do [ -z \"$chr\" ] \u0026\u0026 continue if [ -f \"${OUTDIR}/xpclr_${chr}.out\" ]; then lines=$(tail -n +2 \"${OUTDIR}/xpclr_${chr}.out\" | wc -l) tail -n +2 \"${OUTDIR}/xpclr_${chr}.out\" \u003e\u003e \"${OUTDIR}/chr_all_C_vs_W.txt\" echo \" $chr : $lines windows\" else echo \" WARNING: $chr result missing!\" fi done \u003c\u003c\u003c \"$chromosomes\" total=$(tail -n +2 \"${OUTDIR}/chr_all_C_vs_W.txt\" | wc -l) echo \"============================================\" echo \"Done! Total windows: $total\" echo \"Output: ${OUTDIR}/chr_all_C_vs_W.txt\" # å¯è§†åŒ–ä»£ç ï¼š library(dplyr) library(ggplot2) # ======== 1. è¯»å–åˆå¹¶åçš„å•ä¸ªç»“æœæ–‡ä»¶ ======== df \u003c- read.delim(\"xpclr_results/chr_all_C_vs_W.txt\", header = TRUE, stringsAsFactors = FALSE) # ======== 2. æŸ¥çœ‹å®é™…åˆ—åï¼ˆé¦–æ¬¡è¿è¡Œæ—¶å–æ¶ˆæ³¨é‡Šç¡®è®¤ï¼‰ ======== cat(\"åˆ—åï¼š\", colnames(df), \"\\n\") head(df) # ======== 3. ç»Ÿä¸€åˆ—åï¼ˆxpclr è¾“å‡ºåˆ—åé€šå¸¸æ˜¯ chrom/start/stop/xpclrï¼‰ ======== # å¦‚æœä½ çš„åˆ—åä¸åŒï¼Œæ ¹æ®ä¸Šé¢ cat è¾“å‡ºä¿®æ”¹è¿™é‡Œ if (\"chrom\" %in% colnames(df)) df \u003c- df %\u003e% rename(chr = chrom) if (\"start\" %in% colnames(df)) df \u003c- df %\u003e% rename(pos_start = start) if (\"stop\" %in% colnames(df)) df \u003c- df %\u003e% rename(pos_stop = stop) # å¦‚æœ xpclr åˆ—åæ˜¯ xpclr_scoreï¼š if (\"xpclr_score\" %in% colnames(df)) df \u003c- df %\u003e% rename(xpclr = xpclr_score) # ======== 4. æ•°æ®æ¸…æ´— ======== df \u003c- df %\u003e% mutate(xpclr = ifelse(is.na(xpclr) | xpclr \u003c= 0, NA, xpclr)) %\u003e% filter(!is.na(xpclr)) %\u003e% mutate(pos_center = (pos_start + pos_stop) / 2) # ======== 5. æŸ“è‰²ä½“æ’åºï¼ˆè‡ªåŠ¨ä»æ•°æ®ä¸­è·å–ï¼Œè€Œéç¡¬ç¼–ç ï¼‰ ======== # æå–æŸ“è‰²ä½“ç¼–å·ä¸­çš„æ•°å­—éƒ¨åˆ†è¿›è¡Œè‡ªç„¶æ’åº chr_levels \u003c- df %\u003e% distinct(chr) %\u003e% mutate(chr_num = as.numeric(gsub(\"\\\\D\", \"\", chr))) %\u003e% arrange(chr_num) %\u003e% pull(chr) df$chr \u003c- factor(df$chr, levels = chr_levels) # ======== 6. è®¡ç®—ç´¯ç§¯åæ ‡ ======== data_cum \u003c- df %\u003e% group_by(chr) %\u003e% summarise(chr_len = max(pos_center)) %\u003e% mutate(tot = cumsum(as.numeric(chr_len)) - chr_len) %\u003e% select(-chr_len) df \u003c- left_join(df, data_cum, by = \"chr\") %\u003e% mutate(pos_cum = pos_center + tot) # ======== 7. é˜ˆå€¼ ======== threshold \u003c- quantile(df$xpclr, 0.95, na.rm = TRUE) # ======== 8. åæ ‡è½´æ ‡ç­¾ ======== axis_df \u003c- df %\u003e% group_by(chr) %\u003e% summarize(center = (max(pos_cum) + min(pos_cum)) / 2) # ======== 9. é¢œè‰²ï¼ˆæ ¹æ®å®é™…æŸ“è‰²ä½“æ•°é‡è‡ªåŠ¨ç”Ÿæˆï¼‰ ======== n_chr \u003c- length(chr_levels) chr_colors \u003c- rep(c(\"#d7191c\", \"#2c7bb6\"), length.out = n_chr) # ======== 10. ç»˜å›¾ ======== p \u003c- ggplot(df, aes(x = pos_cum, y = xpclr, color = chr)) + geom_line(linewidth = 0.5) + # æ³¨æ„ï¼šæ–°ç‰ˆggplot2ç”¨linewidthæ›¿ä»£size scale_color_manual(values = chr_colors) + geom_hline(yintercept = threshold, linetype = \"dashed\", color = \"black\", alpha = 0.7) + scale_x_continuous(label = axis_df$chr, breaks = axis_df$center) + labs( x = \"Chromosome\", y = \"XP-CLR Score\", subtitle = paste0(\"Dashed line: 95th percentile threshold (\", round(threshold, 2), \")\") ) + theme_minimal(base_size = 12) + theme( legend.position = \"none\", plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\"), panel.grid.minor = element_blank(), panel.grid.major.x = element_blank(), axis.text.x = element_text(angle = 45, hjust = 1) # Xè½´æ ‡ç­¾æ—‹è½¬ ) # ======== 11. ä¿å­˜ ======== ggsave(\"xpclr_manhattan.pdf\", p, width = 14, height = 5) ggsave(\"xpclr_manhattan.png\", p, width = 14, height = 5, dpi = 300) print(p) # xpclr æºç çš„å·²çŸ¥bugï¼Œéœ€è¦ç›´æ¥ä¿®æ”¹æºç  --- Logging error --- Traceback (most recent call last): File \"/home2/xtc/.conda/envs/xpclr_env/lib/python3.11/logging/init.py\", line 1110, in emit msg = self.format(record) ^^^^^^^^^^^^^^^^^^^ File \"/home2/xtc/.conda/envs/xpclr_env/lib/python3.11/logging/init.py\", line 953, in format return fmt.format(record) ^^^^^^^^^^^^^^^^^^ File \"/home2/xtc/.conda/envs/xpclr_env/lib/python3.11/logging/init.py\", line 687, in format record.message = record.getMessage() ^^^^^^^^^^^^^^^^^^^ File \"/home2/xtc/.conda/envs/xpclr_env/lib/python3.11/logging/init.py\", line 377, in getMessage msg = msg % self.args ~~~~^~~~~~~~~~~ TypeError: not all arguments converted during string formatting Call stack: File \"/home2/xtc/.conda/envs/xpclr_env/bin/xpclr\", line 196, in main() File \"/home2/xtc/.conda/envs/xpclr_env/bin/xpclr\", line 182, in main model_lik, null_lik, selcoef, nsnps, navail, snpedges = xpclr.methods.xpclr_scan( File \"/home2/xtc/.conda/envs/xpclr_env/lib/python3.11/site-packages/xpclr/methods.py\", line 333, in xpclr_scan li_data[i] = compute_xpclr(window_data, sel_coefs) File \"/home2/xtc/.conda/envs/xpclr_env/lib/python3.11/site-packages/xpclr/methods.py\", line 225, in compute_xpclr ll = calculate_cl_romberg(s_coef, dat) File \"/home2/xtc/.conda/envs/xpclr_env/lib/python3.11/site-packages/xpclr/methods.py\", line 204, in calculate_cl_romberg cl = calculate_likelihood(values=(xj, nj, c, p2freq, var)) File \"/home2/xtc/.conda/envs/xpclr_env/lib/python3.11/site-packages/xpclr/methods.py\", line 137, in chen_likelihood logger.warning(w[-1].message, i_likl, i_base) Message: DeprecationWarning('Conversion of an array with ndim \u003e 0 to a scalar is deprecated, and will error in future. Ensure you extract a single element from your array before performing this operation. (Deprecated NumPy 1.25.)') Arguments: ((0.050147255182536286, 4.2684261388273304e-07, {'neval': 63, 'last': 2, 'iord': array([ 1, 2, 5, 4, 3,ã€‚ã€‚ã€‚ã€‚ # ä¸€é”®ä¿®å¤ # æ‰¾åˆ°æ–‡ä»¶ METHODS_FILE=\"/home2/xtc/.conda/envs/xpclr_env/lib/python3.11/site-packages/xpclr/methods.py\" # å¤‡ä»½ cp \"$METHODS_FILE\" \"${METHODS_FILE}.bak\" # ä¿®å¤ç¬¬137è¡Œ sed -i 's/logger.warning(w\\[-1\\].message, i_likl, i_base)/logger.warning(f\"{w[-1].message} | likl={i_likl}, base={i_base}\")/' \"$METHODS_FILE\" éªŒè¯æ˜¯å¦ä¿®æ”¹æˆåŠŸ grep -n \"logger.warning\" \"$METHODS_FILE\" #åº”è¯¥çœ‹åˆ°ï¼š 137: logger.warning(f\"{w[-1].message} | likl={i_likl}, base={i_base}\") # åŸå› è§£é‡Š # åŸä»£ç ï¼ˆæœ‰bugï¼‰ï¼š logger.warning(w[-1].message, i_likl, i_base) # â†‘ è¿™ä¸ªå­—ç¬¦ä¸²é‡Œæ²¡æœ‰ %s å ä½ç¬¦ï¼Œå´ä¼ äº†ä¸¤ä¸ªå‚æ•° â†’ TypeError # ä¿®å¤åï¼š logger.warning(f\"{w[-1].message} | likl={i_likl}, base={i_base}\") # â†‘ ç”¨ f-string æŠŠæ‰€æœ‰å‚æ•°æ‹¼è¿›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸å†æœ‰å¤šä½™å‚æ•° XP-EHHï¼ˆæ›´åŠ å¿«é€Ÿç®€ä¾¿çš„æ–¹æ³•åœ¨8000é‡æµ‹åºæ–‡ç« ä¸­æœ‰ï¼‰ # æ‹†åˆ†vcfæ–‡ä»¶ä¸ºä¸åŒç¾¤ä½“ cat ../chr.list | while read chr; do echo \"vcftools --gzvcf ${chr}.vcf.gz --keep ../W.sample.list --recode --recode-INFO-all --out W.${chr}.missmaf\" \u003e\u003e split.chr.vcf.sh; done # åŸºå› å‹å¡«å…… cat ../chr.list | while read chr; do echo \"java -Xmx10g -jar /home2/xtc/.conda/envs/xpehh/share/beagle-5.5_27Feb25.75f-0/beagle.jar nthreads=4 ne=30 gt=W.${chr}.missmaf.recode.vcf out=W_${chr}.phasing.recode\" \u003e\u003e W.beagle.sh; done cat ../chr.list | while read chr; do echo \"java -Xmx10g -jar /home2/xtc/.conda/envs/xpehh/share/beagle-5.5_27Feb25.75f-0/beagle.jar nthreads=4 ne=30 gt=C.${chr}.missmaf.recode.vcf out=C_${chr}.phasing.recode\" \u003e\u003e C.beagle.sh; done nohup parallel -j 5 --joblog Wbeagle_progress.log \u003c W.beagle.sh \u003e beagle_W.log 2\u003e\u00261 \u0026 nohup parallel -j 5 --joblog Cbeagle_progress.log \u003c C.beagle.sh \u003e beagle_C.log 2\u003e\u00261 \u0026 # è½¬æ¢æ ¼å¼ mkdir -p ./xpehh_result for i in {01..20}; do vcftools --gzvcf \"W_glyma.Wm82.gnm6.Gm${i}.phasing.recode.vcf.gz\" --plink --out ./xpehh_result/W.Gm${i} done for i in {01..20}; do vcftools --gzvcf \"C_glyma.Wm82.gnm6.Gm${i}.phasing.recode.vcf.gz\" --plink --out ./xpehh_result/C.Gm${i}; done è®¡ç®—XP-EHHéœ€è¦è®¡ç®—é—ä¼ è·ç¦»ï¼Œä¸€èˆ¬æ¥è¯´é»˜è®¤ä½¿ç”¨1cM=1Mb,å°†ç¬¬å››åˆ—çš„ç‰©ç†ä½ç½®ä¹˜ä»¥0.000001å³å¯æ¢ç®—æˆé—ä¼ è·ç¦»\nfor i in {01..20}; do awk '{print $1, $2, $4/1000000, $4}' C.Gm${i}.map \u003e C.Gm${i}.genetic.map done for i in {01..20}; do awk '{print $1, $2, $4/1000000, $4}' W.Gm${i}.map \u003e W.Gm${i}.genetic.map done # è®¡ç®— mkdir -p results for i in {01..20}; do selscan --xpehh --vcf ../C_glyma.Wm82.gnm6.Gm${i}.phasing.recode.vcf.gz --vcf-ref ../W_glyma.Wm82.gnm6.Gm${i}.phasing.recode.vcf.gz --map W.Gm${i}.genetic.map --threads 10 --out ./results/C_W_Gm${i} done # è„šæœ¬å½’ä¸€åŒ– https://github.com/Fmaizer/sliding-window-for-xpehh-results ï¼ˆpandas å’Œ tqdmï¼‰ for i in {01..20}; do python norm.py --input C_W_Gm${i}.xpehh.out --window 100000 --step 50000 --chr $i; done # åˆå¹¶æ‰€æœ‰æŸ“è‰²ä½“ç»“æœ awk 'FNR==1 \u0026\u0026 NR!=1{next;}{print}' C_W_Gm*.xpehh.out.norm.100kb.windows \u003e C_W_all.xpehh.out.norm.100kb.windows # ç»˜å›¾ï¼ˆå„æŸ“è‰²ä½“æ•£ç‚¹å›¾ï¼‰ library(ggplot2) # è¯»å–çª—å£æ±‡æ€»æ•°æ® xpehh \u003c- read.table(\"C_W_all.xpehh.out.norm.100kb.windows\", header=TRUE) # æŸ¥çœ‹åˆ—åï¼Œç¡®è®¤å®é™…åç§° colnames(xpehh) # è®¡ç®—çª—å£ä¸­ç‚¹ä½ç½®ï¼ˆç”¨äºç»˜å›¾ï¼‰ xpehh$mid \u003c- (xpehh$win_start + xpehh$win_end) / 2 # ç»˜åˆ¶ XP-EHH æ‰«æå›¾ï¼ˆä½¿ç”¨ mean_normxpehhï¼‰ ggplot(xpehh, aes(x=mid/1000000, y=mean_normxpehh)) + geom_point(size=0.5, alpha=0.6, color=\"steelblue\") + geom_hline(yintercept=0, linetype=\"dashed\", color=\"gray50\") + geom_hline(yintercept=2, linetype=\"dashed\", color=\"red\") + geom_hline(yintercept=-2, linetype=\"dashed\", color=\"blue\") + facet_wrap(~chr, scales=\"free_x\", ncol=4) + labs(x=\"Position (Mb)\", y=\"Mean Normalized XP-EHH\", title=\"XP-EHH Scan (100kb Windows)\") + theme_bw() + theme(axis.text.x = element_text(angle=45, hjust=1)) ggsave(\"chr.W_C.xpehh.pot.png\",width = 10,height = 7,dpi = 300) # è¯†åˆ«æ˜¾è‘—ä¿¡å·ï¼ˆ|mean_normxpehh| \u003e 2ï¼‰ candidates_pos \u003c- xpehh[xpehh$mean_normxpehh \u003e 2, ] candidates_neg \u003c- xpehh[xpehh$mean_normxpehh \u003c -2, ] # ä¿å­˜å€™é€‰åŒºåŸŸ write.table(candidates_pos, \"candidates_positive.txt\", row.names=FALSE, quote=FALSE, sep=\"\\t\") write.table(candidates_neg, \"candidates_negative.txt\", row.names=FALSE, quote=FALSE, sep=\"\\t\") # æŸ¥çœ‹å€™é€‰åŒºåŸŸæ•°é‡ cat(\"æ­£é€‰æ‹©ä¿¡å·çª—å£æ•°:\", nrow(candidates_pos), \"\\n\") cat(\"è´Ÿé€‰æ‹©ä¿¡å·çª—å£æ•°:\", nrow(candidates_neg), \"\\n\") XP_EHH\u003c-read.table(\"C_W_all.xpehh.out.norm.100kb.windows\", header = TRUE, stringsAsFactors = FALSE) XP_EHH$mid\u003c-(XP_EHH$win_start+XP_EHH$win_end)/2 ggplot(XP_EHH, aes(x = mid, y = mean_normxpehh)) + geom_line(linewidth = 0.3,color=\"skyblue\") + theme_minimal()+ theme( text = element_text(family = \"serif\", color = \"black\"), axis.text.x = element_text(angle = 0, color = \"black\", size = 10), axis.text.y = element_text(color = \"black\", size = 10), axis.title.y = element_text(color = \"black\", size = 12), axis.ticks = element_line(size = 0.4, colour = \"black\"), panel.grid.minor = element_blank(), panel.grid.major = element_blank(), panel.border = element_rect(fill = NA, color = \"black\", size = 0.6), plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\"), plot.margin = margin(10, 10, 10, 10), # å°†å›¾ä¾‹ç§»å…¥å›¾å†…ï¼Œå³ä¸‹è§’ legend.position = c(0.95, 0.05), legend.justification = c(\"right\", \"bottom\"), legend.background = element_rect(fill = alpha(\"white\", 0.6), color = NA), legend.key = element_blank()) ggsave(\"all.chr.W_C.xpehh.line.png\",width = 10,height = 7,dpi = 300) ",
  "wordCount" : "9559",
  "inLanguage": "en",
  "datePublished": "2026-02-03T12:08:55+08:00",
  "dateModified": "2026-02-03T12:08:55+08:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://Tdxxxx-student.github.io/posts/%E4%BA%91%E5%8D%97%E5%86%9C%E4%B8%9A%E5%A4%A7%E5%AD%A6%E9%87%8D%E6%B5%8B%E5%BA%8F%E9%A1%B9%E7%9B%AE%E6%95%99%E7%A8%8B/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "æˆ‘çš„ç©ºé—´",
    "logo": {
      "@type": "ImageObject",
      "url": "https://Tdxxxx-student.github.io/favicon.ico"
    }
  }
}
</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://Tdxxxx-student.github.io/" accesskey="h" title="æˆ‘çš„ç©ºé—´ (Alt + H)">æˆ‘çš„ç©ºé—´</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://Tdxxxx-student.github.io/posts/" title="é¦–é¡µ">
                    <span>é¦–é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://Tdxxxx-student.github.io/archives/" title="å½’æ¡£">
                    <span>å½’æ¡£</span>
                </a>
            </li>
            <li>
                <a href="https://Tdxxxx-student.github.io/categories/" title="åˆ†ç±»">
                    <span>åˆ†ç±»</span>
                </a>
            </li>
            <li>
                <a href="https://Tdxxxx-student.github.io/tags/" title="æ ‡ç­¾">
                    <span>æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://Tdxxxx-student.github.io/search/" title="ğŸ”  (Alt &#43; /)" accesskey=/>
                    <span>ğŸ” </span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">


<div id="wide-post-layout" class="post-page-wrapper">
  
  <div class="top-banner-decoration"></div>

  <div class="page-layout">
    
    <article class="post-card">
      <header class="post-header"><div class="breadcrumbs"><a href="https://Tdxxxx-student.github.io/">Home</a>&nbsp;Â»&nbsp;<a href="https://Tdxxxx-student.github.io/posts/">Posts</a></div>
        <h1 class="post-title">äº‘å—å†œä¸šå¤§å­¦é‡æµ‹åºé¡¹ç›®æ•™ç¨‹</h1>
        <div class="post-meta"><span title='2026-02-03 12:08:55 +0800 CST'>2026-02-03</span>&nbsp;Â·&nbsp;<span>20 min</span></div>
      </header>

      <div class="post-content"><p>äº‘å—å†œä¸šå¤§å­¦ äº‘å—ç”Ÿç‰©èµ„æºä¿æŠ¤ä¸åˆ©ç”¨å›½å®¶é‡ç‚¹å®éªŒå®¤</p>
<p>æè¯¦ | 2019 å¹´ 12 æœˆ 31 æ—¥</p>
<h2 id="ç›®å½•">ç›®å½•<a hidden class="anchor" aria-hidden="true" href="#ç›®å½•">#</a></h2>
<ul>
<li><a href="#%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85">è½¯ä»¶å®‰è£…</a></li>
<li><a href="#%E5%8F%98%E5%BC%82%E6%A3%80%E6%B5%8B">å˜å¼‚æ£€æµ‹</a></li>
<li><a href="#%E7%BE%A4%E4%BD%93%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90">ç¾¤ä½“ç»“æ„åˆ†æ</a></li>
<li><a href="#%E9%80%89%E6%8B%A9%E5%88%86%E6%9E%90">é€‰æ‹©åˆ†æ</a></li>
<li><a href="#gwas%E5%88%86%E6%9E%90">GWAS åˆ†æ</a></li>
<li><a href="#qtl-seq%E5%88%86%E6%9E%90">QTL-seq åˆ†æ</a></li>
<li><a href="#%E9%99%84%E5%BD%95%E5%88%86%E6%9E%90%E6%B5%81%E7%A8%8B%E5%9B%BE">é™„å½•ï¼šåˆ†ææµç¨‹å›¾</a></li>
</ul>
<p>ï¼ˆå…¶ä¸­åŒ…å«äº†ä¸€äº›æˆ‘å¤ç”¨æ—¶å¯èƒ½é‡åˆ°çš„é—®é¢˜å’Œè§£å†³åŠæ³•ï¼Œæ¯”è¾ƒæ··ä¹±ï¼Œç”„åˆ«ä½¿ç”¨ï¼‰</p>
<h2 id="è½¯ä»¶å®‰è£…">è½¯ä»¶å®‰è£…<a hidden class="anchor" aria-hidden="true" href="#è½¯ä»¶å®‰è£…">#</a></h2>
<blockquote>
<p>âš ï¸ æ³¨æ„ï¼šè¯¥éƒ¨åˆ†è½¯ä»¶å¾ˆéš¾ç”¨ conda ç›´æ¥å®‰è£…ï¼Œå®‰è£…æ­¥éª¤æ¯”è¾ƒç‰¹æ®Šã€‚</p>
</blockquote>
<h3 id="1-lumpy-sv">1. lumpy-sv<a hidden class="anchor" aria-hidden="true" href="#1-lumpy-sv">#</a></h3>
<p>ğŸ’¡ lumpy-sv ä¾èµ– Python2.7ï¼Œéœ€åˆ‡æ¢åˆ° py27 ç¯å¢ƒä¸‹è¿›è¡Œå®‰è£…ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">conda activate py27
</span></span><span class="line"><span class="cl">git clone --recursive https://github.com/arq5x/lumpy-sv.git
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> lumpy-sv
</span></span><span class="line"><span class="cl">make
</span></span></code></pre></div><h3 id="2-svtyper">2. svtyper<a hidden class="anchor" aria-hidden="true" href="#2-svtyper">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">conda install svtyper
</span></span></code></pre></div><h3 id="3-cnvnator">3. cnvnator<a hidden class="anchor" aria-hidden="true" href="#3-cnvnator">#</a></h3>
<p>ğŸ’¡ cnvnator ä¾èµ–äº root è½¯ä»¶åŒ…åŠ samtools è½¯ä»¶åŒ…ï¼ˆåŒ…å« HTSlibï¼‰ï¼Œå› æ­¤å…ˆå®‰è£…ä¾èµ–ã€‚</p>
<h4 id="31-å®‰è£…-samtools">3.1 å®‰è£… samtools<a hidden class="anchor" aria-hidden="true" href="#31-å®‰è£…-samtools">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">wget https://github.com/samtools/samtools/releases/download/1.9/samtools-1.9.tar.bz2
</span></span><span class="line"><span class="cl">tar -xvf samtools-1.9.tar.bz2
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> samtools-1.9/
</span></span><span class="line"><span class="cl">./configure
</span></span><span class="line"><span class="cl">make
</span></span></code></pre></div><h4 id="32-å®‰è£…-root-è½¯ä»¶">3.2 å®‰è£… root è½¯ä»¶<a hidden class="anchor" aria-hidden="true" href="#32-å®‰è£…-root-è½¯ä»¶">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># ç›´æ¥ä¸‹è½½åè§£å‹å³å¯</span>
</span></span><span class="line"><span class="cl">wget https://root.cern/download/root_v6.18.04.Linux-ubuntu18-x86_64-gcc7.4.tar.gz
</span></span><span class="line"><span class="cl">tar -zxvf root_v6.18.04.Linux-ubuntu18-x86_64-gcc7.4.tar.gz
</span></span></code></pre></div><h4 id="33-å®‰è£…-cnvnator">3.3 å®‰è£… cnvnator<a hidden class="anchor" aria-hidden="true" href="#33-å®‰è£…-cnvnator">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git clone https://github.com/abyzovlab/CNVnator.git
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> CNVnator
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># é“¾æ¥samtoolsè½¯ä»¶ç›®å½•åˆ°cnvnatorç›®å½•</span>
</span></span><span class="line"><span class="cl">ln -s ../samtools-1.9 ./samtools
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åŠ è½½rootè½¯ä»¶åˆ°ç¯å¢ƒå˜é‡</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">ROOTSYS</span><span class="o">=</span>/pub/software/root
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span>/pub/software/root/bin:<span class="nv">$PATH</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LD_LIBRARY_PATH</span>:<span class="nv">$ROOTSYS</span>/lib
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å®‰è£…cnvnator</span>
</span></span><span class="line"><span class="cl">make <span class="nv">LIBS</span><span class="o">=</span><span class="s2">&#34;-lcrypto&#34;</span>
</span></span></code></pre></div><h2 id="å˜å¼‚æ£€æµ‹">å˜å¼‚æ£€æµ‹<a hidden class="anchor" aria-hidden="true" href="#å˜å¼‚æ£€æµ‹">#</a></h2>
<h3 id="1-æ„å»ºåŸºå› ç»„-index">1. æ„å»ºåŸºå› ç»„ index<a hidden class="anchor" aria-hidden="true" href="#1-æ„å»ºåŸºå› ç»„-index">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºè½¯é“¾æ¥</span>
</span></span><span class="line"><span class="cl">ln -s ../data/genome.fasta ./genome.fasta
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># for gatk</span>
</span></span><span class="line"><span class="cl">samtools faidx genome.fasta
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># for bwa</span>
</span></span><span class="line"><span class="cl">bwa index genome.fasta
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># for picard</span>
</span></span><span class="line"><span class="cl">picard CreateSequenceDictionary <span class="nv">R</span><span class="o">=</span>genome.fasta
</span></span></code></pre></div><h3 id="2-æ¯”å¯¹æ’åºå»é‡">2. æ¯”å¯¹æ’åºå»é‡<a hidden class="anchor" aria-hidden="true" href="#2-æ¯”å¯¹æ’åºå»é‡">#</a></h3>
<h4 id="21-æ¯”å¯¹æ’åº">2.1 æ¯”å¯¹æ’åº<a hidden class="anchor" aria-hidden="true" href="#21-æ¯”å¯¹æ’åº">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">bwa mem -t <span class="m">2</span> -R <span class="s1">&#39;@RG\tID:S1\tSM:S1\tPL:illumina&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    ../01.ref/genome.fasta <span class="se">\
</span></span></span><span class="line"><span class="cl">    ../data/S1_1.fq.gz ../data/S1_2.fq.gz <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    /pub/software/samtools/samtools sort -@ <span class="m">2</span> -m 1G -o S1.sort.bam -
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">bwa mem -t <span class="m">2</span> -R <span class="s1">&#39;@RG\tID:S2\tSM:S2\tPL:illumina&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    ../01.ref/genome.fasta <span class="se">\
</span></span></span><span class="line"><span class="cl">    ../data/S2_1.fq.gz ../data/S2_2.fq.gz <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    /pub/software/samtools/samtools sort -@ <span class="m">2</span> -m 1G -o S2.sort.bam -
</span></span></code></pre></div><h4 id="22-å»é™¤é‡å¤">2.2 å»é™¤é‡å¤<a hidden class="anchor" aria-hidden="true" href="#22-å»é™¤é‡å¤">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">picard -Xmx4g MarkDuplicates <span class="se">\
</span></span></span><span class="line"><span class="cl">    <span class="nv">I</span><span class="o">=</span>S1.sort.bam <span class="se">\
</span></span></span><span class="line"><span class="cl">    <span class="nv">O</span><span class="o">=</span>S1.sort.rmdup.bam <span class="se">\
</span></span></span><span class="line"><span class="cl">    <span class="nv">CREATE_INDEX</span><span class="o">=</span><span class="nb">true</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    <span class="nv">REMOVE_DUPLICATES</span><span class="o">=</span><span class="nb">true</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    <span class="nv">M</span><span class="o">=</span>S1.marked_dup_metrics.txt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">picard -Xmx4g MarkDuplicates <span class="se">\
</span></span></span><span class="line"><span class="cl">    <span class="nv">I</span><span class="o">=</span>S2.sort.bam <span class="se">\
</span></span></span><span class="line"><span class="cl">    <span class="nv">O</span><span class="o">=</span>S2.sort.rmdup.bam <span class="se">\
</span></span></span><span class="line"><span class="cl">    <span class="nv">CREATE_INDEX</span><span class="o">=</span><span class="nb">true</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    <span class="nv">REMOVE_DUPLICATES</span><span class="o">=</span><span class="nb">true</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    <span class="nv">M</span><span class="o">=</span>S2.marked_dup_metrics.txt
</span></span></code></pre></div><h4 id="23-æ¯”å¯¹ç‡ç»Ÿè®¡">2.3 æ¯”å¯¹ç‡ç»Ÿè®¡<a hidden class="anchor" aria-hidden="true" href="#23-æ¯”å¯¹ç‡ç»Ÿè®¡">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">/pub/software/samtools/samtools flagstat S1.sort.bam &gt; S1.sort.bam.flagstat
</span></span><span class="line"><span class="cl">/pub/software/samtools/samtools flagstat S2.sort.bam &gt; S2.sort.bam.flagstat
</span></span></code></pre></div><h4 id="24-æ‰¹é‡æ¯”å¯¹è„šæœ¬ç”Ÿæˆ">2.4 æ‰¹é‡æ¯”å¯¹è„šæœ¬ç”Ÿæˆ<a hidden class="anchor" aria-hidden="true" href="#24-æ‰¹é‡æ¯”å¯¹è„šæœ¬ç”Ÿæˆ">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">less ../data/sample.list <span class="p">|</span> awk <span class="s1">&#39;{ 
</span></span></span><span class="line"><span class="cl"><span class="s1">    print &#34;bwa mem -t 2 -R &#39;</span><span class="se">\&#39;</span><span class="s1">&#39;@RG\\tID:&#34;$1&#34;\\tSM:&#34;$1&#34;\\tPL:illumina&#39;</span><span class="se">\&#39;</span><span class="s1">&#39; \
</span></span></span><span class="line"><span class="cl"><span class="s1">    ../01.ref/genome.fasta ../data/&#34;$1&#34;_1.fq.gz ../data/&#34;$1&#34;_2.fq.gz | \
</span></span></span><span class="line"><span class="cl"><span class="s1">    /pub/software/samtools/samtools sort -@ 2 -m 1G -o &#34;$1&#34;.sort.bam -&#34; 
</span></span></span><span class="line"><span class="cl"><span class="s1">}&#39;</span>
</span></span></code></pre></div><h3 id="3-snpindel-æ£€æµ‹">3. SNPã€Indel æ£€æµ‹<a hidden class="anchor" aria-hidden="true" href="#3-snpindel-æ£€æµ‹">#</a></h3>
<h4 id="31-haplotypecaller">3.1 HaplotypeCaller<a hidden class="anchor" aria-hidden="true" href="#31-haplotypecaller">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gatk --java-options <span class="s2">&#34;-Xmx10g -Djava.io.tmpdir=./tmp&#34;</span> HaplotypeCaller <span class="se">\
</span></span></span><span class="line"><span class="cl">    -R ../01.ref/genome.fasta <span class="se">\
</span></span></span><span class="line"><span class="cl">    -I ../02.mapping/S1.sort.rmdup.bam <span class="se">\
</span></span></span><span class="line"><span class="cl">    -ERC GVCF <span class="se">\
</span></span></span><span class="line"><span class="cl">    -O S1.g.vcf 1&gt;S1.HC.log 2&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">gatk --java-options <span class="s2">&#34;-Xmx10g -Djava.io.tmpdir=./tmp&#34;</span> HaplotypeCaller <span class="se">\
</span></span></span><span class="line"><span class="cl">    -R ../01.ref/genome.fasta <span class="se">\
</span></span></span><span class="line"><span class="cl">    -I ../02.mapping/S2.sort.rmdup.bam <span class="se">\
</span></span></span><span class="line"><span class="cl">    -ERC GVCF <span class="se">\
</span></span></span><span class="line"><span class="cl">    -O S2.g.vcf 1&gt;S2.HC.log 2&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span></code></pre></div><h4 id="32-combinegvcfs">3.2 CombineGVCFs<a hidden class="anchor" aria-hidden="true" href="#32-combinegvcfs">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ls ./S*.g.vcf &gt; gvcf.list
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">gatk --java-options <span class="s2">&#34;-Xmx4g -Djava.io.tmpdir=./tmp&#34;</span> CombineGVCFs <span class="se">\
</span></span></span><span class="line"><span class="cl">    -R ../01.ref/genome.fasta <span class="se">\
</span></span></span><span class="line"><span class="cl">    -V gvcf.list <span class="se">\
</span></span></span><span class="line"><span class="cl">    -O all.merge.g.vcf
</span></span></code></pre></div><h4 id="33genotpegvcfs">3.3GenotpeGVCFs<a hidden class="anchor" aria-hidden="true" href="#33genotpegvcfs">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gatk --java-options <span class="s2">&#34;-Xmx4g -Djava.io.tmpdir=./tmp&#34;</span> GenotypeGVCFs <span class="se">\
</span></span></span><span class="line"><span class="cl">    -R ../01.ref/genome.fasta <span class="se">\
</span></span></span><span class="line"><span class="cl">    --variant all.merge.g.vcf <span class="se">\
</span></span></span><span class="line"><span class="cl">    -O all.merge_raw.vcf
</span></span></code></pre></div><h4 id="34-snp-è¿‡æ»¤">3.4 SNP è¿‡æ»¤<a hidden class="anchor" aria-hidden="true" href="#34-snp-è¿‡æ»¤">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># æå–SNP</span>
</span></span><span class="line"><span class="cl">gatk --java-options <span class="s2">&#34;-Xmx4g -Djava.io.tmpdir=./tmp&#34;</span> SelectVariants <span class="se">\
</span></span></span><span class="line"><span class="cl">    -R ../01.ref/genome.fasta <span class="se">\
</span></span></span><span class="line"><span class="cl">    -V all.merge_raw.vcf <span class="se">\
</span></span></span><span class="line"><span class="cl">    --select-type SNP <span class="se">\
</span></span></span><span class="line"><span class="cl">    -O all.raw.snp.vcf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ ‡è®°è¿‡æ»¤</span>
</span></span><span class="line"><span class="cl">gatk --java-options <span class="s2">&#34;-Xmx4g -Djava.io.tmpdir=./tmp&#34;</span> VariantFiltration <span class="se">\
</span></span></span><span class="line"><span class="cl">    -R ../01.ref/genome.fasta <span class="se">\
</span></span></span><span class="line"><span class="cl">    -V all.raw.snp.vcf <span class="se">\
</span></span></span><span class="line"><span class="cl">    --filter-expression <span class="s2">&#34;QD &lt; 2.0 || MQ &lt; 40.0 || FS &gt; 60.0 || SOR &gt; 3.0 || MQRankSum &lt; -12.5 || ReadPosRankSum &lt; -8.0&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    --filter-name <span class="s1">&#39;SNP_filter&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    -O all.filter.snp.vcf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æå–è¿‡æ»¤åçš„SNP</span>
</span></span><span class="line"><span class="cl">gatk --java-options <span class="s2">&#34;-Xmx4g -Djava.io.tmpdir=./tmp&#34;</span> SelectVariants <span class="se">\
</span></span></span><span class="line"><span class="cl">    -R ../01.ref/genome.fasta <span class="se">\
</span></span></span><span class="line"><span class="cl">    -V all.filter.snp.vcf <span class="se">\
</span></span></span><span class="line"><span class="cl">    --exclude-filtered <span class="se">\
</span></span></span><span class="line"><span class="cl">    -O all.filtered.snp.vcf
</span></span></code></pre></div><h4 id="35-indel-è¿‡æ»¤">3.5 InDel è¿‡æ»¤<a hidden class="anchor" aria-hidden="true" href="#35-indel-è¿‡æ»¤">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># æå–InDel</span>
</span></span><span class="line"><span class="cl">gatk --java-options <span class="s2">&#34;-Xmx4g -Djava.io.tmpdir=./tmp&#34;</span> SelectVariants <span class="se">\
</span></span></span><span class="line"><span class="cl">    -R ../01.ref/genome.fasta <span class="se">\
</span></span></span><span class="line"><span class="cl">    -V all.merge_raw.vcf <span class="se">\
</span></span></span><span class="line"><span class="cl">    --select-type INDEL <span class="se">\
</span></span></span><span class="line"><span class="cl">    -O all.raw.indel.vcf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ ‡è®°è¿‡æ»¤</span>
</span></span><span class="line"><span class="cl">gatk --java-options <span class="s2">&#34;-Xmx4g -Djava.io.tmpdir=./tmp&#34;</span> VariantFiltration <span class="se">\
</span></span></span><span class="line"><span class="cl">    -R ../01.ref/genome.fasta <span class="se">\
</span></span></span><span class="line"><span class="cl">    -V all.raw.indel.vcf <span class="se">\
</span></span></span><span class="line"><span class="cl">    --filter-expression <span class="s2">&#34;QD &lt; 2.0 || FS &gt; 200.0 || SOR &gt; 10.0 || MQRankSum &lt; -12.5 || ReadPosRankSum &lt; -8.0&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    --filter-name <span class="s1">&#39;INDEL_filter&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    -O all.filter.indel.vcf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æå–è¿‡æ»¤åçš„InDel</span>
</span></span><span class="line"><span class="cl">gatk --java-options <span class="s2">&#34;-Xmx4g -Djava.io.tmpdir=./tmp&#34;</span> SelectVariants <span class="se">\
</span></span></span><span class="line"><span class="cl">    -R ../01.ref/genome.fasta <span class="se">\
</span></span></span><span class="line"><span class="cl">    -V all.filter.indel.vcf <span class="se">\
</span></span></span><span class="line"><span class="cl">    --exclude-filtered <span class="se">\
</span></span></span><span class="line"><span class="cl">    -O all.filtered.indel.vcf
</span></span></code></pre></div><h3 id="4-sv-æ£€æµ‹">4. SV æ£€æµ‹<a hidden class="anchor" aria-hidden="true" href="#4-sv-æ£€æµ‹">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Step 1: æå– discordants reads</span>
</span></span><span class="line"><span class="cl">/pub/software/samtools/samtools view -b -F <span class="m">1294</span> -@ <span class="m">12</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    ../02.mapping/S1.sort.rmdup.bam &gt; S1.discordants.bam
</span></span><span class="line"><span class="cl">/pub/software/samtools/samtools view -b -F <span class="m">1294</span> -@ <span class="m">12</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    ../02.mapping/S2.sort.rmdup.bam &gt; S2.discordants.bam
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 2: æå– split reads</span>
</span></span><span class="line"><span class="cl">/pub/software/samtools/samtools view -h ../02.mapping/S1.sort.rmdup.bam <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    /pub/software/lumpy-sv/scripts/extractSplitReads_BwaMem -i stdin <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    /pub/software/samtools/samtools sort - &gt; S1.splitters.bam
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/pub/software/samtools/samtools view -h ../02.mapping/S2.sort.rmdup.bam <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    /pub/software/lumpy-sv/scripts/extractSplitReads_BwaMem -i stdin <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    /pub/software/samtools/samtools sort - &gt; S2.splitters.bam
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 3: è¿è¡Œ lumpy</span>
</span></span><span class="line"><span class="cl">/pub/software/lumpy-sv/bin/lumpyexpress <span class="se">\
</span></span></span><span class="line"><span class="cl">    -B ../02.mapping/S1.sort.rmdup.bam,../02.mapping/S2.sort.rmdup.bam <span class="se">\
</span></span></span><span class="line"><span class="cl">    -S S1.splitters.bam,S2.splitters.bam <span class="se">\
</span></span></span><span class="line"><span class="cl">    -D S1.discordants.bam,S2.discordants.bam <span class="se">\
</span></span></span><span class="line"><span class="cl">    -o all.sv.lumpy.vcf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 4: ä¸ªä½“åŸºå› å‹åˆ†å‹</span>
</span></span><span class="line"><span class="cl">vcftools --vcf all.sv.lumpy.vcf --indv S1 --recode --recode-INFO-all --out S1 <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    svtyper -i S1.recode.vcf -B ../02.mapping/S1.sort.rmdup.bam -o S1.genotype.vcf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vcftools --vcf all.sv.lumpy.vcf --indv S2 --recode --recode-INFO-all --out S2 <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    svtyper -i S2.recode.vcf -B ../02.mapping/S2.sort.rmdup.bam -o S2.genotype.vcf
</span></span></code></pre></div><h3 id="5-cnv-æ£€æµ‹">5. CNV æ£€æµ‹<a hidden class="anchor" aria-hidden="true" href="#5-cnv-æ£€æµ‹">#</a></h3>
<h4 id="51-å‡†å¤‡åŸºå› ç»„">5.1 å‡†å¤‡åŸºå› ç»„<a hidden class="anchor" aria-hidden="true" href="#51-å‡†å¤‡åŸºå› ç»„">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># å°†åŸºå› ç»„æ‹†åˆ†ä¸ºå•æ¡æŸ“è‰²ä½“</span>
</span></span><span class="line"><span class="cl">ln -s ../data/genome.fasta ./genome.fa
</span></span><span class="line"><span class="cl">seqkit split -i ./genome.fa -O split
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># é‡å‘½åæ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">ls ./split/genome.id_*.fa <span class="p">|</span> sed <span class="s1">&#39;s/./split/genome.id_//&#39;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    awk <span class="s1">&#39;{print &#34;mv ./split/genome.id_&#34;$aa&#34; ./split/&#34;$aa}&#39;</span> &gt; mv_name.sh
</span></span><span class="line"><span class="cl">sh mv_name.sh
</span></span></code></pre></div><h4 id="52-è¿è¡Œ-cnvnator">5.2 è¿è¡Œ cnvnator<a hidden class="anchor" aria-hidden="true" href="#52-è¿è¡Œ-cnvnator">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># è®¾ç½®ç¯å¢ƒå˜é‡</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">ROOTSYS</span><span class="o">=</span>/pub/software/root
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span>/pub/software/root/bin:<span class="nv">$PATH</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LD_LIBRARY_PATH</span>:<span class="nv">$ROOTSYS</span>/lib
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># é“¾æ¥æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">ln -s ../02.mapping/S1.sort.rmdup.bam
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æå–æ¯”å¯¹ç»“æœ</span>
</span></span><span class="line"><span class="cl">/pub/software/CNVnator/cnvnator -genome genome.fa -root S1.root -tree S1.sort.rmdup.bam
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ç”Ÿæˆæ·±åº¦åˆ†å¸ƒ</span>
</span></span><span class="line"><span class="cl">/pub/software/CNVnator/cnvnator -genome genome.fa -root S1.root -his <span class="m">500</span> -d split
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¿›è¡Œç»Ÿè®¡è®¡ç®—</span>
</span></span><span class="line"><span class="cl">/pub/software/CNVnator/cnvnator -root S1.root -stat <span class="m">500</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ£€æŸ¥bin sizeæ˜¯å¦åˆé€‚</span>
</span></span><span class="line"><span class="cl">/pub/software/CNVnator/cnvnator -root S1.root -eval <span class="m">500</span> &gt; S1.eval.ratio
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># RDä¿¡å·åˆ†å‰²</span>
</span></span><span class="line"><span class="cl">/pub/software/CNVnator/cnvnator -root S1.root -partition <span class="m">500</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¿›è¡ŒCNVæ£€æµ‹</span>
</span></span><span class="line"><span class="cl">/pub/software/CNVnator/cnvnator -root S1.root -call <span class="m">500</span> &gt; S1.cnv
</span></span></code></pre></div><h3 id="6-snpindel-æ³¨é‡Š">6. SNP/InDel æ³¨é‡Š<a hidden class="anchor" aria-hidden="true" href="#6-snpindel-æ³¨é‡Š">#</a></h3>
<h4 id="61-å‡†å¤‡æ³¨é‡Šæ•°æ®åº“">6.1 å‡†å¤‡æ³¨é‡Šæ•°æ®åº“<a hidden class="anchor" aria-hidden="true" href="#61-å‡†å¤‡æ³¨é‡Šæ•°æ®åº“">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ln -s ../data/genome.gtf
</span></span><span class="line"><span class="cl">ln -s ../data/genome.fasta
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">gtfToGenePred -genePredExt genome.gtf genome_refGene.txt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/pub/software/annovar/retrieve_seq_from_fasta.pl <span class="se">\
</span></span></span><span class="line"><span class="cl">    --format refGene <span class="se">\
</span></span></span><span class="line"><span class="cl">    --seqfile genome.fasta <span class="se">\
</span></span></span><span class="line"><span class="cl">    genome_refGene.txt <span class="se">\
</span></span></span><span class="line"><span class="cl">    --out genome_refGeneMrna.fa
</span></span></code></pre></div><h4 id="62-æ³¨é‡Š-vcf-æ–‡ä»¶">6.2 æ³¨é‡Š VCF æ–‡ä»¶<a hidden class="anchor" aria-hidden="true" href="#62-æ³¨é‡Š-vcf-æ–‡ä»¶">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ln -s ../03.SNP_indel/all.filtered.snp.vcf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ ¼å¼è½¬æ¢</span>
</span></span><span class="line"><span class="cl">/pub/software/annovar/convert2annovar.pl <span class="se">\
</span></span></span><span class="line"><span class="cl">    -format vcf4old <span class="se">\
</span></span></span><span class="line"><span class="cl">    all.filtered.snp.vcf &gt; all.snp.vcf.annovar.input
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¿›è¡Œæ³¨é‡Š</span>
</span></span><span class="line"><span class="cl">/pub/software/annovar/annotate_variation.pl <span class="se">\
</span></span></span><span class="line"><span class="cl">    -geneanno <span class="se">\
</span></span></span><span class="line"><span class="cl">    --neargene <span class="m">2000</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    -buildver genome <span class="se">\
</span></span></span><span class="line"><span class="cl">    -dbtype refGene <span class="se">\
</span></span></span><span class="line"><span class="cl">    -outfile all.anno <span class="se">\
</span></span></span><span class="line"><span class="cl">    -exonsort <span class="se">\
</span></span></span><span class="line"><span class="cl">    all.snp.vcf.annovar.input ./
</span></span></code></pre></div><h3 id="7-cnv-å’Œ-sv-æ³¨é‡Š">7. CNV å’Œ SV æ³¨é‡Š<a hidden class="anchor" aria-hidden="true" href="#7-cnv-å’Œ-sv-æ³¨é‡Š">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># å¤„ç†SVæ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">less -S ../04.SV/all.sv.lumpy.vcf <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    awk -F <span class="s2">&#34;;&#34;</span> <span class="s1">&#39;{ if($1!~/#/){print $1&#34;\t&#34;$2&#34;\t&#34;$3&#34;\t&#34;$4} }&#39;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    awk <span class="s1">&#39;{print $1&#34;\t&#34;$2&#34;\t&#34;$11&#34;\t&#34;$3&#34;\t&#34;$8}&#39;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    sed <span class="s1">&#39;s/END=//&#39;</span> <span class="p">|</span> sed <span class="s1">&#39;s/SVTYPE=//&#39;</span> &gt; SV.bed
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¿‡æ»¤BNDç±»å‹</span>
</span></span><span class="line"><span class="cl">awk <span class="s1">&#39;$5 !~ /BND/&#39;</span> SV.bed &gt; SV_filter.bed
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># SVæ³¨é‡Š</span>
</span></span><span class="line"><span class="cl">bedtools intersect -wo -a SV_filter.bed -b gene.gtf &gt; SV_filter.Anno
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¤„ç†CNVæ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">less -S ../05.CNV/S1.cnv <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    awk <span class="s1">&#39;{print $2 &#34;\t&#34; $1}&#39;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    sed <span class="s1">&#39;s/:/\t/&#39;</span> <span class="p">|</span> sed <span class="s1">&#39;s/-/\t/&#39;</span> &gt; CNV.bed
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># CNVæ³¨é‡Š</span>
</span></span><span class="line"><span class="cl">bedtools intersect -wo -a CNV.bed -b gene.gtf &gt; CNV.Anno
</span></span></code></pre></div><h2 id="ç¾¤ä½“ç»“æ„åˆ†æ">ç¾¤ä½“ç»“æ„åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#ç¾¤ä½“ç»“æ„åˆ†æ">#</a></h2>
<h3 id="1-æ•°æ®è¿‡æ»¤">1. æ•°æ®è¿‡æ»¤<a hidden class="anchor" aria-hidden="true" href="#1-æ•°æ®è¿‡æ»¤">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">vcf</span><span class="o">=</span>../data/all.vcf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¿‡æ»¤ç¼ºå¤±ç‡å’Œæœ€å°ç­‰ä½åŸºå› é¢‘ç‡</span>
</span></span><span class="line"><span class="cl">plink --vcf <span class="nv">$vcf</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    --geno 0.1 <span class="se">\
</span></span></span><span class="line"><span class="cl">    --maf 0.01 <span class="se">\
</span></span></span><span class="line"><span class="cl">    --out all.missing_maf <span class="se">\
</span></span></span><span class="line"><span class="cl">    --recode vcf-iid <span class="se">\
</span></span></span><span class="line"><span class="cl">    --allow-extra-chr <span class="se">\
</span></span></span><span class="line"><span class="cl">    --set-missing-var-ids @:# <span class="se">\
</span></span></span><span class="line"><span class="cl">    --keep-allele-order
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¿‡æ»¤è¿é”ä¸å¹³è¡¡</span>
</span></span><span class="line"><span class="cl">plink --vcf all.missing_maf.vcf <span class="se">\
</span></span></span><span class="line"><span class="cl">    --indep-pairwise <span class="m">50</span> <span class="m">10</span> 0.2 <span class="se">\
</span></span></span><span class="line"><span class="cl">    --out tmp.ld <span class="se">\
</span></span></span><span class="line"><span class="cl">    --allow-extra-chr <span class="se">\
</span></span></span><span class="line"><span class="cl">    --set-missing-var-ids @:#
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">plink --vcf all.missing_maf.vcf <span class="se">\
</span></span></span><span class="line"><span class="cl">    --make-bed <span class="se">\
</span></span></span><span class="line"><span class="cl">    --extract tmp.ld.prune.in <span class="se">\
</span></span></span><span class="line"><span class="cl">    --out all.LDfilter <span class="se">\
</span></span></span><span class="line"><span class="cl">    --recode vcf-iid <span class="se">\
</span></span></span><span class="line"><span class="cl">    --keep-allele-order <span class="se">\
</span></span></span><span class="line"><span class="cl">    --allow-extra-chr <span class="se">\
</span></span></span><span class="line"><span class="cl">    --set-missing-var-ids @:#
</span></span></code></pre></div><h3 id="2-å»ºæ ‘åˆ†æ">2. å»ºæ ‘åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#2-å»ºæ ‘åˆ†æ">#</a></h3>
<h4 id="21-nj-æ ‘">2.1 NJ æ ‘<a hidden class="anchor" aria-hidden="true" href="#21-nj-æ ‘">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># ä¸‹è½½</span>
</span></span><span class="line"><span class="cl">git clone https://gitcode.com/gh_mirrors/vc/vcf2phylip
</span></span><span class="line"><span class="cl"><span class="c1"># 1 æ ¼å¼è½¬æ¢ï¼ˆnewï¼‰</span>
</span></span><span class="line"><span class="cl">/home2/xtc/pub/vcf2phylip/vcf2phylip.py -i all.LDfilter.vcf -o phylip_file
</span></span><span class="line"><span class="cl"><span class="c1"># 2 æˆ–ä½¿ç”¨seqtk</span>
</span></span><span class="line"><span class="cl">seqtk subseq reference.fasta region_list.txt &gt; alignment.fasta
</span></span><span class="line"><span class="cl"><span class="c1"># åŸºæœ¬åˆ†æ</span>
</span></span><span class="line"><span class="cl">iqtree -s phylip_file -m GTR+G -bb <span class="m">1000</span> -nt AUTO
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å‚æ•°è¯´æ˜ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="c1"># -s: è¾“å…¥æ–‡ä»¶ï¼ˆPHYLIPæˆ–FASTAæ ¼å¼ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="c1"># -m: æ›¿ä»£æ¨¡å‹ï¼ˆGTR+Gå¸¸ç”¨ï¼Œæˆ–ä½¿ç”¨MFPè®©è½¯ä»¶è‡ªåŠ¨é€‰æ‹©ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="c1"># -bb: è‡ªä¸¾é‡å¤æ¬¡æ•°ï¼ˆ1000ä¸ºæ ‡å‡†ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="c1"># -nt: çº¿ç¨‹æ•°ï¼ˆAUTOè‡ªåŠ¨æ£€æµ‹ï¼‰</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¾“å‡ºæ–‡ä»¶ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="c1"># - *.treefile: æœ€ä½³ç³»ç»Ÿå‘è‚²æ ‘ï¼ˆNewickæ ¼å¼ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="c1"># - *.log: è¿è¡Œæ—¥å¿—</span>
</span></span><span class="line"><span class="cl"><span class="c1"># - *.iqtree: è¯¦ç»†ç»“æœ</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 3 æ ¼å¼è½¬æ¢ï¼ˆæ›´æ–°ç”¨pyè„šæœ¬ï¼‰</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#-----------------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æ ¼å¼è½¬æ¢</span>
</span></span><span class="line"><span class="cl">perl ../../script/vcf2phy.pl ../../00.filter/all.LDfilter.vcf &gt; sequences.dat
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è®¡ç®—é—ä¼ è·ç¦»</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> -e <span class="s2">&#34;sequences.dat\nY&#34;</span> &gt; dnadist.cfg
</span></span><span class="line"><span class="cl">dnadist &lt; dnadist.cfg &gt; dnadist.log
</span></span><span class="line"><span class="cl">mv outfile infile.dist
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ„å»ºNJæ ‘</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> -e <span class="s2">&#34;infile.dist\nY&#34;</span> &gt; neighbor.cfg
</span></span><span class="line"><span class="cl">neighbor &lt; neighbor.cfg &gt; nj.log
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ ¼å¼æ•´ç†</span>
</span></span><span class="line"><span class="cl">less infile.dist <span class="p">|</span> tr <span class="s1">&#39;\n&#39;</span> <span class="s1">&#39;|&#39;</span> <span class="p">|</span> sed <span class="s1">&#39;s/| / /g&#39;</span> <span class="p">|</span> tr <span class="s1">&#39;|&#39;</span> <span class="s1">&#39;\n&#39;</span> &gt; infile.dist.table
</span></span><span class="line"><span class="cl">less outtree <span class="p">|</span> tr <span class="s1">&#39;\n&#39;</span> <span class="s1">&#39; &#39;</span> <span class="p">|</span> sed <span class="s1">&#39;s/ //g&#39;</span> &gt; outtree.nwk
</span></span></code></pre></div><h4 id="22-snphylo-å»ºæ ‘æ…¢">2.2 SNPhylo å»ºæ ‘ï¼ˆæ…¢ï¼‰<a hidden class="anchor" aria-hidden="true" href="#22-snphylo-å»ºæ ‘æ…¢">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">/pub/software/SNPhylo/snphylo.sh <span class="se">\
</span></span></span><span class="line"><span class="cl">    -v ../../00.filter/all.LDfilter.vcf <span class="se">\
</span></span></span><span class="line"><span class="cl">    -r <span class="se">\
</span></span></span><span class="line"><span class="cl">    -l <span class="m">1</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    -m 0.01 <span class="se">\
</span></span></span><span class="line"><span class="cl">    -o GA0001 <span class="se">\
</span></span></span><span class="line"><span class="cl">    -b <span class="se">\
</span></span></span><span class="line"><span class="cl">    -B <span class="m">2</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    -P tree_snphylo
</span></span></code></pre></div><p>treefileæ–‡ä»¶è®©å¦‚ITOLç”»è¿›åŒ–æ ‘ï¼ŒåŒæ—¶æ ¹æ®éœ€æ±‚è¿›è¡Œç¾åŒ–ï¼Œä¸Šä¼ æ³¨é‡Šæ–‡ä»¶ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl"># itol_colorstrip.txt ,ç»™ä¸åŒç§ç¾¤å¤–åœˆæ·»åŠ é¢œè‰²åŒºåˆ†
</span></span><span class="line"><span class="cl">DATASET_COLORSTRIP
</span></span><span class="line"><span class="cl">SEPARATOR TAB
</span></span><span class="line"><span class="cl">DATASET_LABEL	population
</span></span><span class="line"><span class="cl">COLOR	#000000
</span></span><span class="line"><span class="cl">STRIP_WIDTH	50
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">LEGEND_TITLE	Population
</span></span><span class="line"><span class="cl">LEGEND_SHAPES	1	1
</span></span><span class="line"><span class="cl">LEGEND_COLORS	#377EB8	#E41A1C
</span></span><span class="line"><span class="cl">LEGEND_LABELS	Cultivated	Wild
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">DATA
</span></span><span class="line"><span class="cl">C01	#377EB8	Cultivated
</span></span><span class="line"><span class="cl">C02	#377EB8	Cultivated
</span></span><span class="line"><span class="cl">C08	#377EB8	Cultivated
</span></span><span class="line"><span class="cl">C12	#377EB8	Cultivated
</span></span><span class="line"><span class="cl">C14	#377EB8	Cultivated
</span></span><span class="line"><span class="cl">C16	#377EB8	Cultivated
</span></span><span class="line"><span class="cl">C17	#377EB8	Cultivated
</span></span><span class="line"><span class="cl">C19	#377EB8	Cultivated
</span></span><span class="line"><span class="cl">C24	#377EB8	Cultivated
</span></span><span class="line"><span class="cl">C27	#377EB8	Cultivated
</span></span><span class="line"><span class="cl">C30	#377EB8	Cultivated
</span></span><span class="line"><span class="cl">C33	#377EB8	Cultivated
</span></span><span class="line"><span class="cl">C34	#377EB8	Cultivated
</span></span><span class="line"><span class="cl">C35	#377EB8	Cultivated
</span></span><span class="line"><span class="cl">W01	#E41A1C	Wild
</span></span><span class="line"><span class="cl">W02	#E41A1C	Wild
</span></span><span class="line"><span class="cl">W03	#E41A1C	Wild
</span></span><span class="line"><span class="cl">W04	#E41A1C	Wild
</span></span><span class="line"><span class="cl">W05	#E41A1C	Wild
</span></span><span class="line"><span class="cl">W06	#E41A1C	Wild
</span></span><span class="line"><span class="cl">W07	#E41A1C	Wild
</span></span><span class="line"><span class="cl">W08	#E41A1C	Wild
</span></span><span class="line"><span class="cl">W09	#E41A1C	Wild
</span></span><span class="line"><span class="cl">W10	#E41A1C	Wild
</span></span><span class="line"><span class="cl">W11	#E41A1C	Wild
</span></span><span class="line"><span class="cl">W12	#E41A1C	Wild
</span></span><span class="line"><span class="cl">W13	#E41A1C	Wild
</span></span><span class="line"><span class="cl">W14	#E41A1C	Wild
</span></span><span class="line"><span class="cl">W15	#E41A1C	Wild
</span></span><span class="line"><span class="cl">W16	#E41A1C	Wild
</span></span><span class="line"><span class="cl">W17	#E41A1C	Wild
</span></span></code></pre></div><pre tabindex="0"><code>itol_branch_colors.txt ,åˆ†æ”¯æ ‡ç­¾é¢œè‰²
TREE_COLORS
SEPARATOR TAB
DATA
C01	branch	#377EB8	normal	2
C01	label	#377EB8	normal	1
C02	branch	#377EB8	normal	2
C02	label	#377EB8	normal	1
C08	branch	#377EB8	normal	2
C08	label	#377EB8	normal	1
C12	branch	#377EB8	normal	2
C12	label	#377EB8	normal	1
C14	branch	#377EB8	normal	2
C14	label	#377EB8	normal	1
C16	branch	#377EB8	normal	2
C16	label	#377EB8	normal	1
C17	branch	#377EB8	normal	2
C17	label	#377EB8	normal	1
C19	branch	#377EB8	normal	2
C19	label	#377EB8	normal	1
C24	branch	#377EB8	normal	2
C24	label	#377EB8	normal	1
C27	branch	#377EB8	normal	2
C27	label	#377EB8	normal	1
C30	branch	#377EB8	normal	2
C30	label	#377EB8	normal	1
C33	branch	#377EB8	normal	2
C33	label	#377EB8	normal	1
C34	branch	#377EB8	normal	2
C34	label	#377EB8	normal	1
C35	branch	#377EB8	normal	2
C35	label	#377EB8	normal	1
W01	branch	#E41A1C	normal	2
W01	label	#E41A1C	normal	1
W02	branch	#E41A1C	normal	2
W02	label	#E41A1C	normal	1
W03	branch	#E41A1C	normal	2
W03	label	#E41A1C	normal	1
W04	branch	#E41A1C	normal	2
W04	label	#E41A1C	normal	1
W05	branch	#E41A1C	normal	2
W05	label	#E41A1C	normal	1
W06	branch	#E41A1C	normal	2
W06	label	#E41A1C	normal	1
W07	branch	#E41A1C	normal	2
W07	label	#E41A1C	normal	1
W08	branch	#E41A1C	normal	2
W08	label	#E41A1C	normal	1
W09	branch	#E41A1C	normal	2
W09	label	#E41A1C	normal	1
W10	branch	#E41A1C	normal	2
W10	label	#E41A1C	normal	1
W11	branch	#E41A1C	normal	2
W11	label	#E41A1C	normal	1
W12	branch	#E41A1C	normal	2
W12	label	#E41A1C	normal	1
W13	branch	#E41A1C	normal	2
W13	label	#E41A1C	normal	1
W14	branch	#E41A1C	normal	2
W14	label	#E41A1C	normal	1
W15	branch	#E41A1C	normal	2
W15	label	#E41A1C	normal	1
W16	branch	#E41A1C	normal	2
W16	label	#E41A1C	normal	1
W17	branch	#E41A1C	normal	2
W17	label	#E41A1C	normal	1
</code></pre><h3 id="3-pca-åˆ†æ">3. PCA åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#3-pca-åˆ†æ">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">plink --vcf ../00.filter/all.LDfilter.vcf <span class="se">\
</span></span></span><span class="line"><span class="cl">    --pca <span class="m">10</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    --out PCA_out <span class="se">\
</span></span></span><span class="line"><span class="cl">    --allow-extra-chr <span class="se">\
</span></span></span><span class="line"><span class="cl">    --set-missing-var-ids @:#
</span></span><span class="line"><span class="cl"><span class="c1"># Rç»˜å›¾</span>
</span></span><span class="line"><span class="cl">Rscript ../script/draw_PCA.R PCA_out.eigenvec <span class="m">1</span> <span class="m">2</span> ../data/sample.pop PCA_out_figure
</span></span></code></pre></div><h3 id="4-ç¾¤ä½“ç»“æ„åˆ†æ">4. ç¾¤ä½“ç»“æ„åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#4-ç¾¤ä½“ç»“æ„åˆ†æ">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Step 0: vcfè½¬bedæ ¼å¼</span>
</span></span><span class="line"><span class="cl">plink --vcf ../00.filter/all.LDfilter.vcf <span class="se">\
</span></span></span><span class="line"><span class="cl">    --make-bed <span class="se">\
</span></span></span><span class="line"><span class="cl">    --out all <span class="se">\
</span></span></span><span class="line"><span class="cl">    --allow-extra-chr <span class="se">\
</span></span></span><span class="line"><span class="cl">    --keep-allele-order <span class="se">\
</span></span></span><span class="line"><span class="cl">    --set-missing-var-ids @:#
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è½¬æ¢ä¸ºadmixtureæ ¼å¼ï¼ˆped,ä¸ä¼šå‡ºç°æŸ“è‰²ä½“å‘½åæŠ¥é”™ä¸­æ­¢ï¼‰</span>
</span></span><span class="line"><span class="cl">plink --vcf  all.LDfilter.vcf --recode <span class="m">12</span> --out all.LDfilter.prune --allow-extra-chr
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 1: ç”ŸæˆAdmixtureè¿è¡Œè„šæœ¬</span>
</span></span><span class="line"><span class="cl">seq <span class="m">2</span> <span class="m">4</span> <span class="p">|</span> awk <span class="s1">&#39;{print &#34;admixture --cv -j2 all.bed &#34;$1&#34; 1&gt;admix.&#34;$1&#34;.log 2&gt;&amp;1&#34;}&#39;</span> &gt; admixture.sh
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># pedç‰ˆæœ¬</span>
</span></span><span class="line"><span class="cl">seq <span class="m">2</span> <span class="m">10</span> <span class="p">|</span> awk <span class="s1">&#39;{print &#34;admixture --cv -j4 all.LDfilter.prune.ped &#34;$1&#34; 1&gt;admix.&#34;$1&#34;.log 2&gt;&amp;1&#34;}&#39;</span> &gt; admixture.sh
</span></span><span class="line"><span class="cl">nohup parallel -j <span class="m">10</span> &lt; admixture.sh &gt; admixture.log 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">grep -h CV *.log <span class="p">|</span> sort -t<span class="s1">&#39;:&#39;</span> -k2 -n
</span></span><span class="line"><span class="cl"><span class="c1"># Step 2: è¿è¡ŒAdmixture</span>
</span></span><span class="line"><span class="cl">sh admixture.sh
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä¹Ÿå¯å•ç‹¬è¿è¡Œï¼ˆè¦æ±‚æ–‡ä»¶ä¸­æŸ“è‰²ä½“å‘½ååªå«æ•°å­—ï¼‰</span>
</span></span><span class="line"><span class="cl">admixture --cv -j2 all.bed <span class="m">2</span> 1&gt;admix.2.log 2&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">admixture --cv -j2 all.bed <span class="m">3</span> 1&gt;admix.3.log 2&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">admixture --cv -j2 all.bed <span class="m">4</span> 1&gt;admix.4.log 2&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># S2.1 é€‰æ‹©æœ€ä¼˜åˆ†ç¾¤</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æŸ¥çœ‹äº¤å‰éªŒè¯è¯¯å·®</span>
</span></span><span class="line"><span class="cl">grep -h CV log*.out <span class="p">|</span> sort -t<span class="s1">&#39;:&#39;</span> -k2 -n
</span></span><span class="line"><span class="cl"><span class="c1"># é€‰æ‹©CVè¯¯å·®æœ€å°çš„Kå€¼ï¼Œç»˜å›¾ä»£ç å¦ä½œæ•´ç†</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 3: ç»˜åˆ¶ç»“æ„å›¾</span>
</span></span><span class="line"><span class="cl">mkdir result
</span></span><span class="line"><span class="cl">cp ./*.Q result/
</span></span><span class="line"><span class="cl">Rscript ../script/draw_admixture.R result all.nosex structure
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># admixtureåˆ†ç¾¤ç»˜å›¾</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">ggsci</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">ggthemes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">pophelper</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">files</span> <span class="o">&lt;-</span> <span class="nf">paste0</span><span class="p">(</span><span class="s">&#34;all.LDfilter.prune.&#34;</span><span class="p">,</span><span class="m">2</span><span class="o">:</span><span class="m">10</span><span class="p">,</span><span class="s">&#34;.Q&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ID</span> <span class="o">&lt;-</span> <span class="nf">read.table</span><span class="p">(</span><span class="s">&#34;sample.list&#34;</span><span class="p">,</span><span class="n">header</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">slist</span> <span class="o">&lt;-</span> <span class="nf">readQ</span><span class="p">(</span><span class="n">files</span> <span class="o">=</span> <span class="n">files</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">for</span><span class="p">(</span><span class="n">i</span> <span class="kr">in</span> <span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">slist</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">  <span class="nf">row.names</span><span class="p">(</span><span class="n">slist[[i]]</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">ID[</span><span class="p">,</span><span class="m">1</span><span class="n">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="n">P1</span> <span class="o">&lt;-</span> <span class="nf">plotQ</span><span class="p">(</span><span class="n">slist</span><span class="p">,</span> <span class="n">imgoutput</span> <span class="o">=</span> <span class="s">&#34;join&#34;</span><span class="p">,</span><span class="n">imgtype</span> <span class="o">=</span> <span class="s">&#34;pdf&#34;</span><span class="p">,</span><span class="n">width</span> <span class="o">=</span> <span class="m">20</span><span class="p">,</span><span class="n">height</span> <span class="o">=</span> <span class="m">1.2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">showindlab</span> <span class="o">=</span> <span class="bp">T</span><span class="p">,</span><span class="n">useindlab</span> <span class="o">=</span> <span class="bp">T</span><span class="p">,</span><span class="n">indlabhjust</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">,</span><span class="n">indlabangle</span> <span class="o">=</span> <span class="m">90</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">indlabsize</span> <span class="o">=</span> <span class="m">0.6</span><span class="p">,</span><span class="n">sortind</span> <span class="o">=</span> <span class="s">&#34;all&#34;</span><span class="p">,</span><span class="n">sharedindlab</span> <span class="o">=</span> <span class="bp">F</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">panelspacer</span> <span class="o">=</span> <span class="m">0.02</span><span class="p">,</span> <span class="n">indlabspacer</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span><span class="n">indlabcol</span> <span class="o">=</span> <span class="s">&#34;black&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">showtitle</span> <span class="o">=</span> <span class="bp">T</span><span class="p">,</span><span class="n">titlelab</span> <span class="o">=</span> <span class="s">&#34;Population Structure&#34;</span><span class="p">,</span><span class="n">titlecol</span> <span class="o">=</span> <span class="s">&#34;black&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">titlehjust</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">,</span><span class="n">showsp</span> <span class="o">=</span> <span class="bp">T</span><span class="p">,</span><span class="n">exportpath</span><span class="o">=</span><span class="nf">getwd</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="n">sppos</span> <span class="o">=</span> <span class="s">&#34;left&#34;</span><span class="p">,</span><span class="n">splab</span> <span class="o">=</span> <span class="nf">paste0</span><span class="p">(</span><span class="s">&#34;K=&#34;</span><span class="p">,</span><span class="m">2</span><span class="o">:</span><span class="m">10</span><span class="p">),</span><span class="n">splabangle</span> <span class="o">=</span> <span class="m">180</span><span class="p">,</span><span class="n">dpi</span> <span class="o">=</span> <span class="m">600</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">outputfilename</span> <span class="o">=</span> <span class="nf">paste0</span><span class="p">(</span><span class="s">&#34;admixture_barplot&#34;</span><span class="p">),</span><span class="n">units</span> <span class="o">=</span> <span class="s">&#34;cm&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¼•å…¥åˆ†ç»„ä¿¡æ¯</span>
</span></span><span class="line"><span class="cl"><span class="n">group</span> <span class="o">&lt;-</span> <span class="nf">read.table</span><span class="p">(</span><span class="s">&#34;sample.list&#34;</span><span class="p">,</span><span class="n">header</span> <span class="o">=</span> <span class="bp">F</span><span class="p">,</span><span class="n">row.names</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="c1">#ç¬¬ä¸€åˆ—ä¸ºæ ·å“åï¼Œç¬¬äºŒåˆ—ä¸ºç§ç¾¤åˆ†ç±»</span>
</span></span><span class="line"><span class="cl"><span class="n">P2</span> <span class="o">&lt;-</span> <span class="nf">plotQ</span><span class="p">(</span><span class="n">slist</span><span class="p">,</span><span class="n">imgoutput</span> <span class="o">=</span> <span class="s">&#34;join&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">imgtype</span> <span class="o">=</span> <span class="s">&#34;png&#34;</span><span class="p">,</span>  <span class="c1">#è¾“å‡ºæ ¼å¼çš„å˜åŒ–</span>
</span></span><span class="line"><span class="cl">            <span class="n">height</span> <span class="o">=</span> <span class="m">1.2</span><span class="p">,</span><span class="n">width</span> <span class="o">=</span> <span class="m">20</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">showindlab</span> <span class="o">=</span> <span class="bp">T</span><span class="p">,</span><span class="n">useindlab</span> <span class="o">=</span> <span class="bp">T</span><span class="p">,</span><span class="n">sharedindlab</span> <span class="o">=</span> <span class="bp">T</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">showtitle</span> <span class="o">=</span> <span class="bp">T</span><span class="p">,</span><span class="n">titlelab</span> <span class="o">=</span> <span class="s">&#34;Population Structure&#34;</span><span class="p">,</span><span class="n">titlecol</span> <span class="o">=</span> <span class="s">&#34;black&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">showsp</span> <span class="o">=</span> <span class="bp">T</span><span class="p">,</span><span class="n">sppos</span> <span class="o">=</span> <span class="s">&#34;left&#34;</span><span class="p">,</span><span class="n">splab</span> <span class="o">=</span> <span class="nf">paste0</span><span class="p">(</span><span class="s">&#34;K=&#34;</span><span class="p">,</span><span class="m">2</span><span class="o">:</span><span class="m">10</span><span class="p">),</span><span class="n">splabangle</span> <span class="o">=</span> <span class="m">180</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">showlegend</span> <span class="o">=</span> <span class="bp">F</span><span class="p">,</span><span class="n">ordergrp</span> <span class="o">=</span> <span class="bp">T</span><span class="p">,</span><span class="n">grplab</span> <span class="o">=</span> <span class="n">group</span><span class="p">,</span>   <span class="c1">#æ·»åŠ åˆ†ç»„</span>
</span></span><span class="line"><span class="cl">            <span class="n">subsetgrp</span> <span class="o">=</span> <span class="kc">LETTERS</span><span class="n">[1</span><span class="o">:</span><span class="m">31</span><span class="n">]</span><span class="p">,</span>  <span class="c1">#æ·»åŠ ç»„å</span>
</span></span><span class="line"><span class="cl">            <span class="n">dpi</span> <span class="o">=</span> <span class="m">600</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">outputfilename</span> <span class="o">=</span> <span class="nf">paste0</span><span class="p">(</span><span class="s">&#34;structure_barplot_pop&#34;</span><span class="p">),</span><span class="n">units</span> <span class="o">=</span> <span class="s">&#34;cm&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">exportpath</span> <span class="o">=</span> <span class="nf">getwd</span><span class="p">())</span>
</span></span></code></pre></div><h3 id="5-ld-è¡°å‡åˆ†æä¸è¦åšldä¿®å‰ªçš„vcfè¿›è¡Œè®¡ç®—">5. LD è¡°å‡åˆ†æï¼ˆä¸è¦åšLDä¿®å‰ªçš„vcfè¿›è¡Œè®¡ç®—ï¼‰<a hidden class="anchor" aria-hidden="true" href="#5-ld-è¡°å‡åˆ†æä¸è¦åšldä¿®å‰ªçš„vcfè¿›è¡Œè®¡ç®—">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Step 1: è®¡ç®—LD(å¯ä¿®æ”¹binå‚æ•°è°ƒæ•´æ›²çº¿å…‰æ»‘ç¨‹åº¦ï¼Œå¯ç»˜åˆ¶æ€»ç¾¤ä½“æˆ–è€…å•ä¸ªç¾¤ä½“)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ä»¥ä¸‹ä¸ºè®¡ç®—å•ä¸ªç¾¤ä½“çš„LDè¡°å‡è·ç¦»ï¼Œäºšç¾¤æ–‡ä»¶ä¸ºä¸€åˆ—è¯¥ç¾¤çš„æ ·å“åã€‚e.g W01 W02ã€‚ã€‚ã€‚</span>
</span></span><span class="line"><span class="cl">/pub/software/PopLDdecay/bin/PopLDdecay <span class="se">\
</span></span></span><span class="line"><span class="cl">    -InVCF ../data/all.vcf <span class="se">\
</span></span></span><span class="line"><span class="cl">    -SubPop ../data/pop.SC.table <span class="se">\
</span></span></span><span class="line"><span class="cl">    -MaxDist <span class="m">500</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    -OutStat pop.SC.stat
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/pub/software/PopLDdecay/bin/PopLDdecay <span class="se">\
</span></span></span><span class="line"><span class="cl">    -InVCF ../data/all.vcf <span class="se">\
</span></span></span><span class="line"><span class="cl">    -SubPop ../data/pop.YZR.table <span class="se">\
</span></span></span><span class="line"><span class="cl">    -MaxDist <span class="m">500</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    -OutStat pop.YZR.stat
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 2: ç»˜åˆ¶å•ç¾¤ä½“LDè¡°å‡å›¾</span>
</span></span><span class="line"><span class="cl">perl /pub/software/PopLDdecay/bin/Plot_OnePop.pl <span class="se">\
</span></span></span><span class="line"><span class="cl">    -inFile pop.SC.stat.gz <span class="se">\
</span></span></span><span class="line"><span class="cl">    -output pop.SC.ld
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">perl /pub/software/PopLDdecay/bin/Plot_OnePop.pl <span class="se">\
</span></span></span><span class="line"><span class="cl">    -inFile pop.YZR.stat.gz <span class="se">\
</span></span></span><span class="line"><span class="cl">    -output pop.YZR.ld
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 3: ç»˜åˆ¶å¤šç¾¤ä½“LDè¡°å‡å›¾</span>
</span></span><span class="line"><span class="cl">perl /pub/software/PopLDdecay/bin/Plot_MultiPop.pl <span class="se">\
</span></span></span><span class="line"><span class="cl">    -inList ld_stat.list <span class="se">\
</span></span></span><span class="line"><span class="cl">    -output ld_stat.multi
</span></span></code></pre></div><h2 id="é€‰æ‹©åˆ†æ">é€‰æ‹©åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#é€‰æ‹©åˆ†æ">#</a></h2>
<h3 id="1-Ï€-å’Œ-rod-åˆ†æ">1. Ï€ å’Œ ROD åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#1-Ï€-å’Œ-rod-åˆ†æ">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">vcf</span><span class="o">=</span>../../data/all.vcf
</span></span><span class="line"><span class="cl"><span class="nv">window</span><span class="o">=</span><span class="m">20000</span>
</span></span><span class="line"><span class="cl"><span class="nv">step</span><span class="o">=</span><span class="m">2000</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 1: è®¡ç®—piå€¼</span>
</span></span><span class="line"><span class="cl">vcftools --vcf <span class="nv">$vcf</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    --window-pi <span class="nv">$window</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    --window-pi-step <span class="nv">$step</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    --keep ../../data/pop.SC.table <span class="se">\
</span></span></span><span class="line"><span class="cl">    --out ./Pi.pop1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vcftools --vcf <span class="nv">$vcf</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    --window-pi <span class="nv">$window</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    --window-pi-step <span class="nv">$step</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    --keep ../../data/pop.YZR.table <span class="se">\
</span></span></span><span class="line"><span class="cl">    --out ./Pi.pop2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 2: è®¡ç®—RODï¼ˆæ²¡æœ‰æä¾›è¯¥è„šæœ¬ï¼Œä¸‹é¢Rè„šæœ¬å·²ç»è®¡ç®—ï¼Œéœ€è¦ä¿å­˜ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="nv">pi1</span><span class="o">=</span>Pi.pop1.windowed.pi
</span></span><span class="line"><span class="cl"><span class="nv">pi2</span><span class="o">=</span>Pi.pop2.windowed.pi
</span></span><span class="line"><span class="cl">perl ../../script/merge2pi_ROD.pl <span class="nv">$pi1</span> <span class="nv">$pi2</span> &gt; Pi.ROD
</span></span></code></pre></div><h4 id="è‡ªç”¨rodåˆ†æè„šæœ¬ç½‘ä¸Šæ•°ä¿¡é™¢æä¾›">(è‡ªç”¨RODåˆ†æè„šæœ¬ï¼Œç½‘ä¸Šæ•°ä¿¡é™¢æä¾›ï¼‰<a hidden class="anchor" aria-hidden="true" href="#è‡ªç”¨rodåˆ†æè„šæœ¬ç½‘ä¸Šæ•°ä¿¡é™¢æä¾›">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-R" data-lang="R"><span class="line"><span class="cl"><span class="nf">setwd</span><span class="p">(</span><span class="s">&#34;~/workspace/soybean.project/select.place/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">CMplot</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">qtile</span> <span class="o">&lt;-</span> <span class="m">0.95</span>  <span class="c1"># åˆ†ä½æ•°é˜ˆå€¼ï¼Œä¾‹å¦‚0.95è¡¨ç¤º95%åˆ†ä½æ•°</span>
</span></span><span class="line"><span class="cl"><span class="n">prefix</span> <span class="o">&lt;-</span> <span class="s">&#34;outsample&#34;</span><span class="c1"># è¾“å‡ºæ–‡ä»¶å‰ç¼€</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¯»å–æ•°æ®ï¼ˆæ›¿æ¢ä¸ºå®é™…æ–‡ä»¶è·¯å¾„ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">wd</span> <span class="o">&lt;-</span> <span class="nf">read.table</span><span class="p">(</span><span class="s">&#34;Pi.pop2_W.windowed.pi&#34;</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>  <span class="c1"># subpop1çš„Piæ•°æ®</span>
</span></span><span class="line"><span class="cl"><span class="n">cd</span> <span class="o">&lt;-</span> <span class="nf">read.table</span><span class="p">(</span><span class="s">&#34;Pi.pop1_C.windowed.pi&#34;</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>  <span class="c1"># subpop2çš„Piæ•°æ®</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ•°æ®å¤„ç†ï¼šåˆå¹¶IDå¹¶è¿›è¡Œå†…è¿æ¥</span>
</span></span><span class="line"><span class="cl"><span class="c1"># åŸå§‹æ•°æ®åˆ—ååº”ä¸ºï¼šCHROM   BIN_START BIN_END N_VARIANTS      PI</span>
</span></span><span class="line"><span class="cl"><span class="n">wd1</span> <span class="o">&lt;-</span> <span class="nf">unite</span><span class="p">(</span><span class="n">wd</span><span class="p">,</span> <span class="n">ID</span><span class="p">,</span> <span class="n">CHROM</span><span class="p">,</span> <span class="n">BIN_START</span><span class="p">,</span> <span class="n">BIN_END</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#34;:&#34;</span><span class="p">,</span> <span class="n">remove</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">cd1</span> <span class="o">&lt;-</span> <span class="nf">unite</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">ID</span><span class="p">,</span> <span class="n">CHROM</span><span class="p">,</span> <span class="n">BIN_START</span><span class="p">,</span> <span class="n">BIN_END</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#34;:&#34;</span><span class="p">,</span> <span class="n">remove</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">wild_cult</span> <span class="o">&lt;-</span> <span class="nf">inner_join</span><span class="p">(</span><span class="n">wd1</span><span class="p">,</span> <span class="n">cd1</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="s">&#34;ID&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è®¡ç®—RODå’ŒPiæ¯”ç‡</span>
</span></span><span class="line"><span class="cl"><span class="n">wild_cult</span> <span class="o">&lt;-</span> <span class="n">wild_cult</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">rod</span> <span class="o">=</span> <span class="m">1</span> <span class="o">-</span> <span class="n">PI.y</span> <span class="o">/</span> <span class="n">PI.x</span><span class="p">,</span>  <span class="c1"># ROD = 1 - (subpop2çš„Pi / subpop1çš„Pi)</span>
</span></span><span class="line"><span class="cl">    <span class="n">pi_ratio1</span> <span class="o">=</span> <span class="n">PI.x</span> <span class="o">/</span> <span class="n">PI.y</span><span class="p">,</span>  <span class="c1"># subpop1çš„Pi / subpop2çš„Pi</span>
</span></span><span class="line"><span class="cl">    <span class="n">pi_ratio2</span> <span class="o">=</span> <span class="n">PI.y</span> <span class="o">/</span> <span class="n">PI.x</span>   <span class="c1"># subpop2çš„Pi / subpop1çš„Pi</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">separate</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;chr&#34;</span><span class="p">,</span> <span class="s">&#34;start&#34;</span><span class="p">,</span> <span class="s">&#34;end&#34;</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#34;:&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">unite</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">chr</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#34;:&#34;</span><span class="p">,</span> <span class="n">remove</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># RODç»˜å›¾</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># è®¡ç®—RODçš„é˜ˆå€¼ï¼ˆæŒ‡å®šåˆ†ä½æ•°ï¼‰</span>
</span></span><span class="line"><span class="cl">  <span class="n">rod_cut</span> <span class="o">&lt;-</span> <span class="nf">quantile</span><span class="p">(</span><span class="n">wild_cult</span><span class="o">$</span><span class="n">rod</span><span class="p">,</span> <span class="n">qtile</span><span class="p">,</span> <span class="n">na.rm</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># ç­›é€‰ROD&gt;0çš„æ•°æ®å¹¶ç»˜å›¾</span>
</span></span><span class="line"><span class="cl">  <span class="n">rod_data</span> <span class="o">&lt;-</span> <span class="nf">select</span><span class="p">(</span><span class="n">wild_cult</span><span class="p">,</span> <span class="n">ID</span><span class="p">,</span> <span class="n">chr</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">rod</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">rod</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># ä¿å­˜ä¸ºPDF</span>
</span></span><span class="line"><span class="cl">  <span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="s">&#34;ROD.pdf&#34;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#34;.&#34;</span><span class="p">),</span> <span class="n">width</span> <span class="o">=</span> <span class="m">10</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="m">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">CMplot</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">rod_data</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">type</span> <span class="o">=</span> <span class="s">&#34;p&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">plot.type</span> <span class="o">=</span> <span class="s">&#34;m&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOG10</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;blue4&#34;</span><span class="p">,</span> <span class="s">&#34;orange3&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">cex</span> <span class="o">=</span> <span class="m">0.2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">band</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">ylab.pos</span> <span class="o">=</span> <span class="m">2.5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">cex.axis</span> <span class="o">=</span> <span class="m">0.8</span><span class="p">,</span> <span class="c1"># è¯¥å‚æ•°ç‰ˆæœ¬ä¸å¯¹åˆ™ä½¿ç”¨ä¸äº†ï¼Œä¼šæŠ¥é”™</span>
</span></span><span class="line"><span class="cl">    <span class="n">threshold</span> <span class="o">=</span> <span class="n">rod_cut</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">amplify</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">ylab</span> <span class="o">=</span> <span class="nf">expr</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="s">&#34;ROD ( 1-&#34;</span><span class="p">,</span> <span class="kc">pi</span><span class="p">,</span> <span class="s">&#34;_subpop2/&#34;</span><span class="p">,</span> <span class="kc">pi</span><span class="p">,</span> <span class="s">&#34;_subpop1 )&#34;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">    <span class="n">file.output</span> <span class="o">=</span> <span class="kc">FALSE</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">dev.off</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># ä¿å­˜ä¸ºPNG</span>
</span></span><span class="line"><span class="cl">  <span class="nf">png</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="s">&#34;ROD.png&#34;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#34;.&#34;</span><span class="p">),</span> <span class="n">width</span> <span class="o">=</span> <span class="m">1000</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="m">300</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">CMplot</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">rod_data</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">type</span> <span class="o">=</span> <span class="s">&#34;p&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">plot.type</span> <span class="o">=</span> <span class="s">&#34;m&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOG10</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;blue4&#34;</span><span class="p">,</span> <span class="s">&#34;orange3&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">cex</span> <span class="o">=</span> <span class="m">0.2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">band</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">ylab.pos</span> <span class="o">=</span> <span class="m">2.5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">cex.axis</span> <span class="o">=</span> <span class="m">0.8</span><span class="p">,</span> <span class="c1"># è¯¥å‚æ•°ç‰ˆæœ¬ä¸å¯¹åˆ™ä½¿ç”¨ä¸äº†ï¼Œä¼šæŠ¥é”™</span>
</span></span><span class="line"><span class="cl">    <span class="n">threshold</span> <span class="o">=</span> <span class="n">rod_cut</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">amplify</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">ylab</span> <span class="o">=</span> <span class="nf">expr</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="s">&#34;ROD ( 1-&#34;</span><span class="p">,</span> <span class="kc">pi</span><span class="p">,</span> <span class="s">&#34;_subpop2/&#34;</span><span class="p">,</span> <span class="kc">pi</span><span class="p">,</span> <span class="s">&#34;_subpop1 )&#34;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">    <span class="n">file.output</span> <span class="o">=</span> <span class="kc">FALSE</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">dev.off</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Pi_ratio1ç»˜å›¾ï¼ˆsubpop1çš„Pi / subpop2çš„Piï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">ratio1_cut</span> <span class="o">&lt;-</span> <span class="nf">quantile</span><span class="p">(</span><span class="n">wild_cult</span><span class="o">$</span><span class="n">pi_ratio1</span><span class="p">,</span> <span class="n">qtile</span><span class="p">,</span> <span class="n">na.rm</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">ratio1_data</span> <span class="o">&lt;-</span> <span class="nf">select</span><span class="p">(</span><span class="n">wild_cult</span><span class="p">,</span> <span class="n">ID</span><span class="p">,</span> <span class="n">chr</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">pi_ratio1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># PDFæ ¼å¼</span>
</span></span><span class="line"><span class="cl">  <span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="s">&#34;PIratio1.pdf&#34;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#34;.&#34;</span><span class="p">),</span> <span class="n">width</span> <span class="o">=</span> <span class="m">10</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="m">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">CMplot</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">ratio1_data</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">type</span> <span class="o">=</span> <span class="s">&#34;p&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">plot.type</span> <span class="o">=</span> <span class="s">&#34;m&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOG10</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;blue4&#34;</span><span class="p">,</span> <span class="s">&#34;orange3&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">cex</span> <span class="o">=</span> <span class="m">0.2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">band</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">ylab.pos</span> <span class="o">=</span> <span class="m">2.5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">cex.axis</span> <span class="o">=</span> <span class="m">0.8</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">threshold</span> <span class="o">=</span> <span class="n">ratio1_cut</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">amplify</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">ylab</span> <span class="o">=</span> <span class="nf">expr</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="kc">pi</span><span class="p">,</span> <span class="s">&#34;_subpop1/&#34;</span><span class="p">,</span> <span class="kc">pi</span><span class="p">,</span> <span class="s">&#34;_subpop2&#34;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">    <span class="n">file.output</span> <span class="o">=</span> <span class="kc">FALSE</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">dev.off</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># PNGæ ¼å¼</span>
</span></span><span class="line"><span class="cl">  <span class="nf">png</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="s">&#34;PIratio1.png&#34;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#34;.&#34;</span><span class="p">),</span> <span class="n">width</span> <span class="o">=</span> <span class="m">1000</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="m">300</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">CMplot</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">ratio1_data</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">type</span> <span class="o">=</span> <span class="s">&#34;p&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">plot.type</span> <span class="o">=</span> <span class="s">&#34;m&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOG10</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;blue4&#34;</span><span class="p">,</span> <span class="s">&#34;orange3&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">cex</span> <span class="o">=</span> <span class="m">0.2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">band</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">ylab.pos</span> <span class="o">=</span> <span class="m">2.5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">cex.axis</span> <span class="o">=</span> <span class="m">0.8</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">threshold</span> <span class="o">=</span> <span class="n">ratio1_cut</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">amplify</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">ylab</span> <span class="o">=</span> <span class="nf">expr</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="kc">pi</span><span class="p">,</span> <span class="s">&#34;_subpop1/&#34;</span><span class="p">,</span> <span class="kc">pi</span><span class="p">,</span> <span class="s">&#34;_subpop2&#34;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">    <span class="n">file.output</span> <span class="o">=</span> <span class="kc">FALSE</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">dev.off</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Pi_ratio2ç»˜å›¾ï¼ˆsubpop2çš„Pi / subpop1çš„Piï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">ratio2_cut</span> <span class="o">&lt;-</span> <span class="nf">quantile</span><span class="p">(</span><span class="n">wild_cult</span><span class="o">$</span><span class="n">pi_ratio2</span><span class="p">,</span> <span class="n">qtile</span><span class="p">,</span> <span class="n">na.rm</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">ratio2_data</span> <span class="o">&lt;-</span> <span class="nf">select</span><span class="p">(</span><span class="n">wild_cult</span><span class="p">,</span> <span class="n">ID</span><span class="p">,</span> <span class="n">chr</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">pi_ratio2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># PDFæ ¼å¼</span>
</span></span><span class="line"><span class="cl">  <span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="s">&#34;PIratio2.pdf&#34;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#34;.&#34;</span><span class="p">),</span> <span class="n">width</span> <span class="o">=</span> <span class="m">10</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="m">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">CMplot</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">ratio2_data</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">type</span> <span class="o">=</span> <span class="s">&#34;p&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">plot.type</span> <span class="o">=</span> <span class="s">&#34;m&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOG10</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;blue4&#34;</span><span class="p">,</span> <span class="s">&#34;orange3&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">cex</span> <span class="o">=</span> <span class="m">0.2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">band</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">ylab.pos</span> <span class="o">=</span> <span class="m">2.5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">cex.axis</span> <span class="o">=</span> <span class="m">0.8</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">threshold</span> <span class="o">=</span> <span class="n">ratio2_cut</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">amplify</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">ylab</span> <span class="o">=</span> <span class="nf">expr</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="kc">pi</span><span class="p">,</span> <span class="s">&#34;_subpop2/&#34;</span><span class="p">,</span> <span class="kc">pi</span><span class="p">,</span> <span class="s">&#34;_subpop1&#34;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">    <span class="n">file.output</span> <span class="o">=</span> <span class="kc">FALSE</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">dev.off</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># PNGæ ¼å¼</span>
</span></span><span class="line"><span class="cl">  <span class="nf">png</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="s">&#34;PIratio2.png&#34;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#34;.&#34;</span><span class="p">),</span> <span class="n">width</span> <span class="o">=</span> <span class="m">1000</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="m">300</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">CMplot</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">ratio2_data</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">type</span> <span class="o">=</span> <span class="s">&#34;p&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">plot.type</span> <span class="o">=</span> <span class="s">&#34;m&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOG10</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;blue4&#34;</span><span class="p">,</span> <span class="s">&#34;orange3&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">cex</span> <span class="o">=</span> <span class="m">0.2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">band</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">ylab.pos</span> <span class="o">=</span> <span class="m">2.5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">cex.axis</span> <span class="o">=</span> <span class="m">0.8</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">threshold</span> <span class="o">=</span> <span class="n">ratio2_cut</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">amplify</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">ylab</span> <span class="o">=</span> <span class="nf">expr</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="kc">pi</span><span class="p">,</span> <span class="s">&#34;_subpop2/&#34;</span><span class="p">,</span> <span class="kc">pi</span><span class="p">,</span> <span class="s">&#34;_subpop1&#34;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">    <span class="n">file.output</span> <span class="o">=</span> <span class="kc">FALSE</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">dev.off</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¾“å‡ºæ±‡æ€»è¡¨æ ¼</span>
</span></span><span class="line"><span class="cl"><span class="n">outtable</span> <span class="o">&lt;-</span> <span class="nf">select</span><span class="p">(</span><span class="n">wild_cult</span><span class="p">,</span> <span class="n">ID</span><span class="p">,</span> <span class="n">chr</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">PI.x</span><span class="p">,</span> <span class="n">PI.y</span><span class="p">,</span> <span class="n">rod</span><span class="p">,</span> <span class="n">pi_ratio1</span><span class="p">,</span> <span class="n">pi_ratio2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">outfile</span> <span class="o">&lt;-</span> <span class="nf">paste</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="s">&#34;ROD_PiRatio.table&#34;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#34;.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">write.table</span><span class="p">(</span><span class="n">outtable</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#34;\t&#34;</span><span class="p">,</span> <span class="n">quote</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="n">row.names</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¾“å‡ºç»Ÿè®¡é˜ˆå€¼</span>
</span></span><span class="line"><span class="cl"><span class="n">cutfile</span> <span class="o">&lt;-</span> <span class="nf">paste</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="s">&#34;ROD_PiRatio.cutoff&#34;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#34;.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">outcut</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">Iterm</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;ROD(1-subpop2/subpop1)&#34;</span><span class="p">,</span> <span class="s">&#34;Piratio1(subpop1/subpop2)&#34;</span><span class="p">,</span> <span class="s">&#34;Piratio2(subpop2/subpop1)&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="n">cutoff</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="n">rod_cut</span><span class="p">,</span> <span class="n">ratio1_cut</span><span class="p">,</span> <span class="n">ratio2_cut</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">write.table</span><span class="p">(</span><span class="n">outcut</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="n">cutfile</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#34;\t&#34;</span><span class="p">,</span> <span class="n">quote</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="n">row.names</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ========== å•ç‹¬ä¿å­˜ ROD å€™é€‰åŒºåŸŸ ==========</span>
</span></span><span class="line"><span class="cl"><span class="n">rod_cut</span> <span class="o">&lt;-</span> <span class="nf">quantile</span><span class="p">(</span><span class="n">wild_cult</span><span class="o">$</span><span class="n">rod</span><span class="p">,</span> <span class="n">qtile</span><span class="p">,</span> <span class="n">na.rm</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ç­›é€‰ ROD è¶…è¿‡é˜ˆå€¼çš„åŒºåŸŸ</span>
</span></span><span class="line"><span class="cl"><span class="n">rod_candidates</span> <span class="o">&lt;-</span> <span class="n">wild_cult</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">filter</span><span class="p">(</span><span class="n">rod</span> <span class="o">&gt;</span> <span class="n">rod_cut</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">select</span><span class="p">(</span><span class="n">chr</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">PI.x</span><span class="p">,</span> <span class="n">PI.y</span><span class="p">,</span> <span class="n">rod</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">arrange</span><span class="p">(</span><span class="nf">desc</span><span class="p">(</span><span class="n">rod</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># é‡å‘½ååˆ—</span>
</span></span><span class="line"><span class="cl"><span class="nf">colnames</span><span class="p">(</span><span class="n">rod_candidates</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;Chr&#34;</span><span class="p">,</span> <span class="s">&#34;Start&#34;</span><span class="p">,</span> <span class="s">&#34;End&#34;</span><span class="p">,</span> <span class="s">&#34;Pi_wild&#34;</span><span class="p">,</span> <span class="s">&#34;Pi_cultivated&#34;</span><span class="p">,</span> <span class="s">&#34;ROD&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä¿å­˜</span>
</span></span><span class="line"><span class="cl"><span class="nf">write.table</span><span class="p">(</span><span class="n">rod_candidates</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">            <span class="nf">paste0</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="s">&#34;.ROD_candidates.txt&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">row.names</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="n">quote</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#34;\t&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="2-tajimas-d-åˆ†æ">2. Tajima&rsquo;s D åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#2-tajimas-d-åˆ†æ">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">vcf</span><span class="o">=</span>../../data/all.vcf
</span></span><span class="line"><span class="cl"><span class="nv">window</span><span class="o">=</span><span class="m">20000</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vcftools --vcf <span class="nv">$vcf</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    --TajimaD <span class="nv">$window</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    --keep ../../data/pop.SC.table <span class="se">\
</span></span></span><span class="line"><span class="cl">    --out TajimaD.pop1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vcftools --vcf <span class="nv">$vcf</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    --TajimaD <span class="nv">$window</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    --keep ../../data/pop.YZR.table <span class="se">\
</span></span></span><span class="line"><span class="cl">    --out TajimaD.pop2
</span></span></code></pre></div><h3 id="3-fst-åˆ†æè‹¥è¾“å…¥vcfgzå‚æ•°ä¿®æ”¹ä¸ºgzvcf">3. Fst åˆ†æï¼ˆè‹¥è¾“å…¥vcf.gz,å‚æ•°ä¿®æ”¹ä¸º&ndash;gzvcfï¼‰<a hidden class="anchor" aria-hidden="true" href="#3-fst-åˆ†æè‹¥è¾“å…¥vcfgzå‚æ•°ä¿®æ”¹ä¸ºgzvcf">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">vcf</span><span class="o">=</span>../../data/all.vcf
</span></span><span class="line"><span class="cl"><span class="nv">window</span><span class="o">=</span><span class="m">20000</span>
</span></span><span class="line"><span class="cl"><span class="nv">step</span><span class="o">=</span><span class="m">2000</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vcftools --vcf <span class="nv">$vcf</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    --fst-window-size <span class="nv">$window</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    --fst-window-step <span class="nv">$step</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    --weir-fst-pop ../../data/pop.SC.table <span class="se">\
</span></span></span><span class="line"><span class="cl">    --weir-fst-pop ../../data/pop.YZR.table <span class="se">\
</span></span></span><span class="line"><span class="cl">    --out ./Fst.pop1.pop2
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ä½¿ç”¨çª—å£æ–‡ä»¶ç»˜å›¾</span>
</span></span><span class="line"><span class="cl"><span class="n">fst_data</span> <span class="o">&lt;-</span> <span class="nf">read.table</span><span class="p">(</span><span class="s">&#34;../select.place/Fst.popC.popW.windowed.weir.fst&#34;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">head</span><span class="p">(</span><span class="n">fst_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># CHROM  BIN_START  BIN_END  N_VARIANTS  WEIGHTED_FST  MEAN_FST</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">fst_data</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">BIN_START</span><span class="o">/</span><span class="m">1000000</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">WEIGHTED_FST</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_point</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="m">0.6</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#34;steelblue&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="m">0.15</span><span class="p">,</span> <span class="n">linetype</span><span class="o">=</span><span class="s">&#34;dashed&#34;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#34;red&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">CHROM</span><span class="p">,</span> <span class="n">scales</span><span class="o">=</span><span class="s">&#34;free_x&#34;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="m">4</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&#34;Position (Mb)&#34;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">&#34;FST&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="n">title</span><span class="o">=</span><span class="s">&#34;Genome-wide FST (Cultivated vs Wild)&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_bw</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme</span><span class="p">(</span><span class="n">strip.text</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">ggsave</span><span class="p">(</span><span class="s">&#34;FST_plot.pdf&#34;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">12</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="m">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">ggsave</span><span class="p">(</span><span class="s">&#34;FST_plot.png&#34;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">12</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="m">8</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="m">300</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="4-rod--fst-è”åˆåˆ†æ">4. ROD + Fst è”åˆåˆ†æ<a hidden class="anchor" aria-hidden="true" href="#4-rod--fst-è”åˆåˆ†æ">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">fst</span><span class="o">=</span>../03.Fst/Fst.pop1.pop2.windowed.weir.fst
</span></span><span class="line"><span class="cl"><span class="nv">ROD</span><span class="o">=</span>../01.pi_ROD/Pi.ROD
</span></span><span class="line"><span class="cl"><span class="nv">gff</span><span class="o">=</span>../../data/genome.gff
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æå–æ˜¾è‘—ä½ç‚¹</span>
</span></span><span class="line"><span class="cl">perl ../../script/top_Fst_ROD_S.pl <span class="nv">$fst</span> <span class="nv">$ROD</span> 0.05 0.05 Fst_ROD.table Fst_ROD.stat
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ç­›é€‰topä½ç‚¹</span>
</span></span><span class="line"><span class="cl">awk <span class="s1">&#39;$NF==&#34;top&#34;&#39;</span> Fst_ROD.table &gt; Fst_ROD.table.top
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æå–åŸºå› æ³¨é‡Š</span>
</span></span><span class="line"><span class="cl">awk <span class="s1">&#39;$3==&#34;gene&#34;&#39;</span> <span class="nv">$gff</span> &gt; gene.gff
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ³¨é‡Šå€™é€‰åŸºå› </span>
</span></span><span class="line"><span class="cl">bedtools intersect -wo -F 0.1 -a Fst_ROD.table.top -b gene.gff <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    awk -F <span class="s2">&#34;\t&#34;</span> <span class="s1">&#39;{print $7&#34;\t&#34;$10&#34;\t&#34;$11&#34;\t&#34;$13&#34;\t&#34;$15}&#39;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    sort -u &gt; Fst_ROD.table.top.gene
</span></span></code></pre></div><h3 id="5-fsttajimadpi">5. Fst+tajimaD+Pi<a hidden class="anchor" aria-hidden="true" href="#5-fsttajimadpi">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># å‡†å¤‡Piã€TajimaD ã€Fst åˆ†æçš„ç»“æœæ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">cat all.list
</span></span><span class="line"><span class="cl">Fst Fst.subpop.windowed.weir.fst
</span></span><span class="line"><span class="cl">Pi_subpop1   subpop1.windowed.pi
</span></span><span class="line"><span class="cl">Pi_subpop2 subpop2.windowed.pi
</span></span><span class="line"><span class="cl">TajimaD_sub1     TajimaD.subpop1.Tajima.D
</span></span><span class="line"><span class="cl">TajimaD_sub2     TajimaD.subpop2.Tajima.D
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># ç»˜å›¾</span>
</span></span><span class="line"><span class="cl"><span class="c1"># åŠ è½½æ‰€éœ€åº“</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å®šä¹‰å‚æ•°</span>
</span></span><span class="line"><span class="cl"><span class="n">input</span> <span class="o">&lt;-</span> <span class="s">&#34;all.list&#34;</span><span class="c1"># æ›¿æ¢ä¸ºä½ çš„file.listæ–‡ä»¶è·¯å¾„</span>
</span></span><span class="line"><span class="cl"><span class="n">chrname</span> <span class="o">&lt;-</span> <span class="s">&#34;Chr01&#34;</span>    <span class="c1"># æ›¿æ¢ä¸ºä½ è¦åˆ†æçš„æŸ“è‰²ä½“åç§°</span>
</span></span><span class="line"><span class="cl"><span class="n">p_start</span> <span class="o">&lt;-</span> <span class="m">2000000</span>    <span class="c1"># æ›¿æ¢ä¸ºèµ·å§‹ä½ç½®</span>
</span></span><span class="line"><span class="cl"><span class="n">p_end</span> <span class="o">&lt;-</span> <span class="m">4000000</span>      <span class="c1"># æ›¿æ¢ä¸ºç»“æŸä½ç½®</span>
</span></span><span class="line"><span class="cl"><span class="n">prefix</span> <span class="o">&lt;-</span> <span class="s">&#34;output&#34;</span>    <span class="c1"># æ›¿æ¢ä¸ºè¾“å‡ºæ–‡ä»¶å‰ç¼€</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¯»å–æ–‡ä»¶åˆ—è¡¨</span>
</span></span><span class="line"><span class="cl"><span class="n">flist</span> <span class="o">&lt;-</span> <span class="nf">read.table</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆå§‹åŒ–æ•°æ®æ¡†</span>
</span></span><span class="line"><span class="cl"><span class="n">alldata</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¾ªç¯è¯»å–å¹¶å¤„ç†æ¯ä¸ªæ–‡ä»¶</span>
</span></span><span class="line"><span class="cl"><span class="kr">for</span><span class="p">(</span><span class="n">i</span> <span class="kr">in</span> <span class="m">1</span><span class="o">:</span><span class="nf">nrow</span><span class="p">(</span><span class="n">flist</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl"><span class="n">type</span> <span class="o">&lt;-</span> <span class="n">flist[i</span><span class="p">,</span> <span class="m">1</span><span class="n">]</span>
</span></span><span class="line"><span class="cl">  <span class="n">data</span> <span class="o">&lt;-</span> <span class="nf">read.table</span><span class="p">(</span><span class="n">flist[i</span><span class="p">,</span> <span class="m">2</span><span class="n">]</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æå–ç¬¬ä¸€åˆ—æŸ“è‰²ä½“ï¼Œç¬¬äºŒåˆ—èµ·å§‹ä½ç½®ï¼Œæœ€åä¸€åˆ—å€¼</span>
</span></span><span class="line"><span class="cl">  <span class="n">data_f</span> <span class="o">&lt;-</span> <span class="n">data[</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="nf">ncol</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="n">]</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä¿®æ”¹åˆ—å</span>
</span></span><span class="line"><span class="cl">  <span class="nf">colnames</span><span class="p">(</span><span class="n">data_f</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;chr&#34;</span><span class="p">,</span> <span class="s">&#34;start&#34;</span><span class="p">,</span> <span class="s">&#34;val&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æŒ‰ä½ç½®ä¿¡æ¯è¿‡æ»¤æ•°æ®</span>
</span></span><span class="line"><span class="cl">  <span class="n">data_f</span> <span class="o">&lt;-</span> <span class="n">data_f</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">    <span class="n">dplyr</span><span class="o">::</span><span class="nf">filter</span><span class="p">(</span><span class="n">chr</span> <span class="o">==</span> <span class="n">chrname</span> <span class="o">&amp;</span> <span class="n">start</span> <span class="o">&gt;</span> <span class="n">p_start</span> <span class="o">&amp;</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">p_end</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ·»åŠ æ•°æ®æ¥æº</span>
</span></span><span class="line"><span class="cl">  <span class="n">data_f</span> <span class="o">&lt;-</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">data_f</span><span class="p">,</span> <span class="n">type</span> <span class="o">=</span> <span class="nf">rep</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="nf">nrow</span><span class="p">(</span><span class="n">data_f</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆå¹¶æˆä¸€ä¸ªè¡¨æ ¼</span>
</span></span><span class="line"><span class="cl">  <span class="n">alldata</span> <span class="o">&lt;-</span> <span class="nf">rbind</span><span class="p">(</span><span class="n">alldata</span><span class="p">,</span> <span class="n">data_f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ•°æ®å¤„ç†</span>
</span></span><span class="line"><span class="cl"><span class="n">alldata_f</span> <span class="o">&lt;-</span> <span class="n">tidyr</span><span class="o">::</span><span class="nf">separate</span><span class="p">(</span><span class="n">alldata</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;TP&#34;</span><span class="p">,</span> <span class="s">&#34;pop&#34;</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#34;_&#34;</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="n">alldata_f</span><span class="o">$</span><span class="n">val</span><span class="nf">[which</span><span class="p">(</span><span class="n">alldata_f</span><span class="o">$</span><span class="n">TP</span> <span class="o">==</span> <span class="s">&#34;Fst&#34;</span> <span class="o">&amp;</span> <span class="n">alldata_f</span><span class="o">$</span><span class="n">val</span> <span class="o">&lt;</span> <span class="m">0</span><span class="p">)</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="m">0</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºç»˜å›¾</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">alldata_f</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">start</span><span class="o">/</span><span class="m">1000000</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">val</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">pop</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_point</span><span class="p">(</span><span class="n">cex</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&#34;loess&#34;</span><span class="p">,</span> <span class="n">span</span> <span class="o">=</span> <span class="m">0.25</span><span class="p">,</span> <span class="n">cex</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">,</span> <span class="n">se</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_bw</span><span class="p">()</span> <span class="o">+</span>  <span class="c1"># è®¾ç½®ä¸»é¢˜</span>
</span></span><span class="line"><span class="cl">  <span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">TP</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">             <span class="n">scales</span> <span class="o">=</span> <span class="s">&#34;free_y&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">             <span class="n">ncol</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">             <span class="n">strip.position</span> <span class="o">=</span> <span class="s">&#34;left&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">strip.background</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span>  <span class="c1"># å»é™¤æ ‡é¢˜èƒŒæ™¯</span>
</span></span><span class="line"><span class="cl">    <span class="n">strip.text.x</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span>      <span class="c1"># å»é™¤è½´title</span>
</span></span><span class="line"><span class="cl">    <span class="n">strip.placement</span> <span class="o">=</span> <span class="s">&#34;outside&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">axis.title.x</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span>      <span class="c1"># å»é™¤æ¨ªè½´title</span>
</span></span><span class="line"><span class="cl">    <span class="n">axis.title.y</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span>      <span class="c1"># å»é™¤yè½´title</span>
</span></span><span class="line"><span class="cl">    <span class="n">panel.spacing.y</span> <span class="o">=</span> <span class="nf">unit</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;lines&#34;</span><span class="p">),</span>  <span class="c1"># å»é™¤é—´è·</span>
</span></span><span class="line"><span class="cl">    <span class="n">legend.title</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span>      <span class="c1"># å»é™¤legend title</span>
</span></span><span class="line"><span class="cl">    <span class="n">panel.grid.major</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span>  <span class="c1"># å»é™¤ç½‘æ ¼</span>
</span></span><span class="line"><span class="cl">    <span class="n">panel.grid.minor</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">()</span>   <span class="c1"># å»é™¤ç½‘æ ¼</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä¿å­˜PDFæ–‡ä»¶</span>
</span></span><span class="line"><span class="cl"><span class="nf">pdf</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="s">&#34;combine_figure.pdf&#34;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#34;.&#34;</span><span class="p">),</span> <span class="n">width</span> <span class="o">=</span> <span class="m">5</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="m">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">dev.off</span><span class="p">()</span>
</span></span></code></pre></div><h3 id="6-fstrod-å°è¯•å€ŸåŠ©aiå¼¥è¡¥ä¸Šå…å¾—perlè„šæœ¬">6 Fst+Rod (å°è¯•å€ŸåŠ©aiå¼¥è¡¥ä¸Šå…å¾—Perlè„šæœ¬)<a hidden class="anchor" aria-hidden="true" href="#6-fstrod-å°è¯•å€ŸåŠ©aiå¼¥è¡¥ä¸Šå…å¾—perlè„šæœ¬">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/perl</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">strict</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">warnings</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ£€æŸ¥è¾“å…¥å‚æ•°</span>
</span></span><span class="line"><span class="cl"><span class="nb">die</span> <span class="s">&#34;Usage: $0 &lt;Fst_file&gt; &lt;ROD_file&gt; &lt;Fst_top_percent&gt; &lt;ROD_top_percent&gt; &lt;out_table&gt; &lt;out_stat&gt;\n&#34;</span> <span class="k">unless</span> <span class="nv">@ARGV</span> <span class="o">==</span> <span class="mi">6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è§£æå‚æ•°</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="p">(</span><span class="nv">$fst_file</span><span class="p">,</span> <span class="nv">$rod_file</span><span class="p">,</span> <span class="nv">$fst_pct</span><span class="p">,</span> <span class="nv">$rod_pct</span><span class="p">,</span> <span class="nv">$out_table</span><span class="p">,</span> <span class="nv">$out_stat</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@ARGV</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># -------------------------- å¤„ç†Fstæ–‡ä»¶ --------------------------</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="p">(</span><span class="nv">%fst_data</span><span class="p">,</span> <span class="nv">@fst_values</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nb">open</span> <span class="k">my</span> <span class="nv">$fst_fh</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">,</span> <span class="nv">$fst_file</span> <span class="ow">or</span> <span class="nb">die</span> <span class="s">&#34;æ— æ³•æ‰“å¼€Fstæ–‡ä»¶: $!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$fst_header</span> <span class="o">=</span> <span class="sr">&lt;$fst_fh&gt;</span><span class="p">;</span> <span class="c1"># è·³è¿‡è¡¨å¤´</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$line</span> <span class="o">=</span> <span class="sr">&lt;$fst_fh&gt;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">chomp</span> <span class="nv">$line</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">@cols</span> <span class="o">=</span> <span class="nb">split</span> <span class="sr">/\t/</span><span class="p">,</span> <span class="nv">$line</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="p">(</span><span class="nv">$chr</span><span class="p">,</span> <span class="nv">$start</span><span class="p">,</span> <span class="nv">$end</span><span class="p">,</span> <span class="nv">$fst</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@cols</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">];</span> <span class="c1"># Fståœ¨weir.fstç¬¬6åˆ—ï¼ˆç´¢å¼•5ï¼‰</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># è¿‡æ»¤æ— æ•ˆå€¼</span>
</span></span><span class="line"><span class="cl">    <span class="k">next</span> <span class="k">if</span> <span class="nv">$fst</span> <span class="ow">eq</span> <span class="s">&#39;NA&#39;</span> <span class="o">||</span> <span class="nv">$fst</span> <span class="o">=~</span><span class="sr"> /NaN/</span> <span class="o">||</span> <span class="nv">$fst</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="nv">$fst</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># ç»Ÿä¸€æŸ“è‰²ä½“å‘½åï¼ˆåŒ¹é…RODæ–‡ä»¶çš„chræ ¼å¼ï¼šglyma.Wm82.gnm6.Gm01ï¼‰</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$fst_data</span><span class="p">{</span><span class="s">&#34;$chr:$start:$end&#34;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$fst</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">push</span> <span class="nv">@fst_values</span><span class="p">,</span> <span class="nv">$fst</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">close</span> <span class="nv">$fst_fh</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è®¡ç®—Fst topé˜ˆå€¼ï¼ˆé™åºæ’åºï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="nv">@fst_values</span> <span class="o">=</span> <span class="nb">sort</span> <span class="p">{</span><span class="nv">$b</span> <span class="sr">&lt;=&gt;</span> <span class="nv">$a</span><span class="p">}</span> <span class="nv">@fst_values</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$fst_top_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">scalar</span><span class="p">(</span><span class="nv">@fst_values</span><span class="p">)</span> <span class="o">*</span> <span class="nv">$fst_pct</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$fst_cutoff</span> <span class="o">=</span> <span class="nv">$fst_values</span><span class="p">[</span><span class="nv">$fst_top_idx</span><span class="p">]</span> <span class="sr">//</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># -------------------------- å¤„ç†RODæ–‡ä»¶ï¼ˆé€‚é…ä½ çš„æ ¼å¼ï¼‰ --------------------------</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="p">(</span><span class="nv">%rod_data</span><span class="p">,</span> <span class="nv">@rod_values</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nb">open</span> <span class="k">my</span> <span class="nv">$rod_fh</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">,</span> <span class="nv">$rod_file</span> <span class="ow">or</span> <span class="nb">die</span> <span class="s">&#34;æ— æ³•æ‰“å¼€RODæ–‡ä»¶: $!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$rod_header</span> <span class="o">=</span> <span class="sr">&lt;$rod_fh&gt;</span><span class="p">;</span> <span class="c1"># è·³è¿‡è¡¨å¤´</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$line</span> <span class="o">=</span> <span class="sr">&lt;$rod_fh&gt;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">chomp</span> <span class="nv">$line</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">@cols</span> <span class="o">=</span> <span class="nb">split</span> <span class="sr">/\t/</span><span class="p">,</span> <span class="nv">$line</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># é€‚é…ä½ çš„æ–‡ä»¶ï¼šchr(1), start(2), end(3), rod(6)</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="p">(</span><span class="nv">$chr</span><span class="p">,</span> <span class="nv">$start</span><span class="p">,</span> <span class="nv">$end</span><span class="p">,</span> <span class="nv">$rod</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@cols</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">];</span> 
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># è¿‡æ»¤æ— æ•ˆ/å¼‚å¸¸å€¼ï¼ˆRODå€¼èŒƒå›´0~1ï¼‰</span>
</span></span><span class="line"><span class="cl">    <span class="k">next</span> <span class="k">if</span> <span class="nv">$rod</span> <span class="ow">eq</span> <span class="s">&#39;NA&#39;</span> <span class="o">||</span> <span class="nv">$rod</span> <span class="o">=~</span><span class="sr"> /NaN/</span> <span class="o">||</span> <span class="nv">$rod</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nv">$rod</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nv">$rod_data</span><span class="p">{</span><span class="s">&#34;$chr:$start:$end&#34;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$rod</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">push</span> <span class="nv">@rod_values</span><span class="p">,</span> <span class="nv">$rod</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">close</span> <span class="nv">$rod_fh</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è®¡ç®—ROD topé˜ˆå€¼ï¼ˆé™åºæ’åºï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="nv">@rod_values</span> <span class="o">=</span> <span class="nb">sort</span> <span class="p">{</span><span class="nv">$b</span> <span class="sr">&lt;=&gt;</span> <span class="nv">$a</span><span class="p">}</span> <span class="nv">@rod_values</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$rod_top_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">scalar</span><span class="p">(</span><span class="nv">@rod_values</span><span class="p">)</span> <span class="o">*</span> <span class="nv">$rod_pct</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$rod_cutoff</span> <span class="o">=</span> <span class="nv">$rod_values</span><span class="p">[</span><span class="nv">$rod_top_idx</span><span class="p">]</span> <span class="sr">//</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># -------------------------- è¾“å‡ºç»“æœè¡¨æ ¼ --------------------------</span>
</span></span><span class="line"><span class="cl"><span class="nb">open</span> <span class="k">my</span> <span class="nv">$table_fh</span><span class="p">,</span> <span class="s">&#39;&gt;&#39;</span><span class="p">,</span> <span class="nv">$out_table</span> <span class="ow">or</span> <span class="nb">die</span> <span class="s">&#34;æ— æ³•å†™å…¥è¡¨æ ¼: $!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">print</span> <span class="nv">$table_fh</span> <span class="nb">join</span><span class="p">(</span><span class="s">&#34;\t&#34;</span><span class="p">,</span> <span class="sx">qw/Chr Start End Fst ROD Status/</span><span class="p">),</span> <span class="s">&#34;\n&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="p">(</span><span class="nv">$total_top</span><span class="p">,</span> <span class="nv">$total_sites</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">foreach</span> <span class="k">my</span> <span class="nv">$key</span> <span class="p">(</span><span class="nb">keys</span> <span class="nv">%fst_data</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="p">(</span><span class="nv">$chr</span><span class="p">,</span> <span class="nv">$start</span><span class="p">,</span> <span class="nv">$end</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span> <span class="sr">/:/</span><span class="p">,</span> <span class="nv">$key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$fst_val</span> <span class="o">=</span> <span class="nv">$fst_data</span><span class="p">{</span><span class="nv">$key</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$rod_val</span> <span class="o">=</span> <span class="nv">$rod_data</span><span class="p">{</span><span class="nv">$key</span><span class="p">}</span> <span class="sr">//</span> <span class="s">&#39;NA&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$status</span> <span class="o">=</span> <span class="s">&#39;normal&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ä»…å½“ä¸¤ä¸ªå€¼éƒ½è¾¾æ ‡æ—¶æ ‡è®°ä¸ºtop</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nv">$fst_val</span> <span class="o">&gt;=</span> <span class="nv">$fst_cutoff</span> <span class="o">&amp;&amp;</span> <span class="nv">$rod_val</span> <span class="ow">ne</span> <span class="s">&#39;NA&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$rod_val</span> <span class="o">&gt;=</span> <span class="nv">$rod_cutoff</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$status</span> <span class="o">=</span> <span class="s">&#39;top&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$total_top</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">print</span> <span class="nv">$table_fh</span> <span class="nb">join</span><span class="p">(</span><span class="s">&#34;\t&#34;</span><span class="p">,</span> <span class="nv">$chr</span><span class="p">,</span> <span class="nv">$start</span><span class="p">,</span> <span class="nv">$end</span><span class="p">,</span> <span class="nv">$fst_val</span><span class="p">,</span> <span class="nv">$rod_val</span><span class="p">,</span> <span class="nv">$status</span><span class="p">),</span> <span class="s">&#34;\n&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$total_sites</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">close</span> <span class="nv">$table_fh</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># -------------------------- è¾“å‡ºç»Ÿè®¡æ–‡ä»¶ --------------------------</span>
</span></span><span class="line"><span class="cl"><span class="nb">open</span> <span class="k">my</span> <span class="nv">$stat_fh</span><span class="p">,</span> <span class="s">&#39;&gt;&#39;</span><span class="p">,</span> <span class="nv">$out_stat</span> <span class="ow">or</span> <span class="nb">die</span> <span class="s">&#34;æ— æ³•å†™å…¥ç»Ÿè®¡æ–‡ä»¶: $!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$top_ratio</span> <span class="o">=</span> <span class="nv">$total_sites</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">?</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s">&#34;%.4f&#34;</span><span class="p">,</span> <span class="nv">$total_top</span><span class="o">/</span><span class="nv">$total_sites</span><span class="p">)</span> <span class="p">:</span> <span class="s">&#34;0.0000&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">print</span> <span class="nv">$stat_fh</span> <span class="s">&lt;&lt;&#34;</span><span class="dl">STAT</span><span class="s">&#34;;
</span></span></span><span class="line"><span class="cl"><span class="s"># Fst + ROD è”åˆåˆ†æç»Ÿè®¡
</span></span></span><span class="line"><span class="cl"><span class="s">Fstæ–‡ä»¶: $fst_file
</span></span></span><span class="line"><span class="cl"><span class="s">RODæ–‡ä»¶: $rod_file
</span></span></span><span class="line"><span class="cl"><span class="s">Fst top $fst_pct é˜ˆå€¼: $fst_cutoff
</span></span></span><span class="line"><span class="cl"><span class="s">ROD top $rod_pct é˜ˆå€¼: $rod_cutoff
</span></span></span><span class="line"><span class="cl"><span class="s">æ€»æœ‰æ•ˆä½ç‚¹æ•°é‡: $total_sites
</span></span></span><span class="line"><span class="cl"><span class="s">Topæ˜¾è‘—ä½ç‚¹æ•°é‡: $total_top
</span></span></span><span class="line"><span class="cl"><span class="s">Topä½ç‚¹å æ¯”: $top_ratio
</span></span></span><span class="line"><span class="cl"><span class="dl">STAT</span>
</span></span><span class="line"><span class="cl"><span class="nb">close</span> <span class="nv">$stat_fh</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¿è¡Œæç¤º</span>
</span></span><span class="line"><span class="cl"><span class="k">print</span> <span class="s">&#34;åˆ†æå®Œæˆï¼\n&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">print</span> <span class="s">&#34;ç»“æœè¡¨æ ¼: $out_table\nç»Ÿè®¡æ–‡ä»¶: $out_stat\n&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">print</span> <span class="s">&#34;Fsté˜ˆå€¼: $fst_cutoff | RODé˜ˆå€¼: $rod_cutoff | Topä½ç‚¹: $total_top\n&#34;</span><span class="p">;</span>
</span></span></code></pre></div><p>ROD_piæ–‡ä»¶æ ¼å¼ï¼Œè¦ä¸perlç´¢å¼•åˆ—å¯¹åº”</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ID	chr	start	end	PI.x	PI.y	rod	pi_ratio1	pi_ratio2
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># è”åˆFST RODåˆ†æ</span>
</span></span><span class="line"><span class="cl"><span class="nv">fst</span><span class="o">=</span>Fst.popC.popW.windowed.weir.fst
</span></span><span class="line"><span class="cl"><span class="nv">ROD</span><span class="o">=</span>outsample.ROD_PiRatio.table
</span></span><span class="line"><span class="cl"><span class="nv">gff</span><span class="o">=</span>Wm82.gnm6.gff3
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æå–æ˜¾è‘—ä½ç‚¹</span>
</span></span><span class="line"><span class="cl">perl ~/pub/script/top_Fst_ROD_S.pl <span class="nv">$fst</span> <span class="nv">$ROD</span> 0.05 0.05 Fst_ROD.table Fst_ROD.stat
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ç­›é€‰topä½ç‚¹</span>
</span></span><span class="line"><span class="cl">awk <span class="s1">&#39;$NF==&#34;top&#34;&#39;</span> Fst_ROD.table &gt; Fst_ROD.table.top
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æå–åŸºå› æ³¨é‡Š</span>
</span></span><span class="line"><span class="cl">awk <span class="s1">&#39;$3==&#34;gene&#34;&#39;</span> <span class="nv">$gff</span> &gt; gene.gff
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ³¨é‡Šå€™é€‰åŸºå› </span>
</span></span><span class="line"><span class="cl">bedtools intersect -wo -F 0.1 -a Fst_ROD.table.top -b gene.gff <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    awk -F <span class="s2">&#34;\t&#34;</span> <span class="s1">&#39;{print $7&#34;\t&#34;$10&#34;\t&#34;$11&#34;\t&#34;$13&#34;\t&#34;$15}&#39;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    sort -u &gt; Fst_ROD.table.top.gene
</span></span></code></pre></div><h2 id="gwas-åˆ†æ">GWAS åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#gwas-åˆ†æ">#</a></h2>
<h3 id="1-åŸºå› å‹å¡«å……">1. åŸºå› å‹å¡«å……<a hidden class="anchor" aria-hidden="true" href="#1-åŸºå› å‹å¡«å……">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">beagle -Xmx4g -Djava.io.tmpdir<span class="o">=</span>./TMP <span class="se">\
</span></span></span><span class="line"><span class="cl">    <span class="nv">gt</span><span class="o">=</span>../data/all.vcf <span class="se">\
</span></span></span><span class="line"><span class="cl">    <span class="nv">out</span><span class="o">=</span>all.impute <span class="se">\
</span></span></span><span class="line"><span class="cl">    <span class="nv">impute</span><span class="o">=</span><span class="nb">true</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    <span class="nv">window</span><span class="o">=</span><span class="m">10</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    <span class="nv">nthreads</span><span class="o">=</span><span class="m">2</span>
</span></span></code></pre></div><h3 id="2-æ ‡å‡†-gwas-åˆ†æ">2. æ ‡å‡† GWAS åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#2-æ ‡å‡†-gwas-åˆ†æ">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Step 1: å‡†å¤‡VCFæ•°æ®</span>
</span></span><span class="line"><span class="cl">plink --vcf ../data/all.vcf <span class="se">\
</span></span></span><span class="line"><span class="cl">    --maf 0.05 <span class="se">\
</span></span></span><span class="line"><span class="cl">    --geno 0.1 <span class="se">\
</span></span></span><span class="line"><span class="cl">    --recode12 <span class="se">\
</span></span></span><span class="line"><span class="cl">    --output-missing-genotype <span class="m">0</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    --transpose <span class="se">\
</span></span></span><span class="line"><span class="cl">    --out snp_filter <span class="se">\
</span></span></span><span class="line"><span class="cl">    --set-missing-var-ids @:# <span class="se">\
</span></span></span><span class="line"><span class="cl">    --allow-extra-chr
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å‡†å¤‡è¡¨å‹æ•°æ®</span>
</span></span><span class="line"><span class="cl">perl ../script/sort_pheno.pl snp_filter.tfam ../data/trait.table &gt; trait.sort.txt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 2: è®¡ç®—äº²ç¼˜å…³ç³»çŸ©é˜µ</span>
</span></span><span class="line"><span class="cl">/pub/software/emmax/emmax-kin-intel64 -v -d <span class="m">10</span> -o ./pop.kinship snp_filter
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 3: è¿è¡ŒGWAS</span>
</span></span><span class="line"><span class="cl">/pub/software/emmax/emmax-intel64 -v -d <span class="m">10</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    -t snp_filter <span class="se">\
</span></span></span><span class="line"><span class="cl">    -p trait.sort.txt <span class="se">\
</span></span></span><span class="line"><span class="cl">    -k pop.kinship <span class="se">\
</span></span></span><span class="line"><span class="cl">    -o emmax.out 1&gt; emmax.log 2&gt;emmax.err
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 4: ç»˜åˆ¶æ›¼å“ˆé¡¿å›¾</span>
</span></span><span class="line"><span class="cl">paste snp_filter.map emmax.out.ps <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    awk <span class="s1">&#39;BEGIN{print &#34;SNP\tCHR\tBP\tP&#34;}{if($2==$5){print $2&#34;\t&#34;$1&#34;\t&#34;$4&#34;\t&#34;$NF}}&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    &gt; emmax.out.ps.manht_input
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Rscript ../script/manhattan.R emmax.out.ps.manht_input emmax.out.ps.manht_figure
</span></span></code></pre></div><h3 id="3-gwas-q-åˆ†æåŠ å…¥ç¾¤ä½“ç»“æ„åå˜é‡">3. GWAS-Q åˆ†æï¼ˆåŠ å…¥ç¾¤ä½“ç»“æ„åå˜é‡ï¼‰<a hidden class="anchor" aria-hidden="true" href="#3-gwas-q-åˆ†æåŠ å…¥ç¾¤ä½“ç»“æ„åå˜é‡">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># é“¾æ¥æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">ln -s ../01.GWAS/snp_filter.tped
</span></span><span class="line"><span class="cl">ln -s ../01.GWAS/snp_filter.tfam
</span></span><span class="line"><span class="cl">ln -s ../01.GWAS/snp_filter.nosex
</span></span><span class="line"><span class="cl">ln -s ../01.GWAS/snp_filter.map
</span></span><span class="line"><span class="cl">ln -s ../01.GWAS/trait.sort.txt
</span></span><span class="line"><span class="cl">ln -s ../../02.population_genetics/03.structure/all.3.Q
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å‡†å¤‡QçŸ©é˜µ</span>
</span></span><span class="line"><span class="cl">paste snp_filter.nosex all.3.Q <span class="p">|</span> awk <span class="s1">&#39;{print $1&#34; &#34;$1&#34; 1 &#34;$3&#34; &#34;$4}&#39;</span> &gt; pop.Qmatrix
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¿è¡ŒGWAS</span>
</span></span><span class="line"><span class="cl">/pub/software/emmax/emmax-intel64 -v -d <span class="m">10</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    -t snp_filter <span class="se">\
</span></span></span><span class="line"><span class="cl">    -p trait.sort.txt <span class="se">\
</span></span></span><span class="line"><span class="cl">    -k pop.kinship <span class="se">\
</span></span></span><span class="line"><span class="cl">    -c pop.Qmatrix <span class="se">\
</span></span></span><span class="line"><span class="cl">    -o emmax.out 1&gt; emmax.log 2&gt;emmax.err
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ç»˜åˆ¶æ›¼å“ˆé¡¿å›¾</span>
</span></span><span class="line"><span class="cl">paste snp_filter.map emmax.out.ps <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    awk <span class="s1">&#39;BEGIN{print &#34;SNP\tCHR\tBP\tP&#34;}{if($2==$5){print $2&#34;\t&#34;$1&#34;\t&#34;$4&#34;\t&#34;$NF}}&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    &gt; emmax.out.ps.manht_input
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Rscript ../script/manhattan.R emmax.out.ps.manht_input emmax.out.ps.manht_figure_Q
</span></span></code></pre></div><h3 id="4-çœŸå®æ•°æ®-gwas">4. çœŸå®æ•°æ® GWAS<a hidden class="anchor" aria-hidden="true" href="#4-çœŸå®æ•°æ®-gwas">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Step 1: å‡†å¤‡æ•°æ®</span>
</span></span><span class="line"><span class="cl">plink --vcf ../data_real/Sample215.M5M8H3.2allel.vcf <span class="se">\
</span></span></span><span class="line"><span class="cl">    --maf 0.05 <span class="se">\
</span></span></span><span class="line"><span class="cl">    --geno 0.1 <span class="se">\
</span></span></span><span class="line"><span class="cl">    --recode12 <span class="se">\
</span></span></span><span class="line"><span class="cl">    --output-missing-genotype <span class="m">0</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    --transpose <span class="se">\
</span></span></span><span class="line"><span class="cl">    --out snp_filter <span class="se">\
</span></span></span><span class="line"><span class="cl">    --set-missing-var-ids @:# <span class="se">\
</span></span></span><span class="line"><span class="cl">    --allow-extra-chr
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">perl ../script/sort_pheno.pl snp_filter.tfam ../data_real/trait.C16_0.table &gt; trait.sort.txt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 2: è®¡ç®—äº²ç¼˜å…³ç³»çŸ©é˜µ</span>
</span></span><span class="line"><span class="cl">/pub/software/emmax/emmax-kin-intel64 -v -d <span class="m">10</span> -o ./pop.kinship snp_filter
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 3: è¿è¡ŒGWAS</span>
</span></span><span class="line"><span class="cl">/pub/software/emmax/emmax-intel64 -v -d <span class="m">10</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    -t snp_filter <span class="se">\
</span></span></span><span class="line"><span class="cl">    -p trait.sort.txt <span class="se">\
</span></span></span><span class="line"><span class="cl">    -k pop.kinship <span class="se">\
</span></span></span><span class="line"><span class="cl">    -o emmax.out 1&gt; emmax.log 2&gt;emmax.err
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 4: ç»˜åˆ¶æ›¼å“ˆé¡¿å›¾</span>
</span></span><span class="line"><span class="cl">paste snp_filter.map emmax.out.ps <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    awk <span class="s1">&#39;BEGIN{print &#34;SNP\tCHR\tBP\tP&#34;}{if($2==$5){print $2&#34;\t&#34;$1&#34;\t&#34;$4&#34;\t&#34;$NF}}&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    &gt; emmax.out.ps.manht_input
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Rscript ../script/manhattan.R emmax.out.ps.manht_input emmax.out.ps.manht_figure_readData
</span></span></code></pre></div><h2 id="qtl-seq-åˆ†æ">QTL-seq åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#qtl-seq-åˆ†æ">#</a></h2>
<h3 id="1-vcf-è½¬æ¢ä¸º-table-æ ¼å¼">1. VCF è½¬æ¢ä¸º Table æ ¼å¼<a hidden class="anchor" aria-hidden="true" href="#1-vcf-è½¬æ¢ä¸º-table-æ ¼å¼">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">ref</span><span class="o">=</span>&lt;reference.fasta&gt;
</span></span><span class="line"><span class="cl"><span class="nv">vcf</span><span class="o">=</span>&lt;input.vcf&gt;
</span></span><span class="line"><span class="cl"><span class="nv">outfile</span><span class="o">=</span>&lt;output.table&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">gatk VariantsToTable <span class="se">\
</span></span></span><span class="line"><span class="cl">    -R <span class="nv">$ref</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    -V <span class="nv">$vcf</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">    -F CHROM -F POS -F REF -F ALT <span class="se">\
</span></span></span><span class="line"><span class="cl">    -GF AD -GF DP -GF GQ -GF PL <span class="se">\
</span></span></span><span class="line"><span class="cl">    -O <span class="nv">$outfile</span>
</span></span></code></pre></div><h3 id="2-qtl-seq-åˆ†ær-è„šæœ¬">2. QTL-seq åˆ†æï¼ˆR è„šæœ¬ï¼‰<a hidden class="anchor" aria-hidden="true" href="#2-qtl-seq-åˆ†ær-è„šæœ¬">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-R" data-lang="R"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">QTLseqr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è®¾ç½®å‚æ•°</span>
</span></span><span class="line"><span class="cl"><span class="n">HighBulk</span> <span class="o">&lt;-</span> <span class="s">&#34;SRR834931&#34;</span>  <span class="c1"># é«˜å€¼æ··æ± åç§°</span>
</span></span><span class="line"><span class="cl"><span class="n">LowBulk</span> <span class="o">&lt;-</span> <span class="s">&#34;SRR834927&#34;</span>   <span class="c1"># ä½å€¼æ··æ± åç§°</span>
</span></span><span class="line"><span class="cl"><span class="n">Chroms</span> <span class="o">&lt;-</span> <span class="nf">paste0</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="s">&#34;Chr&#34;</span><span class="p">,</span> <span class="m">12</span><span class="p">),</span> <span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">)</span>  <span class="c1"># æŸ“è‰²ä½“åˆ—è¡¨</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ==================== æ•°æ®è¯»å– ====================</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">&lt;-</span> <span class="nf">importFromGATK</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">file</span> <span class="o">=</span> <span class="s">&#34;../data/Yang_et_al_2013.table&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">highBulk</span> <span class="o">=</span> <span class="n">HighBulk</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">lowBulk</span> <span class="o">=</span> <span class="n">LowBulk</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">chromList</span> <span class="o">=</span> <span class="n">Chroms</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ==================== è´¨é‡æ£€æŸ¥å›¾ ====================</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æ·±åº¦åˆ†å¸ƒå›¾</span>
</span></span><span class="line"><span class="cl"><span class="n">p1</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">)</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">    <span class="nf">geom_histogram</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">DP.HIGH</span> <span class="o">+</span> <span class="n">DP.LOW</span><span class="p">))</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">    <span class="nf">xlim</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">800</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">pdf</span><span class="p">(</span><span class="n">file</span> <span class="o">=</span> <span class="s">&#34;SNP_depth.pdf&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p1</span>
</span></span><span class="line"><span class="cl"><span class="nf">dev.off</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># REFç­‰ä½åŸºå› é¢‘ç‡åˆ†å¸ƒ</span>
</span></span><span class="line"><span class="cl"><span class="n">p2</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">)</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">    <span class="nf">geom_histogram</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">REF_FRQ</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nf">pdf</span><span class="p">(</span><span class="n">file</span> <span class="o">=</span> <span class="s">&#34;ref_allele_frequency.pdf&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p2</span>
</span></span><span class="line"><span class="cl"><span class="nf">dev.off</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># é«˜å€¼æ··æ± SNP-indexåˆ†å¸ƒ</span>
</span></span><span class="line"><span class="cl"><span class="n">p3</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">)</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">    <span class="nf">geom_histogram</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">SNPindex.HIGH</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nf">pdf</span><span class="p">(</span><span class="n">file</span> <span class="o">=</span> <span class="s">&#34;SNPindex.HIGH.dis.pdf&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p3</span>
</span></span><span class="line"><span class="cl"><span class="nf">dev.off</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä½å€¼æ··æ± SNP-indexåˆ†å¸ƒ</span>
</span></span><span class="line"><span class="cl"><span class="n">p4</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">)</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">    <span class="nf">geom_histogram</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">SNPindex.LOW</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nf">pdf</span><span class="p">(</span><span class="n">file</span> <span class="o">=</span> <span class="s">&#34;SNPindex.LOW.dis.pdf&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p4</span>
</span></span><span class="line"><span class="cl"><span class="nf">dev.off</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ==================== SNPè¿‡æ»¤ ====================</span>
</span></span><span class="line"><span class="cl"><span class="n">df_filt</span> <span class="o">&lt;-</span> <span class="nf">filterSNPs</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">SNPset</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">refAlleleFreq</span> <span class="o">=</span> <span class="m">0.20</span><span class="p">,</span>    <span class="c1"># REFç­‰ä½åŸºå› é¢‘ç‡: 0.2~0.8</span>
</span></span><span class="line"><span class="cl">    <span class="n">minTotalDepth</span> <span class="o">=</span> <span class="m">100</span><span class="p">,</span>     <span class="c1"># æœ€å°æ€»æ·±åº¦</span>
</span></span><span class="line"><span class="cl">    <span class="n">maxTotalDepth</span> <span class="o">=</span> <span class="m">400</span><span class="p">,</span>     <span class="c1"># æœ€å¤§æ€»æ·±åº¦</span>
</span></span><span class="line"><span class="cl">    <span class="n">minSampleDepth</span> <span class="o">=</span> <span class="m">40</span><span class="p">,</span>     <span class="c1"># å•æ ·å“æœ€å°æ·±åº¦</span>
</span></span><span class="line"><span class="cl">    <span class="n">minGQ</span> <span class="o">=</span> <span class="m">99</span><span class="p">,</span>              <span class="c1"># åŸºå› å‹è´¨é‡é˜ˆå€¼</span>
</span></span><span class="line"><span class="cl">    <span class="n">verbose</span> <span class="o">=</span> <span class="kc">TRUE</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ==================== deltaSNPindexè®¡ç®— ====================</span>
</span></span><span class="line"><span class="cl"><span class="n">df_filt</span> <span class="o">&lt;-</span> <span class="nf">runQTLseqAnalysis</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_filt</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">windowSize</span> <span class="o">=</span> <span class="m">1e6</span><span class="p">,</span>        <span class="c1"># çª—å£å¤§å°</span>
</span></span><span class="line"><span class="cl">    <span class="n">popStruc</span> <span class="o">=</span> <span class="s">&#34;F2&#34;</span><span class="p">,</span>         <span class="c1"># ç¾¤ä½“ç±»å‹</span>
</span></span><span class="line"><span class="cl">    <span class="n">bulkSize</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">385</span><span class="p">,</span> <span class="m">430</span><span class="p">),</span>  <span class="c1"># æ··æ± ä¸ªä½“æ•°</span>
</span></span><span class="line"><span class="cl">    <span class="n">replications</span> <span class="o">=</span> <span class="m">10000</span><span class="p">,</span>    <span class="c1"># Bootstrapæ¬¡æ•°</span>
</span></span><span class="line"><span class="cl">    <span class="n">intervals</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">95</span><span class="p">,</span> <span class="m">99</span><span class="p">)</span>    <span class="c1"># ç½®ä¿¡åŒºé—´</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ==================== ç»“æœå¯è§†åŒ– ====================</span>
</span></span><span class="line"><span class="cl"><span class="c1"># SNPæ²¿æŸ“è‰²ä½“åˆ†å¸ƒ</span>
</span></span><span class="line"><span class="cl"><span class="n">p5</span> <span class="o">&lt;-</span> <span class="nf">plotQTLStats</span><span class="p">(</span><span class="n">SNPset</span> <span class="o">=</span> <span class="n">df_filt</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="s">&#34;nSNPs&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">pdf</span><span class="p">(</span><span class="n">file</span> <span class="o">=</span> <span class="s">&#34;SNP_filter.window.pdf&#34;</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="m">20</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="m">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p5</span>
</span></span><span class="line"><span class="cl"><span class="nf">dev.off</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># deltaSNPindexæ²¿æŸ“è‰²ä½“åˆ†å¸ƒ</span>
</span></span><span class="line"><span class="cl"><span class="n">p6</span> <span class="o">&lt;-</span> <span class="nf">plotQTLStats</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">SNPset</span> <span class="o">=</span> <span class="n">df_filt</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">var</span> <span class="o">=</span> <span class="s">&#34;deltaSNP&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">plotIntervals</span> <span class="o">=</span> <span class="kc">TRUE</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">pdf</span><span class="p">(</span><span class="n">file</span> <span class="o">=</span> <span class="s">&#34;deltaSNPindex.pdf&#34;</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="m">20</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="m">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p6</span>
</span></span><span class="line"><span class="cl"><span class="nf">dev.off</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ==================== æå–æ˜¾è‘—åŒºåŸŸ ====================</span>
</span></span><span class="line"><span class="cl"><span class="n">QTL</span> <span class="o">&lt;-</span> <span class="nf">getSigRegions</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">SNPset</span> <span class="o">=</span> <span class="n">df_filt</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">method</span> <span class="o">=</span> <span class="s">&#34;QTLseq&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">interval</span> <span class="o">=</span> <span class="m">95</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">write.table</span><span class="p">(</span><span class="n">QTL[[1]]</span><span class="p">,</span> <span class="s">&#34;QTLseq_result.SigRegions.table&#34;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#34;\t&#34;</span><span class="p">,</span> <span class="n">quote</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ==================== å¯¼å‡ºå®Œæ•´ç»“æœ ====================</span>
</span></span><span class="line"><span class="cl"><span class="n">results99</span> <span class="o">&lt;-</span> <span class="nf">getQTLTable</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">SNPset</span> <span class="o">=</span> <span class="n">df_filt</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">method</span> <span class="o">=</span> <span class="s">&#34;QTLseq&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">interval</span> <span class="o">=</span> <span class="m">99</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">export</span> <span class="o">=</span> <span class="kc">FALSE</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">write.table</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">results99</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">file</span> <span class="o">=</span> <span class="s">&#34;QTLseq_result_deltaSNPindex_CI99.table&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">sep</span> <span class="o">=</span> <span class="s">&#34;\t&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">quote</span> <span class="o">=</span> <span class="kc">FALSE</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><h2 id="é™„å½•åˆ†ææµç¨‹å›¾">é™„å½•ï¼šåˆ†ææµç¨‹å›¾<a hidden class="anchor" aria-hidden="true" href="#é™„å½•åˆ†ææµç¨‹å›¾">#</a></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-R" data-lang="R"><span class="line"><span class="cl">åŸå§‹æ•°æ® <span class="p">(</span><span class="n">FASTQ</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      â”‚
</span></span><span class="line"><span class="cl">      â–¼
</span></span><span class="line"><span class="cl">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">â”‚   è´¨é‡æ§åˆ¶ <span class="n">QC</span>   â”‚
</span></span><span class="line"><span class="cl">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span class="line"><span class="cl">      â”‚
</span></span><span class="line"><span class="cl">      â–¼
</span></span><span class="line"><span class="cl">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">â”‚  æ¯”å¯¹ <span class="n">Mapping</span>   â”‚ â”€â”€â–º <span class="n">BWA</span> <span class="n">MEM</span>
</span></span><span class="line"><span class="cl">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span class="line"><span class="cl">      â”‚
</span></span><span class="line"><span class="cl">      â–¼
</span></span><span class="line"><span class="cl">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">â”‚ å»é‡ <span class="n">MarkDup</span>    â”‚ â”€â”€â–º <span class="n">Picard</span>
</span></span><span class="line"><span class="cl">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span class="line"><span class="cl">      â”‚
</span></span><span class="line"><span class="cl">      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">      â–¼                      â–¼                      â–¼
</span></span><span class="line"><span class="cl">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">â”‚ <span class="n">SNP</span><span class="o">/</span><span class="n">InDel</span> â”‚          â”‚    <span class="n">SV</span>     â”‚          â”‚    <span class="n">CNV</span>    â”‚
</span></span><span class="line"><span class="cl">â”‚   <span class="n">GATK</span>    â”‚          â”‚  <span class="n">lumpy</span><span class="o">-</span><span class="n">sv</span> â”‚          â”‚  <span class="n">CNVnator</span> â”‚
</span></span><span class="line"><span class="cl">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span class="line"><span class="cl">      â”‚                      â”‚                      â”‚
</span></span><span class="line"><span class="cl">      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span class="line"><span class="cl">                             â”‚
</span></span><span class="line"><span class="cl">                             â–¼
</span></span><span class="line"><span class="cl">                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">                    â”‚      æ³¨é‡Š       â”‚
</span></span><span class="line"><span class="cl">                    â”‚ <span class="n">ANNOVAR</span><span class="o">/</span><span class="n">bedtools</span>â”‚
</span></span><span class="line"><span class="cl">                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span class="line"><span class="cl">                             â”‚
</span></span><span class="line"><span class="cl">         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">         â–¼                   â–¼                   â–¼
</span></span><span class="line"><span class="cl">   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="cl">   â”‚ ç¾¤ä½“ç»“æ„  â”‚       â”‚ é€‰æ‹©åˆ†æ  â”‚       â”‚   <span class="n">GWAS</span>    â”‚
</span></span><span class="line"><span class="cl">   â”‚ <span class="n">PCA</span><span class="o">/</span><span class="n">Tree</span>  â”‚       â”‚ <span class="n">Fst</span><span class="o">/</span>Ï€<span class="o">/</span><span class="n">D</span>   â”‚       â”‚   <span class="n">EMMAX</span>   â”‚
</span></span><span class="line"><span class="cl">   â”‚ <span class="n">Structure</span> â”‚       â”‚           â”‚       â”‚           â”‚
</span></span><span class="line"><span class="cl">   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></div><h3 id="å¸¸è§çš„æ»‘åŠ¨çª—å£å¤§å°è®¾ç½®">å¸¸è§çš„æ»‘åŠ¨çª—å£å¤§å°è®¾ç½®<a hidden class="anchor" aria-hidden="true" href="#å¸¸è§çš„æ»‘åŠ¨çª—å£å¤§å°è®¾ç½®">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ä¸€ã€å¸¸ç”¨çª—å£å¤§å°
</span></span><span class="line"><span class="cl">çª—å£å¤§å°	é€‚ç”¨åœºæ™¯
</span></span><span class="line"><span class="cl">10 kb	ç²¾ç»†å®šä½ï¼Œå°åŸºå› ç»„
</span></span><span class="line"><span class="cl">20 kb	è¾ƒå¸¸ç”¨ï¼Œé€‚ä¸­
</span></span><span class="line"><span class="cl">50 kb	å¸¸ç”¨ï¼Œå¹³è¡¡ç²¾åº¦å’Œå™ªéŸ³
</span></span><span class="line"><span class="cl">100 kb	æœ€å¸¸ç”¨ï¼Œå¤§åŸºå› ç»„ï¼ˆå¦‚å¤§è±†ï¼‰
</span></span><span class="line"><span class="cl">200 kb	ç²—ç•¥æ‰«æï¼Œè¶…å¤§åŸºå› ç»„
</span></span><span class="line"><span class="cl">äºŒã€çª—å£å¤§å°å–å†³äºä»€ä¹ˆï¼Ÿ
</span></span><span class="line"><span class="cl">1. åŸºå› ç»„å¤§å°
</span></span><span class="line"><span class="cl">ç‰©ç§	åŸºå› ç»„å¤§å°	å»ºè®®çª—å£
</span></span><span class="line"><span class="cl">æ‹Ÿå—èŠ¥	~135 Mb	10-20 kb
</span></span><span class="line"><span class="cl">æ°´ç¨»	~430 Mb	50-100 kb
</span></span><span class="line"><span class="cl">å¤§è±†	~1.1 Gb	50-100 kb
</span></span><span class="line"><span class="cl">ç‰ç±³	~2.3 Gb	100-200 kb
</span></span><span class="line"><span class="cl">å°éº¦	~17 Gb	200-500 kb
</span></span><span class="line"><span class="cl">ä¸‰ã€ä¸åŒåˆ†æçš„çª—å£å»ºè®®ï¼ˆå¤§è±†ï¼‰
</span></span><span class="line"><span class="cl">åˆ†æ	å»ºè®®çª—å£	æ­¥é•¿
</span></span><span class="line"><span class="cl">Tajima&#39;s D	100 kb	-
</span></span><span class="line"><span class="cl">Ï€ï¼ˆæ ¸è‹·é…¸å¤šæ ·æ€§ï¼‰	100 kb	10 kb
</span></span><span class="line"><span class="cl">Fst	100 kb	10 kb
</span></span><span class="line"><span class="cl">ROD	100 kb	10 kb
</span></span><span class="line"><span class="cl">é€‰æ‹©æ¶ˆé™¤ï¼ˆXP-CLRï¼‰	50-100 kb	10 kb
</span></span></code></pre></div><h3 id="é€‰æ‹©åˆ†æå¯é€‰">é€‰æ‹©åˆ†æï¼ˆå¯é€‰ï¼‰<a hidden class="anchor" aria-hidden="true" href="#é€‰æ‹©åˆ†æå¯é€‰">#</a></h3>
<h4 id="xp-clr-è·¨ç¾¤ä½“å¤åˆä¼¼ç„¶æ¯”æ£€éªŒ">XP-CLR (è·¨ç¾¤ä½“å¤åˆä¼¼ç„¶æ¯”æ£€éªŒ)<a hidden class="anchor" aria-hidden="true" href="#xp-clr-è·¨ç¾¤ä½“å¤åˆä¼¼ç„¶æ¯”æ£€éªŒ">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-BASH" data-lang="BASH"><span class="line"><span class="cl"><span class="c1"># å®‰è£…xpclr</span>
</span></span><span class="line"><span class="cl">conda create -n xpclr_env <span class="nv">python</span><span class="o">=</span>3.11 <span class="nv">scipy</span><span class="o">=</span>1.11.4 numpy -y
</span></span><span class="line"><span class="cl">conda activate xpclr_env
</span></span><span class="line"><span class="cl">mamba install xpclr
</span></span><span class="line"><span class="cl"><span class="c1"># è½¬æ¢vcf2xpclræ ¼å¼</span>
</span></span><span class="line"><span class="cl">vcftools --vcf filtered_all.vcf.gz <span class="se">\
</span></span></span><span class="line"><span class="cl">         --freq <span class="se">\
</span></span></span><span class="line"><span class="cl">         --out allele_freq
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-BASH" data-lang="BASH"><span class="line"><span class="cl"><span class="c1"># æ–‡ä»¶å‡†å¤‡ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="c1">#1.vcfæ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">bgzip -c all.missing_maf.vcf &gt; all.missing_maf.vcf.gz
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;Building index...&#34;</span>
</span></span><span class="line"><span class="cl">tabix -p vcf all.missing_maf.vcf.gz
</span></span><span class="line"><span class="cl"><span class="c1">#2.ä¸¤ä¸ªè¦æ¯”è¾ƒç¾¤ä½“çš„æ ·æœ¬idçš„txtæ–‡ä»¶</span>
</span></span><span class="line"><span class="cl"><span class="c1">#è®¡ç®—ï¼šåŸæ–¹æ³•è®¡ç®—å¤ªæ…¢</span>
</span></span><span class="line"><span class="cl"><span class="c1">#!/bin/bash</span>
</span></span><span class="line"><span class="cl"><span class="nv">RAW_VCF</span><span class="o">=</span><span class="s2">&#34;all.missing_maf.vcf&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">WILD</span><span class="o">=</span><span class="s2">&#34;W.sample.list&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">CULT</span><span class="o">=</span><span class="s2">&#34;C.sample.list&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">OUTDIR</span><span class="o">=</span><span class="s2">&#34;./xpclr_results&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">VCFDIR</span><span class="o">=</span><span class="s2">&#34;./vcf_by_chr&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">BCFTOOLS_THREADS</span><span class="o">=</span><span class="m">4</span>
</span></span><span class="line"><span class="cl"><span class="nv">SPLIT_PARALLEL</span><span class="o">=</span><span class="m">10</span>
</span></span><span class="line"><span class="cl"><span class="nv">XPCLR_PARALLEL</span><span class="o">=</span><span class="m">10</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">mkdir -p <span class="s2">&#34;</span><span class="nv">$OUTDIR</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="nv">$VCFDIR</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ===== ç¬¬é›¶æ­¥ï¼šè¿‡æ»¤åªä¿ç•™åŒç­‰ä½SNP + å‹ç¼©å»ºç´¢å¼• =====</span>
</span></span><span class="line"><span class="cl"><span class="nv">SNP_VCF</span><span class="o">=</span><span class="s2">&#34;all.snps_only.vcf.gz&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&#34;</span><span class="nv">$SNP_VCF</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;[Step 0] Filtering: keep biallelic SNPs only...&#34;</span>
</span></span><span class="line"><span class="cl">    bcftools view <span class="s2">&#34;</span><span class="nv">$RAW_VCF</span><span class="s2">&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">        --types snps <span class="se">\
</span></span></span><span class="line"><span class="cl">        -m2 -M2 <span class="se">\
</span></span></span><span class="line"><span class="cl">        --threads <span class="nv">$BCFTOOLS_THREADS</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">        -Oz -o <span class="s2">&#34;</span><span class="nv">$SNP_VCF</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    tabix -p vcf <span class="s2">&#34;</span><span class="nv">$SNP_VCF</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># ç»Ÿè®¡</span>
</span></span><span class="line"><span class="cl">    <span class="nv">raw_count</span><span class="o">=</span><span class="k">$(</span>bcftools view -H <span class="s2">&#34;</span><span class="nv">$RAW_VCF</span><span class="s2">&#34;</span> <span class="p">|</span> wc -l<span class="k">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">snp_count</span><span class="o">=</span><span class="k">$(</span>bcftools view -H <span class="s2">&#34;</span><span class="nv">$SNP_VCF</span><span class="s2">&#34;</span> <span class="p">|</span> wc -l<span class="k">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">indel_count</span><span class="o">=</span><span class="k">$((</span>raw_count <span class="o">-</span> snp_count<span class="k">))</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;  è¿‡æ»¤å‰æ€»å˜å¼‚: </span><span class="nv">$raw_count</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;  å»æ‰ indel/å¤šç­‰ä½: </span><span class="nv">$indel_count</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;  ä¿ç•™ SNP: </span><span class="nv">$snp_count</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;[Step 0] </span><span class="nv">$SNP_VCF</span><span class="s2"> already exists, skipping...&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;============================================&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">VCF</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$SNP_VCF</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ===== ç¬¬ä¸€æ­¥ï¼šè·å–æŸ“è‰²ä½“åˆ—è¡¨ =====</span>
</span></span><span class="line"><span class="cl"><span class="nv">chromosomes</span><span class="o">=</span><span class="k">$(</span>bcftools view -h <span class="s2">&#34;</span><span class="nv">$VCF</span><span class="s2">&#34;</span> <span class="p">|</span> grep <span class="s1">&#39;^##contig&#39;</span> <span class="p">|</span> sed <span class="s1">&#39;s/.*ID=\([^,&gt;]*\).*/\1/&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;Chromosomes found:&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$chromosomes</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;============================================&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ===== ç¬¬äºŒæ­¥ï¼šå¹¶è¡Œæ‹†åˆ†VCF =====</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;[Step 1] Splitting VCF by chromosome...&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;  bcftools threads per task: </span><span class="nv">$BCFTOOLS_THREADS</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;  parallel tasks: </span><span class="nv">$SPLIT_PARALLEL</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;============================================&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> -r chr<span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">    <span class="o">[</span> -z <span class="s2">&#34;</span><span class="nv">$chr</span><span class="s2">&#34;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="k">continue</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">[</span> -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">VCFDIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">chr</span><span class="si">}</span><span class="s2">.vcf.gz&#34;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">VCFDIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">chr</span><span class="si">}</span><span class="s2">.vcf.gz.tbi&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;  </span><span class="nv">$chr</span><span class="s2"> already exists, skipping...&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">continue</span>
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;  Splitting </span><span class="nv">$chr</span><span class="s2"> ...&#34;</span>
</span></span><span class="line"><span class="cl">        bcftools view <span class="se">\
</span></span></span><span class="line"><span class="cl">            -r <span class="s2">&#34;</span><span class="nv">$chr</span><span class="s2">&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">            --threads <span class="nv">$BCFTOOLS_THREADS</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">            <span class="s2">&#34;</span><span class="nv">$VCF</span><span class="s2">&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">            -Oz -o <span class="s2">&#34;</span><span class="si">${</span><span class="nv">VCFDIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">chr</span><span class="si">}</span><span class="s2">.vcf.gz&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        tabix -p vcf <span class="s2">&#34;</span><span class="si">${</span><span class="nv">VCFDIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">chr</span><span class="si">}</span><span class="s2">.vcf.gz&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;  âœ“ </span><span class="nv">$chr</span><span class="s2"> split done&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span> <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="o">[</span> <span class="k">$(</span><span class="nb">jobs</span> -rp <span class="p">|</span> wc -l<span class="k">)</span> -ge <span class="nv">$SPLIT_PARALLEL</span> <span class="o">]</span><span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">        sleep <span class="m">2</span>
</span></span><span class="line"><span class="cl">    <span class="k">done</span>
</span></span><span class="line"><span class="cl"><span class="k">done</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">&#34;</span><span class="nv">$chromosomes</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">wait</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;[Step 1] All chromosomes split!&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;============================================&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ===== éªŒè¯æ‹†åˆ†ç»“æœ =====</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;Verifying split files...&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">all_ok</span><span class="o">=</span><span class="nb">true</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> -r chr<span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">    <span class="o">[</span> -z <span class="s2">&#34;</span><span class="nv">$chr</span><span class="s2">&#34;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="k">continue</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">VCFDIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">chr</span><span class="si">}</span><span class="s2">.vcf.gz&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;  ERROR: </span><span class="si">${</span><span class="nv">chr</span><span class="si">}</span><span class="s2">.vcf.gz missing!&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">all_ok</span><span class="o">=</span><span class="nb">false</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="nv">snp_count</span><span class="o">=</span><span class="k">$(</span>bcftools view -H <span class="s2">&#34;</span><span class="si">${</span><span class="nv">VCFDIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">chr</span><span class="si">}</span><span class="s2">.vcf.gz&#34;</span> <span class="p">|</span> wc -l<span class="k">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;  âœ“ </span><span class="nv">$chr</span><span class="s2"> : </span><span class="nv">$snp_count</span><span class="s2"> SNPs&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="k">done</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">&#34;</span><span class="nv">$chromosomes</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$all_ok</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="nb">false</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;Some files missing! Check errors above.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">exit</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;============================================&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ===== ç¬¬ä¸‰æ­¥ï¼šå¹¶è¡Œè¿è¡Œ xpclr =====</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;[Step 2] Running XPCLR in parallel...&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;  parallel tasks: </span><span class="nv">$XPCLR_PARALLEL</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;============================================&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> -r chr<span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">    <span class="o">[</span> -z <span class="s2">&#34;</span><span class="nv">$chr</span><span class="s2">&#34;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="k">continue</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">[</span> -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">OUTDIR</span><span class="si">}</span><span class="s2">/xpclr_</span><span class="si">${</span><span class="nv">chr</span><span class="si">}</span><span class="s2">.out&#34;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> -s <span class="s2">&#34;</span><span class="si">${</span><span class="nv">OUTDIR</span><span class="si">}</span><span class="s2">/xpclr_</span><span class="si">${</span><span class="nv">chr</span><span class="si">}</span><span class="s2">.out&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;  </span><span class="nv">$chr</span><span class="s2"> already completed, skipping...&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">continue</span>
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;  [</span><span class="k">$(</span>date <span class="s1">&#39;+%H:%M:%S&#39;</span><span class="k">)</span><span class="s2">] Starting </span><span class="nv">$chr</span><span class="s2"> ...&#34;</span>
</span></span><span class="line"><span class="cl">        xpclr <span class="se">\
</span></span></span><span class="line"><span class="cl">            --out <span class="s2">&#34;</span><span class="si">${</span><span class="nv">OUTDIR</span><span class="si">}</span><span class="s2">/xpclr_</span><span class="si">${</span><span class="nv">chr</span><span class="si">}</span><span class="s2">.out&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">            --format vcf <span class="se">\
</span></span></span><span class="line"><span class="cl">            --input <span class="s2">&#34;</span><span class="si">${</span><span class="nv">VCFDIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">chr</span><span class="si">}</span><span class="s2">.vcf.gz&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">            --samplesA <span class="s2">&#34;</span><span class="nv">$WILD</span><span class="s2">&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">            --samplesB <span class="s2">&#34;</span><span class="nv">$CULT</span><span class="s2">&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">            --size <span class="m">100000</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">            --step <span class="m">50000</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">            --chr <span class="s2">&#34;</span><span class="nv">$chr</span><span class="s2">&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl">            2&gt;<span class="s2">&#34;</span><span class="si">${</span><span class="nv">OUTDIR</span><span class="si">}</span><span class="s2">/xpclr_</span><span class="si">${</span><span class="nv">chr</span><span class="si">}</span><span class="s2">.log&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;  [</span><span class="k">$(</span>date <span class="s1">&#39;+%H:%M:%S&#39;</span><span class="k">)</span><span class="s2">] âœ“ </span><span class="nv">$chr</span><span class="s2"> completed&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span> <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="o">[</span> <span class="k">$(</span><span class="nb">jobs</span> -rp <span class="p">|</span> wc -l<span class="k">)</span> -ge <span class="nv">$XPCLR_PARALLEL</span> <span class="o">]</span><span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">        sleep <span class="m">10</span>
</span></span><span class="line"><span class="cl">    <span class="k">done</span>
</span></span><span class="line"><span class="cl"><span class="k">done</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">&#34;</span><span class="nv">$chromosomes</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">wait</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;[Step 2] All XPCLR runs completed!&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;============================================&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ===== ç¬¬å››æ­¥ï¼šåˆå¹¶ç»“æœ =====</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;[Step 3] Merging results...&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">first_chr</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$chromosomes</span><span class="s2">&#34;</span> <span class="p">|</span> head -1<span class="k">)</span>
</span></span><span class="line"><span class="cl">head -1 <span class="s2">&#34;</span><span class="si">${</span><span class="nv">OUTDIR</span><span class="si">}</span><span class="s2">/xpclr_</span><span class="si">${</span><span class="nv">first_chr</span><span class="si">}</span><span class="s2">.out&#34;</span> &gt; <span class="s2">&#34;</span><span class="si">${</span><span class="nv">OUTDIR</span><span class="si">}</span><span class="s2">/chr_all_C_vs_W.txt&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> -r chr<span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">    <span class="o">[</span> -z <span class="s2">&#34;</span><span class="nv">$chr</span><span class="s2">&#34;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="k">continue</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">[</span> -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">OUTDIR</span><span class="si">}</span><span class="s2">/xpclr_</span><span class="si">${</span><span class="nv">chr</span><span class="si">}</span><span class="s2">.out&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">        <span class="nv">lines</span><span class="o">=</span><span class="k">$(</span>tail -n +2 <span class="s2">&#34;</span><span class="si">${</span><span class="nv">OUTDIR</span><span class="si">}</span><span class="s2">/xpclr_</span><span class="si">${</span><span class="nv">chr</span><span class="si">}</span><span class="s2">.out&#34;</span> <span class="p">|</span> wc -l<span class="k">)</span>
</span></span><span class="line"><span class="cl">        tail -n +2 <span class="s2">&#34;</span><span class="si">${</span><span class="nv">OUTDIR</span><span class="si">}</span><span class="s2">/xpclr_</span><span class="si">${</span><span class="nv">chr</span><span class="si">}</span><span class="s2">.out&#34;</span> &gt;&gt; <span class="s2">&#34;</span><span class="si">${</span><span class="nv">OUTDIR</span><span class="si">}</span><span class="s2">/chr_all_C_vs_W.txt&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;  </span><span class="nv">$chr</span><span class="s2"> : </span><span class="nv">$lines</span><span class="s2"> windows&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;  WARNING: </span><span class="nv">$chr</span><span class="s2"> result missing!&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="k">done</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">&#34;</span><span class="nv">$chromosomes</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">total</span><span class="o">=</span><span class="k">$(</span>tail -n +2 <span class="s2">&#34;</span><span class="si">${</span><span class="nv">OUTDIR</span><span class="si">}</span><span class="s2">/chr_all_C_vs_W.txt&#34;</span> <span class="p">|</span> wc -l<span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;============================================&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;Done! Total windows: </span><span class="nv">$total</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;Output: </span><span class="si">${</span><span class="nv">OUTDIR</span><span class="si">}</span><span class="s2">/chr_all_C_vs_W.txt&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># å¯è§†åŒ–ä»£ç ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ======== 1. è¯»å–åˆå¹¶åçš„å•ä¸ªç»“æœæ–‡ä»¶ ========</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">&lt;-</span> <span class="nf">read.delim</span><span class="p">(</span><span class="s">&#34;xpclr_results/chr_all_C_vs_W.txt&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                 <span class="n">header</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">stringsAsFactors</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ======== 2. æŸ¥çœ‹å®é™…åˆ—åï¼ˆé¦–æ¬¡è¿è¡Œæ—¶å–æ¶ˆæ³¨é‡Šç¡®è®¤ï¼‰ ========</span>
</span></span><span class="line"><span class="cl"><span class="nf">cat</span><span class="p">(</span><span class="s">&#34;åˆ—åï¼š&#34;</span><span class="p">,</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="s">&#34;\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">head</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ======== 3. ç»Ÿä¸€åˆ—åï¼ˆxpclr è¾“å‡ºåˆ—åé€šå¸¸æ˜¯ chrom/start/stop/xpclrï¼‰ ========</span>
</span></span><span class="line"><span class="cl"><span class="c1"># å¦‚æœä½ çš„åˆ—åä¸åŒï¼Œæ ¹æ®ä¸Šé¢ cat è¾“å‡ºä¿®æ”¹è¿™é‡Œ</span>
</span></span><span class="line"><span class="cl"><span class="kr">if</span> <span class="p">(</span><span class="s">&#34;chrom&#34;</span> <span class="o">%in%</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>    <span class="n">df</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">rename</span><span class="p">(</span><span class="n">chr</span> <span class="o">=</span> <span class="n">chrom</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">if</span> <span class="p">(</span><span class="s">&#34;start&#34;</span> <span class="o">%in%</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>    <span class="n">df</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">rename</span><span class="p">(</span><span class="n">pos_start</span> <span class="o">=</span> <span class="n">start</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">if</span> <span class="p">(</span><span class="s">&#34;stop&#34;</span>  <span class="o">%in%</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>    <span class="n">df</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">rename</span><span class="p">(</span><span class="n">pos_stop</span> <span class="o">=</span> <span class="n">stop</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># å¦‚æœ xpclr åˆ—åæ˜¯ xpclr_scoreï¼š</span>
</span></span><span class="line"><span class="cl"><span class="kr">if</span> <span class="p">(</span><span class="s">&#34;xpclr_score&#34;</span> <span class="o">%in%</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">df</span><span class="p">))</span> <span class="n">df</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">rename</span><span class="p">(</span><span class="n">xpclr</span> <span class="o">=</span> <span class="n">xpclr_score</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ======== 4. æ•°æ®æ¸…æ´— ========</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">xpclr</span> <span class="o">=</span> <span class="nf">ifelse</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">xpclr</span><span class="p">)</span> <span class="o">|</span> <span class="n">xpclr</span> <span class="o">&lt;=</span> <span class="m">0</span><span class="p">,</span> <span class="kc">NA</span><span class="p">,</span> <span class="n">xpclr</span><span class="p">))</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">xpclr</span><span class="p">))</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">pos_center</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos_start</span> <span class="o">+</span> <span class="n">pos_stop</span><span class="p">)</span> <span class="o">/</span> <span class="m">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ======== 5. æŸ“è‰²ä½“æ’åºï¼ˆè‡ªåŠ¨ä»æ•°æ®ä¸­è·å–ï¼Œè€Œéç¡¬ç¼–ç ï¼‰ ========</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æå–æŸ“è‰²ä½“ç¼–å·ä¸­çš„æ•°å­—éƒ¨åˆ†è¿›è¡Œè‡ªç„¶æ’åº</span>
</span></span><span class="line"><span class="cl"><span class="n">chr_levels</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">distinct</span><span class="p">(</span><span class="n">chr</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">chr_num</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="nf">gsub</span><span class="p">(</span><span class="s">&#34;\\D&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="n">chr</span><span class="p">)))</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">arrange</span><span class="p">(</span><span class="n">chr_num</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">pull</span><span class="p">(</span><span class="n">chr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">$</span><span class="n">chr</span> <span class="o">&lt;-</span> <span class="nf">factor</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">chr</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="n">chr_levels</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ======== 6. è®¡ç®—ç´¯ç§¯åæ ‡ ========</span>
</span></span><span class="line"><span class="cl"><span class="n">data_cum</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">group_by</span><span class="p">(</span><span class="n">chr</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">summarise</span><span class="p">(</span><span class="n">chr_len</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">pos_center</span><span class="p">))</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">tot</span> <span class="o">=</span> <span class="nf">cumsum</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">chr_len</span><span class="p">))</span> <span class="o">-</span> <span class="n">chr_len</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">chr_len</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">&lt;-</span> <span class="nf">left_join</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">data_cum</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="s">&#34;chr&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">pos_cum</span> <span class="o">=</span> <span class="n">pos_center</span> <span class="o">+</span> <span class="n">tot</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ======== 7. é˜ˆå€¼ ========</span>
</span></span><span class="line"><span class="cl"><span class="n">threshold</span> <span class="o">&lt;-</span> <span class="nf">quantile</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">xpclr</span><span class="p">,</span> <span class="m">0.95</span><span class="p">,</span> <span class="n">na.rm</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ======== 8. åæ ‡è½´æ ‡ç­¾ ========</span>
</span></span><span class="line"><span class="cl"><span class="n">axis_df</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">group_by</span><span class="p">(</span><span class="n">chr</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">summarize</span><span class="p">(</span><span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">pos_cum</span><span class="p">)</span> <span class="o">+</span> <span class="nf">min</span><span class="p">(</span><span class="n">pos_cum</span><span class="p">))</span> <span class="o">/</span> <span class="m">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ======== 9. é¢œè‰²ï¼ˆæ ¹æ®å®é™…æŸ“è‰²ä½“æ•°é‡è‡ªåŠ¨ç”Ÿæˆï¼‰ ========</span>
</span></span><span class="line"><span class="cl"><span class="n">n_chr</span> <span class="o">&lt;-</span> <span class="nf">length</span><span class="p">(</span><span class="n">chr_levels</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">chr_colors</span> <span class="o">&lt;-</span> <span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&#34;#d7191c&#34;</span><span class="p">,</span> <span class="s">&#34;#2c7bb6&#34;</span><span class="p">),</span> <span class="n">length.out</span> <span class="o">=</span> <span class="n">n_chr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ======== 10. ç»˜å›¾ ========</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">pos_cum</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">xpclr</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">chr</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_line</span><span class="p">(</span><span class="n">linewidth</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">)</span> <span class="o">+</span>    <span class="c1"># æ³¨æ„ï¼šæ–°ç‰ˆggplot2ç”¨linewidthæ›¿ä»£size</span>
</span></span><span class="line"><span class="cl">  <span class="nf">scale_color_manual</span><span class="p">(</span><span class="n">values</span> <span class="o">=</span> <span class="n">chr_colors</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span> <span class="o">=</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">linetype</span> <span class="o">=</span> <span class="s">&#34;dashed&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">             <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;black&#34;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.7</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">axis_df</span><span class="o">$</span><span class="n">chr</span><span class="p">,</span> <span class="n">breaks</span> <span class="o">=</span> <span class="n">axis_df</span><span class="o">$</span><span class="n">center</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">labs</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="s">&#34;Chromosome&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">y</span> <span class="o">=</span> <span class="s">&#34;XP-CLR Score&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">subtitle</span> <span class="o">=</span> <span class="nf">paste0</span><span class="p">(</span><span class="s">&#34;Dashed line: 95th percentile threshold (&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                      <span class="nf">round</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span> <span class="s">&#34;)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_minimal</span><span class="p">(</span><span class="n">base_size</span> <span class="o">=</span> <span class="m">12</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">legend.position</span> <span class="o">=</span> <span class="s">&#34;none&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">plot.title</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">hjust</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">14</span><span class="p">,</span> <span class="n">face</span> <span class="o">=</span> <span class="s">&#34;bold&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">panel.grid.minor</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="n">panel.grid.major.x</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="n">axis.text.x</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">angle</span> <span class="o">=</span> <span class="m">45</span><span class="p">,</span> <span class="n">hjust</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span>  <span class="c1"># Xè½´æ ‡ç­¾æ—‹è½¬</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ======== 11. ä¿å­˜ ========</span>
</span></span><span class="line"><span class="cl"><span class="nf">ggsave</span><span class="p">(</span><span class="s">&#34;xpclr_manhattan.pdf&#34;</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="m">14</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="m">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">ggsave</span><span class="p">(</span><span class="s">&#34;xpclr_manhattan.png&#34;</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="m">14</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="m">5</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="m">300</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># xpclr æºç çš„å·²çŸ¥bugï¼Œéœ€è¦ç›´æ¥ä¿®æ”¹æºç </span>
</span></span><span class="line"><span class="cl">--- Logging error ---
</span></span><span class="line"><span class="cl">Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span></span><span class="line"><span class="cl">File <span class="s2">&#34;/home2/xtc/.conda/envs/xpclr_env/lib/python3.11/logging/init.py&#34;</span>, line 1110, in emit
</span></span><span class="line"><span class="cl"><span class="nv">msg</span> <span class="o">=</span> self.format<span class="o">(</span>record<span class="o">)</span>
</span></span><span class="line"><span class="cl">^^^^^^^^^^^^^^^^^^^
</span></span><span class="line"><span class="cl">File <span class="s2">&#34;/home2/xtc/.conda/envs/xpclr_env/lib/python3.11/logging/init.py&#34;</span>, line 953, in format
</span></span><span class="line"><span class="cl"><span class="k">return</span> fmt.format<span class="o">(</span>record<span class="o">)</span>
</span></span><span class="line"><span class="cl">^^^^^^^^^^^^^^^^^^
</span></span><span class="line"><span class="cl">File <span class="s2">&#34;/home2/xtc/.conda/envs/xpclr_env/lib/python3.11/logging/init.py&#34;</span>, line 687, in format
</span></span><span class="line"><span class="cl">record.message <span class="o">=</span> record.getMessage<span class="o">()</span>
</span></span><span class="line"><span class="cl">^^^^^^^^^^^^^^^^^^^
</span></span><span class="line"><span class="cl">File <span class="s2">&#34;/home2/xtc/.conda/envs/xpclr_env/lib/python3.11/logging/init.py&#34;</span>, line 377, in getMessage
</span></span><span class="line"><span class="cl"><span class="nv">msg</span> <span class="o">=</span> msg % self.args
</span></span><span class="line"><span class="cl">~~~~^~~~~~~~~~~
</span></span><span class="line"><span class="cl">TypeError: not all arguments converted during string formatting
</span></span><span class="line"><span class="cl">Call stack:
</span></span><span class="line"><span class="cl">File <span class="s2">&#34;/home2/xtc/.conda/envs/xpclr_env/bin/xpclr&#34;</span>, line 196, in &lt;module&gt;
</span></span><span class="line"><span class="cl">main<span class="o">()</span>
</span></span><span class="line"><span class="cl">File <span class="s2">&#34;/home2/xtc/.conda/envs/xpclr_env/bin/xpclr&#34;</span>, line 182, in main
</span></span><span class="line"><span class="cl">model_lik, null_lik, selcoef, nsnps, navail, <span class="nv">snpedges</span> <span class="o">=</span> xpclr.methods.xpclr_scan<span class="o">(</span>
</span></span><span class="line"><span class="cl">File <span class="s2">&#34;/home2/xtc/.conda/envs/xpclr_env/lib/python3.11/site-packages/xpclr/methods.py&#34;</span>, line 333, in xpclr_scan
</span></span><span class="line"><span class="cl">li_data<span class="o">[</span>i<span class="o">]</span> <span class="o">=</span> compute_xpclr<span class="o">(</span>window_data, sel_coefs<span class="o">)</span>
</span></span><span class="line"><span class="cl">File <span class="s2">&#34;/home2/xtc/.conda/envs/xpclr_env/lib/python3.11/site-packages/xpclr/methods.py&#34;</span>, line 225, in compute_xpclr
</span></span><span class="line"><span class="cl"><span class="nv">ll</span> <span class="o">=</span> calculate_cl_romberg<span class="o">(</span>s_coef, dat<span class="o">)</span>
</span></span><span class="line"><span class="cl">File <span class="s2">&#34;/home2/xtc/.conda/envs/xpclr_env/lib/python3.11/site-packages/xpclr/methods.py&#34;</span>, line 204, in calculate_cl_romberg
</span></span><span class="line"><span class="cl"><span class="nv">cl</span> <span class="o">=</span> calculate_likelihood<span class="o">(</span><span class="nv">values</span><span class="o">=(</span>xj, nj, c, p2freq, var<span class="o">))</span>
</span></span><span class="line"><span class="cl">File <span class="s2">&#34;/home2/xtc/.conda/envs/xpclr_env/lib/python3.11/site-packages/xpclr/methods.py&#34;</span>, line 137, in chen_likelihood
</span></span><span class="line"><span class="cl">logger.warning<span class="o">(</span>w<span class="o">[</span>-1<span class="o">]</span>.message, i_likl, i_base<span class="o">)</span>
</span></span><span class="line"><span class="cl">Message: DeprecationWarning<span class="o">(</span><span class="s1">&#39;Conversion of an array with ndim &gt; 0 to a scalar is deprecated, and will error in future. Ensure you extract a single element from your array before performing this operation. (Deprecated NumPy 1.25.)&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">Arguments: <span class="o">((</span>0.050147255182536286, 4.2684261388273304e-07, <span class="o">{</span><span class="s1">&#39;neval&#39;</span>: 63, <span class="s1">&#39;last&#39;</span>: 2, <span class="s1">&#39;iord&#39;</span>: array<span class="o">([</span> 1, 2, 5, 4, 3,ã€‚ã€‚ã€‚ã€‚
</span></span><span class="line"><span class="cl"><span class="c1"># ä¸€é”®ä¿®å¤</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æ‰¾åˆ°æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl"><span class="nv">METHODS_FILE</span><span class="o">=</span><span class="s2">&#34;/home2/xtc/.conda/envs/xpclr_env/lib/python3.11/site-packages/xpclr/methods.py&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¤‡ä»½</span>
</span></span><span class="line"><span class="cl">cp <span class="s2">&#34;</span><span class="nv">$METHODS_FILE</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">METHODS_FILE</span><span class="si">}</span><span class="s2">.bak&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä¿®å¤ç¬¬137è¡Œ</span>
</span></span><span class="line"><span class="cl">sed -i <span class="s1">&#39;s/logger.warning(w\[-1\].message, i_likl, i_base)/logger.warning(f&#34;{w[-1].message} | likl={i_likl}, base={i_base}&#34;)/&#39;</span> <span class="s2">&#34;</span><span class="nv">$METHODS_FILE</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">éªŒè¯æ˜¯å¦ä¿®æ”¹æˆåŠŸ
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">grep -n <span class="s2">&#34;logger.warning&#34;</span> <span class="s2">&#34;</span><span class="nv">$METHODS_FILE</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#åº”è¯¥çœ‹åˆ°ï¼š</span>
</span></span><span class="line"><span class="cl">137:                    logger.warning<span class="o">(</span>f<span class="s2">&#34;{w[-1].message} | likl={i_likl}, base={i_base}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># åŸå› è§£é‡Š</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åŸä»£ç ï¼ˆæœ‰bugï¼‰ï¼š</span>
</span></span><span class="line"><span class="cl">logger.warning<span class="o">(</span>w<span class="o">[</span>-1<span class="o">]</span>.message, i_likl, i_base<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#              â†‘ è¿™ä¸ªå­—ç¬¦ä¸²é‡Œæ²¡æœ‰ %s å ä½ç¬¦ï¼Œå´ä¼ äº†ä¸¤ä¸ªå‚æ•° â†’ TypeError</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä¿®å¤åï¼š</span>
</span></span><span class="line"><span class="cl">logger.warning<span class="o">(</span>f<span class="s2">&#34;{w[-1].message} | likl={i_likl}, base={i_base}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#              â†‘ ç”¨ f-string æŠŠæ‰€æœ‰å‚æ•°æ‹¼è¿›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸å†æœ‰å¤šä½™å‚æ•°</span>
</span></span></code></pre></div><h4 id="xp-ehhæ›´åŠ å¿«é€Ÿç®€ä¾¿çš„æ–¹æ³•åœ¨8000é‡æµ‹åºæ–‡ç« ä¸­æœ‰">XP-EHHï¼ˆæ›´åŠ å¿«é€Ÿç®€ä¾¿çš„æ–¹æ³•åœ¨8000é‡æµ‹åºæ–‡ç« ä¸­æœ‰ï¼‰<a hidden class="anchor" aria-hidden="true" href="#xp-ehhæ›´åŠ å¿«é€Ÿç®€ä¾¿çš„æ–¹æ³•åœ¨8000é‡æµ‹åºæ–‡ç« ä¸­æœ‰">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># æ‹†åˆ†vcfæ–‡ä»¶ä¸ºä¸åŒç¾¤ä½“</span>
</span></span><span class="line"><span class="cl">cat ../chr.list <span class="p">|</span> <span class="k">while</span> <span class="nb">read</span> chr<span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="s2">&#34;vcftools --gzvcf </span><span class="si">${</span><span class="nv">chr</span><span class="si">}</span><span class="s2">.vcf.gz --keep ../W.sample.list --recode --recode-INFO-all --out W.</span><span class="si">${</span><span class="nv">chr</span><span class="si">}</span><span class="s2">.missmaf&#34;</span> &gt;&gt; split.chr.vcf.sh<span class="p">;</span> <span class="k">done</span>
</span></span><span class="line"><span class="cl"><span class="c1"># åŸºå› å‹å¡«å……</span>
</span></span><span class="line"><span class="cl">cat ../chr.list <span class="p">|</span> <span class="k">while</span> <span class="nb">read</span> chr<span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="s2">&#34;java -Xmx10g -jar /home2/xtc/.conda/envs/xpehh/share/beagle-5.5_27Feb25.75f-0/beagle.jar nthreads=4 ne=30 gt=W.</span><span class="si">${</span><span class="nv">chr</span><span class="si">}</span><span class="s2">.missmaf.recode.vcf out=W_</span><span class="si">${</span><span class="nv">chr</span><span class="si">}</span><span class="s2">.phasing.recode&#34;</span> &gt;&gt; W.beagle.sh<span class="p">;</span> <span class="k">done</span>
</span></span><span class="line"><span class="cl">cat ../chr.list <span class="p">|</span> <span class="k">while</span> <span class="nb">read</span> chr<span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="s2">&#34;java -Xmx10g -jar /home2/xtc/.conda/envs/xpehh/share/beagle-5.5_27Feb25.75f-0/beagle.jar nthreads=4 ne=30 gt=C.</span><span class="si">${</span><span class="nv">chr</span><span class="si">}</span><span class="s2">.missmaf.recode.vcf out=C_</span><span class="si">${</span><span class="nv">chr</span><span class="si">}</span><span class="s2">.phasing.recode&#34;</span> &gt;&gt; C.beagle.sh<span class="p">;</span> <span class="k">done</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">nohup parallel -j <span class="m">5</span> --joblog Wbeagle_progress.log &lt; W.beagle.sh &gt; beagle_W.log 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">nohup parallel -j <span class="m">5</span> --joblog Cbeagle_progress.log &lt; C.beagle.sh &gt; beagle_C.log 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è½¬æ¢æ ¼å¼</span>
</span></span><span class="line"><span class="cl">mkdir -p ./xpehh_result
</span></span><span class="line"><span class="cl"><span class="k">for</span> i in <span class="o">{</span>01..20<span class="o">}</span><span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">vcftools --gzvcf <span class="s2">&#34;W_glyma.Wm82.gnm6.Gm</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="s2">.phasing.recode.vcf.gz&#34;</span> --plink --out ./xpehh_result/W.Gm<span class="si">${</span><span class="nv">i</span><span class="si">}</span>
</span></span><span class="line"><span class="cl"><span class="k">done</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> i in <span class="o">{</span>01..20<span class="o">}</span><span class="p">;</span> <span class="k">do</span> vcftools --gzvcf <span class="s2">&#34;C_glyma.Wm82.gnm6.Gm</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="s2">.phasing.recode.vcf.gz&#34;</span> --plink --out ./xpehh_result/C.Gm<span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="p">;</span> <span class="k">done</span> 
</span></span></code></pre></div><p>è®¡ç®—XP-EHHéœ€è¦è®¡ç®—é—ä¼ è·ç¦»ï¼Œä¸€èˆ¬æ¥è¯´é»˜è®¤ä½¿ç”¨1cM=1Mb,å°†ç¬¬å››åˆ—çš„ç‰©ç†ä½ç½®ä¹˜ä»¥0.000001å³å¯æ¢ç®—æˆé—ä¼ è·ç¦»</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="k">for</span> i in <span class="o">{</span>01..20<span class="o">}</span><span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">  awk <span class="s1">&#39;{print $1, $2, $4/1000000, $4}&#39;</span> C.Gm<span class="si">${</span><span class="nv">i</span><span class="si">}</span>.map &gt; C.Gm<span class="si">${</span><span class="nv">i</span><span class="si">}</span>.genetic.map
</span></span><span class="line"><span class="cl"><span class="k">done</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> i in <span class="o">{</span>01..20<span class="o">}</span><span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">  awk <span class="s1">&#39;{print $1, $2, $4/1000000, $4}&#39;</span> W.Gm<span class="si">${</span><span class="nv">i</span><span class="si">}</span>.map &gt; W.Gm<span class="si">${</span><span class="nv">i</span><span class="si">}</span>.genetic.map
</span></span><span class="line"><span class="cl"><span class="k">done</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># è®¡ç®—</span>
</span></span><span class="line"><span class="cl">mkdir -p results
</span></span><span class="line"><span class="cl"><span class="k">for</span> i in <span class="o">{</span>01..20<span class="o">}</span><span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">selscan --xpehh --vcf ../C_glyma.Wm82.gnm6.Gm<span class="si">${</span><span class="nv">i</span><span class="si">}</span>.phasing.recode.vcf.gz --vcf-ref ../W_glyma.Wm82.gnm6.Gm<span class="si">${</span><span class="nv">i</span><span class="si">}</span>.phasing.recode.vcf.gz --map W.Gm<span class="si">${</span><span class="nv">i</span><span class="si">}</span>.genetic.map --threads <span class="m">10</span> --out ./results/C_W_Gm<span class="si">${</span><span class="nv">i</span><span class="si">}</span>
</span></span><span class="line"><span class="cl"><span class="k">done</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># è„šæœ¬å½’ä¸€åŒ– https://github.com/Fmaizer/sliding-window-for-xpehh-results ï¼ˆpandas å’Œ tqdmï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> i in <span class="o">{</span>01..20<span class="o">}</span><span class="p">;</span> <span class="k">do</span> python norm.py --input C_W_Gm<span class="si">${</span><span class="nv">i</span><span class="si">}</span>.xpehh.out --window <span class="m">100000</span> --step <span class="m">50000</span> --chr <span class="nv">$i</span><span class="p">;</span> <span class="k">done</span>
</span></span><span class="line"><span class="cl"><span class="c1"># åˆå¹¶æ‰€æœ‰æŸ“è‰²ä½“ç»“æœ</span>
</span></span><span class="line"><span class="cl">awk <span class="s1">&#39;FNR==1 &amp;&amp; NR!=1{next;}{print}&#39;</span> C_W_Gm*.xpehh.out.norm.100kb.windows &gt; C_W_all.xpehh.out.norm.100kb.windows
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># ç»˜å›¾ï¼ˆå„æŸ“è‰²ä½“æ•£ç‚¹å›¾ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¯»å–çª—å£æ±‡æ€»æ•°æ®</span>
</span></span><span class="line"><span class="cl"><span class="n">xpehh</span> <span class="o">&lt;-</span> <span class="nf">read.table</span><span class="p">(</span><span class="s">&#34;C_W_all.xpehh.out.norm.100kb.windows&#34;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æŸ¥çœ‹åˆ—åï¼Œç¡®è®¤å®é™…åç§°</span>
</span></span><span class="line"><span class="cl"><span class="nf">colnames</span><span class="p">(</span><span class="n">xpehh</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è®¡ç®—çª—å£ä¸­ç‚¹ä½ç½®ï¼ˆç”¨äºç»˜å›¾ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">xpehh</span><span class="o">$</span><span class="n">mid</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">xpehh</span><span class="o">$</span><span class="n">win_start</span> <span class="o">+</span> <span class="n">xpehh</span><span class="o">$</span><span class="n">win_end</span><span class="p">)</span> <span class="o">/</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ç»˜åˆ¶ XP-EHH æ‰«æå›¾ï¼ˆä½¿ç”¨ mean_normxpehhï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">xpehh</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">mid</span><span class="o">/</span><span class="m">1000000</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">mean_normxpehh</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_point</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="m">0.6</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#34;steelblue&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="m">0</span><span class="p">,</span> <span class="n">linetype</span><span class="o">=</span><span class="s">&#34;dashed&#34;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#34;gray50&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="m">2</span><span class="p">,</span> <span class="n">linetype</span><span class="o">=</span><span class="s">&#34;dashed&#34;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#34;red&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="m">-2</span><span class="p">,</span> <span class="n">linetype</span><span class="o">=</span><span class="s">&#34;dashed&#34;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#34;blue&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">chr</span><span class="p">,</span> <span class="n">scales</span><span class="o">=</span><span class="s">&#34;free_x&#34;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="m">4</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&#34;Position (Mb)&#34;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">&#34;Mean Normalized XP-EHH&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="n">title</span><span class="o">=</span><span class="s">&#34;XP-EHH Scan (100kb Windows)&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_bw</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme</span><span class="p">(</span><span class="n">axis.text.x</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="m">45</span><span class="p">,</span> <span class="n">hjust</span><span class="o">=</span><span class="m">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nf">ggsave</span><span class="p">(</span><span class="s">&#34;chr.W_C.xpehh.pot.png&#34;</span><span class="p">,</span><span class="n">width</span> <span class="o">=</span> <span class="m">10</span><span class="p">,</span><span class="n">height</span> <span class="o">=</span> <span class="m">7</span><span class="p">,</span><span class="n">dpi</span> <span class="o">=</span> <span class="m">300</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># è¯†åˆ«æ˜¾è‘—ä¿¡å·ï¼ˆ|mean_normxpehh| &gt; 2ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">candidates_pos</span> <span class="o">&lt;-</span> <span class="n">xpehh[xpehh</span><span class="o">$</span><span class="n">mean_normxpehh</span> <span class="o">&gt;</span> <span class="m">2</span><span class="p">,</span> <span class="n">]</span>
</span></span><span class="line"><span class="cl"><span class="n">candidates_neg</span> <span class="o">&lt;-</span> <span class="n">xpehh[xpehh</span><span class="o">$</span><span class="n">mean_normxpehh</span> <span class="o">&lt;</span> <span class="m">-2</span><span class="p">,</span> <span class="n">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä¿å­˜å€™é€‰åŒºåŸŸ</span>
</span></span><span class="line"><span class="cl"><span class="nf">write.table</span><span class="p">(</span><span class="n">candidates_pos</span><span class="p">,</span> <span class="s">&#34;candidates_positive.txt&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">            <span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">quote</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&#34;\t&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">write.table</span><span class="p">(</span><span class="n">candidates_neg</span><span class="p">,</span> <span class="s">&#34;candidates_negative.txt&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">            <span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">quote</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&#34;\t&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æŸ¥çœ‹å€™é€‰åŒºåŸŸæ•°é‡</span>
</span></span><span class="line"><span class="cl"><span class="nf">cat</span><span class="p">(</span><span class="s">&#34;æ­£é€‰æ‹©ä¿¡å·çª—å£æ•°:&#34;</span><span class="p">,</span> <span class="nf">nrow</span><span class="p">(</span><span class="n">candidates_pos</span><span class="p">),</span> <span class="s">&#34;\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">cat</span><span class="p">(</span><span class="s">&#34;è´Ÿé€‰æ‹©ä¿¡å·çª—å£æ•°:&#34;</span><span class="p">,</span> <span class="nf">nrow</span><span class="p">(</span><span class="n">candidates_neg</span><span class="p">),</span> <span class="s">&#34;\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">XP_EHH</span><span class="o">&lt;-</span><span class="nf">read.table</span><span class="p">(</span><span class="s">&#34;C_W_all.xpehh.out.norm.100kb.windows&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="n">header</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">stringsAsFactors</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">XP_EHH</span><span class="o">$</span><span class="n">mid</span><span class="o">&lt;-</span><span class="p">(</span><span class="n">XP_EHH</span><span class="o">$</span><span class="n">win_start</span><span class="o">+</span><span class="n">XP_EHH</span><span class="o">$</span><span class="n">win_end</span><span class="p">)</span><span class="o">/</span><span class="m">2</span>
</span></span><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">XP_EHH</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">mid</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">mean_normxpehh</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_line</span><span class="p">(</span><span class="n">linewidth</span> <span class="o">=</span> <span class="m">0.3</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#34;skyblue&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_minimal</span><span class="p">()</span><span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">text</span>             <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">family</span> <span class="o">=</span> <span class="s">&#34;serif&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;black&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">axis.text.x</span>      <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">angle</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;black&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">10</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">axis.text.y</span>      <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s">&#34;black&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">10</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">axis.title.y</span>     <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s">&#34;black&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">12</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">axis.ticks</span>       <span class="o">=</span> <span class="nf">element_line</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">0.4</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="s">&#34;black&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">panel.grid.minor</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="n">panel.grid.major</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="n">panel.border</span>     <span class="o">=</span> <span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="kc">NA</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;black&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">0.6</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">plot.title</span>       <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">hjust</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">14</span><span class="p">,</span> <span class="n">face</span> <span class="o">=</span> <span class="s">&#34;bold&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">plot.margin</span>      <span class="o">=</span> <span class="nf">margin</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">10</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># å°†å›¾ä¾‹ç§»å…¥å›¾å†…ï¼Œå³ä¸‹è§’</span>
</span></span><span class="line"><span class="cl">    <span class="n">legend.position</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0.95</span><span class="p">,</span> <span class="m">0.05</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">legend.justification</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;right&#34;</span><span class="p">,</span> <span class="s">&#34;bottom&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">legend.background</span> <span class="o">=</span> <span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="nf">alpha</span><span class="p">(</span><span class="s">&#34;white&#34;</span><span class="p">,</span> <span class="m">0.6</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="kc">NA</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">legend.key</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="nf">ggsave</span><span class="p">(</span><span class="s">&#34;all.chr.W_C.xpehh.line.png&#34;</span><span class="p">,</span><span class="n">width</span> <span class="o">=</span> <span class="m">10</span><span class="p">,</span><span class="n">height</span> <span class="o">=</span> <span class="m">7</span><span class="p">,</span><span class="n">dpi</span> <span class="o">=</span> <span class="m">300</span><span class="p">)</span>
</span></span></code></pre></div>

      </div>
      <footer class="post-footer">
        <ul class="post-tags">
          <li><a href="https://Tdxxxx-student.github.io/tags/%E7%BE%A4%E4%BD%93%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90">ç¾¤ä½“ç»“æ„åˆ†æ</a></li>
          <li><a href="https://Tdxxxx-student.github.io/tags/%E5%8F%98%E5%BC%82%E6%A3%80%E6%B5%8B">å˜å¼‚æ£€æµ‹</a></li>
          <li><a href="https://Tdxxxx-student.github.io/tags/%E9%87%8D%E6%B5%8B%E5%BA%8F">é‡æµ‹åº</a></li>
          <li><a href="https://Tdxxxx-student.github.io/tags/gwas">GWAS</a></li>
          <li><a href="https://Tdxxxx-student.github.io/tags/qtl-seq">QTL-seq</a></li>
        </ul>
      </footer>

      
      <nav class="post-nav-full">
        <div class="nav-info">
            ç¬¬ <strong>4</strong> / 4 ç¯‡ 
            <span style="opacity: 0.6; font-size: 0.9em; margin-left: 5px;">(åˆ†ç±»: é‡æµ‹åºåˆ†æ)</span>
        </div>
        
        <div class="nav-buttons">
          <a class="nav-btn first" href="https://Tdxxxx-student.github.io/posts/31%E4%B8%AA%E5%93%81%E7%A7%8D%E5%A4%A7%E8%B1%86%E9%87%8D%E6%B5%8B%E5%BA%8F%E5%88%86%E6%9E%90%E6%96%87%E7%AB%A0/" title="ç¬¬ä¸€ç¯‡">Â«</a>
          <a class="nav-btn prev" href="https://Tdxxxx-student.github.io/posts/%E7%BE%A4%E4%BD%93%E9%81%97%E4%BC%A0%E5%AD%A6%E4%B8%8E%E9%87%8D%E6%B5%8B%E5%BA%8F%E5%88%86%E6%9E%90%E8%A7%A3%E9%87%8A/" title="ç¾¤ä½“é—ä¼ å­¦ä¸é‡æµ‹åºåˆ†æè§£é‡Š">â€¹</a><div class="nav-pages-group">
            <span class="nav-dots">...</span>
                <a class="nav-num" href="https://Tdxxxx-student.github.io/posts/8000%E5%A4%A7%E8%B1%86%E9%87%8D%E6%B5%8B%E5%BA%8F%E6%96%87%E7%AB%A0%E5%A4%8D%E7%8E%B0/" title="8000å¤§è±†é‡æµ‹åºæ–‡ç« å¤ç°">2</a>
                <a class="nav-num" href="https://Tdxxxx-student.github.io/posts/%E7%BE%A4%E4%BD%93%E9%81%97%E4%BC%A0%E5%AD%A6%E4%B8%8E%E9%87%8D%E6%B5%8B%E5%BA%8F%E5%88%86%E6%9E%90%E8%A7%A3%E9%87%8A/" title="ç¾¤ä½“é—ä¼ å­¦ä¸é‡æµ‹åºåˆ†æè§£é‡Š">3</a>

            <span class="nav-num current">4</span>
          </div>
          <span class="nav-btn next disabled">â€º</span>
          <span class="nav-btn last disabled">Â»</span>
        </div>
      </nav></article>

    
    <aside class="sidebar-right">
      <div class="toc-card">
        <div class="toc-title">
          <span class="toc-icon">ğŸ“–</span> ç›®å½•
        </div>
        <nav id="TableOfContents">
          <nav id="TableOfContents">
  <ul>
    <li><a href="#ç›®å½•">ç›®å½•</a></li>
    <li><a href="#è½¯ä»¶å®‰è£…">è½¯ä»¶å®‰è£…</a>
      <ul>
        <li><a href="#1-lumpy-sv">1. lumpy-sv</a></li>
        <li><a href="#2-svtyper">2. svtyper</a></li>
        <li><a href="#3-cnvnator">3. cnvnator</a></li>
      </ul>
    </li>
    <li><a href="#å˜å¼‚æ£€æµ‹">å˜å¼‚æ£€æµ‹</a>
      <ul>
        <li><a href="#1-æ„å»ºåŸºå› ç»„-index">1. æ„å»ºåŸºå› ç»„ index</a></li>
        <li><a href="#2-æ¯”å¯¹æ’åºå»é‡">2. æ¯”å¯¹æ’åºå»é‡</a></li>
        <li><a href="#3-snpindel-æ£€æµ‹">3. SNPã€Indel æ£€æµ‹</a></li>
        <li><a href="#4-sv-æ£€æµ‹">4. SV æ£€æµ‹</a></li>
        <li><a href="#5-cnv-æ£€æµ‹">5. CNV æ£€æµ‹</a></li>
        <li><a href="#6-snpindel-æ³¨é‡Š">6. SNP/InDel æ³¨é‡Š</a></li>
        <li><a href="#7-cnv-å’Œ-sv-æ³¨é‡Š">7. CNV å’Œ SV æ³¨é‡Š</a></li>
      </ul>
    </li>
    <li><a href="#ç¾¤ä½“ç»“æ„åˆ†æ">ç¾¤ä½“ç»“æ„åˆ†æ</a>
      <ul>
        <li><a href="#1-æ•°æ®è¿‡æ»¤">1. æ•°æ®è¿‡æ»¤</a></li>
        <li><a href="#2-å»ºæ ‘åˆ†æ">2. å»ºæ ‘åˆ†æ</a></li>
        <li><a href="#3-pca-åˆ†æ">3. PCA åˆ†æ</a></li>
        <li><a href="#4-ç¾¤ä½“ç»“æ„åˆ†æ">4. ç¾¤ä½“ç»“æ„åˆ†æ</a></li>
        <li><a href="#5-ld-è¡°å‡åˆ†æä¸è¦åšldä¿®å‰ªçš„vcfè¿›è¡Œè®¡ç®—">5. LD è¡°å‡åˆ†æï¼ˆä¸è¦åšLDä¿®å‰ªçš„vcfè¿›è¡Œè®¡ç®—ï¼‰</a></li>
      </ul>
    </li>
    <li><a href="#é€‰æ‹©åˆ†æ">é€‰æ‹©åˆ†æ</a>
      <ul>
        <li><a href="#1-Ï€-å’Œ-rod-åˆ†æ">1. Ï€ å’Œ ROD åˆ†æ</a></li>
        <li><a href="#2-tajimas-d-åˆ†æ">2. Tajima&rsquo;s D åˆ†æ</a></li>
        <li><a href="#3-fst-åˆ†æè‹¥è¾“å…¥vcfgzå‚æ•°ä¿®æ”¹ä¸ºgzvcf">3. Fst åˆ†æï¼ˆè‹¥è¾“å…¥vcf.gz,å‚æ•°ä¿®æ”¹ä¸º&ndash;gzvcfï¼‰</a></li>
        <li><a href="#4-rod--fst-è”åˆåˆ†æ">4. ROD + Fst è”åˆåˆ†æ</a></li>
        <li><a href="#5-fsttajimadpi">5. Fst+tajimaD+Pi</a></li>
        <li><a href="#6-fstrod-å°è¯•å€ŸåŠ©aiå¼¥è¡¥ä¸Šå…å¾—perlè„šæœ¬">6 Fst+Rod (å°è¯•å€ŸåŠ©aiå¼¥è¡¥ä¸Šå…å¾—Perlè„šæœ¬)</a></li>
      </ul>
    </li>
    <li><a href="#gwas-åˆ†æ">GWAS åˆ†æ</a>
      <ul>
        <li><a href="#1-åŸºå› å‹å¡«å……">1. åŸºå› å‹å¡«å……</a></li>
        <li><a href="#2-æ ‡å‡†-gwas-åˆ†æ">2. æ ‡å‡† GWAS åˆ†æ</a></li>
        <li><a href="#3-gwas-q-åˆ†æåŠ å…¥ç¾¤ä½“ç»“æ„åå˜é‡">3. GWAS-Q åˆ†æï¼ˆåŠ å…¥ç¾¤ä½“ç»“æ„åå˜é‡ï¼‰</a></li>
        <li><a href="#4-çœŸå®æ•°æ®-gwas">4. çœŸå®æ•°æ® GWAS</a></li>
      </ul>
    </li>
    <li><a href="#qtl-seq-åˆ†æ">QTL-seq åˆ†æ</a>
      <ul>
        <li><a href="#1-vcf-è½¬æ¢ä¸º-table-æ ¼å¼">1. VCF è½¬æ¢ä¸º Table æ ¼å¼</a></li>
        <li><a href="#2-qtl-seq-åˆ†ær-è„šæœ¬">2. QTL-seq åˆ†æï¼ˆR è„šæœ¬ï¼‰</a></li>
      </ul>
    </li>
    <li><a href="#é™„å½•åˆ†ææµç¨‹å›¾">é™„å½•ï¼šåˆ†ææµç¨‹å›¾</a>
      <ul>
        <li><a href="#å¸¸è§çš„æ»‘åŠ¨çª—å£å¤§å°è®¾ç½®">å¸¸è§çš„æ»‘åŠ¨çª—å£å¤§å°è®¾ç½®</a></li>
        <li><a href="#é€‰æ‹©åˆ†æå¯é€‰">é€‰æ‹©åˆ†æï¼ˆå¯é€‰ï¼‰</a></li>
      </ul>
    </li>
  </ul>
</nav>
        </nav>
      </div>
    </aside>

  </div>
</div>
    </main>
    
<footer class="footer">
        <span>tdx0307</span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>
<a href="/search/" class="search-fab" title="æœç´¢ (Ctrl+F)">ğŸ”</a>

<style>
.search-fab {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    width: 50px;
    height: 50px;
    background: var(--primary);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3rem;
    text-decoration: none;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
    z-index: 100;
}

.search-fab:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
}

@media (max-width: 768px) {
    .search-fab {
        bottom: 1rem;
        right: 1rem;
        width: 45px;
        height: 45px;
    }
}
</style>

<script>

document.addEventListener('DOMContentLoaded', function() {
    if (document.getElementById('wide-post-layout')) {
        var main = document.querySelector('main.main');
        if (main) {
            main.style.maxWidth = '100%';
            main.style.width = '100%';
            main.style.padding = '0';
            main.style.margin = '0 auto';
        }
        
        document.body.classList.add('is-single-post');
    }
});
</script>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
