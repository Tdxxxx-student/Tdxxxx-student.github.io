<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>8000大豆重测序文章复现 | 我的空间</title>
<meta name="keywords" content="重测序, GWAS, 变异检测">
<meta name="description" content="借鉴别人的文章复现结果">
<meta name="author" content="tdx">
<link rel="canonical" href="https://Tdxxxx-student.github.io/posts/8000%E5%A4%A7%E8%B1%86%E9%87%8D%E6%B5%8B%E5%BA%8F%E6%96%87%E7%AB%A0%E5%A4%8D%E7%8E%B0/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.e2698852c6e8116e7ca528885981ca226437cb47da1d503f2737f09678bdfc27.css" integrity="sha256-4mmIUsboEW58pSiIWYHKImQ3y0faHVA/Jzfwlni9/Cc=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://Tdxxxx-student.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://Tdxxxx-student.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://Tdxxxx-student.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://Tdxxxx-student.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://Tdxxxx-student.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://Tdxxxx-student.github.io/posts/8000%E5%A4%A7%E8%B1%86%E9%87%8D%E6%B5%8B%E5%BA%8F%E6%96%87%E7%AB%A0%E5%A4%8D%E7%8E%B0/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><link rel="stylesheet" href="https://Tdxxxx-student.github.io/css/custom.css"><meta property="og:url" content="https://Tdxxxx-student.github.io/posts/8000%E5%A4%A7%E8%B1%86%E9%87%8D%E6%B5%8B%E5%BA%8F%E6%96%87%E7%AB%A0%E5%A4%8D%E7%8E%B0/">
  <meta property="og:site_name" content="我的空间">
  <meta property="og:title" content="8000大豆重测序文章复现">
  <meta property="og:description" content="借鉴别人的文章复现结果">
  <meta property="og:locale" content="zh-cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2026-02-05T14:53:16+08:00">
    <meta property="article:modified_time" content="2026-02-05T14:53:16+08:00">
    <meta property="article:tag" content="重测序">
    <meta property="article:tag" content="GWAS">
    <meta property="article:tag" content="变异检测">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="8000大豆重测序文章复现">
<meta name="twitter:description" content="借鉴别人的文章复现结果">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://Tdxxxx-student.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "8000大豆重测序文章复现",
      "item": "https://Tdxxxx-student.github.io/posts/8000%E5%A4%A7%E8%B1%86%E9%87%8D%E6%B5%8B%E5%BA%8F%E6%96%87%E7%AB%A0%E5%A4%8D%E7%8E%B0/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "8000大豆重测序文章复现",
  "name": "8000大豆重测序文章复现",
  "description": "借鉴别人的文章复现结果",
  "keywords": [
    "重测序", "GWAS", "变异检测"
  ],
  "articleBody": "8000份大豆重测序数据分析流程 目录 分析流程总览 数据分析具体流程 一、数据质控 二、序列比对 三、变异检测 四、变异注释 图表制作 一、群体遗传学分析 二、连锁不平衡分析 三、核苷酸多样性分析 四、固定指数 (FST) 五、选择清除分析 六、全基因组关联分析 (GWAS) 七、其他分析 总结 分析流程总览 整体流程架构 原始数据 (Raw Data) ↓ 数据质控 (Quality Control) ↓ 比对到参考基因组 (Alignment) ↓ 变异检测 (Variant Detection) ↓ 变异注释 (Variant Annotation) ↓ 进化和群体遗传学分析 (Evolutionary and Population Genetics Analysis) 数据分析具体流程 一、数据质控 1. FastQC - 质量评估 软件功能： 对测序数据进行质量评估\n基本用法：\nfastqc -t 8 -o /path/to/output /path/to/seq_data/*.fastq 参数说明：\n参数 说明 -t 8 使用8个线程 -o 指定输出目录 输入文件： fastq格式的测序数据\n输出结果：\nHTML格式的质量报告文件 包含测序质量分布、GC含量、序列长度分布、接头含量等信息 2. fastp - 质控与过滤 软件功能：\n质量剪切（quality trimming） 过滤低质量reads 去接头 UMI（Unique Molecular Identifier）处理 过滤polyG（Illumina NovaSeq特征） 生成HTML和JSON格式的质控报告 基本用法：\nfastp -i sample_R1.fq.gz -I sample_R2.fq.gz \\ -o clean_R1.fq.gz -O clean_R2.fq.gz \\ -w 8 常用参数详解：\n参数 说明 默认值 -i 输入的R1（前向）reads文件 - -I 输入的R2（反向）reads文件 - -o 输出的清洁R1 reads文件 - -O 输出的清洁R2 reads文件 - -w 线程数 2 -q 质量值阈值，低于此值的碱基将被剪切 15 -u 低质量reads百分比阈值，超过此比例的reads将被过滤 30 -n reads长度阈值，短于此长度的reads将被过滤 0 -l 保留的最小reads长度 15 --detect_adapter_for_pe 自动检测接头（推荐） - --trim_poly_g 去除polyG尾（NovaSeq数据必需） - --poly_g_min_len 触发polyG剪切的最小长度 10 --cut_front 从前端剪切指定数量的碱基 - --cut_tail 从尾端剪切指定数量的碱基 - --cut_mean_quality 按平均质量值剪切 - --length_required reads最小长度要求 15 --json 输出JSON格式质控报告 fastp.json --html 输出HTML格式质控报告 fastp.html --report_title 报告标题 fastp report 二、序列比对 BWA-MEM 比对 软件功能： 将清洁后的reads比对到参考基因组\n2.1 建立参考基因组索引 bwa index reference.fasta 此步骤会生成多个索引文件（.amb, .ann, .bwt, .pac, .sa）\n2.2 序列比对 bwa mem -t 8 -M reference.fasta \\ clean_R1.fq.gz clean_R2.fq.gz \\ \u003e sample.sam 参数说明：\n-t 8：使用8个线程进行比对，提高速度 -M：将shorter split hits标记为次优，以便兼容Picard工具 reference.fasta：参考基因组序列文件 输入： 清洁后的R1和R2 reads（gzip压缩格式）\n输出： SAM格式比对结果\n2.3 SAM转BAM并排序 # SAM转BAM（压缩格式） samtools view -Sb sample.sam \u003e sample.bam # 对BAM文件进行排序 samtools sort sample.bam -o sample.sorted.bam # 建立索引，便于后续快速访问 samtools index sample.sorted.bam 2.4 标记PCR重复 # 使用Picard标记重复 picard MarkDuplicates \\ I=sample.sorted.bam \\ O=sample.dedup.bam \\ M=metrics.txt # 建立索引 samtools index sample.dedup.bam 参数说明：\nI=：输入文件 O=：输出文件 M=：输出重复统计信息 2.5 添加Read Groups信息（可选但推荐） gatk AddOrReplaceReadGroups \\ -I sample.dedup.bam \\ -O sample.rg.bam \\ -RGID id1 \\ -RGLB lib1 \\ -RGPL illumina \\ -RGPU unit1 \\ -RGSM sample1 参数说明：\n-RGID：Read Group ID -RGLB：Library名称 -RGPL：测序平台（illumina, iontorrent等） -RGPU：测序单元 -RGSM：样本名称 三、变异检测 GATK Best Practices 流程 GATK（Genome Analysis Toolkit）是目前最广泛使用的变异检测软件之一。\n3.1 HaplotypeCaller - 单样本变异检测 基本用法（GVCF模式）：\ngatk HaplotypeCaller \\ -R reference.fasta \\ -I sample.dedup.bam \\ -O sample.g.vcf.gz \\ -ERC GVCF 参数说明：\n-R：参考基因组fasta文件 -I：输入的BAM文件 -O：输出的gVCF文件（gzip压缩） -ERC GVCF：产生GVCF格式，用于后续联合分析 GVCF模式会记录所有位点的信息，包括变异位点和非变异位点，便于后续多样本联合分析。\n3.2 CombineGVCFs - 合并多个gVCF gatk CombineGVCFs \\ -R reference.fasta \\ --variant sample1.g.vcf.gz \\ --variant sample2.g.vcf.gz \\ --variant sample3.g.vcf.gz \\ ... \\ -O cohort.g.vcf.gz 批处理示例：\n# 创建variant列表文件 ls *.g.vcf.gz \u003e variant_list.txt # 合并 gatk CombineGVCFs \\ -R reference.fasta \\ --variant sample1.g.vcf.gz \\ --variant sample2.g.vcf.gz \\ -O cohort.g.vcf.gz 3.3 GenotypeGVCFs - 联合基因分型 gatk GenotypeGVCFs \\ -R reference.fasta \\ -V cohort.g.vcf.gz \\ -O cohort.vcf.gz 3.4 VariantFiltration - 变异过滤 SNP过滤标准：\ngatk VariantFiltration \\ -R reference.fasta \\ -V cohort.vcf.gz \\ -O cohort.filtered.vcf.gz \\ --filter-name \"QD_filter\" --filter-expression \"QD \u003c 2.0\" \\ --filter-name \"FS_filter\" --filter-expression \"FS \u003e 60.0\" \\ --filter-name \"MQ_filter\" --filter-expression \"MQ \u003c 40.0\" \\ --filter-name \"MQRankSum_filter\" --filter-expression \"MQRankSum \u003c -12.5\" \\ --filter-name \"ReadPosRankSum_filter\" --filter-expression \"ReadPosRankSum \u003c -8.0\" InDel过滤标准：\ngatk VariantFiltration \\ -R reference.fasta \\ -V cohort.vcf.gz \\ -O cohort.indel.filtered.vcf.gz \\ --filter-name \"QD_filter\" --filter-expression \"QD \u003c 2.0\" \\ --filter-name \"FS_filter\" --filter-expression \"FS \u003e 200.0\" \\ --filter-name \"ReadPosRankSum_filter\" --filter-expression \"ReadPosRankSum \u003c -20.0\" 过滤指标说明：\n指标 全称 说明 SNP阈值 InDel阈值 QD QualByDepth 每深度质量分数 \u003c 2.0 \u003c 2.0 FS FisherStrand 链偏向性 \u003e 60.0 \u003e 200.0 MQ RMSMappingQuality 根均方映射质量 \u003c 40.0 - MQRankSum MappingQualityRankSumTest 映射质量秩和检验 \u003c -12.5 - ReadPosRankSum ReadPositionRankSumTest Read位置秩和检验 \u003c -8.0 \u003c -20.0 SOR StrandOddsRatio 链比值 \u003e 3.0 \u003e 10.0 3.5 SelectVariants - 提取高质量变异 gatk SelectVariants \\ -R reference.fasta \\ -V cohort.filtered.vcf.gz \\ --exclude-filtered \\ -O cohort.high_quality.vcf.gz 3.6 分别提取SNP和InDel 提取SNP：\ngatk SelectVariants \\ -V cohort.high_quality.vcf.gz \\ -select-type SNP \\ -O cohort.snp.vcf.gz 提取InDel：\ngatk SelectVariants \\ -V cohort.high_quality.vcf.gz \\ -select-type INDEL \\ -O cohort.indel.vcf.gz 四、变异注释 ANNOVAR 注释流程 软件功能： 对检测到的变异进行功能注释，预测变异对基因功能的影响\n4.1 准备工作 下载注释数据库：\n# 建立数据库目录 mkdir humandb/ # 下载RefSeq基因数据库 annotate_variation.pl -buildver dm6 \\ -downdb -webfrom annovar \\ refGene humandb/ # 下载dbNSFP数据库（包含多个功能预测工具的结果） annotate_variation.pl -buildver dm6 \\ -downdb -webfrom annovar \\ dbnsfp42a humandb/ # 其他常用数据库 annotate_variation.pl -buildver dm6 \\ -downdb -webfrom annovar \\ gnomad_genome humandb/ 4.2 转换VCF格式为ANNOVAR输入格式 # SNP转换 convert2annovar.pl -format v4 cohort.snp.vcf.gz \u003e cohort.snp.avinput # InDel转换 convert2annovar.pl -format v4 cohort.indel.vcf.gz \u003e cohort.indel.avinput 4.3 执行注释 SNP注释：\ntable_annovar.pl cohort.snp.avinput humandb/ \\ -buildver dm6 \\ -out cohort.snp_annotated \\ -remove \\ -protocol refGene,dbnsfp42a,gnomad_genome \\ -operation g,f,f \\ -nastring . \\ -vcfinput InDel注释：\ntable_annovar.pl cohort.indel.avinput humandb/ \\ -buildver dm6 \\ -out cohort.indel_annotated \\ -remove \\ -protocol refGene \\ -operation g \\ -nastring . \\ -vcfinput 参数说明：\n-buildver：基因组版本（如dm6, hg38等） -protocol：指定要使用的注释数据库 -operation： g：基于基因的注释 f：基于过滤的注释 -nastring：缺失值的表示字符串 -vcfinput：输入为VCF格式 注释结果解读：\nexonic：外显子区的变异 splicing：剪接位点附近的变异（±2bp） intronic：内含子区的变异 upstream/downstream：基因上游/下游区域 intergenic：基因间区 UTR5/UTR3：5’/3’非翻译区 功能影响预测：\nsynonymous SNV：同义突变（不改变氨基酸） nonsynonymous SNV：非同义突变 missense：错义突变 nonsense：无义突变（产生终止密码子） frameshift：移码突变 图表制作 一、群体遗传学分析 1.1 PCA分析（主成分分析） 分析目的：\n评估群体结构 识别样本聚类模式 检测离群样本 揭示样本间的遗传关系 常用软件：\nPLINK：命令行工具，快速高效 GCTA：支持混合线性模型 SNPRelate（R包）：灵活，便于可视化 PLINK进行PCA分析：\n# Step 1: 将VCF转换为PLINK格式 plink --vcf cohort.vcf.gz --make-bed --out population # Step 2: 数据过滤（可选） plink --bfile population \\ --maf 0.05 \\ --geno 0.1 \\ --hwe 1e-6 \\ --make-bed \\ --out population_filtered # Step 3: 进行PCA分析 plink --bfile population_filtered \\ --pca 20 \\ --out pca_result # 输出文件： # - pca_result.eigenval：特征值（解释方差比例） # - pca_result.eigenvec：特征向量（样本的PC坐标） R语言可视化：\n# 读取PCA结果 pca_data \u003c- read.table(\"pca_result.eigenvec\", header=FALSE) colnames(pca_data) \u003c- c(\"FID\", \"IID\", paste0(\"PC\", 1:20)) # 读取群体信息（如果有的话） group_info \u003c- read.table(\"group_info.txt\", header=TRUE) pca_data \u003c- merge(pca_data, group_info, by=\"IID\") # 绘制PC1 vs PC2 library(ggplot2) ggplot(pca_data, aes(x=PC1, y=PC2, color=Group)) + geom_point(size=3, alpha=0.7) + theme_bw() + labs(x=\"PC1\", y=\"PC2\", title=\"PCA Analysis\", subtitle=paste0(\"PC1: \", round(summary(prcomp(pca_data[,3:22]))$importance[2,1]*100, 2), \"% variance\")) # 绘制PC1 vs PC3 ggplot(pca_data, aes(x=PC1, y=PC3, color=Group)) + geom_point(size=3, alpha=0.7) + theme_bw() + labs(x=\"PC1\", y=\"PC3\") # 绘制碎石图（Scree plot） eigenvals \u003c- read.table(\"pca_result.eigenval\") var_explained \u003c- eigenvals$V1 / sum(eigenvals$V1) * 100 plot(1:20, var_explained[1:20], type=\"b\", xlab=\"Principal Component\", ylab=\"Variance Explained (%)\", main=\"Scree Plot\") 1.2 系统发育树构建 分析目的：\n展示样本间的进化关系 识别单系群 推断群体历史 常用方法：\n方法 特点 适用场景 软件 邻接法(NJ) 速度快，适用于大数据 初步分析 MEGA, PHYLIP 最大似然法(ML) 准确性高，计算量大 精确分析 RAxML, IQ-TREE 贝叶斯法 最准确，计算量极大 小数据集精细分析 MrBayes 完整流程：\nStep 1: 提取变异位点并格式转换\n# 使用vcf2phylip（推荐） vcf2phylip.py --input cohort.vcf.gz --output phylip_file # 或使用seqtk seqtk subseq reference.fasta region_list.txt \u003e alignment.fasta Step 2: 构建系统发育树（IQ-TREE）\n# 基本分析 iqtree -s phylip_file -m GTR+G -bb 1000 -nt AUTO # 参数说明： # -s: 输入文件（PHYLIP或FASTA格式） # -m: 替代模型（GTR+G常用，或使用MFP让软件自动选择） # -bb: 自举重复次数（1000为标准） # -nt: 线程数（AUTO自动检测） # 输出文件： # - *.treefile: 最佳系统发育树（Newick格式） # - *.log: 运行日志 # - *.iqtree: 详细结果 Step 3: 使用RAxML（替代方案）\nraxmlHPC -s phylip_file \\ -n output \\ -m GTRGAMMA \\ -p 12345 \\ -# 100 \\ -f a # 参数说明： # -s: 输入文件 # -n: 输出文件后缀 # -m: 替代模型 # -p: 随机种子 # -#: 自举重复次数 # -f a: 快速自举分析和搜索最佳树 Step 4: 可视化\n在线工具：\niTOL (https://itol.embl.de/)：功能强大，可高度定制 Evolview (https://evolgenius.info/evolview/)：界面友好 R语言ggtree示例：\nlibrary(ggtree) library(treeio) # 读取树文件 tree \u003c- read.tree(\"output.treefile\") # 基本绘图 ggtree(tree) + geom_tiplab() + geom_tippoint(aes(color=group), size=3) + theme_tree2() # 添加进化距离标尺 ggtree(tree) + geom_treescale() + geom_tiplab(size=3) + geom_nodepoint(aes(label=label), color=\"red\", size=3) # 添加自展值 ggtree(tree) + geom_nodelab(aes(label=bootstrap), size=3, color=\"blue\") 1.3 群体结构分析 分析目的：\n评估群体混合程度 估计祖先群体数量 检测基因流事件 ADMIXTURE分析：\nStep 1: 数据准备\n# 转换为PLINK BED格式 plink --vcf cohort.vcf.gz --make-bed --out population # 过滤相关样本（可选） plink --bfile population \\ --indep-pairwise 50 5 0.2 \\ --out prune plink --bfile population \\ --extract prune.prune.in \\ --make-bed \\ --out population.pruned Step 2: 运行ADMIXTURE\n# 测试不同的K值（祖先群体数量） for K in {1..10}; do admixture --cv population.pruned.bed $K | tee log${K}.out done # 输出文件： # - population.pruned.${K}.Q: 个体 ancestry proportions # - population.pruned.${K}.P: SNP allele frequencies Step 3: 选择最优K值\n# 查看交叉验证误差 grep -h CV log*.out | sort -t':' -k2 -n # 选择CV误差最小的K值 Step 4: 可视化（R语言）\nlibrary(ggplot2) # 读取Q矩阵（ancestry proportions） K \u003c- 3 # 假设最优K=3 Q \u003c- read.table(paste0(\"population.pruned.\", K, \".Q\")) # 设置群体顺序（按第一祖先成分排序） order_idx \u003c- order(Q[,1]) Q_ordered \u003c- Q[order_idx,] # 准备绘图数据 plot_data \u003c- as.data.frame(Q_ordered) colnames(plot_data) \u003c- paste0(\"Ancestry\", 1:K) plot_data$Sample \u003c- factor(1:nrow(Q_ordered)) # 转换为长格式 library(reshape2) plot_data_long \u003c- melt(plot_data, id.vars=\"Sample\", variable.name=\"Ancestry\", value.name=\"Proportion\") # 绘制堆叠条形图 ggplot(plot_data_long, aes(x=Sample, y=Proportion, fill=Ancestry)) + geom_bar(stat=\"identity\", width=0.8) + scale_fill_brewer(palette=\"Set3\") + theme_minimal() + theme( axis.text.x = element_blank(), axis.ticks.x = element_blank(), legend.position=\"right\" ) + labs(x=\"Sample\", y=\"Ancestry Proportion\", title=paste0(\"ADMIXTURE Analysis (K=\", K, \")\")) 二、连锁不平衡分析 2.1 LD衰减分析 分析目的：\n评估连锁不平衡随着距离增加而衰减的程度 估算历史重组率 指导关联分析中的标记密度选择 关键指标：\n指标 说明 取值范围 r² 两个位点间的相关系数 0-1 D' 标准化连锁不平衡系数 0-1 LD衰减曲线：当r²降至其最大值的一半时，对应的物理距离即为LD衰减距离\n软件1: PopLDdecay（推荐）\n# 基本用法 PopLDdecay -InVCF cohort.vcf.gz \\ -OutStat ld_decay_stat # 参数说明： # -InVCF: 输入VCF文件 # -OutStat: 输出统计文件 # 高级参数 PopLDdecay -InVCF cohort.vcf.gz \\ -OutStat ld_decay_stat \\ -MaxDist 1000000 \\ -MAF 0.05 \\ -Miss 0.2 \\ -Het 1 # -MaxDist: 最大距离（bp） # -MAF: 最小等位基因频率 # -Miss: 最大缺失率 # -Het: 包含杂合位点 # 绘制LD衰减曲线 PopLDdecay -InVCF cohort.vcf.gz \\ -OutStat ld_decay_stat \\ -OutPlot ld_decay_plot # 输出文件： # - ld_decay_stat.stat: LD统计结果 # - ld_decay_stat.pdf: LD衰减曲线图 软件2: PLINK\n# 计算配对LD plink --vcf cohort.vcf.gz \\ --r2 \\ --ld-window 99999 \\ --ld-window-kb 100 \\ --ld-window-r2 0 \\ --out ld_pairwise # 参数说明： # --r2: 计算r²值 # --ld-window: 窗口内的最大SNP数量 # --ld-window-kb: 窗口大小（kb） # --ld-window-r2: 只报告r²高于此值的配对 # 滑动窗口LD plink --vcf cohort.vcf.gz \\ --ld-window 100 \\ --ld-window-kb 100 \\ --ld-window-r2 0.2 \\ --r2 --ld-window-r2 0 \\ --out ld_window R语言可视化：\nlibrary(ggplot2) # 读取PopLDdecay结果 ld_data \u003c- read.table(\"ld_decay_stat.stat\", header=TRUE) colnames(ld_data) \u003c- c(\"Distance\", \"R2\") # 按距离分组求平均值 ld_avg \u003c- aggregate(R2 ~ Distance, data=ld_data, FUN=mean) # 绘制LD衰减曲线 ggplot(ld_avg, aes(x=Distance/1000, y=R2)) + geom_line(size=1, color=\"steelblue\") + geom_smooth(method=\"loess\", se=FALSE, color=\"red\", linetype=\"dashed\") + labs(x=\"Distance (kb)\", y=\"Linkage Disequilibrium (r²)\", title=\"LD Decay Analysis\") + theme_bw() + annotate(\"segment\", x=0, xend=Inf, y=0.1, yend=0.1, linetype=\"dotted\", color=\"gray50\") # 计算半衰距离（r²降至0.1时的距离） half_decay_distance \u003c- approx(ld_avg$R2, ld_avg$Distance, xout=0.1)$y print(paste0(\"Half-decay distance: \", round(half_decay_distance/1000, 2), \" kb\")) 2.2 LD热图 目的： 展示特定染色体区域的LD模式\nR语言实现：\nlibrary(LDheatmap) library(SNPRelate) # 将VCF转换为GDS格式 snpgdsVCF2GDS(\"cohort.vcf.gz\", \"cohort.gds\") # 打开GDS文件 genofile \u003c- snpgdsOpen(\"cohort.gds\") # 提取特定区域的SNP snp_id \u003c- snpgdsSelectSNP(genofile, chromosome=1, start.position=1000000, end.position=2000000) # 计算LD矩阵 ld_matrix \u003c- snpgdsLDMat(genofile, snp.id=snp_id, method=\"r\", slide=100, LD.threshold=0.2) # 绘制LD热图 png(\"LD_heatmap.png\", width=2000, height=2000, res=150) LDheatmap(ld_matrix$snpdist, ld_matrix$LDmatrix, flip=TRUE, title=\"LD Heatmap (Chr1: 1-2 Mb)\", geneMap=\"no genes\") dev.off() # 关闭GDS文件 snpgdsClose(genofile) 三、核苷酸多样性分析 3.1 π (Pi) 计算 定义： π（核苷酸多样性）是指从群体中随机抽取的两个染色体的任意位点上，核苷酸差异的平均比例。\n计算公式：\nπ = Σ πij / [n(n-1)/2] 其中，πij是第i个和第j个序列之间的核苷酸差异，n是样本数量\n生物学意义：\n反映群体内的遗传多样性水平 高π值：高遗传多样性 低π值：低遗传多样性（可能经历了选择或瓶颈效应） 使用VCFtools计算：\n# 全基因组π（单点估计） vcftools --vcf cohort.vcf.gz \\ --site-pi \\ --out pi_per_site # 滑动窗口π vcftools --vcf cohort.vcf.gz \\ --window-pi 100000 \\ --window-pi-step 50000 \\ --out pi_window # 参数说明： # --window-pi: 窗口大小（bp） # --window-pi-step: 滑动步长（bp） # 输出文件： # - pi_per_site.sites.pi: 每个位点的π值 # - pi_window.windowed.pi: 窗口π值 使用PopGenome（R包）：\nlibrary(PopGenome) # 读取VCF文件 data \u003c- readVCF(\"cohort.vcf.gz\", include.unknown=TRUE) # 计算全基因组核苷酸多样性 data \u003c- diversity.stats(data) # 提取π值 pi_genome \u003c- data@nuc.diversity.within print(paste0(\"Genome-wide π: \", pi_genome)) # 滑动窗口分析 data \u003c- sliding.window.transform(data, width=100000, step=50000) data \u003c- diversity.stats(data) # 提取窗口π值 window_pi \u003c- data@nuc.diversity.within window_positions \u003c- data@sliding.window.positions # 可视化 plot(window_positions/1000000, window_pi, type=\"l\", lwd=2, xlab=\"Genome Position (Mb)\", ylab=\"Nucleotide Diversity (π)\", main=\"Sliding Window π Analysis\") 群体间π比较：\n# 群体1 vcftools --vcf cohort.vcf.gz \\ --keep population1.txt \\ --window-pi 100000 \\ --out pi_pop1 # 群体2 vcftools --vcf cohort.vcf.gz \\ --keep population2.txt \\ --window-pi 100000 \\ --out pi_pop2 # 群体3 vcftools --vcf cohort.vcf.gz \\ --keep population3.txt \\ --window-pi 100000 \\ --out pi_pop3 3.2 Watterson’s θ (Theta) 定义： 基于分离位点（segregating sites）数目的核苷酸多样性估计量\n计算公式：\nθ = S / an 其中：\nS：分离位点数目 an：调和级数和，an = Σ[1/(i-1)], i从2到n 生物学意义：\n与π类似，也是衡量遗传多样性的指标 在中性进化条件下，θ ≈ π π \u003c θ：说明群体经历了扩张 π \u003e θ：说明存在平衡选择或群体收缩 计算方法：\nlibrary(PopGenome) # 读取数据 data \u003c- readVCF(\"cohort.vcf.gz\", include.unknown=TRUE) # 计算Watterson's θ data \u003c- neutrality.stats(data) # 提取结果 theta \u003c- data@Watterson.theta theta \u003c- data@Tajimas.D print(paste0(\"Watterson's θ: \", theta)) Tajima’s D检验：\n# 使用VCFtools vcftools --vcf cohort.vcf.gz \\ --TajimaD 100000 \\ --out tajimaD # 输出文件： # - tajimaD.Tajima.D: 窗口Tajima's D值 四、固定指数 (FST) 4.1 FST计算 定义： FST（Fixation Index）是衡量群体间遗传分化程度的指标\n取值范围及意义：\nFST值 分化程度 解释 0 - 0.05 很小 群体间几乎无分化 0.05 - 0.15 中等 群体间有一定分化 0.15 - 0.25 较大 群体间分化显著 \u003e 0.25 极大 群体间分化极大 使用VCFtools计算：\n# 准备群体文件（每行一个样本ID） # population1.txt Sample001 Sample002 ... # population2.txt Sample101 Sample102 ... # 计算两群体间FST（单点） vcftools --vcf cohort.vcf.gz \\ --weir-fst-pop population1.txt \\ --weir-fst-pop population2.txt \\ --out fst_pop1_pop2 # 滑动窗口FST vcftools --vcf cohort.vcf.gz \\ --weir-fst-pop population1.txt \\ --weir-fst-pop population2.txt \\ --fst-window-size 100000 \\ --fst-window-step 50000 \\ --out fst_window # 参数说明： # --weir-fst-pop: 指定一个群体的样本文件 # --fst-window-size: 窗口大小（bp） # --fst-window-step: 滑动步长（bp） 使用PopGenome（R包）：\nlibrary(PopGenome) # 读取数据 data \u003c- readVCF(\"cohort.vcf.gz\", include.unknown=TRUE, gffpath=\"annotation.gff\") # 定义群体 populations \u003c- list( pop1 = read.table(\"population1.txt\")$V1, pop2 = read.table(\"population2.txt\")$V1, pop3 = read.table(\"population3.txt\")$V1 ) # 设置群体 data \u003c- set.populations(data, populations) # 计算FST data \u003c- F_ST.stats(data, mode=\"nucleotide\") # 提取结果 fst_matrix \u003c- data@F_ST.matrix print(fst_matrix) # 成对群体FST for (i in 1:(nrow(fst_matrix)-1)) { for (j in (i+1):nrow(fst_matrix)) { cat(sprintf(\"FST(%s, %s) = %.4f\\n\", rownames(fst_matrix)[i], colnames(fst_matrix)[j], fst_matrix[i,j])) } } 可视化FST分布：\nlibrary(ggplot2) # 读取窗口FST结果 fst_data \u003c- read.table(\"fst_window.windowed.weir.fst\", header=TRUE) # 绘制曼哈顿式FST图 ggplot(fst_data, aes(x=POS/1000000, y=WEIR_AND_COCKERHAM_FST)) + geom_point(size=0.5, alpha=0.6, color=\"steelblue\") + geom_hline(yintercept=0.15, linetype=\"dashed\", color=\"red\") + facet_wrap(~CHROM, scales=\"free_x\", ncol=4) + labs(x=\"Position (Mb)\", y=\"FST\", title=\"Genome-wide FST between Population 1 and 2\") + theme_bw() + theme(strip.text = element_text(size=8)) FST热图：\nlibrary(pheatmap) # 绘制FST矩阵热图 pheatmap(fst_matrix, display_numbers=TRUE, number_format=\"%.3f\", main=\"Pairwise FST between Populations\", color=colorRampPalette(c(\"white\", \"orange\", \"red\"))(50), breaks=seq(0, max(fst_matrix), length.out=51)) 五、选择清除分析 5.1 核苷酸多样性比值 (π-ratio) 原理： 受选择区域的核苷酸多样性会显著降低，通过计算不同群体间π的比值可以检测选择信号\n计算公式：\nπ-ratio = π_selected / π_control 低π-ratio值：该区域可能经历了正选择\n分析流程：\n# Step 1: 计算各群体π # 群体1（假设为受选择群体） vcftools --vcf cohort.vcf.gz \\ --keep population1.txt \\ --window-pi 100000 \\ --window-pi-step 50000 \\ --out pi_pop1 # 群体2（对照群体） vcftools --vcf cohort.vcf.gz \\ --keep population2.txt \\ --window-pi 100000 \\ --window-pi-step 50000 \\ --out pi_pop2 # Step 2: 计算π-ratio（使用Python或R） # Python示例 import pandas as pd pi1 = pd.read_csv(\"pi_pop1.windowed.pi\", sep=\"\\t\") pi2 = pd.read_csv(\"pi_pop2.windowed.pi\", sep=\"\\t\") pi_ratio = pi1.copy() pi_ratio[\"PI_RATIO\"] = pi1[\"PI\"] / pi2[\"PI\"] pi_ratio.to_csv(\"pi_ratio.txt\", sep=\"\\t\", index=False) R语言可视化：\nlibrary(ggplot2) # 读取数据 pi1 \u003c- read.table(\"pi_pop1.windowed.pi\", header=TRUE) pi2 \u003c- read.table(\"pi_pop2.windowed.pi\", header=TRUE) # 计算π-ratio pi_ratio \u003c- data.frame( CHROM = pi1$CHROM, BIN_START = pi1$BIN_START, BIN_END = pi1$BIN_END, PI_RATIO = pi1$PI / pi2$PI ) # 识别选择信号（阈值：5%分位数） threshold \u003c- quantile(pi_ratio$PI_RATIO, 0.05) candidates \u003c- pi_ratio[pi_ratio$PI_RATIO \u003c threshold, ] # 可视化 ggplot(pi_ratio, aes(x=BIN_START/1000000, y=PI_RATIO)) + geom_line(color=\"steelblue\", size=0.5) + geom_hline(yintercept=threshold, linetype=\"dashed\", color=\"red\", size=1) + geom_point(data=candidates, aes(x=BIN_START/1000000, y=PI_RATIO), color=\"red\", size=2, alpha=0.7) + facet_wrap(~CHROM, scales=\"free_x\", ncol=4) + labs(x=\"Position (Mb)\", y=\"π Ratio (Pop1/Pop2)\", title=\"Nucleotide Diversity Ratio Scan\") + theme_bw() # 输出候选区域 write.table(candidates, \"selection_candidates.txt\", sep=\"\\t\", row.names=FALSE, quote=FALSE) 5.2 XP-CLR (跨群体复合似然比检验) 原理： 检测由于选择引起的群体间等位基因频率差异，考虑了连锁不平衡和遗传重组\n特点：\n不需要单体型相位信息 适用于大数据集 对古老选择信号敏感 分析流程：\n# Step 1: 准备输入文件 # XP-CLR要求特定的格式：Chrom Position Likelihood # 将VCF转换为XP-CLR格式 # 可以使用自定义脚本或vcftools # 提取多等位基因信息 vcftools --vcf cohort.vcf.gz \\ --freq \\ --out allele_freq # Step 2: 运行XP-CLR # 安装XP-CLR后 xpclr -xpclr cohort.vcf.gz \\ -w1 1 200 2000 \\ -w2 1 100 1000 \\ -p0 0.001 \\ -maxSNP 1000 \\ -out xpclr_result # 参数说明： # -w1: 窗口参数（大小，步长，最大SNP数） # -w2: 第二个窗口参数 # -p0: 置信度阈值 # -maxSNP: 每个窗口的最大SNP数 结果可视化：\nlibrary(ggplot2) # 读取XP-CLR结果 xpclr \u003c- read.table(\"xpclr_result\", header=FALSE) colnames(xpclr) \u003c- c(\"CHROM\", \"Position\", \"XP_CLR_Score\", \"Ref_Freq\", \"Alt_Freq\") # 计算滑动窗口平均 window_size \u003c- 100000 # 100 kb xpclr$Window \u003c- floor(xpclr$Position / window_size) * window_size xpclr_avg \u003c- aggregate(XP_CLR_Score ~ Window + CHROM, data=xpclr, FUN=mean) # 绘制XP-CLR扫描图 ggplot(xpclr_avg, aes(x=Window/1000000, y=XP_CLR_Score)) + geom_line(color=\"steelblue\", size=1) + facet_wrap(~CHROM, scales=\"free_x\", ncol=4) + labs(x=\"Position (Mb)\", y=\"XP-CLR Score\", title=\"XP-CLR Scan for Selection Signals\") + theme_bw() # 识别显著峰（阈值：top 1%） threshold \u003c- quantile(xpclr_avg$XP_CLR_Score, 0.99) peaks \u003c- xpclr_avg[xpclr_avg$XP_CLR_Score \u003e threshold, ] # 标注显著峰 ggplot(xpclr_avg, aes(x=Window/1000000, y=XP_CLR_Score)) + geom_line(color=\"gray\") + geom_point(data=peaks, aes(x=Window/1000000, y=XP_CLR_Score), color=\"red\", size=2) + geom_hline(yintercept=threshold, linetype=\"dashed\", color=\"red\") + facet_wrap(~CHROM, scales=\"free_x\", ncol=4) + labs(x=\"Position (Mb)\", y=\"XP-CLR Score\", title=\"Significant Selection Peaks\") + theme_bw() 5.3 XP-EHH (交叉群体扩展单体型纯合性) 原理： 检测一个群体中已经完成的正选择（单体型频率高且扩展范围大），而另一群体中未完成的选择\n特点：\n适用于检测近期的选择事件 需要单体型相位信息 分析流程：\n# Step 1: 准备PLINK格式数据 plink --vcf cohort.vcf.gz --make-bed --out cohort # Step 2: 相位推断（使用SHAPEIT或BEAGLE） shapeit -B cohort \\ -M genetic_map.txt \\ -O cohort.phased \\ --thread 8 # 或使用beagle beagle gt=cohort.bed \\ out=cohort.phased \\ nthreads=8 # Step 3: 运行XP-EHH（使用selscan） selscan --xpehh \\ --vcf cohort.phased.vcf.gz \\ --map genetic_map.txt \\ --pop1 population1.txt \\ --pop2 population2.txt \\ --out xpehh_result # 参数说明： # --xpehh: 运行XP-EHH模式 # --pop1: 群体1的样本列表 # --pop2: 群体2的样本列表 # Step 4: 标准化XP-EHH得分 norm --xpehh --files xpehh_result 结果可视化：\nlibrary(ggplot2) # 读取标准化后的XP-EHH结果 xpehh \u003c- read.table(\"xpehh_result.norm.xpehh\", header=TRUE) # 绘制XP-EHH扫描图 ggplot(xpehh, aes(x=POS/1000000, y=normXPEHH)) + geom_point(size=0.5, alpha=0.6, color=\"steelblue\") + geom_hline(yintercept=0, linetype=\"dashed\", color=\"gray50\") + geom_hline(yintercept=2, linetype=\"dashed\", color=\"red\") + geom_hline(yintercept=-2, linetype=\"dashed\", color=\"blue\") + facet_wrap(~CHR, scales=\"free_x\", ncol=4) + labs(x=\"Position (Mb)\", y=\"Standardized XP-EHH\", title=\"XP-EHH Scan\") + theme_bw() # 识别显著信号（|XP-EHH| \u003e 2） candidates_pos \u003c- xpehh[xpehh$normXPEHH \u003e 2, ] candidates_neg \u003c- xpehh[xpehh$normXPEHH \u003c -2, ] 5.4 Tajima’s D 定义： 基于等位基因频谱的中性检验统计量\n计算公式：\nD = (π - θ) / SD(π - θ) 取值及生物学意义：\nD值 意义 进化解释 D » 0 显著为正 群体收缩或平衡选择 D ≈ 0 接近0 符合中性进化 D « 0 显著为负 群体扩张或正选择 使用VCFtools计算：\n# 滑动窗口Tajima's D vcftools --vcf cohort.vcf.gz \\ --TajimaD 100000 \\ --out tajimaD # 参数说明： # --TajimaD: 窗口大小（bp） # 输出文件： # - tajimaD.Tajima.D: 窗口Tajima's D值 使用PopGenome（R包）：\nlibrary(PopGenome) # 读取数据 data \u003c- readVCF(\"cohort.vcf.gz\", include.unknown=TRUE) # 滑动窗口分析 data \u003c- sliding.window.transform(data, width=100000, step=50000) # 计算Tajima's D data \u003c- neutrality.stats(data) # 提取结果 tajima_d \u003c- data@Tajimas.D window_positions \u003c- data@sliding.window.positions # 可视化 plot(window_positions/1000000, tajima_d, type=\"l\", lwd=2, col=\"steelblue\", xlab=\"Genome Position (Mb)\", ylab=\"Tajima's D\", main=\"Tajima's D Scan\") # 添加阈值线（显著性水平） abline(h=2, col=\"red\", lty=2) # 显著正D值 abline(h=-2, col=\"blue\", lty=2) # 显著负D值 # 识别显著窗口 sig_pos \u003c- which(tajima_d \u003e 2) sig_neg \u003c- which(tajima_d \u003c -2) 六、全基因组关联分析 (GWAS) 6.1 分析流程总览 表型数据收集 → 基因型数据质控 → 群体结构控制 → 关联分析 → 多重检验校正 → 结果可视化 → 候选基因鉴定 6.2 数据准备 表型文件：\nSample_ID Trait1 Trait2 Trait3 Sample001 10.5 25.3 1.2 Sample002 12.3 28.1 1.5 Sample003 9.8 24.7 1.1 ... 基因型文件：\nVCF格式 PLINK BED格式 HapMap格式 群体结构文件（可选但推荐）：\nQ矩阵：从ADMIXTURE或STRUCTURE获得 PC矩阵：从PCA获得 6.3 基因型数据质控 质控标准：\n参数 阈值 说明 MAF \u003e 0.05 最小等位基因频率 Missing rate \u003c 0.1 缺失率（位点） HWE P \u003e 1e-6 哈代-温伯格平衡p值 Geno missing \u003c 0.1 缺失率（个体） 使用PLINK进行质控：\n# Step 1: 转换格式 plink --vcf cohort.vcf.gz --make-bed --out gwas_raw # Step 2: 基本质控 plink --bfile gwas_raw \\ --maf 0.05 \\ --geno 0.1 \\ --hwe 1e-6 \\ --mind 0.1 \\ --make-bed \\ --out gwas_cleaned # Step 3: 去除相关样本（可选） plink --bfile gwas_cleaned \\ --indep-pairwise 50 5 0.2 \\ --out prune plink --bfile gwas_cleaned \\ --extract prune.prune.in \\ --make-bed \\ --out gwas_pruned # 参数说明： # --maf: 最小等位基因频率 # --geno: 位点最大缺失率 # --hwe: 哈代-温伯格平衡p值阈值 # --mind: 个体最大缺失率 # --indep-pairwise: LD剪裁（窗口大小，步长，r²阈值） 6.4 关联分析 常用软件对比：\n软件 模型 特点 适用场景 TASSEL GLM/MLM 图形界面，易于使用 小数据集 GAPIT 多种模型 R包，灵活 中等数据集 GEMMA LMM 快速，准确 大数据集 EMMAX LMM 高效 大数据集 使用GEMMA进行关联分析：\n# Step 1: 计算关系矩阵（Kinship Matrix） gemma -bfile gwas_cleaned \\ -gk 1 \\ -o kinship_matrix # -gk 1: 中心化关系矩阵（VanRaden method） # 输出：kinship_matrix.cXX.txt # Step 2: 准备表型文件 # 格式：Sample_ID Phenotype # （需要与PLINK的.fam文件顺序一致） # Step 3: 关联分析（线性混合模型） gemma -bfile gwas_cleaned \\ -k output/kinship_matrix.cXX.txt \\ -lmm 4 \\ -phenotype phenotype.txt \\ -o gwas_result # 参数说明： # -k: 关系矩阵文件 # -lmm: 混合模型方法（1=exact LRT, 4= Wald test） # -phenotype: 表型文件 # 输出文件： # - gwas_result.assoc.txt: 关联结果 使用GAPIT（R包）：\nlibrary(GAPIT3) # 读取数据 myG \u003c- read.table(\"gwas_cleaned.raw\", header=TRUE) myY \u003c- read.table(\"phenotype.txt\", header=TRUE) # PCA分析（作为协变量） myPCA \u003c- GAPIT.PCA(myG) # 运行GWAS myGWAS \u003c- GAPIT( Y = myY, G = myG, PCA.total = 3, # 使用前3个PC作为协变量 model = \"MLM\", # 混合线性模型 SNP.MAF = 0.05 ) # 多模型比较 myGWAS_multi \u003c- GAPIT( Y = myY, G = myG, PCA.total = 3, model = c(\"GLM\", \"MLM\", \"FarmCPU\", \"Blink\") ) # 输出： # - myGWAS: Manhattan图和QQ图 # - GAPIT.GWAS.Result.txt: 关联结果 6.5 结果解读 关联结果文件格式：\n列名 说明 CHR 染色体编号 SNP SNP标识符（位置或ID） BP 物理位置 P p值 BETA 效应大小 SE 标准误 R2 解释方差比例 多重检验校正：\n方法 阈值 说明 Bonferroni 0.05/N 保守，适合严格标准 FDR 0.05 允许5%假阳性 Suggestive 1e-5 建议显著性阈值 基因组显著性阈值：\nBonferroni correction: 0.05 / N 其中 N = 总SNP数量 例如，N = 1,000,000： 阈值 = 0.05 / 1,000,000 = 5e-8 6.6 结果可视化 曼哈顿图：\nlibrary(qqman) # 读取结果 gwas \u003c- read.table(\"gwas_result.assoc.txt\", header=TRUE) # 基本曼哈顿图 manhattan(gwas, chr = \"CHR\", bp = \"BP\", p = \"P\", genomewideline = -log10(5e-8), suggestiveline = -log10(1e-5), highlight = NULL, main = \"GWAS Manhattan Plot\") # 高亮特定SNP manhattan(gwas, chr = \"CHR\", bp = \"BP\", p = \"P\", highlight = gwas$SNP[gwas$P \u003c 5e-8], main = \"Significant SNPs\") # 添加基因名称 manhattan(gwas, chr = \"CHR\", bp = \"BP\", p = \"P\", annotatePval = 1e-6, # 标注p值小于1e-6的SNP annotateTop = TRUE) # 只标注最显著的SNP 使用ggplot2绘制曼哈顿图：\nlibrary(ggplot2) library(dplyr) # 准备数据 gwas_plot \u003c- gwas %\u003e% mutate( neglog10p = -log10(P), # 为每个染色体分配颜色 chr_color = ifelse(as.numeric(CHR) %% 2 == 0, \"even\", \"odd\"), # 转换染色体为因子 CHR = factor(CHR, levels=unique(CHR)) ) # 计算阈值 threshold \u003c- 5e-8 # 绘图 ggplot(gwas_plot, aes(x=BP/1000000, y=neglog10p)) + geom_point(aes(color=chr_color), size=0.5, alpha=0.7) + facet_wrap(~CHR, scales=\"free_x\", ncol=4) + scale_color_manual(values=c(\"odd\"=\"steelblue\", \"even\"=\"orange\")) + geom_hline(yintercept=-log10(threshold), linetype=\"dashed\", color=\"red\", size=1) + labs(x=\"Position (Mb)\", y=\"-log10(P)\", title=\"Genome-wide Association Study\", subtitle=paste0(\"Significance threshold: \", threshold)) + theme_bw() + theme( legend.position=\"none\", strip.text = element_text(size=8), axis.text.x = element_text(angle=45, hjust=1) ) QQ图：\n# 使用qqman包 qq(gwas$P, main=\"Q-Q Plot\") # 使用ggplot2 library(ggplot2) # 计算期望p值 expected \u003c- -log10((1:nrow(gwas)) / (nrow(gwas) + 1)) observed \u003c- -log10(sort(gwas$P)) qq_data \u003c- data.frame(Expected=expected, Observed=observed) ggplot(qq_data, aes(x=Expected, y=Observed)) + geom_point(size=0.5, alpha=0.6) + geom_abline(intercept=0, slope=1, linetype=\"dashed\", color=\"red\", size=1) + labs(x=\"Expected -log10(P)\", y=\"Observed -log10(P)\", title=\"Q-Q Plot\") + theme_bw() # 计算膨胀因子 lambda \u003c- median(qchisq(1 - gwas$P, 1)) / qchisq(0.5, 1) cat(paste0(\"Genomic inflation factor (λ): \", round(lambda, 3))) 火山图：\nggplot(gwas, aes(x=BETA, y=-log10(P))) + geom_point(aes(color=-log10(P) \u003e -log10(5e-8)), alpha=0.6, size=0.5) + scale_color_manual(values=c(\"FALSE\"=\"gray\", \"TRUE\"=\"red\")) + geom_hline(yintercept=-log10(5e-8), linetype=\"dashed\") + labs(x=\"Effect Size (BETA)\", y=\"-log10(P)\", title=\"Volcano Plot\") + theme_bw() 区域关联图（Locus Zoom）：\n# 选择显著信号区域 sig_snp \u003c- gwas %\u003e% filter(P \u003c 5e-8) %\u003e% arrange(P) %\u003e% slice(1) # 最显著的SNP chr \u003c- as.character(sig_snp$CHR) center_pos \u003c- sig_snp$BP window \u003c- 500000 # 上下各500kb # 提取区域数据 region_data \u003c- gwas %\u003e% filter(CHR == chr \u0026 BP \u003e= (center_pos - window) \u0026 BP \u003c= (center_pos + window)) # 绘制区域图 ggplot(region_data, aes(x=BP/1000000, y=-log10(P))) + geom_point(color=\"steelblue\", size=1.5) + geom_vline(xintercept=center_pos/1000000, linetype=\"dashed\", color=\"red\") + labs(x=paste0(\"Position on Chr\", chr, \" (Mb)\"), y=\"-log10(P)\", title=paste0(\"Regional Association Plot (\", round(center_pos/1000000, 2), \" Mb)\")) + theme_bw() # 使用LocusZoom在线工具 # https://locuszoom.org/ 6.7 候选基因鉴定 提取显著SNP附近的基因：\n# 提取显著SNP awk 'NR\u003e1 \u0026\u0026 $9 \u003c 5e-8' gwas_result.assoc.txt \u003e significant_snps.txt # 根据基因组注释文件提取附近基因 # 假设有GFF3格式的注释文件 bedtools closest -a significant_snps.bed \\ -b genes.gff3 \\ -d 100000 \\ \u003e candidate_genes.txt 使用BEDTools：\n# 将SNP转换为BED格式 awk 'BEGIN{OFS=\"\\t\"} {print $1, $2-1, $2, $3, $4}' significant_snps.txt \u003e snps.bed # 提取SNP附近的基因（上下各100kb） bedtools window -a snps.bed -b genes.bed -w 100000 \u003e snp_genes.txt 功能富集分析：\n# 使用clusterProfiler进行GO和KEGG富集分析 library(clusterProfiler) library(org.At.tair.db) # 拟南芥注释（大豆需相应数据库） # 读取候选基因列表 genes \u003c- read.table(\"candidate_genes.txt\", header=FALSE)$V1 # GO富集分析 go_enrich \u003c- enrichGO( gene = genes, OrgDb = org.At.tair.db, keyType = \"TAIR\", ont = \"BP\", pAdjustMethod = \"BH\", pvalueCutoff = 0.05, qvalueCutoff = 0.10 ) # 绘图 dotplot(go_enrich, showCategory=20) + ggtitle(\"GO Enrichment\") barplot(go_enrich, showCategory=20) + ggtitle(\"GO Enrichment\") emapplot(go_enrich) + ggtitle(\"GO Enrichment\") # KEGG通路分析 kegg_enrich \u003c- enrichKEGG( gene = genes, organism = 'ath', # 拟南芥 pvalueCutoff = 0.05 ) dotplot(kegg_enrich) + ggtitle(\"KEGG Pathway Analysis\") 七、其他分析 7.1 基因家族分析 目的： 鉴定特定基因家族的成员、进化历史和表达模式\n分析流程：\n# Step 1: 下载目标基因家族的已知蛋白序列 # 从Pfam、InterPro或文献获取 # Step 2: 在大豆基因组中搜索同源基因 # 使用BLASTP或HMMER blastp -query known_family_proteins.fa \\ -db soybean_proteome.fa \\ -evalue 1e-5 \\ -outfmt 6 \\ -out blast_results.txt # 或使用HMMER（更准确） hmmbuild gene_family.hmm known_family_alignment.sto hmmsearch --domtblout hmm_results.txt gene_family.hmm soybean_proteome.fa # Step 3: 提取候选基因序列 samtools faidx soybean_proteome.fa $(awk '{print $1}' blast_results.txt) \u003e candidate_genes.fa # Step 4: 多序列比对 mafft --auto candidate_genes.fa \u003e candidate_genes_aligned.fa # Step 5: 构建系统发育树 iqtree -s candidate_genes_aligned.fa -m MFP -bb 1000 -nt AUTO # Step 6: 计算Ka/Ks比值 # 使用KaKs_Calculator KaKs_Calculator -i coding_sequences.fa -o ka_ks_results.txt # Step 7: 染色体定位 # 使用基因GFF文件提取位置信息 grep -f candidate_genes_list.txt soybean_annotation.gff3 \u003e gene_locations.gff3 可视化基因家族：\nlibrary(ggtree) library(ggplot2) # 读取树文件 tree \u003c- read.tree(\"candidate_genes_aligned.fa.treefile\") # 绘制系统发育树 ggtree(tree) + geom_tiplab(size=2) + geom_tippoint(aes(color=group), size=2) + theme_tree2() + labs(title=\"Gene Family Phylogenetic Tree\") # 添加热图（表达数据） if (file.exists(\"expression_data.txt\")) { expr_data \u003c- read.table(\"expression_data.txt\", header=TRUE, row.names=1) gheatmap(tree, expr_data, offset=0.5, width=0.5, colnames_angle=-45, colnames_offset_y=5) } 7.2 选择压力分析 Ka/Ks比值分析：\n定义：\nKa：非同义替换率 Ks：同义替换率 Ka/Ks：选择压力指标 比值解读：\nKa/Ks 选择类型 说明 Ka/Ks \u003c 1 纯化选择 功能约束，去除有害突变 Ka/Ks = 1 中性进化 无选择压力 Ka/Ks \u003e 1 正选择 适应性进化 使用KaKs_Calculator：\n# 准备输入文件（FASTA格式的编码序列对） # 格式：\u003egene1_seq1 # ATG... # \u003egene1_seq2 # ATG... # 运行KaKs_Calculator KaKs_Calculator -i gene_pairs.fa -o ka_ks_results.txt -m MYN # 参数说明： # -i: 输入文件 # -o: 输出文件 # -m: 方法（MYN, NG, LWL, MLP等） # 输出包含： # - Ka, Ks, Ka/Ks # - 标准误和置信区间 使用PAML (codeml)：\n# 准备必要的文件： # 1. 序列比对文件（PHYLIP格式） # 2. 树文件（Newick格式） # 3. 控制文件（codeml.ctl） # codeml.ctl 示例 seqfile = gene_alignment.phy treefile = gene_tree.nwk outfile = codeml_results.txt runmode = 0 model = 0 NSsites = 0 icode = 0 # 运行codeml codeml codeml.ctl 可视化Ka/Ks分布：\nlibrary(ggplot2) # 读取结果 ka_ks \u003c- read.table(\"ka_ks_results.txt\", header=TRUE) # 绘制Ka/Ks分布直方图 ggplot(ka_ks, aes(x=Ka_Ks)) + geom_histogram(binwidth=0.1, fill=\"steelblue\", color=\"black\") + geom_vline(xintercept=1, linetype=\"dashed\", color=\"red\", size=1) + labs(x=\"Ka/Ks Ratio\", y=\"Count\", title=\"Distribution of Ka/Ks Ratios\") + theme_bw() # Ka vs Ks散点图 ggplot(ka_ks, aes(x=Ks, y=Ka)) + geom_point(alpha=0.6) + geom_abline(intercept=0, slope=1, linetype=\"dashed\", color=\"red\", size=1) + labs(x=\"Ks (synonymous)\", y=\"Ka (nonsynonymous)\", title=\"Ka vs Ks Plot\") + theme_bw() 7.3 单倍型分析 目的： 分析基因区域的单倍型组成和频率分布\n使用Haploview：\n# 导入数据 # File \u003e Import Data \u003e PLINK format # 自动定义单倍型块 # Blocks \u003e Define Blocks # 输出LD图和单倍型频率 # File \u003e Export Plots 使用PLINK：\n# 计算单倍型频率 plink --bfile gwas_cleaned \\ --blocks no-pheno-req \\ --hap-freq \\ --out haplotype_freq # 参数说明： # --blocks: 定义单倍型块 # --hap-freq: 输出单倍型频率 # 输出文件： # - haplotype_freq.frq: 单倍型频率 # - haplotype_freq.blocks: 单倍型块定义 使用VCFtools：\n# 提取特定区域 vcftools --vcf cohort.vcf.gz \\ --chr 1 \\ --from-bp 1000000 \\ --to-bp 2000000 \\ --recode \\ --out region # 使用Haploview或其他软件分析单倍型 7.4 受选择基因功能富集 目的： 确定受选择基因显著富集的功能类别\n分析流程：\n# 提取受选择区域的基因 selected_genes \u003c- read.table(\"selected_genes.txt\", header=FALSE)$V1 # GO富集分析 library(clusterProfiler) library(org.At.tair.db) go_bp \u003c- enrichGO( gene = selected_genes, OrgDb = org.At.tair.db, keyType = \"TAIR\", ont = \"BP\", pAdjustMethod = \"BH\", pvalueCutoff = 0.01, qvalueCutoff = 0.05 ) # 可视化 dotplot(go_bp, showCategory=25) + ggtitle(\"GO Biological Process Enrichment\") cnetplot(go_bp, showCategory=15) + ggtitle(\"Gene Concept Network\") goplot(go_bp) + ggtitle(\"GO Relationship\") # KEGG富集 kegg \u003c- enrichKEGG( gene = selected_genes, organism = 'atha', pvalueCutoff = 0.05 ) dotplot(kegg, showCategory=20) + ggtitle(\"KEGG Pathway Enrichment\") # 比较不同群体受选择基因 # 群体1受选择基因 genes_pop1 \u003c- read.table(\"selected_genes_pop1.txt\")$V1 # 群体2受选择基因 genes_pop2 \u003c- read.table(\"selected_genes_pop2.txt\")$V1 go_pop1 \u003c- enrichGO(gene = genes_pop1, OrgDb = org.At.tair.db, ont = \"BP\", pAdjustMethod = \"BH\") go_pop2 \u003c- enrichGO(gene = genes_pop2, OrgDb = org.At.tair.db, ont = \"BP\", pAdjustMethod = \"BH\") # 比较富集结果 compare \u003c- compareCluster(gene = list(Population1 = genes_pop1, Population2 = genes_pop2), fun = \"enrichGO\", OrgDb = org.At.tair.db, ont = \"BP\") dotplot(compare, showCategory=20) + ggtitle(\"GO Enrichment Comparison between Populations\") 总结 本流程文档详细描述了8000份大豆重测序数据的完整分析pipeline，涵盖了从原始数据到最终发表图表的所有关键步骤：\n核心流程 数据质控：FastQC和fastp确保数据质量 序列比对：BWA-MEM高效比对到参考基因组 变异检测：GATK Best Practices流程检测SNP和InDel 变异注释：ANNOVAR进行功能注释和效应预测 高级分析 群体遗传学分析 PCA：评估群体结构 系统发育树：重建进化历史 ADMIXTURE：分析祖先组成 选择信号分析 核苷酸多样性(π)：遗传多样性评估 FST：群体分化分析 XP-CLR/XPEHH：选择信号扫描 Tajima’s D：中性检验 全基因组关联分析(GWAS) 线性混合模型 多重检验校正 候选基因鉴定 功能富集分析 数据可视化 曼哈顿图和QQ图（GWAS结果） LD衰减曲线 PCA图和系统发育树 ADMIXTURE条形图 FST和π分布图 选择信号扫描图 所有分析方法均提供了详细的命令行示例、参数说明和R语言可视化代码，可直接应用于实际数据分析。该流程适用于大豆及其他作物的重测序数据分析，为遗传学研究和分子育种提供了完整的技术方案。\n",
  "wordCount" : "10442",
  "inLanguage": "en",
  "datePublished": "2026-02-05T14:53:16+08:00",
  "dateModified": "2026-02-05T14:53:16+08:00",
  "author":{
    "@type": "Person",
    "name": "tdx"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://Tdxxxx-student.github.io/posts/8000%E5%A4%A7%E8%B1%86%E9%87%8D%E6%B5%8B%E5%BA%8F%E6%96%87%E7%AB%A0%E5%A4%8D%E7%8E%B0/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "我的空间",
    "logo": {
      "@type": "ImageObject",
      "url": "https://Tdxxxx-student.github.io/favicon.ico"
    }
  }
}
</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://Tdxxxx-student.github.io/" accesskey="h" title="我的空间 (Alt + H)">我的空间</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://Tdxxxx-student.github.io/posts/" title="首页">
                    <span>首页</span>
                </a>
            </li>
            <li>
                <a href="https://Tdxxxx-student.github.io/archives/" title="归档">
                    <span>归档</span>
                </a>
            </li>
            <li>
                <a href="https://Tdxxxx-student.github.io/categories/" title="分类">
                    <span>分类</span>
                </a>
            </li>
            <li>
                <a href="https://Tdxxxx-student.github.io/tags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="https://Tdxxxx-student.github.io/search/" title="🔍  (Alt &#43; /)" accesskey=/>
                    <span>🔍 </span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<div class="main-container">
  
  
  <div class="top-banner-decoration"></div>

  
  <div class="page-layout">
    
    
    <article class="post-card">
      
      
      <header class="post-header"><div class="breadcrumbs"><a href="https://Tdxxxx-student.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://Tdxxxx-student.github.io/posts/">Posts</a></div>
        <h1 class="post-title">
          8000大豆重测序文章复现
        </h1>
        <div class="post-description">借鉴别人的文章复现结果</div>
        <div class="post-meta"><span title='2026-02-05 14:53:16 +0800 CST'>2026-02-05</span>&nbsp;·&nbsp;<span>21 min</span>&nbsp;·&nbsp;<span>tdx</span></div>
      </header>

      
      <div class="post-content"><h1 id="8000份大豆重测序数据分析流程">8000份大豆重测序数据分析流程<a hidden class="anchor" aria-hidden="true" href="#8000份大豆重测序数据分析流程">#</a></h1>
<h2 id="目录">目录<a hidden class="anchor" aria-hidden="true" href="#目录">#</a></h2>
<ul>
<li><a href="#%E5%88%86%E6%9E%90%E6%B5%81%E7%A8%8B%E6%80%BB%E8%A7%88">分析流程总览</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%85%B7%E4%BD%93%E6%B5%81%E7%A8%8B">数据分析具体流程</a>
<ul>
<li><a href="#%E4%B8%80%E6%95%B0%E6%8D%AE%E8%B4%A8%E6%8E%A7">一、数据质控</a></li>
<li><a href="#%E4%BA%8C%E5%BA%8F%E5%88%97%E6%AF%94%E5%AF%B9">二、序列比对</a></li>
<li><a href="#%E4%B8%89%E5%8F%98%E5%BC%82%E6%A3%80%E6%B5%8B">三、变异检测</a></li>
<li><a href="#%E5%9B%9B%E5%8F%98%E5%BC%82%E6%B3%A8%E9%87%8A">四、变异注释</a></li>
</ul>
</li>
<li><a href="#%E5%9B%BE%E8%A1%A8%E5%88%B6%E4%BD%9C">图表制作</a>
<ul>
<li><a href="#%E4%B8%80%E7%BE%A4%E4%BD%93%E9%81%97%E4%BC%A0%E5%AD%A6%E5%88%86%E6%9E%90">一、群体遗传学分析</a></li>
<li><a href="#%E4%BA%8C%E8%BF%9E%E9%94%81%E4%B8%8D%E5%B9%B3%E8%A1%A1%E5%88%86%E6%9E%90">二、连锁不平衡分析</a></li>
<li><a href="#%E4%B8%89%E6%A0%B8%E8%8B%B7%E9%85%B8%E5%A4%9A%E6%A0%B7%E6%80%A7%E5%88%86%E6%9E%90">三、核苷酸多样性分析</a></li>
<li><a href="#%E5%9B%9B%E5%9B%BA%E5%AE%9A%E6%8C%87%E6%95%B0-fst">四、固定指数 (FST)</a></li>
<li><a href="#%E4%BA%94%E9%80%89%E6%8B%A9%E6%B8%85%E9%99%A4%E5%88%86%E6%9E%90">五、选择清除分析</a></li>
<li><a href="#%E5%85%AD%E5%85%A8%E5%9F%BA%E5%9B%A0%E7%BB%84%E5%85%B3%E8%81%94%E5%88%86%E6%9E%90-gwas">六、全基因组关联分析 (GWAS)</a></li>
<li><a href="#%E4%B8%83%E5%85%B6%E4%BB%96%E5%88%86%E6%9E%90">七、其他分析</a></li>
</ul>
</li>
<li><a href="#%E6%80%BB%E7%BB%93">总结</a></li>
</ul>
<hr>
<h2 id="分析流程总览">分析流程总览<a hidden class="anchor" aria-hidden="true" href="#分析流程总览">#</a></h2>
<h3 id="整体流程架构">整体流程架构<a hidden class="anchor" aria-hidden="true" href="#整体流程架构">#</a></h3>
<pre tabindex="0"><code>原始数据 (Raw Data)
    ↓
数据质控 (Quality Control)
    ↓
比对到参考基因组 (Alignment)
    ↓
变异检测 (Variant Detection)
    ↓
变异注释 (Variant Annotation)
    ↓
进化和群体遗传学分析 (Evolutionary and Population Genetics Analysis)
</code></pre><hr>
<h2 id="数据分析具体流程">数据分析具体流程<a hidden class="anchor" aria-hidden="true" href="#数据分析具体流程">#</a></h2>
<h3 id="一数据质控">一、数据质控<a hidden class="anchor" aria-hidden="true" href="#一数据质控">#</a></h3>
<h4 id="1-fastqc---质量评估">1. FastQC - 质量评估<a hidden class="anchor" aria-hidden="true" href="#1-fastqc---质量评估">#</a></h4>
<p><strong>软件功能：</strong> 对测序数据进行质量评估</p>
<p><strong>基本用法：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>fastqc -t <span style="color:#ae81ff">8</span> -o /path/to/output /path/to/seq_data/*.fastq
</span></span></code></pre></div><p><strong>参数说明：</strong></p>
<table>
  <thead>
      <tr>
          <th>参数</th>
          <th>说明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>-t 8</code></td>
          <td>使用8个线程</td>
      </tr>
      <tr>
          <td><code>-o</code></td>
          <td>指定输出目录</td>
      </tr>
  </tbody>
</table>
<p><strong>输入文件：</strong> fastq格式的测序数据</p>
<p><strong>输出结果：</strong></p>
<ul>
<li>HTML格式的质量报告文件</li>
<li>包含测序质量分布、GC含量、序列长度分布、接头含量等信息</li>
</ul>
<h4 id="2-fastp---质控与过滤">2. fastp - 质控与过滤<a hidden class="anchor" aria-hidden="true" href="#2-fastp---质控与过滤">#</a></h4>
<p><strong>软件功能：</strong></p>
<ul>
<li>质量剪切（quality trimming）</li>
<li>过滤低质量reads</li>
<li>去接头</li>
<li>UMI（Unique Molecular Identifier）处理</li>
<li>过滤polyG（Illumina NovaSeq特征）</li>
<li>生成HTML和JSON格式的质控报告</li>
</ul>
<p><strong>基本用法：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>fastp -i sample_R1.fq.gz -I sample_R2.fq.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      -o clean_R1.fq.gz -O clean_R2.fq.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      -w <span style="color:#ae81ff">8</span>
</span></span></code></pre></div><p><strong>常用参数详解：</strong></p>
<table>
  <thead>
      <tr>
          <th>参数</th>
          <th>说明</th>
          <th>默认值</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>-i</code></td>
          <td>输入的R1（前向）reads文件</td>
          <td>-</td>
      </tr>
      <tr>
          <td><code>-I</code></td>
          <td>输入的R2（反向）reads文件</td>
          <td>-</td>
      </tr>
      <tr>
          <td><code>-o</code></td>
          <td>输出的清洁R1 reads文件</td>
          <td>-</td>
      </tr>
      <tr>
          <td><code>-O</code></td>
          <td>输出的清洁R2 reads文件</td>
          <td>-</td>
      </tr>
      <tr>
          <td><code>-w</code></td>
          <td>线程数</td>
          <td>2</td>
      </tr>
      <tr>
          <td><code>-q</code></td>
          <td>质量值阈值，低于此值的碱基将被剪切</td>
          <td>15</td>
      </tr>
      <tr>
          <td><code>-u</code></td>
          <td>低质量reads百分比阈值，超过此比例的reads将被过滤</td>
          <td>30</td>
      </tr>
      <tr>
          <td><code>-n</code></td>
          <td>reads长度阈值，短于此长度的reads将被过滤</td>
          <td>0</td>
      </tr>
      <tr>
          <td><code>-l</code></td>
          <td>保留的最小reads长度</td>
          <td>15</td>
      </tr>
      <tr>
          <td><code>--detect_adapter_for_pe</code></td>
          <td>自动检测接头（推荐）</td>
          <td>-</td>
      </tr>
      <tr>
          <td><code>--trim_poly_g</code></td>
          <td>去除polyG尾（NovaSeq数据必需）</td>
          <td>-</td>
      </tr>
      <tr>
          <td><code>--poly_g_min_len</code></td>
          <td>触发polyG剪切的最小长度</td>
          <td>10</td>
      </tr>
      <tr>
          <td><code>--cut_front</code></td>
          <td>从前端剪切指定数量的碱基</td>
          <td>-</td>
      </tr>
      <tr>
          <td><code>--cut_tail</code></td>
          <td>从尾端剪切指定数量的碱基</td>
          <td>-</td>
      </tr>
      <tr>
          <td><code>--cut_mean_quality</code></td>
          <td>按平均质量值剪切</td>
          <td>-</td>
      </tr>
      <tr>
          <td><code>--length_required</code></td>
          <td>reads最小长度要求</td>
          <td>15</td>
      </tr>
      <tr>
          <td><code>--json</code></td>
          <td>输出JSON格式质控报告</td>
          <td>fastp.json</td>
      </tr>
      <tr>
          <td><code>--html</code></td>
          <td>输出HTML格式质控报告</td>
          <td>fastp.html</td>
      </tr>
      <tr>
          <td><code>--report_title</code></td>
          <td>报告标题</td>
          <td>fastp report</td>
      </tr>
  </tbody>
</table>
<hr>
<h3 id="二序列比对">二、序列比对<a hidden class="anchor" aria-hidden="true" href="#二序列比对">#</a></h3>
<h4 id="bwa-mem-比对">BWA-MEM 比对<a hidden class="anchor" aria-hidden="true" href="#bwa-mem-比对">#</a></h4>
<p><strong>软件功能：</strong> 将清洁后的reads比对到参考基因组</p>
<h5 id="21-建立参考基因组索引">2.1 建立参考基因组索引<a hidden class="anchor" aria-hidden="true" href="#21-建立参考基因组索引">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bwa index reference.fasta
</span></span></code></pre></div><blockquote>
<p>此步骤会生成多个索引文件（.amb, .ann, .bwt, .pac, .sa）</p>
</blockquote>
<h5 id="22-序列比对">2.2 序列比对<a hidden class="anchor" aria-hidden="true" href="#22-序列比对">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bwa mem -t <span style="color:#ae81ff">8</span> -M reference.fasta <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    clean_R1.fq.gz clean_R2.fq.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    &gt; sample.sam
</span></span></code></pre></div><p><strong>参数说明：</strong></p>
<ul>
<li><code>-t 8</code>：使用8个线程进行比对，提高速度</li>
<li><code>-M</code>：将shorter split hits标记为次优，以便兼容Picard工具</li>
<li><code>reference.fasta</code>：参考基因组序列文件</li>
</ul>
<p><strong>输入：</strong> 清洁后的R1和R2 reads（gzip压缩格式）</p>
<p><strong>输出：</strong> SAM格式比对结果</p>
<h5 id="23-sam转bam并排序">2.3 SAM转BAM并排序<a hidden class="anchor" aria-hidden="true" href="#23-sam转bam并排序">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># SAM转BAM（压缩格式）</span>
</span></span><span style="display:flex;"><span>samtools view -Sb sample.sam &gt; sample.bam
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 对BAM文件进行排序</span>
</span></span><span style="display:flex;"><span>samtools sort sample.bam -o sample.sorted.bam
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 建立索引，便于后续快速访问</span>
</span></span><span style="display:flex;"><span>samtools index sample.sorted.bam
</span></span></code></pre></div><h5 id="24-标记pcr重复">2.4 标记PCR重复<a hidden class="anchor" aria-hidden="true" href="#24-标记pcr重复">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 使用Picard标记重复</span>
</span></span><span style="display:flex;"><span>picard MarkDuplicates <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    I<span style="color:#f92672">=</span>sample.sorted.bam <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    O<span style="color:#f92672">=</span>sample.dedup.bam <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    M<span style="color:#f92672">=</span>metrics.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 建立索引</span>
</span></span><span style="display:flex;"><span>samtools index sample.dedup.bam
</span></span></code></pre></div><p><strong>参数说明：</strong></p>
<ul>
<li><code>I=</code>：输入文件</li>
<li><code>O=</code>：输出文件</li>
<li><code>M=</code>：输出重复统计信息</li>
</ul>
<h5 id="25-添加read-groups信息可选但推荐">2.5 添加Read Groups信息（可选但推荐）<a hidden class="anchor" aria-hidden="true" href="#25-添加read-groups信息可选但推荐">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gatk AddOrReplaceReadGroups <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -I sample.dedup.bam <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -O sample.rg.bam <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -RGID id1 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -RGLB lib1 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -RGPL illumina <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -RGPU unit1 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -RGSM sample1
</span></span></code></pre></div><p><strong>参数说明：</strong></p>
<ul>
<li><code>-RGID</code>：Read Group ID</li>
<li><code>-RGLB</code>：Library名称</li>
<li><code>-RGPL</code>：测序平台（illumina, iontorrent等）</li>
<li><code>-RGPU</code>：测序单元</li>
<li><code>-RGSM</code>：样本名称</li>
</ul>
<hr>
<h3 id="三变异检测">三、变异检测<a hidden class="anchor" aria-hidden="true" href="#三变异检测">#</a></h3>
<h4 id="gatk-best-practices-流程">GATK Best Practices 流程<a hidden class="anchor" aria-hidden="true" href="#gatk-best-practices-流程">#</a></h4>
<p>GATK（Genome Analysis Toolkit）是目前最广泛使用的变异检测软件之一。</p>
<h5 id="31-haplotypecaller---单样本变异检测">3.1 HaplotypeCaller - 单样本变异检测<a hidden class="anchor" aria-hidden="true" href="#31-haplotypecaller---单样本变异检测">#</a></h5>
<p><strong>基本用法（GVCF模式）：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gatk HaplotypeCaller <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -R reference.fasta <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -I sample.dedup.bam <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -O sample.g.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -ERC GVCF
</span></span></code></pre></div><p><strong>参数说明：</strong></p>
<ul>
<li><code>-R</code>：参考基因组fasta文件</li>
<li><code>-I</code>：输入的BAM文件</li>
<li><code>-O</code>：输出的gVCF文件（gzip压缩）</li>
<li><code>-ERC GVCF</code>：产生GVCF格式，用于后续联合分析</li>
</ul>
<blockquote>
<p>GVCF模式会记录所有位点的信息，包括变异位点和非变异位点，便于后续多样本联合分析。</p>
</blockquote>
<h5 id="32-combinegvcfs---合并多个gvcf">3.2 CombineGVCFs - 合并多个gVCF<a hidden class="anchor" aria-hidden="true" href="#32-combinegvcfs---合并多个gvcf">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gatk CombineGVCFs <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -R reference.fasta <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    --variant sample1.g.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    --variant sample2.g.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    --variant sample3.g.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    ... <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -O cohort.g.vcf.gz
</span></span></code></pre></div><p><strong>批处理示例：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 创建variant列表文件</span>
</span></span><span style="display:flex;"><span>ls *.g.vcf.gz &gt; variant_list.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 合并</span>
</span></span><span style="display:flex;"><span>gatk CombineGVCFs <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -R reference.fasta <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    --variant sample1.g.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    --variant sample2.g.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -O cohort.g.vcf.gz
</span></span></code></pre></div><h5 id="33-genotypegvcfs---联合基因分型">3.3 GenotypeGVCFs - 联合基因分型<a hidden class="anchor" aria-hidden="true" href="#33-genotypegvcfs---联合基因分型">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gatk GenotypeGVCFs <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -R reference.fasta <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -V cohort.g.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -O cohort.vcf.gz
</span></span></code></pre></div><h5 id="34-variantfiltration---变异过滤">3.4 VariantFiltration - 变异过滤<a hidden class="anchor" aria-hidden="true" href="#34-variantfiltration---变异过滤">#</a></h5>
<p><strong>SNP过滤标准：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gatk VariantFiltration <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -R reference.fasta <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -V cohort.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -O cohort.filtered.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    --filter-name <span style="color:#e6db74">&#34;QD_filter&#34;</span> --filter-expression <span style="color:#e6db74">&#34;QD &lt; 2.0&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    --filter-name <span style="color:#e6db74">&#34;FS_filter&#34;</span> --filter-expression <span style="color:#e6db74">&#34;FS &gt; 60.0&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    --filter-name <span style="color:#e6db74">&#34;MQ_filter&#34;</span> --filter-expression <span style="color:#e6db74">&#34;MQ &lt; 40.0&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    --filter-name <span style="color:#e6db74">&#34;MQRankSum_filter&#34;</span> --filter-expression <span style="color:#e6db74">&#34;MQRankSum &lt; -12.5&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    --filter-name <span style="color:#e6db74">&#34;ReadPosRankSum_filter&#34;</span> --filter-expression <span style="color:#e6db74">&#34;ReadPosRankSum &lt; -8.0&#34;</span>
</span></span></code></pre></div><p><strong>InDel过滤标准：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gatk VariantFiltration <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -R reference.fasta <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -V cohort.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -O cohort.indel.filtered.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    --filter-name <span style="color:#e6db74">&#34;QD_filter&#34;</span> --filter-expression <span style="color:#e6db74">&#34;QD &lt; 2.0&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    --filter-name <span style="color:#e6db74">&#34;FS_filter&#34;</span> --filter-expression <span style="color:#e6db74">&#34;FS &gt; 200.0&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    --filter-name <span style="color:#e6db74">&#34;ReadPosRankSum_filter&#34;</span> --filter-expression <span style="color:#e6db74">&#34;ReadPosRankSum &lt; -20.0&#34;</span>
</span></span></code></pre></div><p><strong>过滤指标说明：</strong></p>
<table>
  <thead>
      <tr>
          <th>指标</th>
          <th>全称</th>
          <th>说明</th>
          <th>SNP阈值</th>
          <th>InDel阈值</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>QD</td>
          <td>QualByDepth</td>
          <td>每深度质量分数</td>
          <td>&lt; 2.0</td>
          <td>&lt; 2.0</td>
      </tr>
      <tr>
          <td>FS</td>
          <td>FisherStrand</td>
          <td>链偏向性</td>
          <td>&gt; 60.0</td>
          <td>&gt; 200.0</td>
      </tr>
      <tr>
          <td>MQ</td>
          <td>RMSMappingQuality</td>
          <td>根均方映射质量</td>
          <td>&lt; 40.0</td>
          <td>-</td>
      </tr>
      <tr>
          <td>MQRankSum</td>
          <td>MappingQualityRankSumTest</td>
          <td>映射质量秩和检验</td>
          <td>&lt; -12.5</td>
          <td>-</td>
      </tr>
      <tr>
          <td>ReadPosRankSum</td>
          <td>ReadPositionRankSumTest</td>
          <td>Read位置秩和检验</td>
          <td>&lt; -8.0</td>
          <td>&lt; -20.0</td>
      </tr>
      <tr>
          <td>SOR</td>
          <td>StrandOddsRatio</td>
          <td>链比值</td>
          <td>&gt; 3.0</td>
          <td>&gt; 10.0</td>
      </tr>
  </tbody>
</table>
<h5 id="35-selectvariants---提取高质量变异">3.5 SelectVariants - 提取高质量变异<a hidden class="anchor" aria-hidden="true" href="#35-selectvariants---提取高质量变异">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gatk SelectVariants <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -R reference.fasta <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -V cohort.filtered.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    --exclude-filtered <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -O cohort.high_quality.vcf.gz
</span></span></code></pre></div><h5 id="36-分别提取snp和indel">3.6 分别提取SNP和InDel<a hidden class="anchor" aria-hidden="true" href="#36-分别提取snp和indel">#</a></h5>
<p><strong>提取SNP：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gatk SelectVariants <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -V cohort.high_quality.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -select-type SNP <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -O cohort.snp.vcf.gz
</span></span></code></pre></div><p><strong>提取InDel：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gatk SelectVariants <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -V cohort.high_quality.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -select-type INDEL <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -O cohort.indel.vcf.gz
</span></span></code></pre></div><hr>
<h3 id="四变异注释">四、变异注释<a hidden class="anchor" aria-hidden="true" href="#四变异注释">#</a></h3>
<h4 id="annovar-注释流程">ANNOVAR 注释流程<a hidden class="anchor" aria-hidden="true" href="#annovar-注释流程">#</a></h4>
<p><strong>软件功能：</strong> 对检测到的变异进行功能注释，预测变异对基因功能的影响</p>
<h5 id="41-准备工作">4.1 准备工作<a hidden class="anchor" aria-hidden="true" href="#41-准备工作">#</a></h5>
<p><strong>下载注释数据库：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 建立数据库目录</span>
</span></span><span style="display:flex;"><span>mkdir humandb/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 下载RefSeq基因数据库</span>
</span></span><span style="display:flex;"><span>annotate_variation.pl -buildver dm6 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -downdb -webfrom annovar <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    refGene humandb/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 下载dbNSFP数据库（包含多个功能预测工具的结果）</span>
</span></span><span style="display:flex;"><span>annotate_variation.pl -buildver dm6 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -downdb -webfrom annovar <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    dbnsfp42a humandb/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 其他常用数据库</span>
</span></span><span style="display:flex;"><span>annotate_variation.pl -buildver dm6 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -downdb -webfrom annovar <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    gnomad_genome humandb/
</span></span></code></pre></div><h5 id="42-转换vcf格式为annovar输入格式">4.2 转换VCF格式为ANNOVAR输入格式<a hidden class="anchor" aria-hidden="true" href="#42-转换vcf格式为annovar输入格式">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># SNP转换</span>
</span></span><span style="display:flex;"><span>convert2annovar.pl -format v4 cohort.snp.vcf.gz &gt; cohort.snp.avinput
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># InDel转换</span>
</span></span><span style="display:flex;"><span>convert2annovar.pl -format v4 cohort.indel.vcf.gz &gt; cohort.indel.avinput
</span></span></code></pre></div><h5 id="43-执行注释">4.3 执行注释<a hidden class="anchor" aria-hidden="true" href="#43-执行注释">#</a></h5>
<p><strong>SNP注释：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>table_annovar.pl cohort.snp.avinput humandb/ <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -buildver dm6 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -out cohort.snp_annotated <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -remove <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -protocol refGene,dbnsfp42a,gnomad_genome <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -operation g,f,f <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -nastring . <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -vcfinput
</span></span></code></pre></div><p><strong>InDel注释：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>table_annovar.pl cohort.indel.avinput humandb/ <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -buildver dm6 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -out cohort.indel_annotated <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -remove <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -protocol refGene <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -operation g <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -nastring . <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>    -vcfinput
</span></span></code></pre></div><p><strong>参数说明：</strong></p>
<ul>
<li><code>-buildver</code>：基因组版本（如dm6, hg38等）</li>
<li><code>-protocol</code>：指定要使用的注释数据库</li>
<li><code>-operation</code>：
<ul>
<li><code>g</code>：基于基因的注释</li>
<li><code>f</code>：基于过滤的注释</li>
</ul>
</li>
<li><code>-nastring</code>：缺失值的表示字符串</li>
<li><code>-vcfinput</code>：输入为VCF格式</li>
</ul>
<p><strong>注释结果解读：</strong></p>
<ul>
<li><code>exonic</code>：外显子区的变异</li>
<li><code>splicing</code>：剪接位点附近的变异（±2bp）</li>
<li><code>intronic</code>：内含子区的变异</li>
<li><code>upstream/downstream</code>：基因上游/下游区域</li>
<li><code>intergenic</code>：基因间区</li>
<li><code>UTR5/UTR3</code>：5&rsquo;/3&rsquo;非翻译区</li>
</ul>
<p><strong>功能影响预测：</strong></p>
<ul>
<li><code>synonymous SNV</code>：同义突变（不改变氨基酸）</li>
<li><code>nonsynonymous SNV</code>：非同义突变</li>
<li><code>missense</code>：错义突变</li>
<li><code>nonsense</code>：无义突变（产生终止密码子）</li>
<li><code>frameshift</code>：移码突变</li>
</ul>
<hr>
<h2 id="图表制作">图表制作<a hidden class="anchor" aria-hidden="true" href="#图表制作">#</a></h2>
<h3 id="一群体遗传学分析">一、群体遗传学分析<a hidden class="anchor" aria-hidden="true" href="#一群体遗传学分析">#</a></h3>
<h4 id="11-pca分析主成分分析">1.1 PCA分析（主成分分析）<a hidden class="anchor" aria-hidden="true" href="#11-pca分析主成分分析">#</a></h4>
<p><strong>分析目的：</strong></p>
<ul>
<li>评估群体结构</li>
<li>识别样本聚类模式</li>
<li>检测离群样本</li>
<li>揭示样本间的遗传关系</li>
</ul>
<p><strong>常用软件：</strong></p>
<ul>
<li>PLINK：命令行工具，快速高效</li>
<li>GCTA：支持混合线性模型</li>
<li>SNPRelate（R包）：灵活，便于可视化</li>
</ul>
<p><strong>PLINK进行PCA分析：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Step 1: 将VCF转换为PLINK格式</span>
</span></span><span style="display:flex;"><span>plink --vcf cohort.vcf.gz --make-bed --out population
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Step 2: 数据过滤（可选）</span>
</span></span><span style="display:flex;"><span>plink --bfile population <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --maf 0.05 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --geno 0.1 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --hwe 1e-6 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --make-bed <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --out population_filtered
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Step 3: 进行PCA分析</span>
</span></span><span style="display:flex;"><span>plink --bfile population_filtered <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --pca <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --out pca_result
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 输出文件：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - pca_result.eigenval：特征值（解释方差比例）</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - pca_result.eigenvec：特征向量（样本的PC坐标）</span>
</span></span></code></pre></div><p><strong>R语言可视化：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># 读取PCA结果</span>
</span></span><span style="display:flex;"><span>pca_data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.table</span>(<span style="color:#e6db74">&#34;pca_result.eigenvec&#34;</span>, header<span style="color:#f92672">=</span><span style="color:#66d9ef">FALSE</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">colnames</span>(pca_data) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;FID&#34;</span>, <span style="color:#e6db74">&#34;IID&#34;</span>, <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;PC&#34;</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">20</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 读取群体信息（如果有的话）</span>
</span></span><span style="display:flex;"><span>group_info <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.table</span>(<span style="color:#e6db74">&#34;group_info.txt&#34;</span>, header<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>)
</span></span><span style="display:flex;"><span>pca_data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">merge</span>(pca_data, group_info, by<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;IID&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 绘制PC1 vs PC2</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(ggplot2)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ggplot</span>(pca_data, <span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>PC1, y<span style="color:#f92672">=</span>PC2, color<span style="color:#f92672">=</span>Group)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_point</span>(size<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.7</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">theme_bw</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labs</span>(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;PC1&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;PC2&#34;</span>,
</span></span><span style="display:flex;"><span>         title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;PCA Analysis&#34;</span>,
</span></span><span style="display:flex;"><span>         subtitle<span style="color:#f92672">=</span><span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;PC1: &#34;</span>,
</span></span><span style="display:flex;"><span>         <span style="color:#a6e22e">round</span>(<span style="color:#a6e22e">summary</span>(<span style="color:#a6e22e">prcomp</span>(pca_data[,<span style="color:#ae81ff">3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">22</span>]))<span style="color:#f92672">$</span>importance[2,<span style="color:#ae81ff">1</span>]<span style="color:#f92672">*</span><span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">2</span>),
</span></span><span style="display:flex;"><span>         <span style="color:#e6db74">&#34;% variance&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 绘制PC1 vs PC3</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ggplot</span>(pca_data, <span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>PC1, y<span style="color:#f92672">=</span>PC3, color<span style="color:#f92672">=</span>Group)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_point</span>(size<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.7</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">theme_bw</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labs</span>(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;PC1&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;PC3&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 绘制碎石图（Scree plot）</span>
</span></span><span style="display:flex;"><span>eigenvals <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.table</span>(<span style="color:#e6db74">&#34;pca_result.eigenval&#34;</span>)
</span></span><span style="display:flex;"><span>var_explained <span style="color:#f92672">&lt;-</span> eigenvals<span style="color:#f92672">$</span>V1 <span style="color:#f92672">/</span> <span style="color:#a6e22e">sum</span>(eigenvals<span style="color:#f92672">$</span>V1) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">plot</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">20</span>, var_explained[1<span style="color:#f92672">:</span><span style="color:#ae81ff">20</span>], type<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;b&#34;</span>,
</span></span><span style="display:flex;"><span>     xlab<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Principal Component&#34;</span>,
</span></span><span style="display:flex;"><span>     ylab<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Variance Explained (%)&#34;</span>,
</span></span><span style="display:flex;"><span>     main<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Scree Plot&#34;</span>)
</span></span></code></pre></div><h4 id="12-系统发育树构建">1.2 系统发育树构建<a hidden class="anchor" aria-hidden="true" href="#12-系统发育树构建">#</a></h4>
<p><strong>分析目的：</strong></p>
<ul>
<li>展示样本间的进化关系</li>
<li>识别单系群</li>
<li>推断群体历史</li>
</ul>
<p><strong>常用方法：</strong></p>
<table>
  <thead>
      <tr>
          <th>方法</th>
          <th>特点</th>
          <th>适用场景</th>
          <th>软件</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>邻接法(NJ)</td>
          <td>速度快，适用于大数据</td>
          <td>初步分析</td>
          <td>MEGA, PHYLIP</td>
      </tr>
      <tr>
          <td>最大似然法(ML)</td>
          <td>准确性高，计算量大</td>
          <td>精确分析</td>
          <td>RAxML, IQ-TREE</td>
      </tr>
      <tr>
          <td>贝叶斯法</td>
          <td>最准确，计算量极大</td>
          <td>小数据集精细分析</td>
          <td>MrBayes</td>
      </tr>
  </tbody>
</table>
<p><strong>完整流程：</strong></p>
<p><strong>Step 1: 提取变异位点并格式转换</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 使用vcf2phylip（推荐）</span>
</span></span><span style="display:flex;"><span>vcf2phylip.py --input cohort.vcf.gz --output phylip_file
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 或使用seqtk</span>
</span></span><span style="display:flex;"><span>seqtk subseq reference.fasta region_list.txt &gt; alignment.fasta
</span></span></code></pre></div><p><strong>Step 2: 构建系统发育树（IQ-TREE）</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 基本分析</span>
</span></span><span style="display:flex;"><span>iqtree -s phylip_file -m GTR+G -bb <span style="color:#ae81ff">1000</span> -nt AUTO
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 参数说明：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -s: 输入文件（PHYLIP或FASTA格式）</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -m: 替代模型（GTR+G常用，或使用MFP让软件自动选择）</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -bb: 自举重复次数（1000为标准）</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -nt: 线程数（AUTO自动检测）</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 输出文件：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - *.treefile: 最佳系统发育树（Newick格式）</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - *.log: 运行日志</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - *.iqtree: 详细结果</span>
</span></span></code></pre></div><p><strong>Step 3: 使用RAxML（替代方案）</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>raxmlHPC -s phylip_file <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         -n output <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         -m GTRGAMMA <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         -p <span style="color:#ae81ff">12345</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         -# <span style="color:#ae81ff">100</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         -f a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 参数说明：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -s: 输入文件</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -n: 输出文件后缀</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -m: 替代模型</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -p: 随机种子</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -#: 自举重复次数</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -f a: 快速自举分析和搜索最佳树</span>
</span></span></code></pre></div><p><strong>Step 4: 可视化</strong></p>
<p><strong>在线工具：</strong></p>
<ul>
<li>iTOL (<a href="https://itol.embl.de/">https://itol.embl.de/</a>)：功能强大，可高度定制</li>
<li>Evolview (<a href="https://evolgenius.info/evolview/">https://evolgenius.info/evolview/</a>)：界面友好</li>
</ul>
<p><strong>R语言ggtree示例：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(ggtree)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(treeio)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 读取树文件</span>
</span></span><span style="display:flex;"><span>tree <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.tree</span>(<span style="color:#e6db74">&#34;output.treefile&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 基本绘图</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ggtree</span>(tree) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_tiplab</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_tippoint</span>(<span style="color:#a6e22e">aes</span>(color<span style="color:#f92672">=</span>group), size<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">theme_tree2</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 添加进化距离标尺</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ggtree</span>(tree) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_treescale</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_tiplab</span>(size<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_nodepoint</span>(<span style="color:#a6e22e">aes</span>(label<span style="color:#f92672">=</span>label), color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;red&#34;</span>, size<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 添加自展值</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ggtree</span>(tree) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_nodelab</span>(<span style="color:#a6e22e">aes</span>(label<span style="color:#f92672">=</span>bootstrap), size<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;blue&#34;</span>)
</span></span></code></pre></div><h4 id="13-群体结构分析">1.3 群体结构分析<a hidden class="anchor" aria-hidden="true" href="#13-群体结构分析">#</a></h4>
<p><strong>分析目的：</strong></p>
<ul>
<li>评估群体混合程度</li>
<li>估计祖先群体数量</li>
<li>检测基因流事件</li>
</ul>
<p><strong>ADMIXTURE分析：</strong></p>
<p><strong>Step 1: 数据准备</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 转换为PLINK BED格式</span>
</span></span><span style="display:flex;"><span>plink --vcf cohort.vcf.gz --make-bed --out population
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 过滤相关样本（可选）</span>
</span></span><span style="display:flex;"><span>plink --bfile population <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --indep-pairwise <span style="color:#ae81ff">50</span> <span style="color:#ae81ff">5</span> 0.2 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --out prune
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plink --bfile population <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --extract prune.prune.in <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --make-bed <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --out population.pruned
</span></span></code></pre></div><p><strong>Step 2: 运行ADMIXTURE</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 测试不同的K值（祖先群体数量）</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> K in <span style="color:#f92672">{</span>1..10<span style="color:#f92672">}</span>; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    admixture --cv population.pruned.bed $K | tee log<span style="color:#e6db74">${</span>K<span style="color:#e6db74">}</span>.out
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 输出文件：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - population.pruned.${K}.Q: 个体 ancestry proportions</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - population.pruned.${K}.P: SNP allele frequencies</span>
</span></span></code></pre></div><p><strong>Step 3: 选择最优K值</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 查看交叉验证误差</span>
</span></span><span style="display:flex;"><span>grep -h CV log*.out | sort -t<span style="color:#e6db74">&#39;:&#39;</span> -k2 -n
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 选择CV误差最小的K值</span>
</span></span></code></pre></div><p><strong>Step 4: 可视化（R语言）</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(ggplot2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 读取Q矩阵（ancestry proportions）</span>
</span></span><span style="display:flex;"><span>K <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">3</span>  <span style="color:#75715e"># 假设最优K=3</span>
</span></span><span style="display:flex;"><span>Q <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.table</span>(<span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;population.pruned.&#34;</span>, K, <span style="color:#e6db74">&#34;.Q&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 设置群体顺序（按第一祖先成分排序）</span>
</span></span><span style="display:flex;"><span>order_idx <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">order</span>(Q[,<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>Q_ordered <span style="color:#f92672">&lt;-</span> Q[order_idx,]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 准备绘图数据</span>
</span></span><span style="display:flex;"><span>plot_data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.data.frame</span>(Q_ordered)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">colnames</span>(plot_data) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;Ancestry&#34;</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>K)
</span></span><span style="display:flex;"><span>plot_data<span style="color:#f92672">$</span>Sample <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">factor</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">nrow</span>(Q_ordered))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 转换为长格式</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(reshape2)
</span></span><span style="display:flex;"><span>plot_data_long <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">melt</span>(plot_data, id.vars<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Sample&#34;</span>,
</span></span><span style="display:flex;"><span>                       variable.name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Ancestry&#34;</span>,
</span></span><span style="display:flex;"><span>                       value.name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Proportion&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 绘制堆叠条形图</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ggplot</span>(plot_data_long, <span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>Sample, y<span style="color:#f92672">=</span>Proportion, fill<span style="color:#f92672">=</span>Ancestry)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_bar</span>(stat<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;identity&#34;</span>, width<span style="color:#f92672">=</span><span style="color:#ae81ff">0.8</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">scale_fill_brewer</span>(palette<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Set3&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">theme_minimal</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">theme</span>(
</span></span><span style="display:flex;"><span>        axis.text.x <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
</span></span><span style="display:flex;"><span>        axis.ticks.x <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
</span></span><span style="display:flex;"><span>        legend.position<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;right&#34;</span>
</span></span><span style="display:flex;"><span>    ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labs</span>(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Sample&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Ancestry Proportion&#34;</span>,
</span></span><span style="display:flex;"><span>         title<span style="color:#f92672">=</span><span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;ADMIXTURE Analysis (K=&#34;</span>, K, <span style="color:#e6db74">&#34;)&#34;</span>))
</span></span></code></pre></div><hr>
<h3 id="二连锁不平衡分析">二、连锁不平衡分析<a hidden class="anchor" aria-hidden="true" href="#二连锁不平衡分析">#</a></h3>
<h4 id="21-ld衰减分析">2.1 LD衰减分析<a hidden class="anchor" aria-hidden="true" href="#21-ld衰减分析">#</a></h4>
<p><strong>分析目的：</strong></p>
<ul>
<li>评估连锁不平衡随着距离增加而衰减的程度</li>
<li>估算历史重组率</li>
<li>指导关联分析中的标记密度选择</li>
</ul>
<p><strong>关键指标：</strong></p>
<table>
  <thead>
      <tr>
          <th>指标</th>
          <th>说明</th>
          <th>取值范围</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>r²</td>
          <td>两个位点间的相关系数</td>
          <td>0-1</td>
      </tr>
      <tr>
          <td>D'</td>
          <td>标准化连锁不平衡系数</td>
          <td>0-1</td>
      </tr>
  </tbody>
</table>
<blockquote>
<p>LD衰减曲线：当r²降至其最大值的一半时，对应的物理距离即为LD衰减距离</p>
</blockquote>
<p><strong>软件1: PopLDdecay（推荐）</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 基本用法</span>
</span></span><span style="display:flex;"><span>PopLDdecay -InVCF cohort.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>           -OutStat ld_decay_stat
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 参数说明：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -InVCF: 输入VCF文件</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -OutStat: 输出统计文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 高级参数</span>
</span></span><span style="display:flex;"><span>PopLDdecay -InVCF cohort.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>           -OutStat ld_decay_stat <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>           -MaxDist <span style="color:#ae81ff">1000000</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>           -MAF 0.05 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>           -Miss 0.2 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>           -Het <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -MaxDist: 最大距离（bp）</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -MAF: 最小等位基因频率</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -Miss: 最大缺失率</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -Het: 包含杂合位点</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 绘制LD衰减曲线</span>
</span></span><span style="display:flex;"><span>PopLDdecay -InVCF cohort.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>           -OutStat ld_decay_stat <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>           -OutPlot ld_decay_plot
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 输出文件：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - ld_decay_stat.stat: LD统计结果</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - ld_decay_stat.pdf: LD衰减曲线图</span>
</span></span></code></pre></div><p><strong>软件2: PLINK</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 计算配对LD</span>
</span></span><span style="display:flex;"><span>plink --vcf cohort.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --r2 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --ld-window <span style="color:#ae81ff">99999</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --ld-window-kb <span style="color:#ae81ff">100</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --ld-window-r2 <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --out ld_pairwise
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 参数说明：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --r2: 计算r²值</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --ld-window: 窗口内的最大SNP数量</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --ld-window-kb: 窗口大小（kb）</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --ld-window-r2: 只报告r²高于此值的配对</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 滑动窗口LD</span>
</span></span><span style="display:flex;"><span>plink --vcf cohort.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --ld-window <span style="color:#ae81ff">100</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --ld-window-kb <span style="color:#ae81ff">100</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --ld-window-r2 0.2 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --r2 --ld-window-r2 <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --out ld_window
</span></span></code></pre></div><p><strong>R语言可视化：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(ggplot2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 读取PopLDdecay结果</span>
</span></span><span style="display:flex;"><span>ld_data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.table</span>(<span style="color:#e6db74">&#34;ld_decay_stat.stat&#34;</span>, header<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">colnames</span>(ld_data) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;Distance&#34;</span>, <span style="color:#e6db74">&#34;R2&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 按距离分组求平均值</span>
</span></span><span style="display:flex;"><span>ld_avg <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">aggregate</span>(R2 <span style="color:#f92672">~</span> Distance, data<span style="color:#f92672">=</span>ld_data, FUN<span style="color:#f92672">=</span>mean)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 绘制LD衰减曲线</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ggplot</span>(ld_avg, <span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>Distance<span style="color:#f92672">/</span><span style="color:#ae81ff">1000</span>, y<span style="color:#f92672">=</span>R2)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_line</span>(size<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;steelblue&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_smooth</span>(method<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;loess&#34;</span>, se<span style="color:#f92672">=</span><span style="color:#66d9ef">FALSE</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;red&#34;</span>, linetype<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dashed&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labs</span>(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Distance (kb)&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Linkage Disequilibrium (r²)&#34;</span>,
</span></span><span style="display:flex;"><span>         title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;LD Decay Analysis&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">theme_bw</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">annotate</span>(<span style="color:#e6db74">&#34;segment&#34;</span>, x<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, xend<span style="color:#f92672">=</span><span style="color:#66d9ef">Inf</span>, y<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>, yend<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>,
</span></span><span style="display:flex;"><span>             linetype<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dotted&#34;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;gray50&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 计算半衰距离（r²降至0.1时的距离）</span>
</span></span><span style="display:flex;"><span>half_decay_distance <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">approx</span>(ld_avg<span style="color:#f92672">$</span>R2, ld_avg<span style="color:#f92672">$</span>Distance, xout<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>)<span style="color:#f92672">$</span>y
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">print</span>(<span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;Half-decay distance: &#34;</span>, <span style="color:#a6e22e">round</span>(half_decay_distance<span style="color:#f92672">/</span><span style="color:#ae81ff">1000</span>, <span style="color:#ae81ff">2</span>), <span style="color:#e6db74">&#34; kb&#34;</span>))
</span></span></code></pre></div><h4 id="22-ld热图">2.2 LD热图<a hidden class="anchor" aria-hidden="true" href="#22-ld热图">#</a></h4>
<p><strong>目的：</strong> 展示特定染色体区域的LD模式</p>
<p><strong>R语言实现：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(LDheatmap)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(SNPRelate)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 将VCF转换为GDS格式</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">snpgdsVCF2GDS</span>(<span style="color:#e6db74">&#34;cohort.vcf.gz&#34;</span>, <span style="color:#e6db74">&#34;cohort.gds&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打开GDS文件</span>
</span></span><span style="display:flex;"><span>genofile <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">snpgdsOpen</span>(<span style="color:#e6db74">&#34;cohort.gds&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 提取特定区域的SNP</span>
</span></span><span style="display:flex;"><span>snp_id <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">snpgdsSelectSNP</span>(genofile, chromosome<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                         start.position<span style="color:#f92672">=</span><span style="color:#ae81ff">1000000</span>,
</span></span><span style="display:flex;"><span>                         end.position<span style="color:#f92672">=</span><span style="color:#ae81ff">2000000</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 计算LD矩阵</span>
</span></span><span style="display:flex;"><span>ld_matrix <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">snpgdsLDMat</span>(genofile, snp.id<span style="color:#f92672">=</span>snp_id,
</span></span><span style="display:flex;"><span>                         method<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;r&#34;</span>, slide<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>,
</span></span><span style="display:flex;"><span>                         LD.threshold<span style="color:#f92672">=</span><span style="color:#ae81ff">0.2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 绘制LD热图</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">png</span>(<span style="color:#e6db74">&#34;LD_heatmap.png&#34;</span>, width<span style="color:#f92672">=</span><span style="color:#ae81ff">2000</span>, height<span style="color:#f92672">=</span><span style="color:#ae81ff">2000</span>, res<span style="color:#f92672">=</span><span style="color:#ae81ff">150</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">LDheatmap</span>(ld_matrix<span style="color:#f92672">$</span>snpdist, ld_matrix<span style="color:#f92672">$</span>LDmatrix,
</span></span><span style="display:flex;"><span>          flip<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>,
</span></span><span style="display:flex;"><span>          title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;LD Heatmap (Chr1: 1-2 Mb)&#34;</span>,
</span></span><span style="display:flex;"><span>          geneMap<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;no genes&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">dev.off</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 关闭GDS文件</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">snpgdsClose</span>(genofile)
</span></span></code></pre></div><hr>
<h3 id="三核苷酸多样性分析">三、核苷酸多样性分析<a hidden class="anchor" aria-hidden="true" href="#三核苷酸多样性分析">#</a></h3>
<h4 id="31-π-pi-计算">3.1 π (Pi) 计算<a hidden class="anchor" aria-hidden="true" href="#31-π-pi-计算">#</a></h4>
<p><strong>定义：</strong>
π（核苷酸多样性）是指从群体中随机抽取的两个染色体的任意位点上，核苷酸差异的平均比例。</p>
<p><strong>计算公式：</strong></p>
<pre tabindex="0"><code>π = Σ πij / [n(n-1)/2]
</code></pre><p>其中，πij是第i个和第j个序列之间的核苷酸差异，n是样本数量</p>
<p><strong>生物学意义：</strong></p>
<ul>
<li>反映群体内的遗传多样性水平</li>
<li>高π值：高遗传多样性</li>
<li>低π值：低遗传多样性（可能经历了选择或瓶颈效应）</li>
</ul>
<p><strong>使用VCFtools计算：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 全基因组π（单点估计）</span>
</span></span><span style="display:flex;"><span>vcftools --vcf cohort.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --site-pi <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --out pi_per_site
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 滑动窗口π</span>
</span></span><span style="display:flex;"><span>vcftools --vcf cohort.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --window-pi <span style="color:#ae81ff">100000</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --window-pi-step <span style="color:#ae81ff">50000</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --out pi_window
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 参数说明：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --window-pi: 窗口大小（bp）</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --window-pi-step: 滑动步长（bp）</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 输出文件：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - pi_per_site.sites.pi: 每个位点的π值</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - pi_window.windowed.pi: 窗口π值</span>
</span></span></code></pre></div><p><strong>使用PopGenome（R包）：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(PopGenome)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 读取VCF文件</span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">readVCF</span>(<span style="color:#e6db74">&#34;cohort.vcf.gz&#34;</span>, include.unknown<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 计算全基因组核苷酸多样性</span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">diversity.stats</span>(data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 提取π值</span>
</span></span><span style="display:flex;"><span>pi_genome <span style="color:#f92672">&lt;-</span> data<span style="color:#f92672">@</span>nuc.diversity.within
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">print</span>(<span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;Genome-wide π: &#34;</span>, pi_genome))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 滑动窗口分析</span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sliding.window.transform</span>(data, width<span style="color:#f92672">=</span><span style="color:#ae81ff">100000</span>, step<span style="color:#f92672">=</span><span style="color:#ae81ff">50000</span>)
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">diversity.stats</span>(data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 提取窗口π值</span>
</span></span><span style="display:flex;"><span>window_pi <span style="color:#f92672">&lt;-</span> data<span style="color:#f92672">@</span>nuc.diversity.within
</span></span><span style="display:flex;"><span>window_positions <span style="color:#f92672">&lt;-</span> data<span style="color:#f92672">@</span>sliding.window.positions
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 可视化</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">plot</span>(window_positions<span style="color:#f92672">/</span><span style="color:#ae81ff">1000000</span>, window_pi,
</span></span><span style="display:flex;"><span>     type<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;l&#34;</span>, lwd<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>     xlab<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Genome Position (Mb)&#34;</span>,
</span></span><span style="display:flex;"><span>     ylab<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Nucleotide Diversity (π)&#34;</span>,
</span></span><span style="display:flex;"><span>     main<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Sliding Window π Analysis&#34;</span>)
</span></span></code></pre></div><p><strong>群体间π比较：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 群体1</span>
</span></span><span style="display:flex;"><span>vcftools --vcf cohort.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --keep population1.txt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --window-pi <span style="color:#ae81ff">100000</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --out pi_pop1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 群体2</span>
</span></span><span style="display:flex;"><span>vcftools --vcf cohort.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --keep population2.txt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --window-pi <span style="color:#ae81ff">100000</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --out pi_pop2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 群体3</span>
</span></span><span style="display:flex;"><span>vcftools --vcf cohort.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --keep population3.txt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --window-pi <span style="color:#ae81ff">100000</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --out pi_pop3
</span></span></code></pre></div><h4 id="32-wattersons-θ-theta">3.2 Watterson&rsquo;s θ (Theta)<a hidden class="anchor" aria-hidden="true" href="#32-wattersons-θ-theta">#</a></h4>
<p><strong>定义：</strong>
基于分离位点（segregating sites）数目的核苷酸多样性估计量</p>
<p><strong>计算公式：</strong></p>
<pre tabindex="0"><code>θ = S / an
</code></pre><p>其中：</p>
<ul>
<li>S：分离位点数目</li>
<li>an：调和级数和，an = Σ[1/(i-1)], i从2到n</li>
</ul>
<p><strong>生物学意义：</strong></p>
<ul>
<li>与π类似，也是衡量遗传多样性的指标</li>
<li>在中性进化条件下，θ ≈ π</li>
<li>π &lt; θ：说明群体经历了扩张</li>
<li>π &gt; θ：说明存在平衡选择或群体收缩</li>
</ul>
<p><strong>计算方法：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(PopGenome)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 读取数据</span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">readVCF</span>(<span style="color:#e6db74">&#34;cohort.vcf.gz&#34;</span>, include.unknown<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 计算Watterson&#39;s θ</span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">neutrality.stats</span>(data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 提取结果</span>
</span></span><span style="display:flex;"><span>theta <span style="color:#f92672">&lt;-</span> data<span style="color:#f92672">@</span>Watterson.theta
</span></span><span style="display:flex;"><span>theta <span style="color:#f92672">&lt;-</span> data<span style="color:#f92672">@</span>Tajimas.D
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">print</span>(<span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;Watterson&#39;s θ: &#34;</span>, theta))
</span></span></code></pre></div><p><strong>Tajima&rsquo;s D检验：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 使用VCFtools</span>
</span></span><span style="display:flex;"><span>vcftools --vcf cohort.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --TajimaD <span style="color:#ae81ff">100000</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --out tajimaD
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 输出文件：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - tajimaD.Tajima.D: 窗口Tajima&#39;s D值</span>
</span></span></code></pre></div><hr>
<h3 id="四固定指数-fst">四、固定指数 (FST)<a hidden class="anchor" aria-hidden="true" href="#四固定指数-fst">#</a></h3>
<h4 id="41-fst计算">4.1 FST计算<a hidden class="anchor" aria-hidden="true" href="#41-fst计算">#</a></h4>
<p><strong>定义：</strong>
FST（Fixation Index）是衡量群体间遗传分化程度的指标</p>
<p><strong>取值范围及意义：</strong></p>
<table>
  <thead>
      <tr>
          <th>FST值</th>
          <th>分化程度</th>
          <th>解释</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0 - 0.05</td>
          <td>很小</td>
          <td>群体间几乎无分化</td>
      </tr>
      <tr>
          <td>0.05 - 0.15</td>
          <td>中等</td>
          <td>群体间有一定分化</td>
      </tr>
      <tr>
          <td>0.15 - 0.25</td>
          <td>较大</td>
          <td>群体间分化显著</td>
      </tr>
      <tr>
          <td>&gt; 0.25</td>
          <td>极大</td>
          <td>群体间分化极大</td>
      </tr>
  </tbody>
</table>
<p><strong>使用VCFtools计算：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 准备群体文件（每行一个样本ID）</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># population1.txt</span>
</span></span><span style="display:flex;"><span>Sample001
</span></span><span style="display:flex;"><span>Sample002
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># population2.txt</span>
</span></span><span style="display:flex;"><span>Sample101
</span></span><span style="display:flex;"><span>Sample102
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 计算两群体间FST（单点）</span>
</span></span><span style="display:flex;"><span>vcftools --vcf cohort.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --weir-fst-pop population1.txt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --weir-fst-pop population2.txt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --out fst_pop1_pop2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 滑动窗口FST</span>
</span></span><span style="display:flex;"><span>vcftools --vcf cohort.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --weir-fst-pop population1.txt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --weir-fst-pop population2.txt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --fst-window-size <span style="color:#ae81ff">100000</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --fst-window-step <span style="color:#ae81ff">50000</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --out fst_window
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 参数说明：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --weir-fst-pop: 指定一个群体的样本文件</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --fst-window-size: 窗口大小（bp）</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --fst-window-step: 滑动步长（bp）</span>
</span></span></code></pre></div><p><strong>使用PopGenome（R包）：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(PopGenome)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 读取数据</span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">readVCF</span>(<span style="color:#e6db74">&#34;cohort.vcf.gz&#34;</span>, include.unknown<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>,
</span></span><span style="display:flex;"><span>                gffpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;annotation.gff&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 定义群体</span>
</span></span><span style="display:flex;"><span>populations <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(
</span></span><span style="display:flex;"><span>    pop1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">read.table</span>(<span style="color:#e6db74">&#34;population1.txt&#34;</span>)<span style="color:#f92672">$</span>V1,
</span></span><span style="display:flex;"><span>    pop2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">read.table</span>(<span style="color:#e6db74">&#34;population2.txt&#34;</span>)<span style="color:#f92672">$</span>V1,
</span></span><span style="display:flex;"><span>    pop3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">read.table</span>(<span style="color:#e6db74">&#34;population3.txt&#34;</span>)<span style="color:#f92672">$</span>V1
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 设置群体</span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">set.populations</span>(data, populations)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 计算FST</span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">F_ST.stats</span>(data, mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;nucleotide&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 提取结果</span>
</span></span><span style="display:flex;"><span>fst_matrix <span style="color:#f92672">&lt;-</span> data<span style="color:#f92672">@</span>F_ST.matrix
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">print</span>(fst_matrix)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 成对群体FST</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (i <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>(<span style="color:#a6e22e">nrow</span>(fst_matrix)<span style="color:#ae81ff">-1</span>)) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (j <span style="color:#66d9ef">in</span> (i<span style="color:#ae81ff">+1</span>)<span style="color:#f92672">:</span><span style="color:#a6e22e">nrow</span>(fst_matrix)) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">cat</span>(<span style="color:#a6e22e">sprintf</span>(<span style="color:#e6db74">&#34;FST(%s, %s) = %.4f\n&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">rownames</span>(fst_matrix)[i],
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">colnames</span>(fst_matrix)[j],
</span></span><span style="display:flex;"><span>                    fst_matrix[i,j]))
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>可视化FST分布：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(ggplot2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 读取窗口FST结果</span>
</span></span><span style="display:flex;"><span>fst_data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.table</span>(<span style="color:#e6db74">&#34;fst_window.windowed.weir.fst&#34;</span>, header<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 绘制曼哈顿式FST图</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ggplot</span>(fst_data, <span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>POS<span style="color:#f92672">/</span><span style="color:#ae81ff">1000000</span>, y<span style="color:#f92672">=</span>WEIR_AND_COCKERHAM_FST)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_point</span>(size<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.6</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;steelblue&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_hline</span>(yintercept<span style="color:#f92672">=</span><span style="color:#ae81ff">0.15</span>, linetype<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dashed&#34;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;red&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span>CHROM, scales<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;free_x&#34;</span>, ncol<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labs</span>(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Position (Mb)&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;FST&#34;</span>,
</span></span><span style="display:flex;"><span>         title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Genome-wide FST between Population 1 and 2&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">theme_bw</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">theme</span>(strip.text <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(size<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>))
</span></span></code></pre></div><p><strong>FST热图：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(pheatmap)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 绘制FST矩阵热图</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">pheatmap</span>(fst_matrix,
</span></span><span style="display:flex;"><span>         display_numbers<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>,
</span></span><span style="display:flex;"><span>         number_format<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;%.3f&#34;</span>,
</span></span><span style="display:flex;"><span>         main<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Pairwise FST between Populations&#34;</span>,
</span></span><span style="display:flex;"><span>         color<span style="color:#f92672">=</span><span style="color:#a6e22e">colorRampPalette</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;orange&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>))(<span style="color:#ae81ff">50</span>),
</span></span><span style="display:flex;"><span>         breaks<span style="color:#f92672">=</span><span style="color:#a6e22e">seq</span>(<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">max</span>(fst_matrix), length.out<span style="color:#f92672">=</span><span style="color:#ae81ff">51</span>))
</span></span></code></pre></div><hr>
<h3 id="五选择清除分析">五、选择清除分析<a hidden class="anchor" aria-hidden="true" href="#五选择清除分析">#</a></h3>
<h4 id="51-核苷酸多样性比值-π-ratio">5.1 核苷酸多样性比值 (π-ratio)<a hidden class="anchor" aria-hidden="true" href="#51-核苷酸多样性比值-π-ratio">#</a></h4>
<p><strong>原理：</strong>
受选择区域的核苷酸多样性会显著降低，通过计算不同群体间π的比值可以检测选择信号</p>
<p><strong>计算公式：</strong></p>
<pre tabindex="0"><code>π-ratio = π_selected / π_control
</code></pre><p>低π-ratio值：该区域可能经历了正选择</p>
<p><strong>分析流程：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Step 1: 计算各群体π</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 群体1（假设为受选择群体）</span>
</span></span><span style="display:flex;"><span>vcftools --vcf cohort.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --keep population1.txt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --window-pi <span style="color:#ae81ff">100000</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --window-pi-step <span style="color:#ae81ff">50000</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --out pi_pop1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 群体2（对照群体）</span>
</span></span><span style="display:flex;"><span>vcftools --vcf cohort.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --keep population2.txt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --window-pi <span style="color:#ae81ff">100000</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --window-pi-step <span style="color:#ae81ff">50000</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --out pi_pop2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Step 2: 计算π-ratio（使用Python或R）</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Python示例</span>
</span></span><span style="display:flex;"><span>import pandas as pd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pi1 <span style="color:#f92672">=</span> pd.read_csv<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;pi_pop1.windowed.pi&#34;</span>, sep<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;\t&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>pi2 <span style="color:#f92672">=</span> pd.read_csv<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;pi_pop2.windowed.pi&#34;</span>, sep<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;\t&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pi_ratio <span style="color:#f92672">=</span> pi1.copy<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>pi_ratio<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;PI_RATIO&#34;</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> pi1<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;PI&#34;</span><span style="color:#f92672">]</span> / pi2<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;PI&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>pi_ratio.to_csv<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;pi_ratio.txt&#34;</span>, sep<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;\t&#34;</span>, index<span style="color:#f92672">=</span>False<span style="color:#f92672">)</span>
</span></span></code></pre></div><p><strong>R语言可视化：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(ggplot2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 读取数据</span>
</span></span><span style="display:flex;"><span>pi1 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.table</span>(<span style="color:#e6db74">&#34;pi_pop1.windowed.pi&#34;</span>, header<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>)
</span></span><span style="display:flex;"><span>pi2 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.table</span>(<span style="color:#e6db74">&#34;pi_pop2.windowed.pi&#34;</span>, header<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 计算π-ratio</span>
</span></span><span style="display:flex;"><span>pi_ratio <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.frame</span>(
</span></span><span style="display:flex;"><span>    CHROM <span style="color:#f92672">=</span> pi1<span style="color:#f92672">$</span>CHROM,
</span></span><span style="display:flex;"><span>    BIN_START <span style="color:#f92672">=</span> pi1<span style="color:#f92672">$</span>BIN_START,
</span></span><span style="display:flex;"><span>    BIN_END <span style="color:#f92672">=</span> pi1<span style="color:#f92672">$</span>BIN_END,
</span></span><span style="display:flex;"><span>    PI_RATIO <span style="color:#f92672">=</span> pi1<span style="color:#f92672">$</span>PI <span style="color:#f92672">/</span> pi2<span style="color:#f92672">$</span>PI
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 识别选择信号（阈值：5%分位数）</span>
</span></span><span style="display:flex;"><span>threshold <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">quantile</span>(pi_ratio<span style="color:#f92672">$</span>PI_RATIO, <span style="color:#ae81ff">0.05</span>)
</span></span><span style="display:flex;"><span>candidates <span style="color:#f92672">&lt;-</span> pi_ratio[pi_ratio<span style="color:#f92672">$</span>PI_RATIO <span style="color:#f92672">&lt;</span> threshold, ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 可视化</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ggplot</span>(pi_ratio, <span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>BIN_START<span style="color:#f92672">/</span><span style="color:#ae81ff">1000000</span>, y<span style="color:#f92672">=</span>PI_RATIO)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_line</span>(color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;steelblue&#34;</span>, size<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_hline</span>(yintercept<span style="color:#f92672">=</span>threshold, linetype<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dashed&#34;</span>,
</span></span><span style="display:flex;"><span>               color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;red&#34;</span>, size<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_point</span>(data<span style="color:#f92672">=</span>candidates, <span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>BIN_START<span style="color:#f92672">/</span><span style="color:#ae81ff">1000000</span>, y<span style="color:#f92672">=</span>PI_RATIO),
</span></span><span style="display:flex;"><span>               color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;red&#34;</span>, size<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.7</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span>CHROM, scales<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;free_x&#34;</span>, ncol<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labs</span>(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Position (Mb)&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;π Ratio (Pop1/Pop2)&#34;</span>,
</span></span><span style="display:flex;"><span>         title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Nucleotide Diversity Ratio Scan&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">theme_bw</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 输出候选区域</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">write.table</span>(candidates, <span style="color:#e6db74">&#34;selection_candidates.txt&#34;</span>,
</span></span><span style="display:flex;"><span>            sep<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;\t&#34;</span>, row.names<span style="color:#f92672">=</span><span style="color:#66d9ef">FALSE</span>, quote<span style="color:#f92672">=</span><span style="color:#66d9ef">FALSE</span>)
</span></span></code></pre></div><h4 id="52-xp-clr-跨群体复合似然比检验">5.2 XP-CLR (跨群体复合似然比检验)<a hidden class="anchor" aria-hidden="true" href="#52-xp-clr-跨群体复合似然比检验">#</a></h4>
<p><strong>原理：</strong>
检测由于选择引起的群体间等位基因频率差异，考虑了连锁不平衡和遗传重组</p>
<p><strong>特点：</strong></p>
<ul>
<li>不需要单体型相位信息</li>
<li>适用于大数据集</li>
<li>对古老选择信号敏感</li>
</ul>
<p><strong>分析流程：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Step 1: 准备输入文件</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># XP-CLR要求特定的格式：Chrom  Position  Likelihood</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 将VCF转换为XP-CLR格式</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 可以使用自定义脚本或vcftools</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 提取多等位基因信息</span>
</span></span><span style="display:flex;"><span>vcftools --vcf cohort.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --freq <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --out allele_freq
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Step 2: 运行XP-CLR</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 安装XP-CLR后</span>
</span></span><span style="display:flex;"><span>xpclr -xpclr cohort.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>       -w1 <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">200</span> <span style="color:#ae81ff">2000</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>       -w2 <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">100</span> <span style="color:#ae81ff">1000</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>       -p0 0.001 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>       -maxSNP <span style="color:#ae81ff">1000</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>       -out xpclr_result
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 参数说明：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -w1: 窗口参数（大小，步长，最大SNP数）</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -w2: 第二个窗口参数</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -p0: 置信度阈值</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -maxSNP: 每个窗口的最大SNP数</span>
</span></span></code></pre></div><p><strong>结果可视化：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(ggplot2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 读取XP-CLR结果</span>
</span></span><span style="display:flex;"><span>xpclr <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.table</span>(<span style="color:#e6db74">&#34;xpclr_result&#34;</span>, header<span style="color:#f92672">=</span><span style="color:#66d9ef">FALSE</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">colnames</span>(xpclr) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;CHROM&#34;</span>, <span style="color:#e6db74">&#34;Position&#34;</span>, <span style="color:#e6db74">&#34;XP_CLR_Score&#34;</span>,
</span></span><span style="display:flex;"><span>                     <span style="color:#e6db74">&#34;Ref_Freq&#34;</span>, <span style="color:#e6db74">&#34;Alt_Freq&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 计算滑动窗口平均</span>
</span></span><span style="display:flex;"><span>window_size <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">100000</span>  <span style="color:#75715e"># 100 kb</span>
</span></span><span style="display:flex;"><span>xpclr<span style="color:#f92672">$</span>Window <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">floor</span>(xpclr<span style="color:#f92672">$</span>Position <span style="color:#f92672">/</span> window_size) <span style="color:#f92672">*</span> window_size
</span></span><span style="display:flex;"><span>xpclr_avg <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">aggregate</span>(XP_CLR_Score <span style="color:#f92672">~</span> Window <span style="color:#f92672">+</span> CHROM,
</span></span><span style="display:flex;"><span>                       data<span style="color:#f92672">=</span>xpclr, FUN<span style="color:#f92672">=</span>mean)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 绘制XP-CLR扫描图</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ggplot</span>(xpclr_avg, <span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>Window<span style="color:#f92672">/</span><span style="color:#ae81ff">1000000</span>, y<span style="color:#f92672">=</span>XP_CLR_Score)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_line</span>(color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;steelblue&#34;</span>, size<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span>CHROM, scales<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;free_x&#34;</span>, ncol<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labs</span>(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Position (Mb)&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;XP-CLR Score&#34;</span>,
</span></span><span style="display:flex;"><span>         title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;XP-CLR Scan for Selection Signals&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">theme_bw</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 识别显著峰（阈值：top 1%）</span>
</span></span><span style="display:flex;"><span>threshold <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">quantile</span>(xpclr_avg<span style="color:#f92672">$</span>XP_CLR_Score, <span style="color:#ae81ff">0.99</span>)
</span></span><span style="display:flex;"><span>peaks <span style="color:#f92672">&lt;-</span> xpclr_avg[xpclr_avg<span style="color:#f92672">$</span>XP_CLR_Score <span style="color:#f92672">&gt;</span> threshold, ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 标注显著峰</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ggplot</span>(xpclr_avg, <span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>Window<span style="color:#f92672">/</span><span style="color:#ae81ff">1000000</span>, y<span style="color:#f92672">=</span>XP_CLR_Score)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_line</span>(color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;gray&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_point</span>(data<span style="color:#f92672">=</span>peaks, <span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>Window<span style="color:#f92672">/</span><span style="color:#ae81ff">1000000</span>, y<span style="color:#f92672">=</span>XP_CLR_Score),
</span></span><span style="display:flex;"><span>               color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;red&#34;</span>, size<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_hline</span>(yintercept<span style="color:#f92672">=</span>threshold, linetype<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dashed&#34;</span>,
</span></span><span style="display:flex;"><span>               color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;red&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span>CHROM, scales<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;free_x&#34;</span>, ncol<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labs</span>(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Position (Mb)&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;XP-CLR Score&#34;</span>,
</span></span><span style="display:flex;"><span>         title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Significant Selection Peaks&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">theme_bw</span>()
</span></span></code></pre></div><h4 id="53-xp-ehh-交叉群体扩展单体型纯合性">5.3 XP-EHH (交叉群体扩展单体型纯合性)<a hidden class="anchor" aria-hidden="true" href="#53-xp-ehh-交叉群体扩展单体型纯合性">#</a></h4>
<p><strong>原理：</strong>
检测一个群体中已经完成的正选择（单体型频率高且扩展范围大），而另一群体中未完成的选择</p>
<p><strong>特点：</strong></p>
<ul>
<li>适用于检测近期的选择事件</li>
<li>需要单体型相位信息</li>
</ul>
<p><strong>分析流程：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Step 1: 准备PLINK格式数据</span>
</span></span><span style="display:flex;"><span>plink --vcf cohort.vcf.gz --make-bed --out cohort
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Step 2: 相位推断（使用SHAPEIT或BEAGLE）</span>
</span></span><span style="display:flex;"><span>shapeit -B cohort <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>        -M genetic_map.txt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>        -O cohort.phased <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>        --thread <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 或使用beagle</span>
</span></span><span style="display:flex;"><span>beagle gt<span style="color:#f92672">=</span>cohort.bed <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>       out<span style="color:#f92672">=</span>cohort.phased <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>       nthreads<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Step 3: 运行XP-EHH（使用selscan）</span>
</span></span><span style="display:flex;"><span>selscan --xpehh <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>        --vcf cohort.phased.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>        --map genetic_map.txt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>        --pop1 population1.txt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>        --pop2 population2.txt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>        --out xpehh_result
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 参数说明：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --xpehh: 运行XP-EHH模式</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --pop1: 群体1的样本列表</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --pop2: 群体2的样本列表</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Step 4: 标准化XP-EHH得分</span>
</span></span><span style="display:flex;"><span>norm --xpehh --files xpehh_result
</span></span></code></pre></div><p><strong>结果可视化：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(ggplot2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 读取标准化后的XP-EHH结果</span>
</span></span><span style="display:flex;"><span>xpehh <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.table</span>(<span style="color:#e6db74">&#34;xpehh_result.norm.xpehh&#34;</span>, header<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 绘制XP-EHH扫描图</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ggplot</span>(xpehh, <span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>POS<span style="color:#f92672">/</span><span style="color:#ae81ff">1000000</span>, y<span style="color:#f92672">=</span>normXPEHH)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_point</span>(size<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.6</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;steelblue&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_hline</span>(yintercept<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, linetype<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dashed&#34;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;gray50&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_hline</span>(yintercept<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, linetype<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dashed&#34;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;red&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_hline</span>(yintercept<span style="color:#f92672">=</span><span style="color:#ae81ff">-2</span>, linetype<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dashed&#34;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;blue&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span>CHR, scales<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;free_x&#34;</span>, ncol<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labs</span>(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Position (Mb)&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Standardized XP-EHH&#34;</span>,
</span></span><span style="display:flex;"><span>         title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;XP-EHH Scan&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">theme_bw</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 识别显著信号（|XP-EHH| &gt; 2）</span>
</span></span><span style="display:flex;"><span>candidates_pos <span style="color:#f92672">&lt;-</span> xpehh[xpehh<span style="color:#f92672">$</span>normXPEHH <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">2</span>, ]
</span></span><span style="display:flex;"><span>candidates_neg <span style="color:#f92672">&lt;-</span> xpehh[xpehh<span style="color:#f92672">$</span>normXPEHH <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">-2</span>, ]
</span></span></code></pre></div><h4 id="54-tajimas-d">5.4 Tajima&rsquo;s D<a hidden class="anchor" aria-hidden="true" href="#54-tajimas-d">#</a></h4>
<p><strong>定义：</strong>
基于等位基因频谱的中性检验统计量</p>
<p><strong>计算公式：</strong></p>
<pre tabindex="0"><code>D = (π - θ) / SD(π - θ)
</code></pre><p><strong>取值及生物学意义：</strong></p>
<table>
  <thead>
      <tr>
          <th>D值</th>
          <th>意义</th>
          <th>进化解释</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>D &raquo; 0</td>
          <td>显著为正</td>
          <td>群体收缩或平衡选择</td>
      </tr>
      <tr>
          <td>D ≈ 0</td>
          <td>接近0</td>
          <td>符合中性进化</td>
      </tr>
      <tr>
          <td>D &laquo; 0</td>
          <td>显著为负</td>
          <td>群体扩张或正选择</td>
      </tr>
  </tbody>
</table>
<p><strong>使用VCFtools计算：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 滑动窗口Tajima&#39;s D</span>
</span></span><span style="display:flex;"><span>vcftools --vcf cohort.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --TajimaD <span style="color:#ae81ff">100000</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --out tajimaD
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 参数说明：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --TajimaD: 窗口大小（bp）</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 输出文件：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - tajimaD.Tajima.D: 窗口Tajima&#39;s D值</span>
</span></span></code></pre></div><p><strong>使用PopGenome（R包）：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(PopGenome)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 读取数据</span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">readVCF</span>(<span style="color:#e6db74">&#34;cohort.vcf.gz&#34;</span>, include.unknown<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 滑动窗口分析</span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sliding.window.transform</span>(data, width<span style="color:#f92672">=</span><span style="color:#ae81ff">100000</span>, step<span style="color:#f92672">=</span><span style="color:#ae81ff">50000</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 计算Tajima&#39;s D</span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">neutrality.stats</span>(data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 提取结果</span>
</span></span><span style="display:flex;"><span>tajima_d <span style="color:#f92672">&lt;-</span> data<span style="color:#f92672">@</span>Tajimas.D
</span></span><span style="display:flex;"><span>window_positions <span style="color:#f92672">&lt;-</span> data<span style="color:#f92672">@</span>sliding.window.positions
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 可视化</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">plot</span>(window_positions<span style="color:#f92672">/</span><span style="color:#ae81ff">1000000</span>, tajima_d,
</span></span><span style="display:flex;"><span>     type<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;l&#34;</span>, lwd<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, col<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;steelblue&#34;</span>,
</span></span><span style="display:flex;"><span>     xlab<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Genome Position (Mb)&#34;</span>,
</span></span><span style="display:flex;"><span>     ylab<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Tajima&#39;s D&#34;</span>,
</span></span><span style="display:flex;"><span>     main<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Tajima&#39;s D Scan&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 添加阈值线（显著性水平）</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">abline</span>(h<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, col<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;red&#34;</span>, lty<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)  <span style="color:#75715e"># 显著正D值</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">abline</span>(h<span style="color:#f92672">=</span><span style="color:#ae81ff">-2</span>, col<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;blue&#34;</span>, lty<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)  <span style="color:#75715e"># 显著负D值</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 识别显著窗口</span>
</span></span><span style="display:flex;"><span>sig_pos <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">which</span>(tajima_d <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>sig_neg <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">which</span>(tajima_d <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">-2</span>)
</span></span></code></pre></div><hr>
<h3 id="六全基因组关联分析-gwas">六、全基因组关联分析 (GWAS)<a hidden class="anchor" aria-hidden="true" href="#六全基因组关联分析-gwas">#</a></h3>
<h4 id="61-分析流程总览">6.1 分析流程总览<a hidden class="anchor" aria-hidden="true" href="#61-分析流程总览">#</a></h4>
<pre tabindex="0"><code>表型数据收集 → 基因型数据质控 → 群体结构控制 → 关联分析 → 多重检验校正 → 结果可视化 → 候选基因鉴定
</code></pre><h4 id="62-数据准备">6.2 数据准备<a hidden class="anchor" aria-hidden="true" href="#62-数据准备">#</a></h4>
<p><strong>表型文件：</strong></p>
<pre tabindex="0"><code>Sample_ID    Trait1    Trait2    Trait3
Sample001    10.5      25.3      1.2
Sample002    12.3      28.1      1.5
Sample003    9.8       24.7      1.1
...
</code></pre><p><strong>基因型文件：</strong></p>
<ul>
<li>VCF格式</li>
<li>PLINK BED格式</li>
<li>HapMap格式</li>
</ul>
<p><strong>群体结构文件（可选但推荐）：</strong></p>
<ul>
<li>Q矩阵：从ADMIXTURE或STRUCTURE获得</li>
<li>PC矩阵：从PCA获得</li>
</ul>
<h4 id="63-基因型数据质控">6.3 基因型数据质控<a hidden class="anchor" aria-hidden="true" href="#63-基因型数据质控">#</a></h4>
<p><strong>质控标准：</strong></p>
<table>
  <thead>
      <tr>
          <th>参数</th>
          <th>阈值</th>
          <th>说明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>MAF</td>
          <td>&gt; 0.05</td>
          <td>最小等位基因频率</td>
      </tr>
      <tr>
          <td>Missing rate</td>
          <td>&lt; 0.1</td>
          <td>缺失率（位点）</td>
      </tr>
      <tr>
          <td>HWE P</td>
          <td>&gt; 1e-6</td>
          <td>哈代-温伯格平衡p值</td>
      </tr>
      <tr>
          <td>Geno missing</td>
          <td>&lt; 0.1</td>
          <td>缺失率（个体）</td>
      </tr>
  </tbody>
</table>
<p><strong>使用PLINK进行质控：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Step 1: 转换格式</span>
</span></span><span style="display:flex;"><span>plink --vcf cohort.vcf.gz --make-bed --out gwas_raw
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Step 2: 基本质控</span>
</span></span><span style="display:flex;"><span>plink --bfile gwas_raw <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --maf 0.05 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --geno 0.1 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --hwe 1e-6 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --mind 0.1 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --make-bed <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --out gwas_cleaned
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Step 3: 去除相关样本（可选）</span>
</span></span><span style="display:flex;"><span>plink --bfile gwas_cleaned <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --indep-pairwise <span style="color:#ae81ff">50</span> <span style="color:#ae81ff">5</span> 0.2 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --out prune
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plink --bfile gwas_cleaned <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --extract prune.prune.in <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --make-bed <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --out gwas_pruned
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 参数说明：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --maf: 最小等位基因频率</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --geno: 位点最大缺失率</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --hwe: 哈代-温伯格平衡p值阈值</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --mind: 个体最大缺失率</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --indep-pairwise: LD剪裁（窗口大小，步长，r²阈值）</span>
</span></span></code></pre></div><h4 id="64-关联分析">6.4 关联分析<a hidden class="anchor" aria-hidden="true" href="#64-关联分析">#</a></h4>
<p><strong>常用软件对比：</strong></p>
<table>
  <thead>
      <tr>
          <th>软件</th>
          <th>模型</th>
          <th>特点</th>
          <th>适用场景</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>TASSEL</td>
          <td>GLM/MLM</td>
          <td>图形界面，易于使用</td>
          <td>小数据集</td>
      </tr>
      <tr>
          <td>GAPIT</td>
          <td>多种模型</td>
          <td>R包，灵活</td>
          <td>中等数据集</td>
      </tr>
      <tr>
          <td>GEMMA</td>
          <td>LMM</td>
          <td>快速，准确</td>
          <td>大数据集</td>
      </tr>
      <tr>
          <td>EMMAX</td>
          <td>LMM</td>
          <td>高效</td>
          <td>大数据集</td>
      </tr>
  </tbody>
</table>
<p><strong>使用GEMMA进行关联分析：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Step 1: 计算关系矩阵（Kinship Matrix）</span>
</span></span><span style="display:flex;"><span>gemma -bfile gwas_cleaned <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      -gk <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      -o kinship_matrix
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -gk 1: 中心化关系矩阵（VanRaden method）</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 输出：kinship_matrix.cXX.txt</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Step 2: 准备表型文件</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 格式：Sample_ID  Phenotype</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># （需要与PLINK的.fam文件顺序一致）</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Step 3: 关联分析（线性混合模型）</span>
</span></span><span style="display:flex;"><span>gemma -bfile gwas_cleaned <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      -k output/kinship_matrix.cXX.txt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      -lmm <span style="color:#ae81ff">4</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      -phenotype phenotype.txt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      -o gwas_result
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 参数说明：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -k: 关系矩阵文件</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -lmm: 混合模型方法（1=exact LRT, 4= Wald test）</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -phenotype: 表型文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 输出文件：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - gwas_result.assoc.txt: 关联结果</span>
</span></span></code></pre></div><p><strong>使用GAPIT（R包）：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(GAPIT3)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 读取数据</span>
</span></span><span style="display:flex;"><span>myG <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.table</span>(<span style="color:#e6db74">&#34;gwas_cleaned.raw&#34;</span>, header<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>)
</span></span><span style="display:flex;"><span>myY <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.table</span>(<span style="color:#e6db74">&#34;phenotype.txt&#34;</span>, header<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># PCA分析（作为协变量）</span>
</span></span><span style="display:flex;"><span>myPCA <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">GAPIT.PCA</span>(myG)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 运行GWAS</span>
</span></span><span style="display:flex;"><span>myGWAS <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">GAPIT</span>(
</span></span><span style="display:flex;"><span>    Y <span style="color:#f92672">=</span> myY,
</span></span><span style="display:flex;"><span>    G <span style="color:#f92672">=</span> myG,
</span></span><span style="display:flex;"><span>    PCA.total <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>,  <span style="color:#75715e"># 使用前3个PC作为协变量</span>
</span></span><span style="display:flex;"><span>    model <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;MLM&#34;</span>,  <span style="color:#75715e"># 混合线性模型</span>
</span></span><span style="display:flex;"><span>    SNP.MAF <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.05</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 多模型比较</span>
</span></span><span style="display:flex;"><span>myGWAS_multi <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">GAPIT</span>(
</span></span><span style="display:flex;"><span>    Y <span style="color:#f92672">=</span> myY,
</span></span><span style="display:flex;"><span>    G <span style="color:#f92672">=</span> myG,
</span></span><span style="display:flex;"><span>    PCA.total <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>    model <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;GLM&#34;</span>, <span style="color:#e6db74">&#34;MLM&#34;</span>, <span style="color:#e6db74">&#34;FarmCPU&#34;</span>, <span style="color:#e6db74">&#34;Blink&#34;</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 输出：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - myGWAS: Manhattan图和QQ图</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - GAPIT.GWAS.Result.txt: 关联结果</span>
</span></span></code></pre></div><h4 id="65-结果解读">6.5 结果解读<a hidden class="anchor" aria-hidden="true" href="#65-结果解读">#</a></h4>
<p><strong>关联结果文件格式：</strong></p>
<table>
  <thead>
      <tr>
          <th>列名</th>
          <th>说明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>CHR</td>
          <td>染色体编号</td>
      </tr>
      <tr>
          <td>SNP</td>
          <td>SNP标识符（位置或ID）</td>
      </tr>
      <tr>
          <td>BP</td>
          <td>物理位置</td>
      </tr>
      <tr>
          <td>P</td>
          <td>p值</td>
      </tr>
      <tr>
          <td>BETA</td>
          <td>效应大小</td>
      </tr>
      <tr>
          <td>SE</td>
          <td>标准误</td>
      </tr>
      <tr>
          <td>R2</td>
          <td>解释方差比例</td>
      </tr>
  </tbody>
</table>
<p><strong>多重检验校正：</strong></p>
<table>
  <thead>
      <tr>
          <th>方法</th>
          <th>阈值</th>
          <th>说明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Bonferroni</td>
          <td>0.05/N</td>
          <td>保守，适合严格标准</td>
      </tr>
      <tr>
          <td>FDR</td>
          <td>0.05</td>
          <td>允许5%假阳性</td>
      </tr>
      <tr>
          <td>Suggestive</td>
          <td>1e-5</td>
          <td>建议显著性阈值</td>
      </tr>
  </tbody>
</table>
<p><strong>基因组显著性阈值：</strong></p>
<pre tabindex="0"><code>Bonferroni correction: 0.05 / N
其中 N = 总SNP数量

例如，N = 1,000,000：
阈值 = 0.05 / 1,000,000 = 5e-8
</code></pre><h4 id="66-结果可视化">6.6 结果可视化<a hidden class="anchor" aria-hidden="true" href="#66-结果可视化">#</a></h4>
<p><strong>曼哈顿图：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(qqman)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 读取结果</span>
</span></span><span style="display:flex;"><span>gwas <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.table</span>(<span style="color:#e6db74">&#34;gwas_result.assoc.txt&#34;</span>, header<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 基本曼哈顿图</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">manhattan</span>(gwas,
</span></span><span style="display:flex;"><span>          chr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;CHR&#34;</span>,
</span></span><span style="display:flex;"><span>          bp <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;BP&#34;</span>,
</span></span><span style="display:flex;"><span>          p <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;P&#34;</span>,
</span></span><span style="display:flex;"><span>          genomewideline <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">log10</span>(<span style="color:#ae81ff">5e-8</span>),
</span></span><span style="display:flex;"><span>          suggestiveline <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">log10</span>(<span style="color:#ae81ff">1e-5</span>),
</span></span><span style="display:flex;"><span>          highlight <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>          main <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;GWAS Manhattan Plot&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 高亮特定SNP</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">manhattan</span>(gwas,
</span></span><span style="display:flex;"><span>          chr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;CHR&#34;</span>,
</span></span><span style="display:flex;"><span>          bp <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;BP&#34;</span>,
</span></span><span style="display:flex;"><span>          p <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;P&#34;</span>,
</span></span><span style="display:flex;"><span>          highlight <span style="color:#f92672">=</span> gwas<span style="color:#f92672">$</span>SNP[gwas<span style="color:#f92672">$</span>P <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">5e-8</span>],
</span></span><span style="display:flex;"><span>          main <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Significant SNPs&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 添加基因名称</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">manhattan</span>(gwas,
</span></span><span style="display:flex;"><span>          chr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;CHR&#34;</span>,
</span></span><span style="display:flex;"><span>          bp <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;BP&#34;</span>,
</span></span><span style="display:flex;"><span>          p <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;P&#34;</span>,
</span></span><span style="display:flex;"><span>          annotatePval <span style="color:#f92672">=</span> <span style="color:#ae81ff">1e-6</span>,  <span style="color:#75715e"># 标注p值小于1e-6的SNP</span>
</span></span><span style="display:flex;"><span>          annotateTop <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)   <span style="color:#75715e"># 只标注最显著的SNP</span>
</span></span></code></pre></div><p><strong>使用ggplot2绘制曼哈顿图：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(ggplot2)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(dplyr)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 准备数据</span>
</span></span><span style="display:flex;"><span>gwas_plot <span style="color:#f92672">&lt;-</span> gwas <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mutate</span>(
</span></span><span style="display:flex;"><span>        neglog10p <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">log10</span>(P),
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 为每个染色体分配颜色</span>
</span></span><span style="display:flex;"><span>        chr_color <span style="color:#f92672">=</span> <span style="color:#a6e22e">ifelse</span>(<span style="color:#a6e22e">as.numeric</span>(CHR) <span style="color:#f92672">%%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#34;even&#34;</span>, <span style="color:#e6db74">&#34;odd&#34;</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 转换染色体为因子</span>
</span></span><span style="display:flex;"><span>        CHR <span style="color:#f92672">=</span> <span style="color:#a6e22e">factor</span>(CHR, levels<span style="color:#f92672">=</span><span style="color:#a6e22e">unique</span>(CHR))
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 计算阈值</span>
</span></span><span style="display:flex;"><span>threshold <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">5e-8</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 绘图</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ggplot</span>(gwas_plot, <span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>BP<span style="color:#f92672">/</span><span style="color:#ae81ff">1000000</span>, y<span style="color:#f92672">=</span>neglog10p)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_point</span>(<span style="color:#a6e22e">aes</span>(color<span style="color:#f92672">=</span>chr_color), size<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.7</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span>CHR, scales<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;free_x&#34;</span>, ncol<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">scale_color_manual</span>(values<span style="color:#f92672">=</span><span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;odd&#34;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;steelblue&#34;</span>, <span style="color:#e6db74">&#34;even&#34;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;orange&#34;</span>)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_hline</span>(yintercept<span style="color:#f92672">=-</span><span style="color:#a6e22e">log10</span>(threshold),
</span></span><span style="display:flex;"><span>               linetype<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dashed&#34;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;red&#34;</span>, size<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labs</span>(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Position (Mb)&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-log10(P)&#34;</span>,
</span></span><span style="display:flex;"><span>         title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Genome-wide Association Study&#34;</span>,
</span></span><span style="display:flex;"><span>         subtitle<span style="color:#f92672">=</span><span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;Significance threshold: &#34;</span>, threshold)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">theme_bw</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">theme</span>(
</span></span><span style="display:flex;"><span>        legend.position<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;none&#34;</span>,
</span></span><span style="display:flex;"><span>        strip.text <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(size<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>),
</span></span><span style="display:flex;"><span>        axis.text.x <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(angle<span style="color:#f92672">=</span><span style="color:#ae81ff">45</span>, hjust<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    )
</span></span></code></pre></div><p><strong>QQ图：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># 使用qqman包</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">qq</span>(gwas<span style="color:#f92672">$</span>P, main<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Q-Q Plot&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用ggplot2</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(ggplot2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 计算期望p值</span>
</span></span><span style="display:flex;"><span>expected <span style="color:#f92672">&lt;-</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">log10</span>((<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">nrow</span>(gwas)) <span style="color:#f92672">/</span> (<span style="color:#a6e22e">nrow</span>(gwas) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>observed <span style="color:#f92672">&lt;-</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">log10</span>(<span style="color:#a6e22e">sort</span>(gwas<span style="color:#f92672">$</span>P))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>qq_data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.frame</span>(Expected<span style="color:#f92672">=</span>expected, Observed<span style="color:#f92672">=</span>observed)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ggplot</span>(qq_data, <span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>Expected, y<span style="color:#f92672">=</span>Observed)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_point</span>(size<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.6</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_abline</span>(intercept<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, slope<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, linetype<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dashed&#34;</span>,
</span></span><span style="display:flex;"><span>                color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;red&#34;</span>, size<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labs</span>(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Expected -log10(P)&#34;</span>,
</span></span><span style="display:flex;"><span>         y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Observed -log10(P)&#34;</span>,
</span></span><span style="display:flex;"><span>         title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Q-Q Plot&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">theme_bw</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 计算膨胀因子</span>
</span></span><span style="display:flex;"><span>lambda <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">median</span>(<span style="color:#a6e22e">qchisq</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> gwas<span style="color:#f92672">$</span>P, <span style="color:#ae81ff">1</span>)) <span style="color:#f92672">/</span> <span style="color:#a6e22e">qchisq</span>(<span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">cat</span>(<span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;Genomic inflation factor (λ): &#34;</span>, <span style="color:#a6e22e">round</span>(lambda, <span style="color:#ae81ff">3</span>)))
</span></span></code></pre></div><p><strong>火山图：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">ggplot</span>(gwas, <span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>BETA, y<span style="color:#f92672">=-</span><span style="color:#a6e22e">log10</span>(P))) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_point</span>(<span style="color:#a6e22e">aes</span>(color<span style="color:#f92672">=-</span><span style="color:#a6e22e">log10</span>(P) <span style="color:#f92672">&gt;</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">log10</span>(<span style="color:#ae81ff">5e-8</span>)),
</span></span><span style="display:flex;"><span>               alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.6</span>, size<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">scale_color_manual</span>(values<span style="color:#f92672">=</span><span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;FALSE&#34;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;gray&#34;</span>, <span style="color:#e6db74">&#34;TRUE&#34;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;red&#34;</span>)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_hline</span>(yintercept<span style="color:#f92672">=-</span><span style="color:#a6e22e">log10</span>(<span style="color:#ae81ff">5e-8</span>), linetype<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dashed&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labs</span>(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Effect Size (BETA)&#34;</span>,
</span></span><span style="display:flex;"><span>         y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-log10(P)&#34;</span>,
</span></span><span style="display:flex;"><span>         title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Volcano Plot&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">theme_bw</span>()
</span></span></code></pre></div><p><strong>区域关联图（Locus Zoom）：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># 选择显著信号区域</span>
</span></span><span style="display:flex;"><span>sig_snp <span style="color:#f92672">&lt;-</span> gwas <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">filter</span>(P <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">5e-8</span>) <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">arrange</span>(P) <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">slice</span>(<span style="color:#ae81ff">1</span>)  <span style="color:#75715e"># 最显著的SNP</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>chr <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.character</span>(sig_snp<span style="color:#f92672">$</span>CHR)
</span></span><span style="display:flex;"><span>center_pos <span style="color:#f92672">&lt;-</span> sig_snp<span style="color:#f92672">$</span>BP
</span></span><span style="display:flex;"><span>window <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">500000</span>  <span style="color:#75715e"># 上下各500kb</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 提取区域数据</span>
</span></span><span style="display:flex;"><span>region_data <span style="color:#f92672">&lt;-</span> gwas <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">filter</span>(CHR <span style="color:#f92672">==</span> chr <span style="color:#f92672">&amp;</span> BP <span style="color:#f92672">&gt;=</span> (center_pos <span style="color:#f92672">-</span> window) <span style="color:#f92672">&amp;</span>
</span></span><span style="display:flex;"><span>           BP <span style="color:#f92672">&lt;=</span> (center_pos <span style="color:#f92672">+</span> window))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 绘制区域图</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ggplot</span>(region_data, <span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>BP<span style="color:#f92672">/</span><span style="color:#ae81ff">1000000</span>, y<span style="color:#f92672">=-</span><span style="color:#a6e22e">log10</span>(P))) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_point</span>(color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;steelblue&#34;</span>, size<span style="color:#f92672">=</span><span style="color:#ae81ff">1.5</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_vline</span>(xintercept<span style="color:#f92672">=</span>center_pos<span style="color:#f92672">/</span><span style="color:#ae81ff">1000000</span>,
</span></span><span style="display:flex;"><span>               linetype<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dashed&#34;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;red&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labs</span>(x<span style="color:#f92672">=</span><span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;Position on Chr&#34;</span>, chr, <span style="color:#e6db74">&#34; (Mb)&#34;</span>),
</span></span><span style="display:flex;"><span>         y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-log10(P)&#34;</span>,
</span></span><span style="display:flex;"><span>         title<span style="color:#f92672">=</span><span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;Regional Association Plot (&#34;</span>, <span style="color:#a6e22e">round</span>(center_pos<span style="color:#f92672">/</span><span style="color:#ae81ff">1000000</span>, <span style="color:#ae81ff">2</span>), <span style="color:#e6db74">&#34; Mb)&#34;</span>)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">theme_bw</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用LocusZoom在线工具</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># https://locuszoom.org/</span>
</span></span></code></pre></div><h4 id="67-候选基因鉴定">6.7 候选基因鉴定<a hidden class="anchor" aria-hidden="true" href="#67-候选基因鉴定">#</a></h4>
<p><strong>提取显著SNP附近的基因：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 提取显著SNP</span>
</span></span><span style="display:flex;"><span>awk <span style="color:#e6db74">&#39;NR&gt;1 &amp;&amp; $9 &lt; 5e-8&#39;</span> gwas_result.assoc.txt &gt; significant_snps.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 根据基因组注释文件提取附近基因</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 假设有GFF3格式的注释文件</span>
</span></span><span style="display:flex;"><span>bedtools closest -a significant_snps.bed <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>                -b genes.gff3 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>                -d <span style="color:#ae81ff">100000</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>                &gt; candidate_genes.txt
</span></span></code></pre></div><p><strong>使用BEDTools：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 将SNP转换为BED格式</span>
</span></span><span style="display:flex;"><span>awk <span style="color:#e6db74">&#39;BEGIN{OFS=&#34;\t&#34;} {print $1, $2-1, $2, $3, $4}&#39;</span> significant_snps.txt &gt; snps.bed
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 提取SNP附近的基因（上下各100kb）</span>
</span></span><span style="display:flex;"><span>bedtools window -a snps.bed -b genes.bed -w <span style="color:#ae81ff">100000</span> &gt; snp_genes.txt
</span></span></code></pre></div><p><strong>功能富集分析：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># 使用clusterProfiler进行GO和KEGG富集分析</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(clusterProfiler)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(org.At.tair.db)  <span style="color:#75715e"># 拟南芥注释（大豆需相应数据库）</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 读取候选基因列表</span>
</span></span><span style="display:flex;"><span>genes <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.table</span>(<span style="color:#e6db74">&#34;candidate_genes.txt&#34;</span>, header<span style="color:#f92672">=</span><span style="color:#66d9ef">FALSE</span>)<span style="color:#f92672">$</span>V1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># GO富集分析</span>
</span></span><span style="display:flex;"><span>go_enrich <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">enrichGO</span>(
</span></span><span style="display:flex;"><span>    gene <span style="color:#f92672">=</span> genes,
</span></span><span style="display:flex;"><span>    OrgDb <span style="color:#f92672">=</span> org.At.tair.db,
</span></span><span style="display:flex;"><span>    keyType <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;TAIR&#34;</span>,
</span></span><span style="display:flex;"><span>    ont <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;BP&#34;</span>,
</span></span><span style="display:flex;"><span>    pAdjustMethod <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;BH&#34;</span>,
</span></span><span style="display:flex;"><span>    pvalueCutoff <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.05</span>,
</span></span><span style="display:flex;"><span>    qvalueCutoff <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.10</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 绘图</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">dotplot</span>(go_enrich, showCategory<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">ggtitle</span>(<span style="color:#e6db74">&#34;GO Enrichment&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">barplot</span>(go_enrich, showCategory<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">ggtitle</span>(<span style="color:#e6db74">&#34;GO Enrichment&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">emapplot</span>(go_enrich) <span style="color:#f92672">+</span> <span style="color:#a6e22e">ggtitle</span>(<span style="color:#e6db74">&#34;GO Enrichment&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># KEGG通路分析</span>
</span></span><span style="display:flex;"><span>kegg_enrich <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">enrichKEGG</span>(
</span></span><span style="display:flex;"><span>    gene <span style="color:#f92672">=</span> genes,
</span></span><span style="display:flex;"><span>    organism <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ath&#39;</span>,  <span style="color:#75715e"># 拟南芥</span>
</span></span><span style="display:flex;"><span>    pvalueCutoff <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.05</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">dotplot</span>(kegg_enrich) <span style="color:#f92672">+</span> <span style="color:#a6e22e">ggtitle</span>(<span style="color:#e6db74">&#34;KEGG Pathway Analysis&#34;</span>)
</span></span></code></pre></div><hr>
<h3 id="七其他分析">七、其他分析<a hidden class="anchor" aria-hidden="true" href="#七其他分析">#</a></h3>
<h4 id="71-基因家族分析">7.1 基因家族分析<a hidden class="anchor" aria-hidden="true" href="#71-基因家族分析">#</a></h4>
<p><strong>目的：</strong> 鉴定特定基因家族的成员、进化历史和表达模式</p>
<p><strong>分析流程：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Step 1: 下载目标基因家族的已知蛋白序列</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 从Pfam、InterPro或文献获取</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Step 2: 在大豆基因组中搜索同源基因</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用BLASTP或HMMER</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>blastp -query known_family_proteins.fa <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>       -db soybean_proteome.fa <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>       -evalue 1e-5 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>       -outfmt <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>       -out blast_results.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 或使用HMMER（更准确）</span>
</span></span><span style="display:flex;"><span>hmmbuild gene_family.hmm known_family_alignment.sto
</span></span><span style="display:flex;"><span>hmmsearch --domtblout hmm_results.txt gene_family.hmm soybean_proteome.fa
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Step 3: 提取候选基因序列</span>
</span></span><span style="display:flex;"><span>samtools faidx soybean_proteome.fa <span style="color:#66d9ef">$(</span>awk <span style="color:#e6db74">&#39;{print $1}&#39;</span> blast_results.txt<span style="color:#66d9ef">)</span> &gt; candidate_genes.fa
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Step 4: 多序列比对</span>
</span></span><span style="display:flex;"><span>mafft --auto candidate_genes.fa &gt; candidate_genes_aligned.fa
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Step 5: 构建系统发育树</span>
</span></span><span style="display:flex;"><span>iqtree -s candidate_genes_aligned.fa -m MFP -bb <span style="color:#ae81ff">1000</span> -nt AUTO
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Step 6: 计算Ka/Ks比值</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用KaKs_Calculator</span>
</span></span><span style="display:flex;"><span>KaKs_Calculator -i coding_sequences.fa -o ka_ks_results.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Step 7: 染色体定位</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用基因GFF文件提取位置信息</span>
</span></span><span style="display:flex;"><span>grep -f candidate_genes_list.txt soybean_annotation.gff3 &gt; gene_locations.gff3
</span></span></code></pre></div><p><strong>可视化基因家族：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(ggtree)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(ggplot2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 读取树文件</span>
</span></span><span style="display:flex;"><span>tree <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.tree</span>(<span style="color:#e6db74">&#34;candidate_genes_aligned.fa.treefile&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 绘制系统发育树</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ggtree</span>(tree) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_tiplab</span>(size<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_tippoint</span>(<span style="color:#a6e22e">aes</span>(color<span style="color:#f92672">=</span>group), size<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">theme_tree2</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labs</span>(title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Gene Family Phylogenetic Tree&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 添加热图（表达数据）</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">file.exists</span>(<span style="color:#e6db74">&#34;expression_data.txt&#34;</span>)) {
</span></span><span style="display:flex;"><span>    expr_data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.table</span>(<span style="color:#e6db74">&#34;expression_data.txt&#34;</span>, header<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>, row.names<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gheatmap</span>(tree, expr_data, offset<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, width<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>,
</span></span><span style="display:flex;"><span>             colnames_angle<span style="color:#f92672">=</span><span style="color:#ae81ff">-45</span>, colnames_offset_y<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="72-选择压力分析">7.2 选择压力分析<a hidden class="anchor" aria-hidden="true" href="#72-选择压力分析">#</a></h4>
<p><strong>Ka/Ks比值分析：</strong></p>
<p><strong>定义：</strong></p>
<ul>
<li>Ka：非同义替换率</li>
<li>Ks：同义替换率</li>
<li>Ka/Ks：选择压力指标</li>
</ul>
<p><strong>比值解读：</strong></p>
<table>
  <thead>
      <tr>
          <th>Ka/Ks</th>
          <th>选择类型</th>
          <th>说明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Ka/Ks &lt; 1</td>
          <td>纯化选择</td>
          <td>功能约束，去除有害突变</td>
      </tr>
      <tr>
          <td>Ka/Ks = 1</td>
          <td>中性进化</td>
          <td>无选择压力</td>
      </tr>
      <tr>
          <td>Ka/Ks &gt; 1</td>
          <td>正选择</td>
          <td>适应性进化</td>
      </tr>
  </tbody>
</table>
<p><strong>使用KaKs_Calculator：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 准备输入文件（FASTA格式的编码序列对）</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 格式：&gt;gene1_seq1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#       ATG...</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#       &gt;gene1_seq2</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#       ATG...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 运行KaKs_Calculator</span>
</span></span><span style="display:flex;"><span>KaKs_Calculator -i gene_pairs.fa -o ka_ks_results.txt -m MYN
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 参数说明：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -i: 输入文件</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -o: 输出文件</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -m: 方法（MYN, NG, LWL, MLP等）</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 输出包含：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - Ka, Ks, Ka/Ks</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - 标准误和置信区间</span>
</span></span></code></pre></div><p><strong>使用PAML (codeml)：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 准备必要的文件：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1. 序列比对文件（PHYLIP格式）</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. 树文件（Newick格式）</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. 控制文件（codeml.ctl）</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># codeml.ctl 示例</span>
</span></span><span style="display:flex;"><span>seqfile <span style="color:#f92672">=</span> gene_alignment.phy
</span></span><span style="display:flex;"><span>treefile <span style="color:#f92672">=</span> gene_tree.nwk
</span></span><span style="display:flex;"><span>outfile <span style="color:#f92672">=</span> codeml_results.txt
</span></span><span style="display:flex;"><span>runmode <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>NSsites <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>icode <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 运行codeml</span>
</span></span><span style="display:flex;"><span>codeml codeml.ctl
</span></span></code></pre></div><p><strong>可视化Ka/Ks分布：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(ggplot2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 读取结果</span>
</span></span><span style="display:flex;"><span>ka_ks <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.table</span>(<span style="color:#e6db74">&#34;ka_ks_results.txt&#34;</span>, header<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 绘制Ka/Ks分布直方图</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ggplot</span>(ka_ks, <span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>Ka_Ks)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_histogram</span>(binwidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>, fill<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;steelblue&#34;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;black&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_vline</span>(xintercept<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, linetype<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dashed&#34;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;red&#34;</span>, size<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labs</span>(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Ka/Ks Ratio&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Count&#34;</span>,
</span></span><span style="display:flex;"><span>         title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Distribution of Ka/Ks Ratios&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">theme_bw</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Ka vs Ks散点图</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ggplot</span>(ka_ks, <span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>Ks, y<span style="color:#f92672">=</span>Ka)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_point</span>(alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.6</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_abline</span>(intercept<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, slope<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, linetype<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dashed&#34;</span>,
</span></span><span style="display:flex;"><span>                color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;red&#34;</span>, size<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labs</span>(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Ks (synonymous)&#34;</span>,
</span></span><span style="display:flex;"><span>         y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Ka (nonsynonymous)&#34;</span>,
</span></span><span style="display:flex;"><span>         title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Ka vs Ks Plot&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">theme_bw</span>()
</span></span></code></pre></div><h4 id="73-单倍型分析">7.3 单倍型分析<a hidden class="anchor" aria-hidden="true" href="#73-单倍型分析">#</a></h4>
<p><strong>目的：</strong> 分析基因区域的单倍型组成和频率分布</p>
<p><strong>使用Haploview：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 导入数据</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># File &gt; Import Data &gt; PLINK format</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 自动定义单倍型块</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Blocks &gt; Define Blocks</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 输出LD图和单倍型频率</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># File &gt; Export Plots</span>
</span></span></code></pre></div><p><strong>使用PLINK：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 计算单倍型频率</span>
</span></span><span style="display:flex;"><span>plink --bfile gwas_cleaned <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --blocks no-pheno-req <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --hap-freq <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>      --out haplotype_freq
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 参数说明：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --blocks: 定义单倍型块</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --hap-freq: 输出单倍型频率</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 输出文件：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - haplotype_freq.frq: 单倍型频率</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - haplotype_freq.blocks: 单倍型块定义</span>
</span></span></code></pre></div><p><strong>使用VCFtools：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 提取特定区域</span>
</span></span><span style="display:flex;"><span>vcftools --vcf cohort.vcf.gz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --chr <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --from-bp <span style="color:#ae81ff">1000000</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --to-bp <span style="color:#ae81ff">2000000</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --recode <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>         --out region
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用Haploview或其他软件分析单倍型</span>
</span></span></code></pre></div><h4 id="74-受选择基因功能富集">7.4 受选择基因功能富集<a hidden class="anchor" aria-hidden="true" href="#74-受选择基因功能富集">#</a></h4>
<p><strong>目的：</strong> 确定受选择基因显著富集的功能类别</p>
<p><strong>分析流程：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># 提取受选择区域的基因</span>
</span></span><span style="display:flex;"><span>selected_genes <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.table</span>(<span style="color:#e6db74">&#34;selected_genes.txt&#34;</span>, header<span style="color:#f92672">=</span><span style="color:#66d9ef">FALSE</span>)<span style="color:#f92672">$</span>V1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># GO富集分析</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(clusterProfiler)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(org.At.tair.db)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>go_bp <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">enrichGO</span>(
</span></span><span style="display:flex;"><span>    gene <span style="color:#f92672">=</span> selected_genes,
</span></span><span style="display:flex;"><span>    OrgDb <span style="color:#f92672">=</span> org.At.tair.db,
</span></span><span style="display:flex;"><span>    keyType <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;TAIR&#34;</span>,
</span></span><span style="display:flex;"><span>    ont <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;BP&#34;</span>,
</span></span><span style="display:flex;"><span>    pAdjustMethod <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;BH&#34;</span>,
</span></span><span style="display:flex;"><span>    pvalueCutoff <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.01</span>,
</span></span><span style="display:flex;"><span>    qvalueCutoff <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.05</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 可视化</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">dotplot</span>(go_bp, showCategory<span style="color:#f92672">=</span><span style="color:#ae81ff">25</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ggtitle</span>(<span style="color:#e6db74">&#34;GO Biological Process Enrichment&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">cnetplot</span>(go_bp, showCategory<span style="color:#f92672">=</span><span style="color:#ae81ff">15</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ggtitle</span>(<span style="color:#e6db74">&#34;Gene Concept Network&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">goplot</span>(go_bp) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ggtitle</span>(<span style="color:#e6db74">&#34;GO Relationship&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># KEGG富集</span>
</span></span><span style="display:flex;"><span>kegg <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">enrichKEGG</span>(
</span></span><span style="display:flex;"><span>    gene <span style="color:#f92672">=</span> selected_genes,
</span></span><span style="display:flex;"><span>    organism <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;atha&#39;</span>,
</span></span><span style="display:flex;"><span>    pvalueCutoff <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.05</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">dotplot</span>(kegg, showCategory<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ggtitle</span>(<span style="color:#e6db74">&#34;KEGG Pathway Enrichment&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 比较不同群体受选择基因</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 群体1受选择基因</span>
</span></span><span style="display:flex;"><span>genes_pop1 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.table</span>(<span style="color:#e6db74">&#34;selected_genes_pop1.txt&#34;</span>)<span style="color:#f92672">$</span>V1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 群体2受选择基因</span>
</span></span><span style="display:flex;"><span>genes_pop2 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.table</span>(<span style="color:#e6db74">&#34;selected_genes_pop2.txt&#34;</span>)<span style="color:#f92672">$</span>V1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>go_pop1 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">enrichGO</span>(gene <span style="color:#f92672">=</span> genes_pop1, OrgDb <span style="color:#f92672">=</span> org.At.tair.db,
</span></span><span style="display:flex;"><span>                    ont <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;BP&#34;</span>, pAdjustMethod <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;BH&#34;</span>)
</span></span><span style="display:flex;"><span>go_pop2 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">enrichGO</span>(gene <span style="color:#f92672">=</span> genes_pop2, OrgDb <span style="color:#f92672">=</span> org.At.tair.db,
</span></span><span style="display:flex;"><span>                    ont <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;BP&#34;</span>, pAdjustMethod <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;BH&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 比较富集结果</span>
</span></span><span style="display:flex;"><span>compare <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">compareCluster</span>(gene <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(Population1 <span style="color:#f92672">=</span> genes_pop1,
</span></span><span style="display:flex;"><span>                                      Population2 <span style="color:#f92672">=</span> genes_pop2),
</span></span><span style="display:flex;"><span>                          fun <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;enrichGO&#34;</span>,
</span></span><span style="display:flex;"><span>                          OrgDb <span style="color:#f92672">=</span> org.At.tair.db,
</span></span><span style="display:flex;"><span>                          ont <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;BP&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">dotplot</span>(compare, showCategory<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ggtitle</span>(<span style="color:#e6db74">&#34;GO Enrichment Comparison between Populations&#34;</span>)
</span></span></code></pre></div><hr>
<h2 id="总结">总结<a hidden class="anchor" aria-hidden="true" href="#总结">#</a></h2>
<p>本流程文档详细描述了8000份大豆重测序数据的完整分析pipeline，涵盖了从原始数据到最终发表图表的所有关键步骤：</p>
<h3 id="核心流程">核心流程<a hidden class="anchor" aria-hidden="true" href="#核心流程">#</a></h3>
<ol>
<li><strong>数据质控</strong>：FastQC和fastp确保数据质量</li>
<li><strong>序列比对</strong>：BWA-MEM高效比对到参考基因组</li>
<li><strong>变异检测</strong>：GATK Best Practices流程检测SNP和InDel</li>
<li><strong>变异注释</strong>：ANNOVAR进行功能注释和效应预测</li>
</ol>
<h3 id="高级分析">高级分析<a hidden class="anchor" aria-hidden="true" href="#高级分析">#</a></h3>
<h4 id="群体遗传学分析">群体遗传学分析<a hidden class="anchor" aria-hidden="true" href="#群体遗传学分析">#</a></h4>
<ul>
<li><strong>PCA</strong>：评估群体结构</li>
<li><strong>系统发育树</strong>：重建进化历史</li>
<li><strong>ADMIXTURE</strong>：分析祖先组成</li>
</ul>
<h4 id="选择信号分析">选择信号分析<a hidden class="anchor" aria-hidden="true" href="#选择信号分析">#</a></h4>
<ul>
<li><strong>核苷酸多样性(π)</strong>：遗传多样性评估</li>
<li><strong>FST</strong>：群体分化分析</li>
<li><strong>XP-CLR/XPEHH</strong>：选择信号扫描</li>
<li><strong>Tajima&rsquo;s D</strong>：中性检验</li>
</ul>
<h4 id="全基因组关联分析gwas">全基因组关联分析(GWAS)<a hidden class="anchor" aria-hidden="true" href="#全基因组关联分析gwas">#</a></h4>
<ul>
<li>线性混合模型</li>
<li>多重检验校正</li>
<li>候选基因鉴定</li>
<li>功能富集分析</li>
</ul>
<h3 id="数据可视化">数据可视化<a hidden class="anchor" aria-hidden="true" href="#数据可视化">#</a></h3>
<ul>
<li>曼哈顿图和QQ图（GWAS结果）</li>
<li>LD衰减曲线</li>
<li>PCA图和系统发育树</li>
<li>ADMIXTURE条形图</li>
<li>FST和π分布图</li>
<li>选择信号扫描图</li>
</ul>
<hr>
<p>所有分析方法均提供了详细的命令行示例、参数说明和R语言可视化代码，可直接应用于实际数据分析。该流程适用于大豆及其他作物的重测序数据分析，为遗传学研究和分子育种提供了完整的技术方案。</p>


      </div>
      
      
      <footer class="post-footer">
        <ul class="post-tags">
          <li><a href="https://Tdxxxx-student.github.io/tags/%E9%87%8D%E6%B5%8B%E5%BA%8F">重测序</a></li>
          <li><a href="https://Tdxxxx-student.github.io/tags/gwas">GWAS</a></li>
          <li><a href="https://Tdxxxx-student.github.io/tags/%E5%8F%98%E5%BC%82%E6%A3%80%E6%B5%8B">变异检测</a></li>
        </ul>
      </footer></article>

    
    <aside class="sidebar-right">
      <div class="toc-card">
        <div class="toc-title">
          <span class="toc-icon">📖</span> 目录
        </div>
        <nav id="TableOfContents">
          <nav id="TableOfContents">
  <ul>
    <li><a href="#目录">目录</a></li>
    <li><a href="#分析流程总览">分析流程总览</a>
      <ul>
        <li><a href="#整体流程架构">整体流程架构</a></li>
      </ul>
    </li>
    <li><a href="#数据分析具体流程">数据分析具体流程</a>
      <ul>
        <li><a href="#一数据质控">一、数据质控</a></li>
        <li><a href="#二序列比对">二、序列比对</a></li>
        <li><a href="#三变异检测">三、变异检测</a></li>
        <li><a href="#四变异注释">四、变异注释</a></li>
      </ul>
    </li>
    <li><a href="#图表制作">图表制作</a>
      <ul>
        <li><a href="#一群体遗传学分析">一、群体遗传学分析</a></li>
        <li><a href="#二连锁不平衡分析">二、连锁不平衡分析</a></li>
        <li><a href="#三核苷酸多样性分析">三、核苷酸多样性分析</a></li>
        <li><a href="#四固定指数-fst">四、固定指数 (FST)</a></li>
        <li><a href="#五选择清除分析">五、选择清除分析</a></li>
        <li><a href="#六全基因组关联分析-gwas">六、全基因组关联分析 (GWAS)</a></li>
        <li><a href="#七其他分析">七、其他分析</a></li>
      </ul>
    </li>
    <li><a href="#总结">总结</a>
      <ul>
        <li><a href="#核心流程">核心流程</a></li>
        <li><a href="#高级分析">高级分析</a></li>
        <li><a href="#数据可视化">数据可视化</a></li>
      </ul>
    </li>
  </ul>
</nav>
        </nav>
      </div>
    </aside>

  </div>
</div>


<script>
  document.addEventListener('DOMContentLoaded', () => {
    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        const id = entry.target.getAttribute('id');
        if (entry.intersectionRatio > 0) {
          document.querySelectorAll('.toc-card li a').forEach(link => {
            link.classList.remove('active');
          });
          const activeLink = document.querySelector(`.toc-card li a[href="#${id}"]`);
          if (activeLink) {
            activeLink.classList.add('active');
          }
        }
      });
    });
    document.querySelectorAll('h1[id], h2[id], h3[id], h4[id]').forEach((section) => {
      observer.observe(section);
    });
  });
</script>
    </main>
    
<footer class="footer">
        <span>tdx0307</span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>
<a href="/search/" class="search-fab" title="搜索 (Ctrl+F)">🔍</a>

<style>
.search-fab {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    width: 50px;
    height: 50px;
    background: var(--primary);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3rem;
    text-decoration: none;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
    z-index: 100;
}

.search-fab:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
}

@media (max-width: 768px) {
    .search-fab {
        bottom: 1rem;
        right: 1rem;
        width: 45px;
        height: 45px;
    }
}
</style>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
